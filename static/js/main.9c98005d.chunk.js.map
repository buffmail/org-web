{"version":3,"sources":["components/HeaderBar/org-web.svg","components/SyncServiceSignIn/dropbox.svg","components/SyncServiceSignIn/google_drive.png","middleware/google_analytics_logging.js","actions/base.js","lib/timestamps.js","lib/export_org.js","lib/capture_template_substitution.js","lib/id_generator.js","lib/org_utils.js","lib/sample_capture_templates.js","actions/org.js","middleware/live_sync.js","middleware/sync_on_becoming_visible.js","actions/capture.js","util/settings_persister.js","reducers/base.js","lib/parse_org.js","reducers/org.js","reducers/capture.js","reducers/index.js","reducers/sync_backend.js","store.js","migrations/index.js","migrations/migrate_access_token_to_dropbox_access_token.js","migrations/migrate_store_in_dropbox_to_store_in_sync_backend.js","util/parse_query_string.js","actions/sync_backend.js","sync_backend_clients/dropbox_sync_backend_client.js","sync_backend_clients/google_drive_sync_backend_client.js","components/PrivacyPolicy/index.js","components/HeaderBar/index.js","components/Landing/index.js","components/FileBrowser/index.js","components/LoadingIndicator/index.js","components/OrgFile/components/AttributedString/components/TablePart/TableActionDrawer/index.js","components/OrgFile/components/AttributedString/components/TablePart/index.js","lib/color.js","components/UI/Checkbox/index.js","components/OrgFile/components/AttributedString/components/ListPart/ListActionDrawer/index.js","components/OrgFile/components/AttributedString/components/ListPart/index.js","components/OrgFile/components/AttributedString/components/TimestampPart/index.js","components/OrgFile/components/AttributedString/index.js","components/OrgFile/components/TitleLine/index.js","components/OrgFile/components/HeaderContent/components/PlanningItems/index.js","components/OrgFile/components/HeaderContent/components/PropertyListItems/index.js","components/OrgFile/components/HeaderContent/index.js","components/OrgFile/components/Header/components/HeaderActionDrawer/index.js","components/OrgFile/components/Header/index.js","components/OrgFile/components/HeaderList/index.js","components/OrgFile/components/ActionDrawer/components/ActionButton/index.js","components/OrgFile/components/ActionDrawer/index.js","components/UI/Switch/index.js","components/UI/Drawer/index.js","components/OrgFile/components/CaptureModal/index.js","components/OrgFile/components/SyncConfirmationModal/index.js","components/OrgFile/components/TagsEditorModal/index.js","components/UI/TabButtons/index.js","components/OrgFile/components/TimestampEditorModal/components/TimestampEditor/index.js","components/OrgFile/components/TimestampEditorModal/index.js","components/OrgFile/components/PropertyListEditorModal/index.js","components/OrgFile/components/AgendaModal/components/AgendaDay/index.js","components/OrgFile/components/AgendaModal/index.js","lib/keybindings.js","components/OrgFile/index.js","components/Settings/index.js","components/KeyboardShortcutsEditor/components/ShortcutRow/index.js","components/KeyboardShortcutsEditor/index.js","components/CaptureTemplatesEditor/components/CaptureTemplate/index.js","components/CaptureTemplatesEditor/index.js","components/SyncServiceSignIn/index.js","components/Entry/index.js","App.js","registerServiceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","google_analytics_logging","store","next","action","type","payload","Object","objectWithoutProperties","eventFieldsToRedact","SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING","AUTHENTICATE","DISPLAY_FILE","forEach","field","objectSpread","defineProperty","ga","JSON","stringify","setLoadingMessage","loadingMessage","hideLoadingMessage","setIsLoading","isLoading","setDisappearingLoadingMessage","delay","dispatch","setTimeout","setLastViewedFile","lastViewedPath","lastViewedContents","loadStaticFile","staticFile","getState","org","present","get","displayFile","changelog","sample","unloadStaticFile","stopDisplayingFile","base","setFontSize","newFontSize","setBulletStyle","newBulletStyle","setShouldTapTodoToAdvance","newShouldTapTodoToAdvance","setAgendaDefaultDeadlineDelayUnit","newAgendaDefaultDeadlineDelayUnit","setAgendaDefaultDeadlineDelayValue","newAgendaDefaultDeadlineDelayValue","setShouldLiveSync","shouldLiveSync","setShouldSyncOnBecomingVisibile","shouldSyncOnBecomingVisibile","setShouldStoreSettingsInSyncBackend","newShouldStoreSettingsInSyncBackend","client","syncBackend","deleteFile","catch","doesFileNotExist","error","alert","concat","deleteFileByNameAndParent","window","previousSettingsFileContents","setHasUnseenChangelog","newHasUnseenChangelog","setLastSeenChangelogHeader","newLastSeenChangelogHeader","setCustomKeybinding","keybindingName","keybinding","restoreBaseSettings","newSettings","pushModalPage","modalPage","popModalPage","clearModalStack","activatePopup","popupType","data","closePopup","renderAsText","timestamp","_timestamp$toJS","toJS","isActive","year","month","day","dayName","startHour","startMinute","endHour","endMinute","repeaterType","repeaterValue","repeaterUnit","delayType","delayValue","delayUnit","timestampText","getCurrentTimestamp","_ref","arguments","length","undefined","_ref$isActive","_ref$withStartTime","withStartTime","time","Date","formatDate","getCurrentTimestampAsText","dateForTimestamp","_timestamp$toJS2","timestampString","padStart","parseDate","addTimestampUnitToDate","date","numUnits","timestampUnit","h","addHours","d","addDays","w","addWeeks","m","addMonths","y","addYears","formattedAttributedStringText","parts","map","part","getIn","join","attributedStringToRawText","prevPartTypes","unshift","zip","linkPart","_ref2","slicedToArray","prevPartType","text","tablePart","rowHeights","row","Math","max","apply","toConsumableArray","cell","_","countBy","numColumns","size","columnWidths","times","columnIndex","content","lineLengths","split","line","trim","dropRight","flatten","rowIndex","rowHeight","contentRows","lineIndex","formattedLineLengths","padCount","repeat","contentRow","separator","columnWidth","tablePartToRawText","listPart","bulletCharacter","previousNumber","item","optionalLeadingSpace","titleText","contentText","indentedContentText","listItemText","number","forceNumber","stateCharacter","checked","unchecked","partial","listPartToRawText","timestampPartToRawText","console","includes","capture_template_substitution","templateString","customVariables","Map","substitutions","%t","%T","%u","%U","entrySeq","key","value","substitutedString","entries","_ref3","_ref4","formatString","replace","RegExp","cursorIndex","indexOf","id_generator","nextId","indexOfHeaderWithId","headers","headerId","findIndex","header","headerWithId","subheadersOfHeaderWithId","headerIndex","afterHeaders","slice","nextSiblingHeaderIndex","siblingHeader","numSubheadersOfHeaderWithId","parentIdOfHeaderWithId","parentHeader","reverse","find","previousHeader","isHeaderVisible","parentHeaderId","openDirectParent","state","i","directParentIdOfHeaderWithId","parentHeaderIndex","setIn","headerWithPath","headerPath","firstHeader","first","skip","tablePartContainsCellId","cellId","some","headerThatContainsTableCellId","doesAttributedStringContainTableCellId","filter","pathAndPartOfTimestampItemWithIdInAttributedString","timestampId","partIndex","path","timestampPart","itemIndex","pathAndPart","result","cellIndex","pathAndPartOfListContainingItemIdInAttributedString","itemId","listPartContainsItemId","pathAndPartOfListItemWithIdInHeaders","listItemId","pathAndPartOfListItemWithIdInAttributedString","listItemPart","pathAndPartOfTableContainingCellIdInHeaders","pathAndPartOfTableContainingCellIdInAttributedString","updateTableContainingCellId","updaterCallbackGenerator","_pathAndPartOfTableCo","rowIndexContainingCellId","columnIndexContainingCellId","updateIn","updateListContainingListItemId","_pathAndPartOfListCon","pathAndPartOfListContainingItemIdInHeaders","itemIndexContainingId","updateContentsWithListItemAddition","listItem","insert","set","generateId","List","fromJS","id","items","numberTerminatorCharacter","isOrdered","update","push","timestampWithIdInAttributedString","todoKeywordSetForKeyword","todoKeywordSets","keyword","keywordSet","contains","description","headerPaths","iconName","isAvailableInAllOrgFiles","letter","orgFilesWhereAvailable","shouldPrepend","template","isSample","contents","setLastSyncAt","lastSyncAt","ActionTypes","CLEAR_HISTORY","unfocusHeader","sync","_ref$forceAction","forceAction","_ref$successMessage","successMessage","_ref$shouldSuppressMe","shouldSuppressMessages","setOrgFileErrorMessage","getFileContentsAndMetadata","then","lastModifiedAt","isDirty","lastServerModifiedAt","isAfter","updateFile","fileConfigLines","linesBeforeHeadings","configContent","todoKeywordSet","nestingLevel","titleLine","todoKeyword","rawTitle","tags","tag","planningItems","planningItemsContent","planningItem","trimRight","propertyListItems","propertyListItem","property","rawDescription","startsWith","exportOrg","setDirty","addSeconds","toString","applyOpennessState","openHeader","toggleHeaderOpened","selectHeader","setSelectedTableCellId","setSelectedListItemId","selectHeaderAndOpenParents","advanceTodoState","dirtying","enterEditMode","editModeType","exitEditMode","updateHeaderTitle","newRawTitle","updateHeaderDescription","newRawDescription","addHeader","selectNextSiblingHeader","addHeaderAndEdit","selectNextVisibleHeader","selectPreviousVisibleHeader","removeHeader","moveHeaderUp","moveHeaderDown","moveHeaderLeft","moveHeaderRight","moveSubtreeLeft","moveSubtreeRight","focusHeader","noOp","addNewTableRow","removeTableRow","addNewTableColumn","removeTableColumn","moveTableRowDown","moveTableRowUp","moveTableColumnLeft","moveTableColumnRight","updateTableCellValue","newValue","insertCapture","templateId","capture","sampleCaptureTemplates","clearPendingCapture","insertPendingCapture","pendingCapture","templateName","captureContent","customCaptureVariables","history","pushState","location","pathname","_substituteTemplateVa","substituteTemplateVariables","_substituteTemplateVa2","substitutedTemplate","initialCursorIndex","substring","advanceCheckboxState","updateListTitleValue","updateListContentsValue","addNewListItem","selectNextSiblingListItem","addNewListItemAndEdit","removeListItem","moveListItemUp","moveListItemDown","moveListItemLeft","moveListItemRight","moveListSubtreeLeft","moveListSubtreeRight","setHeaderTags","reorderTags","fromIndex","toIndex","reorderPropertyList","updateTimestampWithId","newTimestamp","updatePlanningItemTimestamp","planningItemIndex","addNewPlanningItem","planningType","updatePropertyListItems","newPropertyListItems","message","live_sync","debouncedDispatchSync","debounce","sync_on_becoming_visible","addEventListener","addNewEmptyCaptureTemplate","updateTemplateFieldPathValue","fieldPath","addNewTemplateOrgFileAvailability","removeTemplateOrgFileAvailability","orgFileAvailabilityIndex","addNewTemplateHeaderPath","removeTemplateHeaderPath","headerPathIndex","deleteTemplate","restoreCaptureSettings","reorderCaptureTemplate","isLocalStorageAvailable","localStorage","setItem","getItem","e","debouncedPushConfigToSyncBackend","syncBackendClient","createFile","maxWait","persistableFields","category","name","shouldStoreInConfig","default","getFieldsToPersist","fields","depreacted","getConfigFileContents","fieldsToPersist","fromPairs","readInitialState","initialState","past","future","parse","templates","opennessState","opennessStateJSONString","readOpennessState","loadSettingsFromConfigFile","fileContentsPromise","getFileContents","getFileContentsByNameAndParent","configFileContents","config","_error","subscribeToChanges","settingsFileContents","currentFilePath","openHeaderPaths","getOpenHeaderPaths","openedHeaders","_loop","_i","title","subheaders","openSubheaderPaths","openedSubheaderPath","persistField","getPersistedField","nullable","applyCategorySettingsFromConfig","markupAndCookieRegex","timestampRegex","timestampFromRegexMatch","match","partIndices","_partIndices$map","_partIndices$map2","typeBracket","timeStart","timeEnd","firstDelayRepeatType","firstDelayRepeatValue","firstDelayRepeatUnit","secondDelayRepeatType","secondDelayRepeatValue","secondDelayRepeatUnit","parseMarkupAndCookies","rawText","_ref5","_ref5$shouldAppendNew","shouldAppendNewline","matches","excludeCookies","exec","uri","index","percentCookieMatch","percentage","fractionCookieMatch","fraction","markupType","~","*","/","+","=","markupPrefixLength","firstTimestamp","range","secondTimestamp","lineParts","startIndex","trailingText","parseTable","tableLines","table","columnProperties","lastRow","last","lineCells","substr","cellContents","rawContents","maxNumColumns","parseRawText","_ref6$excludeContentE","excludeContentElements","lines","LIST_HEADER_REGEX","currentListHeaderNestingLevel","rawLineParts","numLeadingSpaces","processedLineParts","linePart","takeWhile","contentLines","checkboxState","isCheckbox"," ","X","-","newListItem","lastIndex","parseDescriptionPrefixElements","planningItemsParse","singlePlanningItemRegex","concatRegexes","optionalSinglePlanningItemRegex","planningRegex","planningMatch","planningTypeIndex","strippedDescription","_parsePlanningItems","propertyListParse","propertiesLineIndex","endLineIndex","parsePropertyList","defaultKeywordSets","keywords","completedKeywords","parseTitleLine","flatMap","endsWith","titleParts","possibleTags","test","newHeaderWithTitle","opened","_len","regexes","Array","_key","reduce","prev","curr","parseOrg","fileContents","keywordTokens","pipeIndex","configLine","_parseDescriptionPref2","updateCookiesInAttributedStringWithChildCompletionStates","completionStates","doneCount","isDone","totalCount","floor","updateCookiesOfHeaderWithId","directChildren","subheader","updateCookiesOfParentOfHeaderWithId","currentTodoState","currentTodoSet","newStateIndex","newTodoState","indexedPlanningItemsWithRepeaters","currentDate","newDate","isBefore","applyRepeater","lastRepeatTimestamp","newLastRepeatValue","nextVisibleHeader","nextVisibleHeaderAfterIndex","previousVisibleHeader","previousVisibleHeaderAfterIndex","fileOpennessState","openHeaderPath","openHeaderWithPath","maxNestingLevel","firstTitle","rest","take","takeLast","updateDescriptionOfHeaderContainingTableCell","selectedTableCellId","rows","newEmptyTableRowLikeRows","_rowIndex","colIndex","isTopLevelTarget","newHeader","_parseDescriptionPref","newHeaderFromText","numSubheaders","newIndex","newCheckboxState","updateParentListCheckboxes","itemPath","parentListItemPath","parentListItem","has","childrenCheckedStates","checkboxItem","every","childCompletionStates","updateDescriptionOfHeaderContainingListItem","selectedListItemId","newItem","containingHeader","headerThatContainsListItemId","delete","selectedListItem","selectedListItemIndex","partOfPath","parentListItemWithIdInHeaders","_item","_pathAndPart2","_pathAndPart3","propertyListItemIndex","plistPathAndPart","indexOfTemplateWithId","captureTemplates","applyCaptureSettingsFromConfig","combineReducers","stack","pop","signOut","listing","directoryListing","hasMore","additionalSyncBackendState","setCurrentFileBrowserDirectoryListing","currentFileBrowserDirectoryListing","isLoadingMore","setIsLoadingMoreDirectoryListing","undoable","parsedFile","isOpened","openParentsOfHeader","newTitleLine","nextSibling","numHeadersToRemove","previousSiblingIndex","indexOfPreviousSibling","nextSiblingIndex","nextSiblingSubheaders","previousParentHeaderId","counter","prevSiblingItemIndex","prevSiblingItemContentsPath","childrenListParts","selectedHeaderId","splice","newPlanningItem","includeAction","linearizeHistory","templateIndex","orgFiles","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","src_store","createStore","rootReducer","applyMiddleware","thunk","googleAnalyticsLogger","liveSync","syncOnBecomingVisible","migrations","accessToken","removeItem","migrateAccessTokenToDropboxAccessToken","shouldStoreSettingsInDropbox","migrateStoreInDropboxToStoreInSyncBackend","parseQueryString","str","ret","create","param","shift","val","decodeURIComponent","isArray","token","gapi","getToken","google","accounts","oauth2","revoke","setToken","reload","getDirectoryListing","log","status","authURL","Dropbox","clientId","process","fetch","getAuthenticationUrl","origin","loadMoreDirectoryListing","getMoreDirectoryListing","extendedListing","pushBackup","pathOrFileId","duplicateFile","fileName","downloadFile","dropbox_sync_backend_client","dropboxClient","transformDirectoryListing","entry","isDirectory","path_display","uploadFile","Promise","resolve","reject","filesUpload","mode",".tag","autorename","filesDownload","response","reader","FileReader","server_modified","readAsText","fileBlob","isSignedIn","filesListFolder","has_more","cursor","filesListFolderContinue","filesDelete","google_drive_sync_backend_client","getAPIClient","isInited","isIniting","afterInitCallbacks","load","init","apiKey","discoveryDocs","asyncToGenerator","regenerator_default","a","mark","_callee","googleDriveAccessTokenString","googleDriveAccessToken","wrap","_context","initTokenClient","client_id","scope","callback","requestAccessToken","prompt","stop","handleGoogleDriveClientLoad","getFiles","directoryId","nextPageToken","fileListPromise","drive","files","list","pageSize","q","pageToken","mimeType","currentDirectoryId","fileParentPromise","fileId","parents","rootFolderIdPromise","rootFolderId","all","parentId","directoryParentId","fileIdByNameAndParent","method","Authorization","auth","access_token","body","alt","escape","errors","reason","fileModifiedTimePromise","modifiedTime","_ref6","fileNameCallback","getResponse","newFileName","backupFileId","makeCopy","copy","copyResponse","listResponse","PrivacyPolicy","react_default","createElement","className","HeaderBar","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","bindAll","assertThisInitialized","_this$props","syncBackendType","directoryPath","pathParts","parentDirectoryName","parentPath","Link","to","filePath","src","logo","width","height","onClick","handleSettingsSubPageBackClick","activeModalPage","renderSettingsSubPageBackButton","getPathRoot","renderLogo","renderFileBrowserBackButton","renderOrgFileBackButton","renderSampleFileBackButton","renderSignInBackButton","titleContainerWithText","isUndoEnabled","undo","_this$props2","isAuthenticated","hasUnseenChangelog","handleModalPageDoneClick","undoIconClassName","classNames","header-bar__actions__item--disabled","settingsIconClassName","settings-icon--has-unseen-changelog","href","target","rel","react","handleUndoClick","handleHelpClick","handleSettingsClick","header-bar--with-logo","renderBackButton","renderTitle","renderActions","PureComponent","withRouter","connect","bindActionCreators","baseActions","undoActions","Landing","syncBackendActions","useEffect","isTopLevelDirectory","getParentDirectoryPath","file","isBackupFile","isOrgFile","isSettingsFile","iconClass","fa-folder","file-browser__file-list__icon--directory","fa-file","file-browser__file-list__icon--not-org","fa-copy","fa-cogs","LoadingIndicator","_useState","useState","_useState2","shouldRenderIndicator","setShouldRenderIndicator","_useState3","_useState4","lastMessage","setLastMessage","handleClick","style","opacity","spring","stiffness","react_motion","onRest","TableActionDrawer","_ref$subPartDataAndHa","subPartDataAndHandlers","onEnterTableEditMode","onAddNewTableRow","onRemoveTableRow","onAddNewTableColumn","onRemoveTableColumn","TablePart","rawCellValues","generateCellValueMap","shouldIgnoreBlur","prevProps","_this$props$subPartDa","onTableCellValueUpdate","inTableEditMode","setState","_this2","onTableCellSelect","_this3","onExitTableEditMode","event","cellValue","insertionIndex","textarea","selectionStart","selectionEnd","focus","_this4","_this$props$subPartDa2","shouldDisableActions","isTableSelected","isCellSelected","table-part__cell--selected","handleCellSelect","autoFocus","onBlur","handleTextareaBlur","onChange","handleCellChange","ref","handleTextareaRef","handleInsertTimestamp","AttributedString","react_collapse_lib","interpolateColors","colorA","colorB","interpolationFactor","r","parseInt","g","b","rgbaObject","rgbaString","rgba","Checkbox","uncheckedColor","checkedColor","checkboxStyle","colorFactor","backgroundColor","ListActionDrawer","onEnterListTitleEditMode","onEnterListContentsEditMode","onAddNewListItem","onRemoveListItem","ListPart","listTitleValues","generateListTitleValueMap","listContentsValues","generateListContentsValueMap","onListTitleValueUpdate","onListContentsValueUpdate","inListTitleEditMode","inListContentsEditMode","_this$state","prevSelectedListItemId","onListItemSelect","onCheckboxClick","onExitListTitleEditMode","listTitleValue","listContentsValue","_this5","_this$state2","isItemSelected","lineContainerClass","list-part__not_checkbox-container","list-part__checkbox-container","list-part__item--selected","handleListItemSelect","handleCheckboxClick","handleListTitleChange","handleInsertTimestampListTitle","handleListContentsChange","handleInsertTimestampListContents","renderContent","TimestampPart","onTimestampClick","attributed-string__cookie-part--complete","TablePart_TablePart","ListPart_ListPart","TitleLine","titleValue","calculateRawTitle","containerWidth","containerDiv","offsetWidth","storeContainerWidth","inEditMode","div","span","titleSpan","hasContent","isSelected","shouldTapTodoToAdvance","stopPropagation","newTitle","lastCharacter","_this$props3","color","shouldDisableExplicitWidth","titleStyle","wordBreak","handleTitleClick","handleRef","toLowerCase","handleTodoClick","handleTitleChange","handleTitleFieldClick","handleTitleSpanRef","handleTimestampClick","toSet","toList","orgActions","PlanningItems","PropertyListItems","onEdit","isDrawerCollapsed","setIsDrawerCollapsed","HeaderContent","descriptionValue","calculateRawDescription","planningItemsText","propertyListItemsText","descriptionText","handleDescriptionChange","PlanningItems_PlanningItems","handlePlanningItemTimestampClick","handlePropertyListEdit","handleTableCellSelect","handleExitTableEditMode","handleTableCellValueUpdate","handleEnterTableEditMode","handleAddNewTableRow","handleRemoveTableRow","handleAddNewTableColumn","handleRemoveTableColumn","handleEnterListTitleEditMode","handleExitListTitleEditMode","handleListTitleValueUpdate","handleEnterListContentsEditMode","onExitListContentsEditMode","handleExitListContentsEditMode","handleListContentsValueUpdate","handleAddNewListItem","handleRemoveListItem","HeaderActionDrawer","onEnterTitleEditMode","onEnterDescriptionEditMode","onTagsClick","isFocused","onFocus","onUnfocus","onAddNewHeader","onDeadlineClick","onScheduledClick","iconWithFFClickCatcher","Header","SWIPE_ACTION_ACTIVATION_DISTANCE","FREE_DRAG_ACTIVATION_DISTANCE","isDraggingFreely","dragStartX","dragStartY","currentDragX","isPlayingRemoveAnimation","heightBeforeRemove","onRef","dragX","dragY","closest","abs","swipeDistance","offsetHeight","handleDragStart","clientX","clientY","handleDragMove","handleDragEnd","handleDragCancel","changedTouches","classList","existingDeadlinePlanningItemIndex","handleDeadlineAndScheduledClick","bulletStyle","focusedHeader","indentLevel","_this$state3","paddingLeft","marginLeft","heightFactor","header--selected","header--removing","handleRest","interpolatedStyle","swipedDistance","isLeftActionActivated","isRightActionActivated","disabledColor","leftActivatedColor","rightActivatedColor","leftSwipeActionContainerStyle","backgroundColorFactor","rightSwipeActionContainerStyle","leftIconStyle","display","rightIconStyle","headerStyle","handleHeaderClick","onMouseDown","handleMouseDown","onMouseMove","handleMouseMove","onMouseUp","handleMouseUp","onMouseOut","handleMouseOut","onTouchStart","handleTouchStart","onTouchMove","handleTouchMove","onTouchEnd","handleTouchEnd","onTouchCancel","handleTouchCancel","leftInterpolatedStyle","leftStyle","rightInterpolatedStyle","rightStyle","components_TitleLine","springConfig","marginRight","HeaderActionDrawer_HeaderActionDrawer","handleEnterTitleEditMode","handleEnterDescriptionEditMode","handleShowTagsModal","handleFocus","handleUnfocus","handleAddNewHeader","handleDeadlineClick","handleScheduledClick","components_HeaderContent","HeaderList","headerRefs","selectedHeaderDiv","boundingRectangle","getBoundingClientRect","viewportHeight","document","documentElement","clientHeight","top","bottom","scrollIntoView","focusedHeaderId","headerRenderData","displayed","toArray","headerRenderDatum","previousRenderDatum","followingHeaders","followingHeaderIndex","followingHeader","focusedHeaderIndex","headerColors","displayedHeaderRenderData","header-list-container--focused","components_Header","handleHeaderRef","ActionButton","isDisabled","_classNames","subIconName","shouldRotateSubIcon","additionalClassName","tooltip","shouldSpinSubIcon","fas","fa-lg","subIconClassName","action-drawer__btn__sub-icon--rotated","fa-spin","isFocusedHeaderActive","captureActions","shouldDisableSyncButtons","isDisplayingArrowButtons","setIsDisplayingArrowButtons","isDisplayingCaptureButtons","setIsDisplayingCaptureButtons","querySelector","paddingBottom","mainArrowButton","useRef","mainArrowButtonBoundingRect","useMemo","current","handleUpClick","handleDownClick","handleLeftClick","handleRightClick","handleMoveSubtreeLeftClick","handleMoveSubtreeRightClick","getAvailableCaptureTemplates","availablePath","handleMainArrowButtonClick","handleMainCaptureButtonClick","ActionButton_ActionButton","baseArrowButtonStyle","boxShadow","centerXOffset","screen","x","animatedStyles","topRowYOffset","bottomRowYOffset","firstColumnXOffset","secondColumnXOffset","subIconNameStr","tooltipUpStr","tooltipDownStr","tooltipLeftStr","tooltipRightStr","left","right","renderMovementButtons","availableCaptureTemplates","baseCaptureButtonStyle","position","zIndex","mainButtonStyle","animatedStyle","renderCaptureButtons","UI_Switch","isEnabled","onToggle","enabledColor","switchStyle","grabberStyle","Drawer","children","shouldIncludeCloseButton","onClose","isVisible","setIsVisible","dragOffsetY","setDragOffsetY","useLayoutEffect","initialClientY","innerContainer","innerContainerHeight","handleInnerContainerClick","handleClose","targetTouches","isScrollingDown","scrollHeight","scrollTop","preventDefault","handleTouchEndOrCancel","removeEventListener","outerClassName","drawer-outer-container--visible","innerStyle","offsetY","innerHeight","transform","CaptureModal","onCapture","_useMemo","_useMemo2","targetHeader","textareaValue","setTextareaValue","setShouldPrepend","capture-modal-header-path--top-level","SyncConfirmationModal","onPull","onPush","onCancel","distanceInWordsToNow","TagsEditorModal","allTags","prevTags","currentTags","lastTextfield","tagIndex","newTag","headerTags","react_beautiful_dnd_esm","droppableId","provided","snapshot","assign","innerRef","droppableProps","draggableId","tag-container--dragging","isDragging","draggableProps","handleTagChange","textfield","handleRemoveTag","dragHandleProps","placeholder","handleAddNewTag","all-tags__tag--in-use","handleExistingTagClick","TabButtons","buttons","selectedButton","useEqualWidthTabs","onSelect","handleButtonClick","buttonName","containerClassName","tab-buttons--equal-width-tabs","gridTemplateColumns","tab-buttons__btn--selected","TimestampEditor","_formatDate$split","_formatDate$split2","newYear","newMonth","newDay","newDayName","startOrEnd","_this2$props","hourKey","minuteKey","_formatDate$split3","_formatDate$split4","hour","minute","_this3$props","_this4$props","_event$target$value$s","_event$target$value$s2","newRepeaterType","_this$props4","_this$props5","newRepeaterUnit","_this$props6","_this$props7","_this$props8","newDelayType","_this$props9","_this$props10","newDelayUnit","_this$props11","label","timeKey","showRemoveButton","handleTimeChange","handleRemoveTime","handleAddTime","_this$props$timestamp","handleRepeaterTypeChange","min","handleRepeaterValueChange","handleRepeaterUnitChange","handleRemoveRepeater","handleAddRepeater","_this$props$timestamp2","handleDelayTypeChange","handleDelayValueChange","handleDelayUnitChange","handleRemoveDelay","handleAddDelay","handleActiveToggle","handleDateChange","renderTimeField","renderRepeater","renderDelay","TimestampEditorModal","singleTimestampOnly","TimestampEditor_TimestampEditor","handleChange","handleRemoveEndTimestamp","handleAddEndTimestamp","PropertyListEditorModal","prevItems","currentItems","propertyListItemId","property-list-editor__item-container--dragging","handlePropertyChange","handleValueChange","handleRemoveItem","handleAddNewItem","AgendaDay","onHeaderClick","dateDisplayType","onToggleDateDisplayType","agendaDefaultDeadlineDelayValue","agendaDefaultDeadlineDelayUnit","dateStart","startOfDay","dateEnd","endOfDay","planningItemsAndHeaders","planningItemDate","isTodoKeywordCompleted","isToday","appearDate","subHours","subDays","subWeeks","subMonths","subYears","subtractTimestampUnitFromDate","isEqual","isWithinRange","hasBeenRepeated","sortBy","_planningItem$get$toJ","hasTodoKeyword","dateClassName","agenda-day__header-planning-date--overdue","isPast","AgendaModal","selectedDate","timeframeType","weekStart","startOfWeek","weekEnd","_this$state4","dates","daysAfter","monthStart","startOfMonth","getDaysInMonth","handleTimeframeTypeChange","handlePreviousDateClick","calculateTimeframeHeader","handleNextDateClick","AgendaDay_AgendaDay","handleToggleDateDisplayType","DEFAULT_BINDINGS","calculateNamedKeybindings","customKeybindings","bindingName","binding","OrgFile","hasUncaughtError","loadedPath","container","newTags","activePopupData","popupData","activePopupType","selectedHeader","handleSyncConfirmationPull","handleSyncConfirmationPush","handleSyncConfirmationCancel","handleCapture","handlePopupClose","TagsEditorModal_TagsEditorModal","OrderedSet","sort","handleTagsChange","editingTimestamp","timestampWithId","TimestampEditorModal_TimestampEditorModal","handleTimestampChange","PropertyListEditorModal_PropertyListEditorModal","handlePropertyListItemsChange","components_AgendaModal","shouldDisableDirtyIndicator","parsingErrorMessage","orgFileErrorMessage","Redirect","keyMap","bindingAction","calculateActionedKeybindings","preventDefaultAndHandleEditMode","ignoreInEditMode","activeElement","nodeName","handlers","handleSelectNextVisibleHeaderHotKey","handleSelectPreviousVisibleHeaderHotKey","handleToggleHeaderOpenedHotKey","advanceTodo","handleAdvanceTodoHotKey","editTitle","handleEditTitleHotKey","editDescription","handleEditDescriptionHotKey","handleExitEditModeHotKey","handleAddHeaderHotKey","handleRemoveHeaderHotKey","handleMoveHeaderUpHotKey","handleMoveHeaderDownHotKey","handleMoveHeaderLeftHotKey","handleMoveHeaderRightHotKey","handleUndoHotKey","index_es","tabIndex","handleContainerRef","components_HeaderList","components_ActionDrawer","renderActivePopup","activePopup","fontSize","shouldStoreSettingsInSyncBackend","confirm","ShortcutRow","isEditMode","rebindArea","handleKeyPress","code","Minus","Equal","Backspace","Enter","Return","Tab","BracketLeft","BracketRight","Semicolon","Quote","Backslash","Comma","Period","Slash","newModifiers","modifier","newBinding","onBindingChange","currentBinding","symbol","rebindAreaClassName","keyboard-shortcut-container__shortcut-key--edit-mode","handleRebindClick","symbolizeKeybinding","handleBindingChange","alreadyInUseBinding","ShortcutRow_ShortcutRow","CaptureTemplate","onFieldPathUpdate","onAddNewTemplateOrgFileAvailability","onRemoveTemplateOrgFileAvailability","onAddNewTemplateHeaderPath","onRemoveTemplateHeaderPath","onDeleteTemplate","isCollapsed","setIsCollapsed","handleHeaderBarClick","updateField","fieldName","toggleAvailabilityInAllOrgFiles","togglePrepend","handleAddNewOrgFileAvailability","handleRemoveOrgFileAvailability","handleOrgFileAvailabilityChange","handleAddNewHeaderPath","handleRemoveHeaderPath","handleHeaderPathChange","handleDeleteClick","caretClassName","capture-template-container__header__caret--rotated","capture-template-container--dragging","renderDescriptionField","maxLength","autoCapitalize","autoCorrect","renderIconField","orgFilePath","renderOrgFileAvailability","marginTop","renderHeaderPaths","renderPrependField","renderTemplateField","handleFieldPathUpdate","handleAddNewTemplateOrgFileAvailability","handleRemoveTemplateOrgFileAvailability","handleAddNewTemplateHeaderPath","handleRemoveTemplateHeaderPath","handleDeleteTemplate","handleReorderTemplate","onReorder","SyncServiceSignIn","handleDropboxClick","DropboxLogo","handleGoogleDriveClick","GoogleDriveLogo","Entry","lastSeenChangelogHeader","firstHeaderTitle","shouldPromptWhenLeaving","onbeforeunload","components_OrgFile","shouldDisableActionDrawer","_ref$match$params$pat","params","components_FileBrowser","pendingCapturePath","shouldRedirectToCapturePath","entry-container--large-font","components_HeaderBar","Prompt","when","renderChangelogFile","components_Settings","components_KeyboardShortcutsEditor","components_CaptureTemplatesEditor","renderSampleFile","Switch","Route","exact","component","render","renderFile","renderFileBrowser","App","runAllMigrations","initialHash","hash","hashContents","authenticatedSyncService","dropboxAccessToken","createDropboxSyncBackendClient","persistedDropboxAccessToken","createGoogleDriveSyncBackendClient","queryStringContents","search","captureFile","captureTemplateName","capturePath","Store","subscribe","destination","source","onDragEnd","BrowserRouter","es","components_Entry","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","App_App","getElementById","URL","ready","unregister","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.9c98005d.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/org-web.b087bbb4.svg\";","module.exports = __webpack_public_path__ + \"static/media/dropbox.44db08f0.svg\";","module.exports = __webpack_public_path__ + \"static/media/google_drive.f5fd3e02.png\";","/* global ga */\r\n\r\nexport default store => next => action => {\r\n  let { type, ...payload } = action;\r\n\r\n  const eventFieldsToRedact = {\r\n    SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING: ['directoryListing'],\r\n    AUTHENTICATE: ['dropboxAccessToken'],\r\n    DISPLAY_FILE: ['contents'],\r\n  };\r\n\r\n  if (!!eventFieldsToRedact[type]) {\r\n    eventFieldsToRedact[type].forEach(field => {\r\n      payload = { ...payload, [field]: '--REDACTED--' };\r\n    });\r\n  }\r\n\r\n  ga('send', 'event', 'action', type, JSON.stringify(payload));\r\n\r\n  return next(action);\r\n};\r\n","import { displayFile, stopDisplayingFile } from './org';\r\n\r\nimport raw from 'raw.macro';\r\n\r\nexport const setLoadingMessage = loadingMessage => ({\r\n  type: 'SET_LOADING_MESSAGE',\r\n  loadingMessage,\r\n});\r\n\r\nexport const hideLoadingMessage = () => ({\r\n  type: 'HIDE_LOADING_MESSAGE',\r\n});\r\n\r\nexport const setIsLoading = isLoading => ({\r\n  type: 'SET_IS_LOADING',\r\n  isLoading,\r\n});\r\n\r\nexport const setDisappearingLoadingMessage = (loadingMessage, delay) => dispatch => {\r\n  dispatch(setLoadingMessage(loadingMessage));\r\n  setTimeout(() => dispatch(hideLoadingMessage()), delay);\r\n};\r\n\r\nexport const setLastViewedFile = (lastViewedPath, lastViewedContents) => ({\r\n  type: 'SET_LAST_VIEWED_FILE',\r\n  lastViewedPath,\r\n  lastViewedContents,\r\n});\r\n\r\nexport const loadStaticFile = staticFile => {\r\n  return (dispatch, getState) => {\r\n    dispatch(\r\n      setLastViewedFile(getState().org.present.get('path'), getState().org.present.get('contents'))\r\n    );\r\n\r\n    const fileContents = {\r\n      changelog: raw('../../changelog.org'),\r\n      sample: raw('../../sample.org'),\r\n    }[staticFile];\r\n\r\n    dispatch(displayFile(null, fileContents));\r\n  };\r\n};\r\n\r\nexport const unloadStaticFile = () => {\r\n  return (dispatch, getState) => {\r\n    dispatch(stopDisplayingFile());\r\n\r\n    if (!!getState().base.get('lastViewedPath')) {\r\n      dispatch(\r\n        displayFile(\r\n          getState().base.get('lastViewedPath'),\r\n          getState().base.get('lastViewedContents')\r\n        )\r\n      );\r\n    }\r\n  };\r\n};\r\n\r\nexport const setFontSize = newFontSize => ({\r\n  type: 'SET_FONT_SIZE',\r\n  newFontSize,\r\n});\r\n\r\nexport const setBulletStyle = newBulletStyle => ({\r\n  type: 'SET_BULLET_STYLE',\r\n  newBulletStyle,\r\n});\r\n\r\nexport const setShouldTapTodoToAdvance = newShouldTapTodoToAdvance => ({\r\n  type: 'SET_SHOULD_TAP_TODO_TO_ADVANCE',\r\n  newShouldTapTodoToAdvance,\r\n});\r\n\r\nexport const setAgendaDefaultDeadlineDelayUnit = newAgendaDefaultDeadlineDelayUnit => ({\r\n  type: 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_UNIT',\r\n  newAgendaDefaultDeadlineDelayUnit,\r\n});\r\n\r\nexport const setAgendaDefaultDeadlineDelayValue = newAgendaDefaultDeadlineDelayValue => ({\r\n  type: 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_VALUE',\r\n  newAgendaDefaultDeadlineDelayValue,\r\n});\r\n\r\nexport const setShouldLiveSync = shouldLiveSync => ({\r\n  type: 'SET_SHOULD_LIVE_SYNC',\r\n  shouldLiveSync,\r\n});\r\n\r\nexport const setShouldSyncOnBecomingVisibile = shouldSyncOnBecomingVisibile => ({\r\n  type: 'SET_SHOULD_SYNC_ON_BECOMING_VISIBLE',\r\n  shouldSyncOnBecomingVisibile,\r\n});\r\n\r\nexport const setShouldStoreSettingsInSyncBackend = newShouldStoreSettingsInSyncBackend => {\r\n  return (dispatch, getState) => {\r\n    dispatch({\r\n      type: 'SET_SHOULD_STORE_SETTINGS_IN_SYNC_BACKEND',\r\n      newShouldStoreSettingsInSyncBackend,\r\n    });\r\n\r\n    if (!newShouldStoreSettingsInSyncBackend) {\r\n      const client = getState().syncBackend.get('client');\r\n      switch (client.type) {\r\n        case 'Dropbox':\r\n          client\r\n            .deleteFile('/.org-web-config.json')\r\n            .catch(\r\n              (doesFileNotExist, error) =>\r\n                doesFileNotExist\r\n                  ? null\r\n                  : alert(\r\n                      `There was an error trying to delete the .org-web-config.json file: ${error}`\r\n                    )\r\n            );\r\n          break;\r\n        case 'Google Drive':\r\n          client.deleteFileByNameAndParent('.org-web-config.json', 'root');\r\n          break;\r\n        default:\r\n      }\r\n\r\n      window.previousSettingsFileContents = null;\r\n    }\r\n  };\r\n};\r\n\r\nexport const setHasUnseenChangelog = newHasUnseenChangelog => ({\r\n  type: 'SET_HAS_UNSEEN_CHANGELOG',\r\n  newHasUnseenChangelog,\r\n});\r\n\r\nexport const setLastSeenChangelogHeader = newLastSeenChangelogHeader => ({\r\n  type: 'SET_LAST_SEEN_CHANGELOG_HEADER',\r\n  newLastSeenChangelogHeader,\r\n});\r\n\r\nexport const setCustomKeybinding = (keybindingName, keybinding) => ({\r\n  type: 'SET_CUSTOM_KEYBINDING',\r\n  keybindingName,\r\n  keybinding,\r\n});\r\n\r\nexport const restoreBaseSettings = newSettings => ({\r\n  type: 'RESTORE_BASE_SETTINGS',\r\n  newSettings,\r\n});\r\n\r\nexport const pushModalPage = modalPage => ({\r\n  type: 'PUSH_MODAL_PAGE',\r\n  modalPage,\r\n});\r\n\r\nexport const popModalPage = () => ({\r\n  type: 'POP_MODAL_PAGE',\r\n});\r\n\r\nexport const clearModalStack = () => ({\r\n  type: 'CLEAR_MODAL_STACK',\r\n});\r\n\r\nexport const activatePopup = (popupType, data) => ({\r\n  type: 'ACTIVATE_POPUP',\r\n  popupType,\r\n  data,\r\n});\r\n\r\nexport const closePopup = () => ({\r\n  type: 'CLOSE_POPUP',\r\n});\r\n","import formatDate from 'date-fns/format';\r\nimport parseDate from 'date-fns/parse';\r\nimport {\r\n  addHours,\r\n  addDays,\r\n  addWeeks,\r\n  addMonths,\r\n  addYears,\r\n  subHours,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  subYears,\r\n  isBefore,\r\n} from 'date-fns';\r\n\r\nexport const renderAsText = timestamp => {\r\n  const {\r\n    isActive,\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    startHour,\r\n    startMinute,\r\n    endHour,\r\n    endMinute,\r\n    repeaterType,\r\n    repeaterValue,\r\n    repeaterUnit,\r\n    delayType,\r\n    delayValue,\r\n    delayUnit,\r\n  } = timestamp.toJS();\r\n\r\n  let timestampText = '';\r\n  timestampText += isActive ? '<' : '[';\r\n  timestampText += `${year}-${month}-${day}`;\r\n  timestampText += !!dayName ? ` ${dayName}` : '';\r\n  timestampText += !!startHour ? ` ${startHour}:${startMinute}` : '';\r\n  timestampText += !!endHour ? `-${endHour}:${endMinute}` : '';\r\n  timestampText += !!repeaterType ? ` ${repeaterType}${repeaterValue}${repeaterUnit}` : '';\r\n  timestampText += !!delayType ? ` ${delayType}${delayValue}${delayUnit}` : '';\r\n  timestampText += isActive ? '>' : ']';\r\n\r\n  return timestampText;\r\n};\r\n\r\nexport const getCurrentTimestamp = ({ isActive = true, withStartTime = false } = {}) => {\r\n  const time = new Date();\r\n\r\n  const timestamp = {\r\n    isActive,\r\n    year: formatDate(time, 'YYYY'),\r\n    month: formatDate(time, 'MM'),\r\n    day: formatDate(time, 'DD'),\r\n    dayName: formatDate(time, 'ddd'),\r\n    startHour: null,\r\n    startMinute: null,\r\n    endHour: null,\r\n    endMinute: null,\r\n    repeaterType: null,\r\n    repeaterValue: null,\r\n    repeaterUnit: null,\r\n    delayType: null,\r\n    delayValue: null,\r\n    delayUnit: null,\r\n  };\r\n\r\n  if (withStartTime) {\r\n    timestamp.startHour = formatDate(time, 'HH');\r\n    timestamp.startMinute = formatDate(time, 'mm');\r\n  }\r\n\r\n  return timestamp;\r\n};\r\n\r\nexport const getCurrentTimestampAsText = () => `<${formatDate(new Date(), 'YYYY-MM-DD ddd')}>`;\r\n\r\nexport const dateForTimestamp = timestamp => {\r\n  const { year, month, day, startHour, startMinute } = timestamp.toJS();\r\n\r\n  let timestampString = `${year}-${month}-${day}`;\r\n  if (!!startHour && !!startMinute) {\r\n    timestampString += ` ${startHour.padStart(2, '0')}:${startMinute}`;\r\n  }\r\n\r\n  return parseDate(timestampString);\r\n};\r\n\r\nexport const addTimestampUnitToDate = (date, numUnits, timestampUnit) =>\r\n  ({\r\n    h: addHours(date, numUnits),\r\n    d: addDays(date, numUnits),\r\n    w: addWeeks(date, numUnits),\r\n    m: addMonths(date, numUnits),\r\n    y: addYears(date, numUnits),\r\n  }[timestampUnit]);\r\n\r\nexport const subtractTimestampUnitFromDate = (date, numUnits, timestampUnit) =>\r\n  ({\r\n    h: subHours(date, numUnits),\r\n    d: subDays(date, numUnits),\r\n    w: subWeeks(date, numUnits),\r\n    m: subMonths(date, numUnits),\r\n    y: subYears(date, numUnits),\r\n  }[timestampUnit]);\r\n\r\nexport const applyRepeater = (timestamp, currentDate) => {\r\n  if (!timestamp.get('repeaterType')) {\r\n    return timestamp;\r\n  }\r\n\r\n  let newDate = null;\r\n  switch (timestamp.get('repeaterType')) {\r\n    case '+':\r\n      newDate = addTimestampUnitToDate(\r\n        dateForTimestamp(timestamp),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      break;\r\n    case '++':\r\n      newDate = addTimestampUnitToDate(\r\n        dateForTimestamp(timestamp),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      while (isBefore(newDate, currentDate)) {\r\n        newDate = addTimestampUnitToDate(\r\n          newDate,\r\n          timestamp.get('repeaterValue'),\r\n          timestamp.get('repeaterUnit')\r\n        );\r\n      }\r\n      break;\r\n    case '.+':\r\n      newDate = addTimestampUnitToDate(\r\n        new Date(),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      break;\r\n    default:\r\n      console.error(`Unrecognized timestamp repeater type: ${timestamp.get('repeaterType')}`);\r\n      return timestamp;\r\n  }\r\n\r\n  timestamp = timestamp\r\n    .set('day', formatDate(newDate, 'DD'))\r\n    .set('dayName', formatDate(newDate, 'ddd'))\r\n    .set('month', formatDate(newDate, 'MM'))\r\n    .set('year', formatDate(newDate, 'YYYY'));\r\n\r\n  if (timestamp.get('startHour') !== undefined && timestamp.get('startHour') !== null) {\r\n    timestamp = timestamp\r\n      .set('startHour', formatDate(newDate, 'HH'))\r\n      .set('startMinute', formatDate(newDate, 'mm'));\r\n  }\r\n\r\n  return timestamp;\r\n};\r\n","import _ from 'lodash';\r\nimport { fromJS } from 'immutable';\r\n\r\nimport { renderAsText } from './timestamps';\r\n\r\nconst linkPartToRawText = linkPart => {\r\n  if (!!linkPart.getIn(['contents', 'title'])) {\r\n    return `[[${linkPart.getIn(['contents', 'uri'])}][${linkPart.getIn(['contents', 'title'])}]]`;\r\n  } else {\r\n    return `[[${linkPart.getIn(['contents', 'uri'])}]]`;\r\n  }\r\n};\r\n\r\nconst formattedAttributedStringText = parts => {\r\n  return parts\r\n    .map(part => {\r\n      switch (part.get('type')) {\r\n        case 'text':\r\n          return part.get('contents');\r\n        case 'link':\r\n          if (part.getIn(['contents', 'title'])) {\r\n            return part.getIn(['contents', 'title']);\r\n          } else {\r\n            return part.getIn(['contents', 'uri']);\r\n          }\r\n        case 'table':\r\n          return '';\r\n        default:\r\n          return '';\r\n      }\r\n    })\r\n    .join('');\r\n};\r\n\r\nconst tablePartToRawText = tablePart => {\r\n  const rowHeights = tablePart\r\n    .get('contents')\r\n    .map(row =>\r\n      Math.max(\r\n        ...row.get('contents').map(cell => (_.countBy(cell.get('rawContents'))['\\n'] || 0) + 1)\r\n      )\r\n    )\r\n    .toJS();\r\n\r\n  const numColumns = tablePart.getIn(['contents', 0, 'contents']).size;\r\n  const columnWidths = _.times(numColumns).map(columnIndex =>\r\n    Math.max(\r\n      ...tablePart.get('contents').map(row => {\r\n        const content = row.getIn(['contents', columnIndex, 'contents']);\r\n        const formattedText = formattedAttributedStringText(content);\r\n        const lineLengths = formattedText.split('\\n').map(line => line.trim().length);\r\n        return Math.max(...lineLengths);\r\n      })\r\n    )\r\n  );\r\n\r\n  const rowStrings = _.dropRight(\r\n    _.flatten(\r\n      tablePart\r\n        .get('contents')\r\n        .map((row, rowIndex) => {\r\n          const rowHeight = rowHeights[rowIndex];\r\n\r\n          const contentRows = _.times(rowHeight)\r\n            .map(lineIndex =>\r\n              row\r\n                .get('contents')\r\n                .map((cell, columnIndex) => {\r\n                  const content = cell.get('contents');\r\n                  const formattedText = formattedAttributedStringText(content);\r\n                  const formattedLineLengths = formattedText\r\n                    .split('\\n')\r\n                    .map(line => line.trim().length);\r\n                  const line = (cell.get('rawContents').split('\\n')[lineIndex] || '').trim();\r\n\r\n                  const padCount = columnWidths[columnIndex] - formattedLineLengths[lineIndex];\r\n\r\n                  return line + ' '.repeat(padCount);\r\n                })\r\n                .toJS()\r\n                .join(' | ')\r\n            )\r\n            .map(contentRow => `| ${contentRow} |`);\r\n\r\n          const separator =\r\n            '|' + columnWidths.map(columnWidth => '-'.repeat(columnWidth + 2)).join('+') + '|';\r\n\r\n          return contentRows.concat(separator);\r\n        })\r\n        .toJS()\r\n    )\r\n  );\r\n\r\n  return rowStrings.join('\\n');\r\n};\r\n\r\nconst listPartToRawText = listPart => {\r\n  const bulletCharacter = listPart.get('bulletCharacter');\r\n\r\n  let previousNumber = 0;\r\n  return listPart\r\n    .get('items')\r\n    .map(item => {\r\n      const optionalLeadingSpace = !listPart.get('isOrdered') && bulletCharacter === '*' ? ' ' : '';\r\n\r\n      const titleText = attributedStringToRawText(item.get('titleLine'));\r\n\r\n      const contentText = attributedStringToRawText(item.get('contents'));\r\n      const indentedContentText = contentText\r\n        .split('\\n')\r\n        .map(line => (!!line.trim() ? `${optionalLeadingSpace}  ${line}` : ''))\r\n        .join('\\n');\r\n\r\n      let listItemText = null;\r\n      if (listPart.get('isOrdered')) {\r\n        let number = ++previousNumber;\r\n        let forceNumber = item.get('forceNumber');\r\n        if (!!forceNumber) {\r\n          number = forceNumber;\r\n          previousNumber = number;\r\n        }\r\n\r\n        listItemText = `${number}${listPart.get('numberTerminatorCharacter')}`;\r\n\r\n        if (!!forceNumber) {\r\n          listItemText += ` [@${forceNumber}]`;\r\n        }\r\n\r\n        if (item.get('isCheckbox')) {\r\n          const stateCharacter = {\r\n            checked: 'X',\r\n            unchecked: ' ',\r\n            partial: '-',\r\n          }[item.get('checkboxState')];\r\n\r\n          listItemText += ` [${stateCharacter}]`;\r\n        }\r\n\r\n        listItemText += ` ${titleText}`;\r\n      } else {\r\n        listItemText = `${optionalLeadingSpace}${bulletCharacter}`;\r\n\r\n        if (item.get('isCheckbox')) {\r\n          const stateCharacter = {\r\n            checked: 'X',\r\n            unchecked: ' ',\r\n            partial: '-',\r\n          }[item.get('checkboxState')];\r\n\r\n          listItemText += ` [${stateCharacter}]`;\r\n        }\r\n\r\n        listItemText += ` ${titleText}`;\r\n      }\r\n\r\n      if (!!contentText) {\r\n        listItemText += `\\n${indentedContentText}`;\r\n      }\r\n\r\n      return listItemText;\r\n    })\r\n    .join('\\n');\r\n};\r\n\r\nconst timestampPartToRawText = part => {\r\n  let text = renderAsText(part.get('firstTimestamp'));\r\n  if (part.get('secondTimestamp')) {\r\n    text += `--${renderAsText(part.get('secondTimestamp'))}`;\r\n  }\r\n\r\n  return text;\r\n};\r\n\r\nexport const attributedStringToRawText = parts => {\r\n  if (!parts) {\r\n    return '';\r\n  }\r\n\r\n  const prevPartTypes = parts.map(part => part.get('type')).unshift(null);\r\n\r\n  return parts\r\n    .zip(prevPartTypes)\r\n    .map(([part, prevPartType]) => {\r\n      let text = '';\r\n      switch (part.get('type')) {\r\n        case 'text':\r\n          text = part.get('contents');\r\n          break;\r\n        case 'link':\r\n          text = linkPartToRawText(part);\r\n          break;\r\n        case 'fraction-cookie':\r\n          text = `[${part.getIn(['fraction', 0]) || ''}/${part.getIn(['fraction', 1]) || ''}]`;\r\n          break;\r\n        case 'percentage-cookie':\r\n          text = `[${part.get('percentage') || ''}%]`;\r\n          break;\r\n        case 'table':\r\n          text = tablePartToRawText(part);\r\n          break;\r\n        case 'list':\r\n          text = listPartToRawText(part);\r\n          break;\r\n        case 'timestamp':\r\n          text = timestampPartToRawText(part);\r\n          break;\r\n        default:\r\n          console.error(\r\n            `Unknown attributed string part type in attributedStringToRawText: ${part.get('type')}`\r\n          );\r\n      }\r\n\r\n      const optionalNewlinePrefix = ['list', 'table'].includes(prevPartType) ? '\\n' : '';\r\n      return optionalNewlinePrefix + text;\r\n    })\r\n    .join('');\r\n};\r\n\r\nexport default (headers, todoKeywordSets, fileConfigLines, linesBeforeHeadings) => {\r\n  let configContent = '';\r\n\r\n  if (fileConfigLines.size > 0) {\r\n    configContent = fileConfigLines.join('\\n') + '\\n';\r\n  }\r\n\r\n  if (!todoKeywordSets.get(0).get('default')) {\r\n    configContent =\r\n      configContent +\r\n      todoKeywordSets\r\n        .map(todoKeywordSet => {\r\n          return todoKeywordSet.get('configLine');\r\n        })\r\n        .join('\\n') +\r\n      '\\n';\r\n  }\r\n\r\n  if (linesBeforeHeadings.size > 0) {\r\n    configContent = configContent + linesBeforeHeadings.join('\\n');\r\n  }\r\n\r\n  // TODO: maybe this adds empty lines?\r\n  if (configContent.length > 0) {\r\n    configContent = configContent + '\\n';\r\n  }\r\n\r\n  const headerContent = headers\r\n    .toJS()\r\n    .map(header => {\r\n      let contents = '';\r\n      contents += '*'.repeat(header.nestingLevel);\r\n\r\n      if (header.titleLine.todoKeyword) {\r\n        contents += ` ${header.titleLine.todoKeyword}`;\r\n      }\r\n      contents += ` ${header.titleLine.rawTitle}`;\r\n\r\n      if (header.titleLine.tags.length > 0) {\r\n        contents += ` :${header.titleLine.tags.filter(tag => !!tag).join(':')}:`;\r\n      }\r\n\r\n      if (header.planningItems.length > 0) {\r\n        const planningItemsContent = header.planningItems\r\n          .map(\r\n            planningItem => `${planningItem.type}: ${renderAsText(fromJS(planningItem.timestamp))}`\r\n          )\r\n          .join(' ')\r\n          .trimRight();\r\n        contents += `\\n  ${planningItemsContent}`;\r\n      }\r\n\r\n      if (header.propertyListItems.length > 0) {\r\n        contents += '\\n:PROPERTIES:';\r\n        header.propertyListItems.forEach(propertyListItem => {\r\n          contents += `\\n:${propertyListItem.property}: ${attributedStringToRawText(\r\n            fromJS(propertyListItem.value)\r\n          )}`;\r\n        });\r\n        contents += '\\n:END:\\n';\r\n      }\r\n\r\n      if (header.description) {\r\n        if (!header.rawDescription.startsWith('\\n') && header.rawDescription.length !== 0) {\r\n          contents += '\\n';\r\n        }\r\n        contents += header.rawDescription;\r\n      }\r\n\r\n      return contents;\r\n    })\r\n    .join('\\n');\r\n\r\n  return configContent + headerContent;\r\n};\r\n","import { Map } from 'immutable';\r\nimport formatDate from 'date-fns/format';\r\nimport _ from 'lodash';\r\n\r\nexport default (templateString, customVariables = Map()) => {\r\n  if (!templateString) {\r\n    return ['', null];\r\n  }\r\n\r\n  const substitutions = {\r\n    '%t': `<${formatDate(new Date(), 'YYYY-MM-DD ddd')}>`,\r\n    '%T': `<${formatDate(new Date(), 'YYYY-MM-DD ddd HH:mm')}>`,\r\n    '%u': `[${formatDate(new Date(), 'YYYY-MM-DD ddd')}]`,\r\n    '%U': `[${formatDate(new Date(), 'YYYY-MM-DD ddd HH:mm')}]`,\r\n  };\r\n\r\n  customVariables.entrySeq().forEach(([key, value]) => {\r\n    substitutions[`%${key}`] = value;\r\n  });\r\n\r\n  let substitutedString = templateString;\r\n  _.entries(substitutions).forEach(\r\n    ([formatString, value]) =>\r\n      (substitutedString = substitutedString.replace(RegExp(formatString, 'g'), value))\r\n  );\r\n\r\n  const cursorIndex = substitutedString.includes('%?') ? substitutedString.indexOf('%?') : null;\r\n  substitutedString = substitutedString.replace(/%\\?/, '');\r\n\r\n  return [substitutedString, cursorIndex];\r\n};\r\n","export default (() => {\r\n  let nextId = 1;\r\n  return () => nextId++;\r\n})();\r\n","import generateId from './id_generator';\r\n\r\nimport { List, fromJS } from 'immutable';\r\n\r\nexport const indexOfHeaderWithId = (headers, headerId) => {\r\n  return headers.findIndex(header => header.get('id') === headerId);\r\n};\r\n\r\nexport const headerWithId = (headers, headerId) => {\r\n  return headers.get(indexOfHeaderWithId(headers, headerId));\r\n};\r\n\r\nexport const subheadersOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const afterHeaders = headers.slice(headerIndex + 1);\r\n  const nextSiblingHeaderIndex = afterHeaders.findIndex(siblingHeader => {\r\n    return siblingHeader.get('nestingLevel') <= header.get('nestingLevel');\r\n  });\r\n\r\n  if (nextSiblingHeaderIndex === -1) {\r\n    return afterHeaders;\r\n  } else {\r\n    return afterHeaders.slice(0, nextSiblingHeaderIndex);\r\n  }\r\n};\r\n\r\nexport const numSubheadersOfHeaderWithId = (headers, headerId) =>\r\n  subheadersOfHeaderWithId(headers, headerId).size;\r\n\r\nexport const directParentIdOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  for (let i = headerIndex - 1; i >= 0; --i) {\r\n    const previousHeader = headers.get(i);\r\n\r\n    if (previousHeader.get('nestingLevel') === header.get('nestingLevel') - 1) {\r\n      return previousHeader.get('id');\r\n    }\r\n\r\n    if (previousHeader.get('nestingLevel') < header.get('nestingLevel')) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const parentIdOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const previousHeaders = headers.slice(0, headerIndex).reverse();\r\n  const parentHeader = previousHeaders.find(\r\n    previousHeader => previousHeader.get('nestingLevel') < header.get('nestingLevel')\r\n  );\r\n\r\n  if (!parentHeader) {\r\n    return null;\r\n  }\r\n\r\n  return parentHeader.get('id');\r\n};\r\n\r\nexport const indexOfPreviousSibling = (headers, headerIndex) => {\r\n  const nestingLevel = headers.getIn([headerIndex, 'nestingLevel']);\r\n\r\n  for (let i = headerIndex - 1; i >= 0; --i) {\r\n    const header = headers.get(i);\r\n\r\n    if (header.get('nestingLevel') < nestingLevel) {\r\n      return null;\r\n    }\r\n\r\n    if (header.get('nestingLevel') === nestingLevel) {\r\n      return i;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst isHeaderVisible = (headers, headerId) => {\r\n  const parentHeaderId = parentIdOfHeaderWithId(headers, headerId);\r\n  if (!parentHeaderId) {\r\n    return true;\r\n  }\r\n\r\n  const parentHeader = headerWithId(headers, parentHeaderId);\r\n  return parentHeader.get('opened') && isHeaderVisible(headers, parentHeader.get('id'));\r\n};\r\n\r\nexport const nextVisibleHeaderAfterIndex = (headers, headerIndex) => {\r\n  const followingHeaders = headers.slice(headerIndex + 1);\r\n  return followingHeaders.find(header => isHeaderVisible(headers, header.get('id')));\r\n};\r\n\r\nexport const previousVisibleHeaderAfterIndex = (headers, headerIndex) => {\r\n  const previousHeaders = headers.slice(0, headerIndex).reverse();\r\n  return previousHeaders.find(header => isHeaderVisible(headers, header.get('id')));\r\n};\r\n\r\nexport const openDirectParent = (state, headerId) => {\r\n  const parentHeaderId = directParentIdOfHeaderWithId(state.get('headers'), headerId);\r\n  if (parentHeaderId !== null) {\r\n    const parentHeaderIndex = indexOfHeaderWithId(state.get('headers'), parentHeaderId);\r\n    state = state.setIn(['headers', parentHeaderIndex, 'opened'], true);\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const getOpenHeaderPaths = headers => {\r\n  let openedHeaders = [];\r\n  for (let i = 0; i < headers.size; ++i) {\r\n    const header = headers.get(i);\r\n    if (!header.get('opened')) {\r\n      continue;\r\n    }\r\n\r\n    const title = header.getIn(['titleLine', 'rawTitle']);\r\n\r\n    const subheaders = subheadersOfHeaderWithId(headers, header.get('id'));\r\n    const openSubheaderPaths = getOpenHeaderPaths(subheaders);\r\n\r\n    if (openSubheaderPaths.length > 0) {\r\n      openSubheaderPaths.forEach(openedSubheaderPath => {\r\n        openedHeaders.push([title].concat(openedSubheaderPath));\r\n      });\r\n    } else {\r\n      openedHeaders.push([title]);\r\n    }\r\n\r\n    i += subheaders.size;\r\n  }\r\n\r\n  return openedHeaders;\r\n};\r\n\r\nexport const headerWithPath = (headers, headerPath) => {\r\n  if (headerPath.size === 0) {\r\n    return null;\r\n  }\r\n\r\n  const firstHeader = headers.find(\r\n    header =>\r\n      parentIdOfHeaderWithId(headers, header.get('id')) === null &&\r\n      header.getIn(['titleLine', 'rawTitle']).trim() === headerPath.first().trim()\r\n  );\r\n  if (!firstHeader) {\r\n    return null;\r\n  }\r\n\r\n  if (headerPath.size === 1) {\r\n    return firstHeader;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, firstHeader.get('id'));\r\n  return headerWithPath(subheaders, headerPath.skip(1));\r\n};\r\n\r\nexport const openHeaderWithPath = (headers, headerPath, maxNestingLevel = 1) => {\r\n  if (headerPath.size === 0) {\r\n    return headers;\r\n  }\r\n\r\n  const firstTitle = headerPath.first();\r\n  const headerIndex = headers.findIndex(header => {\r\n    const rawTitle = header.getIn(['titleLine', 'rawTitle']);\r\n    const nestingLevel = header.get('nestingLevel');\r\n    return rawTitle === firstTitle && nestingLevel <= maxNestingLevel;\r\n  });\r\n  if (headerIndex === -1) {\r\n    return headers;\r\n  }\r\n\r\n  headers = headers.update(headerIndex, header => header.set('opened', true));\r\n\r\n  let subheaders = subheadersOfHeaderWithId(headers, headers.getIn([headerIndex, 'id']));\r\n  subheaders = openHeaderWithPath(subheaders, headerPath.rest(), maxNestingLevel + 1);\r\n\r\n  headers = headers\r\n    .take(headerIndex + 1)\r\n    .concat(subheaders)\r\n    .concat(headers.takeLast(headers.size - (headerIndex + 1 + subheaders.size)));\r\n\r\n  return headers;\r\n};\r\n\r\nconst tablePartContainsCellId = (tablePart, cellId) =>\r\n  tablePart\r\n    .get('contents')\r\n    .some(row => row.get('contents').some(cell => cell.get('id') === cellId));\r\n\r\nconst doesAttributedStringContainTableCellId = (parts, cellId) =>\r\n  parts\r\n    .filter(part => ['table', 'list'].includes(part.get('type')))\r\n    .some(\r\n      part =>\r\n        part.get('type') === 'table'\r\n          ? tablePartContainsCellId(part, cellId)\r\n          : part\r\n              .get('items')\r\n              .some(item => doesAttributedStringContainTableCellId(item.get('contents'), cellId))\r\n    );\r\n\r\nexport const headerThatContainsTableCellId = (headers, cellId) =>\r\n  headers.find(header => doesAttributedStringContainTableCellId(header.get('description'), cellId));\r\n\r\nexport const pathAndPartOfTimestampItemWithIdInAttributedString = (parts, timestampId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'timestamp' && part.get('id') === timestampId) {\r\n        return {\r\n          path: [partIndex],\r\n          timestampPart: part,\r\n        };\r\n      } else if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n              item.get('contents'),\r\n              timestampId\r\n            );\r\n            if (!!pathAndPart) {\r\n              const { path, timestampPart } = pathAndPart;\r\n              return {\r\n                path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                timestampPart,\r\n              };\r\n            } else {\r\n              let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n                item.get('titleLine'),\r\n                timestampId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, timestampPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'titleLine'].concat(path),\r\n                  timestampPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else if (part.get('type') === 'table') {\r\n        return part\r\n          .get('contents')\r\n          .map((row, rowIndex) => {\r\n            return row\r\n              .get('contents')\r\n              .map((cell, cellIndex) => {\r\n                const pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n                  cell.get('contents'),\r\n                  timestampId\r\n                );\r\n                if (!!pathAndPart) {\r\n                  const { path, timestampPart } = pathAndPart;\r\n                  return {\r\n                    path: [\r\n                      partIndex,\r\n                      'contents',\r\n                      rowIndex,\r\n                      'contents',\r\n                      cellIndex,\r\n                      'contents',\r\n                    ].concat(path),\r\n                    timestampPart,\r\n                  };\r\n                } else {\r\n                  return null;\r\n                }\r\n              })\r\n              .filter(result => !!result)\r\n              .first();\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nconst listPartContainsItemId = (listPart, itemId) =>\r\n  listPart.get('items').some(item => item.get('id') === itemId);\r\n\r\nexport const headerThatContainsListItemId = (headers, listItemId) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n  const headerIndex = pathAndPart.path[0];\r\n  return headers.get(headerIndex);\r\n};\r\n\r\nexport const pathAndPartOfListItemWithIdInAttributedString = (parts, listItemId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            if (item.get('id') === listItemId) {\r\n              return {\r\n                path: [partIndex, 'items', itemIndex],\r\n                listItemPart: item,\r\n              };\r\n            } else {\r\n              const pathAndPart = pathAndPartOfListItemWithIdInAttributedString(\r\n                item.get('contents'),\r\n                listItemId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, listItemPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                  listItemPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTableContainingCellIdInAttributedString = (parts, cellId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'table') {\r\n        if (tablePartContainsCellId(part, cellId)) {\r\n          return { path: [partIndex], tablePart: part };\r\n        } else {\r\n          return null;\r\n        }\r\n      } else if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            const pathAndPart = pathAndPartOfTableContainingCellIdInAttributedString(\r\n              item.get('contents'),\r\n              cellId\r\n            );\r\n            if (!!pathAndPart) {\r\n              const { path, tablePart } = pathAndPart;\r\n              return {\r\n                path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                tablePart,\r\n              };\r\n            } else {\r\n              return null;\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListContainingItemIdInHeaders = (headers, itemId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfListContainingItemIdInAttributedString(\r\n        header.get('description'),\r\n        itemId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, listPart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        listPart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListContainingItemIdInAttributedString = (parts, itemId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'list') {\r\n        if (listPartContainsItemId(part, itemId)) {\r\n          return { path: [partIndex], listPart: part };\r\n        } else {\r\n          return part\r\n            .get('items')\r\n            .map((item, itemIndex) => {\r\n              const pathAndPart = pathAndPartOfListContainingItemIdInAttributedString(\r\n                item.get('contents'),\r\n                itemId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, listPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                  listPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            })\r\n            .filter(result => !!result)\r\n            .first();\r\n        }\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTimestampItemWithIdInHeaders = (headers, timestampId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n        header.getIn(['titleLine', 'title']),\r\n        timestampId\r\n      );\r\n      if (!!pathAndPart) {\r\n        const { path, timestampPart } = pathAndPart;\r\n        return {\r\n          path: [headerIndex, 'titleLine', 'title'].concat(path),\r\n          timestampPart,\r\n        };\r\n      }\r\n\r\n      pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n        header.get('description'),\r\n        timestampId\r\n      );\r\n      if (!!pathAndPart) {\r\n        const { path, timestampPart } = pathAndPart;\r\n        return {\r\n          path: [headerIndex, 'description'].concat(path),\r\n          timestampPart,\r\n        };\r\n      }\r\n\r\n      pathAndPart = header\r\n        .get('propertyListItems')\r\n        .map((propertyListItem, propertyListItemIndex) => {\r\n          if (!propertyListItem.get('value')) {\r\n            return null;\r\n          }\r\n\r\n          const plistPathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n            propertyListItem.get('value'),\r\n            timestampId\r\n          );\r\n          if (!!plistPathAndPart) {\r\n            const { path, timestampPart } = plistPathAndPart;\r\n            return {\r\n              path: [headerIndex, 'propertyListItems', propertyListItemIndex, 'value'].concat(path),\r\n              timestampPart,\r\n            };\r\n          }\r\n\r\n          return null;\r\n        })\r\n        .filter(result => !!result)\r\n        .first();\r\n      if (!!pathAndPart) {\r\n        return pathAndPart;\r\n      }\r\n\r\n      return null;\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListItemWithIdInHeaders = (headers, listItemId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfListItemWithIdInAttributedString(\r\n        header.get('description'),\r\n        listItemId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, listItemPart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        listItemPart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTableContainingCellIdInHeaders = (headers, cellId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfTableContainingCellIdInAttributedString(\r\n        header.get('description'),\r\n        cellId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, tablePart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        tablePart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const updateTableContainingCellId = (headers, cellId, updaterCallbackGenerator) => {\r\n  const { path, tablePart } = pathAndPartOfTableContainingCellIdInHeaders(headers, cellId);\r\n\r\n  const rowIndexContainingCellId = tablePart\r\n    .get('contents')\r\n    .findIndex(row => row.get('contents').some(cell => cell.get('id') === cellId));\r\n  const columnIndexContainingCellId = tablePart\r\n    .getIn(['contents', rowIndexContainingCellId, 'contents'])\r\n    .findIndex(cell => cell.get('id') === cellId);\r\n\r\n  return headers.updateIn(\r\n    path.concat(['contents']),\r\n    updaterCallbackGenerator(rowIndexContainingCellId, columnIndexContainingCellId)\r\n  );\r\n};\r\n\r\nexport const newEmptyTableRowLikeRows = rows =>\r\n  rows\r\n    .get(0)\r\n    .set('id', generateId())\r\n    .update('contents', contents =>\r\n      contents.map(cell =>\r\n        cell\r\n          .set('id', generateId())\r\n          .set('contents', new List())\r\n          .set('rawContents', '')\r\n      )\r\n    );\r\n\r\nexport const newEmptyTableCell = () =>\r\n  fromJS({\r\n    id: generateId(),\r\n    contents: [],\r\n    rawContents: '',\r\n  });\r\n\r\nexport const newListPart = () =>\r\n  fromJS({\r\n    type: 'list',\r\n    id: generateId(),\r\n    items: [],\r\n    bulletCharacter: '-',\r\n    numberTerminatorCharacter: null,\r\n    isOrdered: false,\r\n  });\r\n\r\nexport const newListPartLikePart = part => part.set('id', generateId()).set('items', new List());\r\n\r\nexport const newListItem = () =>\r\n  fromJS({\r\n    id: generateId(),\r\n    titleLine: [],\r\n    contents: [],\r\n    forceNumber: null,\r\n    isCheckbox: false,\r\n  });\r\n\r\nexport const parentListItemWithIdInHeaders = (headers, listItemId) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n  let { path } = pathAndPart;\r\n  return headers.getIn(path.slice(0, path.length - 4));\r\n};\r\n\r\nexport const updateListContainingListItemId = (headers, listItemId, updaterCallbackGenerator) => {\r\n  const { path, listPart } = pathAndPartOfListContainingItemIdInHeaders(headers, listItemId);\r\n\r\n  const itemIndexContainingId = listPart\r\n    .get('items')\r\n    .findIndex(item => item.get('id') === listItemId);\r\n\r\n  return headers.updateIn(path.concat(['items']), updaterCallbackGenerator(itemIndexContainingId));\r\n};\r\n\r\nexport const updateContentsWithListItemAddition = (parts, listItem, listPart = null) => {\r\n  if (parts.size === 0) {\r\n    if (!!listPart) {\r\n      parts = parts.insert(0, newListPartLikePart(listPart));\r\n    } else {\r\n      parts = parts.insert(0, newListPart());\r\n    }\r\n  }\r\n  return parts.map(part => {\r\n    switch (part.get('type')) {\r\n      case 'list':\r\n        return part.update('items', items => items.push(listItem));\r\n      default:\r\n        return part;\r\n    }\r\n  });\r\n};\r\n\r\nexport const timestampWithIdInAttributedString = (parts, timestampId) => {\r\n  if (!parts) {\r\n    return null;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(parts, timestampId);\r\n  if (!!pathAndPart) {\r\n    return pathAndPart.timestampPart;\r\n  } else {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const timestampWithId = (headers, timestampId) =>\r\n  headers\r\n    .map(\r\n      header =>\r\n        timestampWithIdInAttributedString(header.getIn(['titleLine', 'title']), timestampId) ||\r\n        timestampWithIdInAttributedString(header.get('description'), timestampId) ||\r\n        header\r\n          .get('propertyListItems')\r\n          .map(propertyListItem =>\r\n            timestampWithIdInAttributedString(propertyListItem.get('value'), timestampId)\r\n          )\r\n          .filter(result => !!result)\r\n          .first()\r\n    )\r\n    .find(result => !!result);\r\n\r\nexport const todoKeywordSetForKeyword = (todoKeywordSets, keyword) =>\r\n  todoKeywordSets.find(keywordSet => keywordSet.get('keywords').contains(keyword)) ||\r\n  todoKeywordSets.first();\r\n\r\nexport const isTodoKeywordCompleted = (todoKeywordSets, keyword) =>\r\n  todoKeywordSetForKeyword(todoKeywordSets, keyword)\r\n    .get('completedKeywords')\r\n    .includes(keyword);\r\n","import generateId from './id_generator';\r\n\r\nimport { fromJS } from 'immutable';\r\n\r\nexport default fromJS([\r\n  {\r\n    description: 'Groceries',\r\n    headerPaths: ['Capture', 'Groceries'],\r\n    iconName: 'lemon',\r\n    id: generateId(),\r\n    isAvailableInAllOrgFiles: false,\r\n    letter: '',\r\n    orgFilesWhereAvailable: [],\r\n    shouldPrepend: false,\r\n    template: '* TODO %?',\r\n    isSample: true,\r\n  },\r\n  {\r\n    description: 'Deeply nested header',\r\n    headerPaths: ['Capture', 'Deeply', 'Nested', 'Headers', 'Work', 'Too!'],\r\n    iconName: 'fighter-jet',\r\n    id: generateId(),\r\n    isAvailableInAllOrgFiles: false,\r\n    letter: '',\r\n    orgFilesWhereAvailable: [],\r\n    shouldPrepend: true,\r\n    template: '* You can insert timestamps too! %T %?',\r\n    isSample: true,\r\n  },\r\n]);\r\n","import { ActionTypes } from 'redux-linear-undo';\r\nimport {\r\n  setLoadingMessage,\r\n  hideLoadingMessage,\r\n  setIsLoading,\r\n  setDisappearingLoadingMessage,\r\n  activatePopup,\r\n  closePopup,\r\n} from './base';\r\nimport exportOrg from '../lib/export_org';\r\nimport substituteTemplateVariables from '../lib/capture_template_substitution';\r\nimport { headerWithPath } from '../lib/org_utils';\r\n\r\nimport sampleCaptureTemplates from '../lib/sample_capture_templates';\r\n\r\nimport { isAfter, addSeconds } from 'date-fns';\r\nimport parseDate from 'date-fns/parse';\r\n\r\nexport const displayFile = (path, contents) => ({\r\n  type: 'DISPLAY_FILE',\r\n  path,\r\n  contents,\r\n});\r\n\r\nexport const setLastSyncAt = lastSyncAt => ({\r\n  type: 'SET_LAST_SYNC_AT',\r\n  lastSyncAt,\r\n});\r\n\r\nexport const stopDisplayingFile = () => {\r\n  return (dispatch, getState) => {\r\n    dispatch({ type: 'STOP_DISPLAYING_FILE' });\r\n    dispatch({ type: ActionTypes.CLEAR_HISTORY });\r\n    dispatch(unfocusHeader());\r\n    dispatch(closePopup());\r\n    dispatch(setLastSyncAt(null));\r\n  };\r\n};\r\n\r\nexport const sync = ({\r\n  forceAction = null,\r\n  successMessage = 'Changes pushed',\r\n  shouldSuppressMessages = false,\r\n} = {}) => (dispatch, getState) => {\r\n  const client = getState().syncBackend.get('client');\r\n  const path = getState().org.present.get('path');\r\n  if (path === null) {\r\n    return;\r\n  }\r\n\r\n  if (!shouldSuppressMessages) {\r\n    dispatch(setLoadingMessage('Syncing...'));\r\n  }\r\n  dispatch(setIsLoading(true));\r\n  dispatch(setOrgFileErrorMessage(null));\r\n\r\n  client\r\n    .getFileContentsAndMetadata(path)\r\n    .then(({ contents, lastModifiedAt }) => {\r\n      const isDirty = getState().org.present.get('isDirty');\r\n      const lastServerModifiedAt = parseDate(lastModifiedAt);\r\n      const lastSyncAt = getState().org.present.get('lastSyncAt');\r\n\r\n      if (isAfter(lastSyncAt, lastServerModifiedAt) || forceAction === 'push') {\r\n        if (isDirty) {\r\n          client\r\n            .updateFile(\r\n              path,\r\n              exportOrg(\r\n                getState().org.present.get('headers'),\r\n                getState().org.present.get('todoKeywordSets'),\r\n                getState().org.present.get('fileConfigLines'),\r\n                getState().org.present.get('linesBeforeHeadings')\r\n              )\r\n            )\r\n            .then(() => {\r\n              if (!shouldSuppressMessages) {\r\n                dispatch(setDisappearingLoadingMessage(successMessage, 2000));\r\n              }\r\n              dispatch(setIsLoading(false));\r\n              dispatch(setDirty(false));\r\n              dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n            })\r\n            .catch(error => {\r\n              alert(`There was an error pushing the file: ${error.toString()}`);\r\n              dispatch(hideLoadingMessage());\r\n              dispatch(setIsLoading(false));\r\n            });\r\n        } else {\r\n          if (!shouldSuppressMessages) {\r\n            dispatch(setDisappearingLoadingMessage('Nothing to sync', 2000));\r\n          }\r\n          dispatch(setIsLoading(false));\r\n        }\r\n      } else {\r\n        if (isDirty && forceAction !== 'pull') {\r\n          dispatch(hideLoadingMessage());\r\n          dispatch(setIsLoading(false));\r\n          dispatch(activatePopup('sync-confirmation', { lastServerModifiedAt }));\r\n        } else {\r\n          dispatch(displayFile(path, contents));\r\n          dispatch(applyOpennessState());\r\n          dispatch(setDirty(false));\r\n          dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n          if (!shouldSuppressMessages) {\r\n            dispatch(setDisappearingLoadingMessage('Latest version pulled', 2000));\r\n          }\r\n          dispatch(setIsLoading(false));\r\n        }\r\n      }\r\n    })\r\n    .catch(() => {\r\n      dispatch(hideLoadingMessage());\r\n      dispatch(setIsLoading(false));\r\n      dispatch(setOrgFileErrorMessage('File not found'));\r\n    });\r\n};\r\n\r\nexport const openHeader = headerId => ({\r\n  type: 'OPEN_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const toggleHeaderOpened = headerId => ({\r\n  type: 'TOGGLE_HEADER_OPENED',\r\n  headerId,\r\n});\r\n\r\nexport const selectHeader = headerId => dispatch => {\r\n  dispatch({ type: 'SELECT_HEADER', headerId });\r\n\r\n  if (!!headerId) {\r\n    dispatch(setSelectedTableCellId(null));\r\n    dispatch(setSelectedListItemId(null));\r\n  }\r\n};\r\n\r\nexport const selectHeaderAndOpenParents = headerId => dispatch => {\r\n  dispatch(selectHeader(headerId));\r\n  dispatch({ type: 'OPEN_PARENTS_OF_HEADER', headerId });\r\n};\r\n\r\nexport const advanceTodoState = (headerId = null) => ({\r\n  type: 'ADVANCE_TODO_STATE',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const enterEditMode = editModeType => ({\r\n  type: 'ENTER_EDIT_MODE',\r\n  editModeType,\r\n});\r\n\r\nexport const exitEditMode = () => ({\r\n  type: 'EXIT_EDIT_MODE',\r\n});\r\n\r\nexport const updateHeaderTitle = (headerId, newRawTitle) => ({\r\n  type: 'UPDATE_HEADER_TITLE',\r\n  headerId,\r\n  newRawTitle,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateHeaderDescription = (headerId, newRawDescription) => ({\r\n  type: 'UPDATE_HEADER_DESCRIPTION',\r\n  headerId,\r\n  newRawDescription,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addHeader = headerId => ({\r\n  type: 'ADD_HEADER',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const selectNextSiblingHeader = headerId => ({\r\n  type: 'SELECT_NEXT_SIBLING_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const addHeaderAndEdit = headerId => dispatch => {\r\n  dispatch(addHeader(headerId));\r\n  dispatch(selectNextSiblingHeader(headerId));\r\n  dispatch(enterEditMode('title'));\r\n};\r\n\r\nexport const selectNextVisibleHeader = headerId => ({\r\n  type: 'SELECT_NEXT_VISIBLE_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const selectPreviousVisibleHeader = headerId => ({\r\n  type: 'SELECT_PREVIOUS_VISIBLE_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const removeHeader = headerId => ({\r\n  type: 'REMOVE_HEADER',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderUp = headerId => ({\r\n  type: 'MOVE_HEADER_UP',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderDown = headerId => ({\r\n  type: 'MOVE_HEADER_DOWN',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderLeft = headerId => ({\r\n  type: 'MOVE_HEADER_LEFT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderRight = headerId => ({\r\n  type: 'MOVE_HEADER_RIGHT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveSubtreeLeft = headerId => ({\r\n  type: 'MOVE_SUBTREE_LEFT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveSubtreeRight = headerId => ({\r\n  type: 'MOVE_SUBTREE_RIGHT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const focusHeader = headerId => ({\r\n  type: 'FOCUS_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const unfocusHeader = () => ({\r\n  type: 'UNFOCUS_HEADER',\r\n});\r\n\r\nexport const noOp = () => ({\r\n  type: 'NO_OP',\r\n});\r\n\r\nexport const applyOpennessState = () => ({\r\n  type: 'APPLY_OPENNESS_STATE',\r\n});\r\n\r\nexport const setDirty = isDirty => ({\r\n  type: 'SET_DIRTY',\r\n  isDirty,\r\n});\r\n\r\nexport const setSelectedTableCellId = cellId => dispatch => {\r\n  dispatch({ type: 'SET_SELECTED_TABLE_CELL_ID', cellId });\r\n\r\n  if (!!cellId) {\r\n    dispatch(selectHeader(null));\r\n    dispatch(setSelectedListItemId(null));\r\n  }\r\n};\r\n\r\nexport const addNewTableRow = () => ({\r\n  type: 'ADD_NEW_TABLE_ROW',\r\n  dirtying: true,\r\n});\r\n\r\nexport const removeTableRow = () => ({\r\n  type: 'REMOVE_TABLE_ROW',\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewTableColumn = () => ({\r\n  type: 'ADD_NEW_TABLE_COLUMN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const removeTableColumn = () => ({\r\n  type: 'REMOVE_TABLE_COLUMN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableRowDown = () => ({\r\n  type: 'MOVE_TABLE_ROW_DOWN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableRowUp = () => ({\r\n  type: 'MOVE_TABLE_ROW_UP',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableColumnLeft = () => ({\r\n  type: 'MOVE_TABLE_COLUMN_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableColumnRight = () => ({\r\n  type: 'MOVE_TABLE_COLUMN_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateTableCellValue = (cellId, newValue) => ({\r\n  type: 'UPDATE_TABLE_CELL_VALUE',\r\n  cellId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const insertCapture = (templateId, content, shouldPrepend) => (dispatch, getState) => {\r\n  dispatch(closePopup());\r\n\r\n  const template = getState()\r\n    .capture.get('captureTemplates')\r\n    .concat(sampleCaptureTemplates)\r\n    .find(template => template.get('id') === templateId);\r\n  dispatch({ type: 'INSERT_CAPTURE', template, content, shouldPrepend, dirtying: true });\r\n};\r\n\r\nexport const clearPendingCapture = () => ({\r\n  type: 'CLEAR_PENDING_CAPTURE',\r\n});\r\n\r\nexport const insertPendingCapture = () => (dispatch, getState) => {\r\n  const pendingCapture = getState().org.present.get('pendingCapture');\r\n  const templateName = pendingCapture.get('captureTemplateName');\r\n  const captureContent = pendingCapture.get('captureContent');\r\n  const customCaptureVariables = pendingCapture.get('customCaptureVariables');\r\n\r\n  dispatch(clearPendingCapture());\r\n  window.history.pushState({}, '', window.location.pathname);\r\n\r\n  const template = getState()\r\n    .capture.get('captureTemplates')\r\n    .filter(\r\n      template =>\r\n        template.get('isAvailableInAllOrgFiles') ||\r\n        template.get('orgFilesWhereAvailable').includes(getState().org.present.get('path'))\r\n    )\r\n    .find(template => template.get('description').trim() === templateName.trim());\r\n  if (!template) {\r\n    dispatch(\r\n      setDisappearingLoadingMessage(\r\n        `Capture failed: \"${templateName}\" template not found or not available in this file`,\r\n        8000\r\n      )\r\n    );\r\n    return;\r\n  }\r\n\r\n  const targetHeader = headerWithPath(\r\n    getState().org.present.get('headers'),\r\n    template.get('headerPaths')\r\n  );\r\n  if (!targetHeader) {\r\n    dispatch(\r\n      setDisappearingLoadingMessage(\r\n        `Capture failed: \"${template.get('description')}\" header path invalid in this file`,\r\n        8000\r\n      )\r\n    );\r\n    return;\r\n  }\r\n\r\n  const [substitutedTemplate, initialCursorIndex] = substituteTemplateVariables(\r\n    template.get('template'),\r\n    customCaptureVariables\r\n  );\r\n\r\n  const content = !!initialCursorIndex\r\n    ? `${substitutedTemplate.substring(\r\n        0,\r\n        initialCursorIndex\r\n      )}${captureContent}${substitutedTemplate.substring(initialCursorIndex)}`\r\n    : `${substitutedTemplate}${captureContent}`;\r\n\r\n  dispatch(insertCapture(template.get('id'), content, template.get('shouldPrepend')));\r\n  dispatch(sync({ successMessage: 'Item captured' }));\r\n};\r\n\r\nexport const advanceCheckboxState = listItemId => ({\r\n  type: 'ADVANCE_CHECKBOX_STATE',\r\n  listItemId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const setSelectedListItemId = listItemId => dispatch => {\r\n  dispatch({ type: 'SET_SELECTED_LIST_ITEM_ID', listItemId });\r\n\r\n  if (!!listItemId) {\r\n    dispatch(selectHeader(null));\r\n    dispatch(setSelectedTableCellId(null));\r\n  }\r\n};\r\n\r\nexport const updateListTitleValue = (listItemId, newValue) => ({\r\n  type: 'UPDATE_LIST_TITLE_VALUE',\r\n  listItemId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateListContentsValue = (listItemId, newValue) => ({\r\n  type: 'UPDATE_LIST_CONTENTS_VALUE',\r\n  listItemId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewListItem = () => ({\r\n  type: 'ADD_NEW_LIST_ITEM',\r\n  dirtying: true,\r\n});\r\n\r\nexport const selectNextSiblingListItem = () => ({\r\n  type: 'SELECT_NEXT_SIBLING_LIST_ITEM',\r\n});\r\n\r\nexport const addNewListItemAndEdit = () => dispatch => {\r\n  dispatch(addNewListItem());\r\n  dispatch(selectNextSiblingListItem());\r\n  dispatch(enterEditMode('list-title'));\r\n};\r\n\r\nexport const removeListItem = () => ({\r\n  type: 'REMOVE_LIST_ITEM',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemUp = () => ({\r\n  type: 'MOVE_LIST_ITEM_UP',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemDown = () => ({\r\n  type: 'MOVE_LIST_ITEM_DOWN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemLeft = () => ({\r\n  type: 'MOVE_LIST_ITEM_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemRight = () => ({\r\n  type: 'MOVE_LIST_ITEM_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListSubtreeLeft = () => ({\r\n  type: 'MOVE_LIST_SUBTREE_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListSubtreeRight = () => ({\r\n  type: 'MOVE_LIST_SUBTREE_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const setHeaderTags = (headerId, tags) => ({\r\n  type: 'SET_HEADER_TAGS',\r\n  headerId,\r\n  tags,\r\n  dirtying: true,\r\n});\r\n\r\nexport const reorderTags = (fromIndex, toIndex) => ({\r\n  type: 'REORDER_TAGS',\r\n  fromIndex,\r\n  toIndex,\r\n  dirtying: true,\r\n});\r\n\r\nexport const reorderPropertyList = (fromIndex, toIndex) => (dispatch, getState) =>\r\n  dispatch({\r\n    type: 'REORDER_PROPERTY_LIST',\r\n    fromIndex,\r\n    toIndex,\r\n    headerId: getState().base.getIn(['activePopup', 'data', 'headerId']),\r\n    dirtying: true,\r\n  });\r\n\r\nexport const updateTimestampWithId = (timestampId, newTimestamp) => ({\r\n  type: 'UPDATE_TIMESTAMP_WITH_ID',\r\n  timestampId,\r\n  newTimestamp,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updatePlanningItemTimestamp = (headerId, planningItemIndex, newTimestamp) => ({\r\n  type: 'UPDATE_PLANNING_ITEM_TIMESTAMP',\r\n  headerId,\r\n  planningItemIndex,\r\n  newTimestamp,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewPlanningItem = (headerId, planningType) => ({\r\n  type: 'ADD_NEW_PLANNING_ITEM',\r\n  headerId,\r\n  planningType,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updatePropertyListItems = (headerId, newPropertyListItems) => ({\r\n  type: 'UPDATE_PROPERTY_LIST_ITEMS',\r\n  headerId,\r\n  newPropertyListItems,\r\n  dirtying: true,\r\n});\r\n\r\nexport const setOrgFileErrorMessage = message => ({\r\n  type: 'SET_ORG_FILE_ERROR_MESSAGE',\r\n  message,\r\n});\r\n","import { sync } from '../actions/org';\r\n\r\nexport default store => next => action => {\r\n  if (action.dirtying && store.getState().base.get('shouldLiveSync')) {\r\n    store.dispatch(sync({ shouldSuppressMessages: true }));\r\n  }\r\n\r\n  return next(action);\r\n};\r\n","import { sync } from '../actions/org';\r\nimport { debounce } from 'lodash';\r\n\r\nconst dispatchSync = store => store.dispatch(sync({ shouldSuppressMessages: true }));\r\n\r\n// The 'visibilitychange' event might get triggered in some browsers many times for one 'real'\r\n// event of the browser becoming visible to the user. Debouncing through lodash ensures that\r\n// it is called at maximum once every second.\r\nvar debouncedDispatchSync = debounce(dispatchSync, 1000);\r\n\r\nexport default store => next => action => {\r\n  window.addEventListener('visibilitychange', () => {\r\n    if (store.getState().base.get('shouldSyncOnBecomingVisibile')) {\r\n      debouncedDispatchSync(store);\r\n    }\r\n  });\r\n\r\n  return next(action);\r\n};\r\n","export const addNewEmptyCaptureTemplate = () => ({\r\n  type: 'ADD_NEW_EMPTY_CAPTURE_TEMPLATE',\r\n});\r\n\r\nexport const updateTemplateFieldPathValue = (templateId, fieldPath, newValue) => ({\r\n  type: 'UPDATE_TEMPLATE_FIELD_PATH_VALUE',\r\n  templateId,\r\n  fieldPath,\r\n  newValue,\r\n});\r\n\r\nexport const addNewTemplateOrgFileAvailability = templateId => ({\r\n  type: 'ADD_NEW_TEMPLATE_ORG_FILE_AVAILABILITY',\r\n  templateId,\r\n});\r\n\r\nexport const removeTemplateOrgFileAvailability = (templateId, orgFileAvailabilityIndex) => ({\r\n  type: 'REMOVE_TEMPLATE_ORG_FILE_AVAILABILITY',\r\n  templateId,\r\n  orgFileAvailabilityIndex,\r\n});\r\n\r\nexport const addNewTemplateHeaderPath = templateId => ({\r\n  type: 'ADD_NEW_TEMPLATE_HEADER_PATH',\r\n  templateId,\r\n});\r\n\r\nexport const removeTemplateHeaderPath = (templateId, headerPathIndex) => ({\r\n  type: 'REMOVE_TEMPLATE_HEADER_PATH',\r\n  templateId,\r\n  headerPathIndex,\r\n});\r\n\r\nexport const deleteTemplate = templateId => ({\r\n  type: 'DELETE_TEMPLATE',\r\n  templateId,\r\n});\r\n\r\nexport const restoreCaptureSettings = newSettings => ({\r\n  type: 'RESTORE_CAPTURE_SETTINGS',\r\n  newSettings,\r\n});\r\n\r\nexport const reorderCaptureTemplate = (fromIndex, toIndex) => ({\r\n  type: 'REORDER_CAPTURE_TEMPLATE',\r\n  fromIndex,\r\n  toIndex,\r\n});\r\n","import { Map, List, fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nimport { getOpenHeaderPaths } from '../lib/org_utils';\r\n\r\nimport { restoreBaseSettings } from '../actions/base';\r\nimport { restoreCaptureSettings } from '../actions/capture';\r\n\r\nimport generateId from '../lib/id_generator';\r\n\r\nexport const isLocalStorageAvailable = () => {\r\n  try {\r\n    localStorage.setItem('test', 'test');\r\n    return localStorage.getItem('test') === 'test';\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst debouncedPushConfigToSyncBackend = _.debounce(\r\n  (syncBackendClient, contents) => {\r\n    switch (syncBackendClient.type) {\r\n      case 'Dropbox':\r\n        syncBackendClient\r\n          .createFile('/.org-web-config.json', contents)\r\n          .catch(error =>\r\n            alert(`There was an error trying to push settings to your sync backend: ${error}`)\r\n          );\r\n        break;\r\n      case 'Google Drive':\r\n        syncBackendClient\r\n          .createFile('.org-web-config.json', 'root', contents)\r\n          .catch(error =>\r\n            alert(`There was an error trying to push settings to your sync backend: ${error}`)\r\n          );\r\n        break;\r\n      default:\r\n    }\r\n  },\r\n  1000,\r\n  { maxWait: 3000 }\r\n);\r\n\r\nexport const persistableFields = [\r\n  {\r\n    category: 'base',\r\n    name: 'fontSize',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'bulletStyle',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldTapTodoToAdvance',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n\r\n  {\r\n    category: 'base',\r\n    name: 'agendaDefaultDeadlineDelayUnit',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'agendaDefaultDeadlineDelayValue',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n\r\n  {\r\n    category: 'base',\r\n    name: 'shouldStoreSettingsInSyncBackend',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'lastSeenChangelogHeader',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'customKeybindings',\r\n    type: 'json',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldLiveSync',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: false,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldSyncOnBecomingVisibile',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'capture',\r\n    name: 'captureTemplates',\r\n    type: 'json',\r\n    shouldStoreInConfig: true,\r\n    default: new List(),\r\n  },\r\n];\r\n\r\nexport const readOpennessState = () => {\r\n  const opennessStateJSONString = localStorage.getItem('headerOpenness');\r\n  return !!opennessStateJSONString ? JSON.parse(opennessStateJSONString) : null;\r\n};\r\n\r\nconst getFieldsToPersist = (state, fields) =>\r\n  fields\r\n    .filter(field => !field.depreacted)\r\n    .filter(field => field.category === 'org')\r\n    .map(field => field.name)\r\n    .map(field => [field, state.org.present.get(field)])\r\n    .concat(\r\n      persistableFields\r\n        .filter(field => field.category !== 'org')\r\n        .map(field =>\r\n          field.type === 'json'\r\n            ? [\r\n                field.name,\r\n                JSON.stringify(state[field.category].get(field.name) || field.default || {}),\r\n              ]\r\n            : [field.name, state[field.category].get(field.name)]\r\n        )\r\n    );\r\n\r\nconst getConfigFileContents = fieldsToPersist =>\r\n  JSON.stringify(\r\n    _.fromPairs(\r\n      fieldsToPersist.filter(([name, _value]) => !['lastSeenChangelogHeader'].includes(name))\r\n    ),\r\n    null,\r\n    2\r\n  );\r\n\r\nexport const applyCategorySettingsFromConfig = (state, config, category) => {\r\n  persistableFields\r\n    .filter(field => field.category === category)\r\n    .filter(field => field.shouldStoreInConfig)\r\n    .filter(\r\n      field =>\r\n        // I accidentally included this field in some config files, so I need to forever\r\n        // filter it out here. Whoops...\r\n        field.name !== 'lastSeenChangelogHeader'\r\n    )\r\n    .forEach(field => {\r\n      field.type === 'json'\r\n        ? (state = state.set(field.name, fromJS(JSON.parse(config[field.name]))))\r\n        : (state = state.set(field.name, config[field.name]));\r\n    });\r\n\r\n  return state;\r\n};\r\n\r\nexport const applyCaptureSettingsFromConfig = (state, config) => {\r\n  const captureTemplates = fromJS(JSON.parse(config.captureTemplates)).map(template =>\r\n    template.set('id', generateId())\r\n  );\r\n\r\n  return state.set('captureTemplates', captureTemplates);\r\n};\r\n\r\nexport const readInitialState = () => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return undefined;\r\n  }\r\n\r\n  let initialState = {\r\n    syncBackend: Map(),\r\n    org: {\r\n      past: [],\r\n      present: Map(),\r\n      future: [],\r\n    },\r\n    base: Map(),\r\n    capture: Map(),\r\n  };\r\n\r\n  persistableFields.forEach(field => {\r\n    let value = localStorage.getItem(field.name);\r\n\r\n    if (field.type === 'nullable') {\r\n      if (value === 'null') {\r\n        value = null;\r\n      }\r\n    } else if (field.type === 'boolean') {\r\n      value = value === 'true';\r\n    } else if (field.type === 'json') {\r\n      if (!value) {\r\n        value = field.default || new Map();\r\n      } else {\r\n        value = fromJS(JSON.parse(value));\r\n      }\r\n    }\r\n\r\n    if (field.category === 'org') {\r\n      initialState[field.category].present = initialState[field.category].present.set(\r\n        field.name,\r\n        value\r\n      );\r\n    } else {\r\n      initialState[field.category] = initialState[field.category].set(field.name, value);\r\n    }\r\n  });\r\n\r\n  // Assign new ids to the capture templates.\r\n  if (initialState.capture.get('captureTemplates')) {\r\n    initialState.capture = initialState.capture.update('captureTemplates', templates =>\r\n      templates.map(template => template.set('id', generateId()))\r\n    );\r\n  }\r\n\r\n  const opennessState = readOpennessState();\r\n  if (!!opennessState) {\r\n    initialState.org.present = initialState.org.present.set('opennessState', fromJS(opennessState));\r\n  }\r\n\r\n  // Cache the config file contents locally so we don't overwrite on initial page load.\r\n  window.previousSettingsFileContents = getConfigFileContents(\r\n    getFieldsToPersist(initialState, persistableFields)\r\n  );\r\n\r\n  return initialState;\r\n};\r\n\r\nexport const loadSettingsFromConfigFile = (dispatch, getState) => {\r\n  const syncBackendClient = getState().syncBackend.get('client');\r\n  if (!syncBackendClient) {\r\n    return;\r\n  }\r\n\r\n  let fileContentsPromise = null;\r\n  switch (syncBackendClient.type) {\r\n    case 'Dropbox':\r\n      fileContentsPromise = syncBackendClient.getFileContents('/.org-web-config.json');\r\n      break;\r\n    case 'Google Drive':\r\n      fileContentsPromise = syncBackendClient.getFileContentsByNameAndParent(\r\n        '.org-web-config.json',\r\n        'root'\r\n      );\r\n      break;\r\n    default:\r\n  }\r\n\r\n  fileContentsPromise\r\n    .then(configFileContents => {\r\n      try {\r\n        const config = JSON.parse(configFileContents);\r\n        dispatch(restoreBaseSettings(config));\r\n        dispatch(restoreCaptureSettings(config));\r\n      } catch (_error) {\r\n        // Something went wrong parsing the config file, but we don't care, we'll just\r\n        // overwrite it with a good local copy.\r\n      }\r\n    })\r\n    .catch(() => {});\r\n};\r\n\r\nexport const subscribeToChanges = store => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return () => {};\r\n  } else {\r\n    return () => {\r\n      const state = store.getState();\r\n\r\n      const fieldsToPersist = getFieldsToPersist(state, persistableFields);\r\n\r\n      fieldsToPersist.forEach(([name, value]) => localStorage.setItem(name, value));\r\n\r\n      if (state.base.get('shouldStoreSettingsInSyncBackend')) {\r\n        const settingsFileContents = getConfigFileContents(fieldsToPersist);\r\n\r\n        if (window.previousSettingsFileContents !== settingsFileContents) {\r\n          debouncedPushConfigToSyncBackend(state.syncBackend.get('client'), settingsFileContents);\r\n        }\r\n\r\n        window.previousSettingsFileContents = settingsFileContents;\r\n      }\r\n\r\n      const currentFilePath = state.org.present.get('path');\r\n      if (!!currentFilePath && state.org.present.get('headers')) {\r\n        const openHeaderPaths = getOpenHeaderPaths(state.org.present.get('headers'));\r\n\r\n        let opennessState = {};\r\n        const opennessStateJSONString = localStorage.getItem('headerOpenness');\r\n        if (opennessStateJSONString) {\r\n          opennessState = JSON.parse(opennessStateJSONString);\r\n        }\r\n\r\n        opennessState[currentFilePath] = openHeaderPaths;\r\n        localStorage.setItem('headerOpenness', JSON.stringify(opennessState));\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport const persistField = (field, value) => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return;\r\n  } else {\r\n    localStorage.setItem(field, value);\r\n  }\r\n};\r\n\r\nexport const getPersistedField = (field, nullable = false) => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return null;\r\n  } else {\r\n    const value = localStorage.getItem(field);\r\n    if (nullable) {\r\n      return value === 'null' ? null : value;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\n\r\nimport { applyCategorySettingsFromConfig } from '../util/settings_persister';\r\n\r\nconst setLoadingMessage = (state, action) => state.set('loadingMessage', action.loadingMessage);\r\n\r\nconst hideLoadingMessage = (state, action) => state.set('loadingMessage', null);\r\n\r\nconst setFontSize = (state, action) => state.set('fontSize', action.newFontSize);\r\n\r\nconst setBulletStyle = (state, action) => state.set('bulletStyle', action.newBulletStyle);\r\n\r\nconst setShouldTapTodoToAdvance = (state, action) =>\r\n  state.set('shouldTapTodoToAdvance', action.newShouldTapTodoToAdvance);\r\n\r\nconst setAgendaDefaultDeadlineDelayUnit = (state, action) =>\r\n  state.set('agendaDefaultDeadlineDelayUnit', action.newAgendaDefaultDeadlineDelayUnit);\r\n\r\nconst setAgendaDefaultDeadlineDelayValue = (state, action) =>\r\n  state.set('agendaDefaultDeadlineDelayValue', action.newAgendaDefaultDeadlineDelayValue);\r\n\r\nconst setShouldStoreSettingsInSyncBackend = (state, action) =>\r\n  state.set('shouldStoreSettingsInSyncBackend', action.newShouldStoreSettingsInSyncBackend);\r\n\r\nconst setShouldLiveSync = (state, action) => state.set('shouldLiveSync', action.shouldLiveSync);\r\n\r\nconst setShouldSyncOnBecomingVisibile = (state, action) =>\r\n  state.set('shouldSyncOnBecomingVisibile', action.shouldSyncOnBecomingVisibile);\r\n\r\nconst setHasUnseenChangelog = (state, action) =>\r\n  state.set('hasUnseenChangelog', action.newHasUnseenChangelog);\r\n\r\nconst setLastSeenChangelogHeader = (state, action) =>\r\n  state.set('lastSeenChangelogHeader', action.newLastSeenChangelogHeader);\r\n\r\nconst setLastViewedFile = (state, action) =>\r\n  state\r\n    .set('lastViewedPath', action.lastViewedPath)\r\n    .set('lastViewedContents', action.lastViewedContents);\r\n\r\nconst setCustomKeybinding = (state, action) => {\r\n  if (!state.get('customKeybindings')) {\r\n    state = state.set('customKeybindings', new Map());\r\n  }\r\n\r\n  return state.setIn(['customKeybindings', action.keybindingName], action.keybinding);\r\n};\r\n\r\nconst restoreBaseSettings = (state, action) => {\r\n  if (!action.newSettings) {\r\n    return state;\r\n  }\r\n\r\n  return applyCategorySettingsFromConfig(state, action.newSettings, 'base');\r\n};\r\n\r\nconst pushModalPage = (state, action) =>\r\n  state.update('modalPageStack', stack =>\r\n    !!stack ? stack.push(action.modalPage) : List([action.modalPage])\r\n  );\r\n\r\nconst popModalPage = state =>\r\n  state.update('modalPageStack', stack => (!!stack ? stack.pop() : stack));\r\n\r\nconst clearModalStack = state => state.set('modalPageStack', List());\r\n\r\nconst activatePopup = (state, action) =>\r\n  state.set(\r\n    'activePopup',\r\n    fromJS({\r\n      type: action.popupType,\r\n      data: action.data,\r\n    })\r\n  );\r\n\r\nconst closePopup = state => state.set('activePopup', null);\r\n\r\nconst setIsLoading = (state, action) => state.set('isLoading', action.isLoading);\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'SET_LOADING_MESSAGE':\r\n      return setLoadingMessage(state, action);\r\n    case 'HIDE_LOADING_MESSAGE':\r\n      return hideLoadingMessage(state, action);\r\n    case 'SET_FONT_SIZE':\r\n      return setFontSize(state, action);\r\n    case 'SET_BULLET_STYLE':\r\n      return setBulletStyle(state, action);\r\n    case 'SET_SHOULD_TAP_TODO_TO_ADVANCE':\r\n      return setShouldTapTodoToAdvance(state, action);\r\n    case 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_UNIT':\r\n      return setAgendaDefaultDeadlineDelayUnit(state, action);\r\n    case 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_VALUE':\r\n      return setAgendaDefaultDeadlineDelayValue(state, action);\r\n    case 'SET_SHOULD_STORE_SETTINGS_IN_SYNC_BACKEND':\r\n      return setShouldStoreSettingsInSyncBackend(state, action);\r\n    case 'SET_SHOULD_LIVE_SYNC':\r\n      return setShouldLiveSync(state, action);\r\n    case 'SET_SHOULD_SYNC_ON_BECOMING_VISIBLE':\r\n      return setShouldSyncOnBecomingVisibile(state, action);\r\n    case 'SET_HAS_UNSEEN_CHANGELOG':\r\n      return setHasUnseenChangelog(state, action);\r\n    case 'SET_LAST_SEEN_CHANGELOG_HEADER':\r\n      return setLastSeenChangelogHeader(state, action);\r\n    case 'SET_LAST_VIEWED_FILE':\r\n      return setLastViewedFile(state, action);\r\n    case 'SET_CUSTOM_KEYBINDING':\r\n      return setCustomKeybinding(state, action);\r\n    case 'RESTORE_BASE_SETTINGS':\r\n      return restoreBaseSettings(state, action);\r\n    case 'PUSH_MODAL_PAGE':\r\n      return pushModalPage(state, action);\r\n    case 'POP_MODAL_PAGE':\r\n      return popModalPage(state, action);\r\n    case 'CLEAR_MODAL_STACK':\r\n      return clearModalStack(state, action);\r\n    case 'ACTIVATE_POPUP':\r\n      return activatePopup(state, action);\r\n    case 'CLOSE_POPUP':\r\n      return closePopup(state, action);\r\n    case 'SET_IS_LOADING':\r\n      return setIsLoading(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import generateId from './id_generator';\r\n\r\nimport { fromJS, List } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\n// Yeah, this thing is pretty wild. I use https://www.debuggex.com/ to edit it, then paste the results in here.\r\n// But fixing this mess is on my todo list...\r\nconst markupAndCookieRegex = /(\\[\\[([^\\]]*)\\]\\]|\\[\\[([^\\]]*)\\]\\[([^\\]]*)\\]\\])|(\\[((\\d*%)|(\\d*\\/\\d*))\\])|(([\\s({'\"]?)([*/~=_+])([^\\s,'](.*)[^\\s,'])\\11([\\s\\-.,:!?'\")}]?))|(([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]](?:--([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]])?)/g;\r\nconst timestampRegex = /([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]]/;\r\n\r\nconst timestampFromRegexMatch = (match, partIndices) => {\r\n  const [\r\n    typeBracket,\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    timeStart,\r\n    timeEnd,\r\n    firstDelayRepeatType,\r\n    firstDelayRepeatValue,\r\n    firstDelayRepeatUnit,\r\n    secondDelayRepeatType,\r\n    secondDelayRepeatValue,\r\n    secondDelayRepeatUnit,\r\n  ] = partIndices.map(partIndex => match[partIndex]);\r\n\r\n  if (!year) {\r\n    return null;\r\n  }\r\n\r\n  const [startHour, startMinute] = !!timeStart ? timeStart.split(':') : [];\r\n  const [endHour, endMinute] = !!timeEnd ? timeEnd.split(':') : [];\r\n\r\n  let repeaterType, repeaterValue, repeaterUnit;\r\n  let delayType, delayValue, delayUnit;\r\n\r\n  if (['+', '++', '.+'].includes(firstDelayRepeatType)) {\r\n    repeaterType = firstDelayRepeatType;\r\n    repeaterValue = firstDelayRepeatValue;\r\n    repeaterUnit = firstDelayRepeatUnit;\r\n  } else if (['-', '--'].includes(firstDelayRepeatType)) {\r\n    delayType = firstDelayRepeatType;\r\n    delayValue = firstDelayRepeatValue;\r\n    delayUnit = firstDelayRepeatUnit;\r\n  }\r\n  if (['+', '++', '.+'].includes(secondDelayRepeatType)) {\r\n    repeaterType = secondDelayRepeatType;\r\n    repeaterValue = secondDelayRepeatValue;\r\n    repeaterUnit = secondDelayRepeatUnit;\r\n  } else if (['-', '--'].includes(secondDelayRepeatType)) {\r\n    delayType = secondDelayRepeatType;\r\n    delayValue = secondDelayRepeatValue;\r\n    delayUnit = secondDelayRepeatUnit;\r\n  }\r\n\r\n  return {\r\n    isActive: typeBracket === '<',\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    startHour,\r\n    startMinute,\r\n    endHour,\r\n    endMinute,\r\n    repeaterType,\r\n    repeaterValue,\r\n    repeaterUnit,\r\n    delayType,\r\n    delayValue,\r\n    delayUnit,\r\n  };\r\n};\r\n\r\nexport const parseMarkupAndCookies = (\r\n  rawText,\r\n  { shouldAppendNewline = false, excludeCookies = true } = {}\r\n) => {\r\n  const matches = [];\r\n  let match = markupAndCookieRegex.exec(rawText);\r\n  while (match) {\r\n    if (!!match[2]) {\r\n      matches.push({\r\n        type: 'link',\r\n        rawText: match[0],\r\n        uri: match[2],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[3] && !!match[4]) {\r\n      matches.push({\r\n        type: 'link',\r\n        rawText: match[0],\r\n        uri: match[3],\r\n        title: match[4],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[7]) {\r\n      const percentCookieMatch = match[7].match(/(\\d*)%/);\r\n      matches.push({\r\n        type: 'percentage-cookie',\r\n        rawText: match[0],\r\n        percentage: percentCookieMatch[1],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[8]) {\r\n      const fractionCookieMatch = match[8].match(/(\\d*)\\/(\\d*)/);\r\n      matches.push({\r\n        type: 'fraction-cookie',\r\n        rawText: match[0],\r\n        fraction: [fractionCookieMatch[1], fractionCookieMatch[2]],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[11]) {\r\n      const markupType = {\r\n        '~': 'inline-code',\r\n        '*': 'bold',\r\n        '/': 'italic',\r\n        '+': 'strikethrough',\r\n        _: 'underline',\r\n        '=': 'verbatim',\r\n      }[match[11]];\r\n\r\n      const markupPrefixLength = match[10].length;\r\n\r\n      matches.push({\r\n        type: 'inline-markup',\r\n        rawText: match[0].substring(markupPrefixLength, match[12].length + 2 + markupPrefixLength),\r\n        index: match.index + markupPrefixLength,\r\n        content: match[12],\r\n        markupType,\r\n      });\r\n    } else if (!!match[15]) {\r\n      const firstTimestamp = timestampFromRegexMatch(match, _.range(16, 29));\r\n      const secondTimestamp = timestampFromRegexMatch(match, _.range(29, 42));\r\n\r\n      matches.push({\r\n        type: 'timestamp',\r\n        rawText: match[0],\r\n        index: match.index,\r\n        firstTimestamp,\r\n        secondTimestamp,\r\n      });\r\n    }\r\n    match = markupAndCookieRegex.exec(rawText);\r\n  }\r\n\r\n  const lineParts = [];\r\n  let startIndex = 0;\r\n  matches.forEach(match => {\r\n    let index = match.index;\r\n\r\n    if (index !== startIndex) {\r\n      const text = rawText.substring(startIndex, index);\r\n      lineParts.push({\r\n        type: 'text',\r\n        contents: text,\r\n      });\r\n    }\r\n\r\n    if (match.type === 'link') {\r\n      const linkPart = {\r\n        id: generateId(),\r\n        type: 'link',\r\n        contents: {\r\n          uri: match.uri,\r\n        },\r\n      };\r\n      if (match.title) {\r\n        linkPart.contents.title = match.title;\r\n      }\r\n      lineParts.push(linkPart);\r\n    } else if (match.type === 'percentage-cookie') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'percentage-cookie',\r\n        percentage: match.percentage,\r\n      });\r\n    } else if (match.type === 'fraction-cookie') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'fraction-cookie',\r\n        fraction: match.fraction,\r\n      });\r\n    } else if (match.type === 'inline-markup') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'inline-markup',\r\n        content: match.content,\r\n        markupType: match.markupType,\r\n      });\r\n    } else if (match.type === 'timestamp') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'timestamp',\r\n        firstTimestamp: match.firstTimestamp,\r\n        secondTimestamp: match.secondTimestamp,\r\n      });\r\n    }\r\n\r\n    startIndex = match.index + match.rawText.length;\r\n  });\r\n\r\n  if (startIndex !== rawText.length || shouldAppendNewline) {\r\n    const trailingText =\r\n      rawText.substring(startIndex, rawText.length) + (shouldAppendNewline ? '\\n' : '');\r\n    lineParts.push({\r\n      type: 'text',\r\n      contents: trailingText,\r\n    });\r\n  }\r\n\r\n  return lineParts;\r\n};\r\n\r\nconst parseTable = tableLines => {\r\n  const table = {\r\n    id: generateId(),\r\n    type: 'table',\r\n    contents: [[]],\r\n    columnProperties: [],\r\n  };\r\n\r\n  tableLines\r\n    .map(line => line.trim())\r\n    .forEach(line => {\r\n      if (line.startsWith('|-')) {\r\n        table.contents.push([]);\r\n      } else {\r\n        const lastRow = _.last(table.contents);\r\n        const lineCells = line.substr(1, line.length - 2).split('|');\r\n\r\n        if (lastRow.length === 0) {\r\n          lineCells.forEach(cell => lastRow.push(cell));\r\n        } else {\r\n          lineCells.forEach((cellContents, cellIndex) => {\r\n            lastRow[cellIndex] += `\\n${cellContents}`;\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n  // Parse the contents of each cell.\r\n  table.contents = table.contents.map(row => ({\r\n    id: generateId(),\r\n    contents: row.map(rawContents => ({\r\n      id: generateId(),\r\n      contents: parseMarkupAndCookies(rawContents, { excludeCookies: true }),\r\n      rawContents,\r\n    })),\r\n  }));\r\n\r\n  // We sometimes end up with an extra, empty row - remove it if so.\r\n  if (_.last(table.contents).contents.length === 0) {\r\n    table.contents = table.contents.slice(0, table.contents.length - 1);\r\n  }\r\n\r\n  // Make sure each row has the same number of columns.\r\n  const maxNumColumns = Math.max(...table.contents.map(row => row.contents.length));\r\n  table.contents.forEach(row => {\r\n    if (row.contents.length < maxNumColumns) {\r\n      _.times(maxNumColumns - row.contents.length, () => {\r\n        row.contents.push({\r\n          id: generateId(),\r\n          contents: [],\r\n          rawContents: '',\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n  return table;\r\n};\r\n\r\nexport const parseRawText = (rawText, { excludeContentElements = false } = {}) => {\r\n  const lines = rawText.split('\\n');\r\n\r\n  const LIST_HEADER_REGEX = /^\\s*([-+*]|(\\d+(\\.|\\)))) (.*)/;\r\n\r\n  let currentListHeaderNestingLevel = null;\r\n  const rawLineParts = _.flatten(\r\n    lines.map((line, lineIndex) => {\r\n      const numLeadingSpaces = line.match(/^( *)/)[0].length;\r\n\r\n      if (\r\n        currentListHeaderNestingLevel !== null &&\r\n        (numLeadingSpaces > currentListHeaderNestingLevel || !line.trim())\r\n      ) {\r\n        return [\r\n          {\r\n            type: 'raw-list-content',\r\n            line,\r\n          },\r\n        ];\r\n      } else {\r\n        currentListHeaderNestingLevel = null;\r\n\r\n        if (!!line.match(LIST_HEADER_REGEX) && !excludeContentElements) {\r\n          currentListHeaderNestingLevel = numLeadingSpaces;\r\n\r\n          return [\r\n            {\r\n              type: 'raw-list-header',\r\n              line,\r\n            },\r\n          ];\r\n        } else if (line.trim().startsWith('|') && !excludeContentElements) {\r\n          return [\r\n            {\r\n              type: 'raw-table',\r\n              line,\r\n            },\r\n          ];\r\n        } else {\r\n          return parseMarkupAndCookies(line, {\r\n            shouldAppendNewline: lineIndex !== lines.length - 1,\r\n            excludeCookies: true,\r\n          });\r\n        }\r\n      }\r\n    })\r\n  );\r\n\r\n  const processedLineParts = [];\r\n  for (let partIndex = 0; partIndex < rawLineParts.length; ++partIndex) {\r\n    const linePart = rawLineParts[partIndex];\r\n    if (linePart.type === 'raw-table') {\r\n      const tableLines = _.takeWhile(\r\n        rawLineParts.slice(partIndex),\r\n        part => part.type === 'raw-table'\r\n      ).map(part => part.line);\r\n\r\n      processedLineParts.push(parseTable(tableLines));\r\n\r\n      partIndex += tableLines.length - 1;\r\n    } else if (linePart.type === 'raw-list-header') {\r\n      const numLeadingSpaces = linePart.line.match(/^( *)/)[0].length;\r\n      const contentLines = _.takeWhile(\r\n        rawLineParts.slice(partIndex + 1),\r\n        part => part.type === 'raw-list-content'\r\n      )\r\n        .map(part => part.line)\r\n        .map(line =>\r\n          line.startsWith(' '.repeat(numLeadingSpaces + 2))\r\n            ? line.substr(numLeadingSpaces + 2)\r\n            : line.substr(numLeadingSpaces + 1)\r\n        );\r\n      if (contentLines[contentLines.length - 1] === '') {\r\n        contentLines[contentLines.length - 1] = ' ';\r\n      }\r\n      const contents = parseRawText(contentLines.join('\\n')).toJS();\r\n\r\n      partIndex += contentLines.length;\r\n\r\n      const isOrdered = !!linePart.line.match(/^\\s*\\d+[.)]/);\r\n\r\n      // Remove the leading -, +, *, or number characters.\r\n      let line = linePart.line.match(LIST_HEADER_REGEX)[4];\r\n\r\n      let forceNumber = null;\r\n      if (line.match(/^\\s*\\[@\\d+\\]/)) {\r\n        forceNumber = line.match(/^\\s*\\[@(\\d+)\\]/)[1];\r\n        line = line.replace(/^\\s*\\[@\\d+\\]\\s*/, '');\r\n      }\r\n\r\n      let checkboxState = null;\r\n      const isCheckbox = !!line.match(/^\\s*\\[[ X-]\\]/);\r\n      if (isCheckbox) {\r\n        const stateCharacter = line.match(/^\\s*\\[([ X-])\\]/)[1];\r\n        checkboxState = {\r\n          ' ': 'unchecked',\r\n          X: 'checked',\r\n          '-': 'partial',\r\n        }[stateCharacter];\r\n\r\n        line = line.replace(/^\\s*\\[[ X-]\\]\\s*/, '');\r\n      }\r\n\r\n      const newListItem = {\r\n        id: generateId(),\r\n        titleLine: parseMarkupAndCookies(line),\r\n        contents,\r\n        forceNumber,\r\n        isCheckbox,\r\n        checkboxState,\r\n      };\r\n\r\n      const lastIndex = processedLineParts.length - 1;\r\n      if (lastIndex >= 0 && processedLineParts[lastIndex].type === 'list') {\r\n        processedLineParts[lastIndex].items.push(newListItem);\r\n      } else {\r\n        processedLineParts.push({\r\n          type: 'list',\r\n          id: generateId(),\r\n          items: [newListItem],\r\n          bulletCharacter: linePart.line.trim()[0],\r\n          numberTerminatorCharacter: isOrdered ? linePart.line.match(/\\s*\\d+([.)])/)[1] : null,\r\n          isOrdered,\r\n        });\r\n      }\r\n    } else {\r\n      processedLineParts.push(linePart);\r\n    }\r\n  }\r\n\r\n  return fromJS(processedLineParts);\r\n};\r\n\r\nexport const _parsePlanningItems = rawText => {\r\n  const singlePlanningItemRegex = concatRegexes(/(DEADLINE|SCHEDULED|CLOSED):\\s*/, timestampRegex);\r\n  const optionalSinglePlanningItemRegex = RegExp(\r\n    '(' +\r\n      singlePlanningItemRegex\r\n        .toString()\r\n        .substring(1, singlePlanningItemRegex.toString().length - 1) +\r\n      ')?'\r\n  );\r\n\r\n  const planningRegex = concatRegexes(\r\n    /^\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/\r\n  );\r\n  const planningMatch = rawText.match(planningRegex);\r\n\r\n  const planningItems = fromJS(\r\n    [2, 17, 32]\r\n      .map(planningTypeIndex => {\r\n        const type = planningMatch[planningTypeIndex];\r\n        if (!type) {\r\n          return null;\r\n        }\r\n\r\n        const timestamp = timestampFromRegexMatch(\r\n          planningMatch,\r\n          _.range(planningTypeIndex + 1, planningTypeIndex + 1 + 13)\r\n        );\r\n\r\n        return { type, timestamp, id: generateId() };\r\n      })\r\n      .filter(item => !!item)\r\n  );\r\n\r\n  if (planningItems.size > 0) {\r\n    // The `rawText` can look like:\r\n    // `SCHEDULED: <2019-07-30 Tue>\r\n    //   - indented list\r\n    //      - Foo`\r\n    // For the remaining description, filter the planning item out\r\n    const remainingDescriptionWithoutPlanningItem = rawText\r\n      .split('\\n')\r\n      .filter(line => {\r\n        return !line.includes(planningMatch[0].trim());\r\n      })\r\n      .join('\\n');\r\n    return { planningItems, strippedDescription: remainingDescriptionWithoutPlanningItem };\r\n  } else {\r\n    return { planningItems: fromJS([]), strippedDescription: rawText };\r\n  }\r\n};\r\n\r\nconst parsePropertyList = rawText => {\r\n  const lines = rawText.split('\\n');\r\n  const propertiesLineIndex = lines.findIndex(line => line.trim() === ':PROPERTIES:');\r\n  const endLineIndex = lines.findIndex(line => line.trim() === ':END:');\r\n\r\n  if (\r\n    propertiesLineIndex === -1 ||\r\n    endLineIndex === -1 ||\r\n    !rawText.trim().startsWith(':PROPERTIES:')\r\n  ) {\r\n    return {\r\n      propertyListItems: List(),\r\n      strippedDescription: rawText,\r\n    };\r\n  }\r\n\r\n  const propertyListItems = fromJS(\r\n    lines\r\n      .slice(propertiesLineIndex + 1, endLineIndex)\r\n      .map(line => {\r\n        const match = line.match(/:([^\\s]*):(?: (.*))?/);\r\n        if (!match) {\r\n          return null;\r\n        }\r\n\r\n        const value = !!match[2] ? parseMarkupAndCookies(match[2]) : null;\r\n\r\n        return {\r\n          property: match[1],\r\n          value,\r\n          id: generateId(),\r\n        };\r\n      })\r\n      .filter(result => !!result)\r\n  );\r\n\r\n  return {\r\n    propertyListItems,\r\n    strippedDescription: lines.slice(endLineIndex + 1).join('\\n'),\r\n  };\r\n};\r\n\r\nexport const parseDescriptionPrefixElements = rawText => {\r\n  const planningItemsParse = _parsePlanningItems(rawText);\r\n  const propertyListParse = parsePropertyList(planningItemsParse.strippedDescription);\r\n\r\n  return {\r\n    planningItems: planningItemsParse.planningItems,\r\n    propertyListItems: propertyListParse.propertyListItems,\r\n    strippedDescription: propertyListParse.strippedDescription,\r\n  };\r\n};\r\n\r\nconst defaultKeywordSets = fromJS([\r\n  {\r\n    keywords: ['TODO', 'DONE'],\r\n    completedKeywords: ['DONE'],\r\n    default: true,\r\n  },\r\n]);\r\n\r\nexport const parseTitleLine = (titleLine, todoKeywordSets) => {\r\n  const allKeywords = todoKeywordSets.flatMap(todoKeywordSet => {\r\n    return todoKeywordSet.get('keywords');\r\n  });\r\n  const todoKeyword = allKeywords.filter(keyword => titleLine.startsWith(keyword + ' ')).first();\r\n  let rawTitle = titleLine;\r\n  if (todoKeyword) {\r\n    rawTitle = rawTitle.substr(todoKeyword.length + 1);\r\n  }\r\n\r\n  // Check for tags.\r\n  let tags = [];\r\n  if (rawTitle.trimRight().endsWith(':')) {\r\n    const titleParts = rawTitle.trimRight().split(' ');\r\n    const possibleTags = titleParts[titleParts.length - 1];\r\n    if (/^:[^\\s]+:$/.test(possibleTags)) {\r\n      rawTitle = rawTitle.substr(0, rawTitle.length - possibleTags.length);\r\n      tags = possibleTags.split(':').filter(tag => tag !== '');\r\n    }\r\n  }\r\n\r\n  const title = parseMarkupAndCookies(rawTitle);\r\n\r\n  return fromJS({ title, rawTitle, todoKeyword, tags });\r\n};\r\n\r\nexport const newHeaderWithTitle = (line, nestingLevel, todoKeywordSets) => {\r\n  if (todoKeywordSets.size === 0) {\r\n    todoKeywordSets = defaultKeywordSets;\r\n  }\r\n\r\n  const titleLine = parseTitleLine(line, todoKeywordSets);\r\n  return fromJS({\r\n    titleLine,\r\n    rawDescription: '',\r\n    description: [],\r\n    opened: false,\r\n    id: generateId(),\r\n    nestingLevel,\r\n    planningItems: [],\r\n    propertyListItems: [],\r\n  });\r\n};\r\n\r\nconst concatRegexes = (...regexes) =>\r\n  regexes.reduce((prev, curr) =>\r\n    RegExp(\r\n      prev.toString().substring(1, prev.toString().length - 1) +\r\n        curr.toString().substring(1, curr.toString().length - 1)\r\n    )\r\n  );\r\n\r\nexport const newHeaderFromText = (rawText, todoKeywordSets) => {\r\n  const titleLine = rawText.split('\\n')[0].replace(/^\\**\\s*/, '');\r\n  const description = rawText\r\n    .split('\\n')\r\n    .slice(1)\r\n    .join('\\n');\r\n\r\n  const { planningItems, propertyListItems, strippedDescription } = parseDescriptionPrefixElements(\r\n    description\r\n  );\r\n\r\n  return newHeaderWithTitle(titleLine, 1, todoKeywordSets)\r\n    .set('rawDescription', strippedDescription)\r\n    .set('description', parseRawText(strippedDescription))\r\n    .set('planningItems', planningItems)\r\n    .set('propertyListItems', propertyListItems);\r\n};\r\n\r\nexport const parseOrg = fileContents => {\r\n  let headers = new List();\r\n  const lines = fileContents.split('\\n');\r\n\r\n  let todoKeywordSets = new List();\r\n  let fileConfigLines = new List();\r\n  let linesBeforeHeadings = new List();\r\n\r\n  lines.forEach(line => {\r\n    if (line.startsWith('*')) {\r\n      let nestingLevel = line.indexOf(' ');\r\n      if (nestingLevel === -1) {\r\n        nestingLevel = line.length;\r\n      }\r\n      const title = line.substr(nestingLevel + 1);\r\n      headers = headers.push(newHeaderWithTitle(title, nestingLevel, todoKeywordSets));\r\n    } else {\r\n      if (headers.size === 0) {\r\n        if (line.startsWith('#+TODO: ') || line.startsWith('#+TYP_TODO: ')) {\r\n          const keywordsString = line.substr(line.indexOf(':') + 2);\r\n          const keywordTokens = keywordsString.split(/\\s/);\r\n          const keywords = keywordTokens.filter(keyword => keyword !== '|');\r\n\r\n          const pipeIndex = keywordTokens.indexOf('|');\r\n          const completedKeywords = pipeIndex >= 0 ? keywords.slice(pipeIndex) : [];\r\n\r\n          todoKeywordSets = todoKeywordSets.push(\r\n            fromJS({\r\n              keywords,\r\n              completedKeywords,\r\n              configLine: line,\r\n              default: false,\r\n            })\r\n          );\r\n        } else if (line.startsWith('#+')) {\r\n          fileConfigLines = fileConfigLines.push(line);\r\n        } else {\r\n          linesBeforeHeadings = linesBeforeHeadings.push(line);\r\n        }\r\n      } else {\r\n        headers = headers.updateIn([headers.size - 1, 'rawDescription'], rawDescription =>\r\n          rawDescription.length === 0 ? line : rawDescription + '\\n' + line\r\n        );\r\n      }\r\n    }\r\n  });\r\n\r\n  if (todoKeywordSets.size === 0) {\r\n    todoKeywordSets = defaultKeywordSets;\r\n  }\r\n\r\n  headers = headers.map(header => {\r\n    const {\r\n      planningItems,\r\n      propertyListItems,\r\n      strippedDescription,\r\n    } = parseDescriptionPrefixElements(header.get('rawDescription'));\r\n\r\n    return header\r\n      .set('rawDescription', strippedDescription)\r\n      .set('description', parseRawText(strippedDescription))\r\n      .set('planningItems', planningItems)\r\n      .set('propertyListItems', propertyListItems);\r\n  });\r\n\r\n  return fromJS({\r\n    headers,\r\n    todoKeywordSets,\r\n    fileConfigLines,\r\n    linesBeforeHeadings,\r\n  });\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nimport {\r\n  parseOrg,\r\n  parseTitleLine,\r\n  parseRawText,\r\n  parseDescriptionPrefixElements,\r\n  parseMarkupAndCookies,\r\n  newHeaderWithTitle,\r\n  newHeaderFromText,\r\n} from '../lib/parse_org';\r\nimport { attributedStringToRawText } from '../lib/export_org';\r\nimport {\r\n  indexOfHeaderWithId,\r\n  headerWithId,\r\n  parentIdOfHeaderWithId,\r\n  subheadersOfHeaderWithId,\r\n  numSubheadersOfHeaderWithId,\r\n  indexOfPreviousSibling,\r\n  openDirectParent,\r\n  openHeaderWithPath,\r\n  nextVisibleHeaderAfterIndex,\r\n  previousVisibleHeaderAfterIndex,\r\n  updateTableContainingCellId,\r\n  newEmptyTableRowLikeRows,\r\n  newEmptyTableCell,\r\n  headerThatContainsTableCellId,\r\n  headerWithPath,\r\n  pathAndPartOfListItemWithIdInHeaders,\r\n  pathAndPartOfTimestampItemWithIdInHeaders,\r\n  todoKeywordSetForKeyword,\r\n  newListItem,\r\n  parentListItemWithIdInHeaders,\r\n  updateListContainingListItemId,\r\n  headerThatContainsListItemId,\r\n  updateContentsWithListItemAddition,\r\n} from '../lib/org_utils';\r\nimport { getCurrentTimestamp, applyRepeater, renderAsText } from '../lib/timestamps';\r\nimport generateId from '../lib/id_generator';\r\n\r\nconst displayFile = (state, action) => {\r\n  const parsedFile = parseOrg(action.contents);\r\n\r\n  return state\r\n    .set('path', action.path)\r\n    .set('contents', action.contents)\r\n    .set('headers', parsedFile.get('headers'))\r\n    .set('todoKeywordSets', parsedFile.get('todoKeywordSets'))\r\n    .set('fileConfigLines', parsedFile.get('fileConfigLines'))\r\n    .set('linesBeforeHeadings', parsedFile.get('linesBeforeHeadings'));\r\n};\r\n\r\nconst stopDisplayingFile = state =>\r\n  state\r\n    .set('path', null)\r\n    .set('contents', null)\r\n    .set('headers', null)\r\n    .set('todoKeywordSets', null)\r\n    .set('fileConfigLines', null)\r\n    .set('linesBeforeHeadings', null);\r\n\r\nconst openHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  return state.setIn(['headers', headerIndex, 'opened'], true);\r\n};\r\n\r\nconst toggleHeaderOpened = (state, action) => {\r\n  const headers = state.get('headers');\r\n\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  const isOpened = headerWithId(headers, action.headerId).get('opened');\r\n\r\n  if (isOpened && state.get('focusedHeaderId') === action.headerId) {\r\n    return state;\r\n  }\r\n\r\n  if (isOpened) {\r\n    const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n    subheaders.forEach((subheader, index) => {\r\n      state = state.setIn(['headers', headerIndex + index + 1, 'opened'], false);\r\n    });\r\n  }\r\n\r\n  return state.setIn(['headers', headerIndex, 'opened'], !isOpened);\r\n};\r\n\r\nconst selectHeader = (state, action) => {\r\n  return state.set('selectedHeaderId', action.headerId);\r\n};\r\n\r\nconst openParentsOfHeader = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const { headerId } = action;\r\n\r\n  let parentHeaderId = parentIdOfHeaderWithId(headers, headerId);\r\n  while (!!parentHeaderId) {\r\n    const parentHeaderIndex = indexOfHeaderWithId(headers, parentHeaderId);\r\n    headers = headers.setIn([parentHeaderIndex, 'opened'], true);\r\n    parentHeaderId = parentIdOfHeaderWithId(headers, parentHeaderId);\r\n  }\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst updateCookiesInAttributedStringWithChildCompletionStates = (parts, completionStates) => {\r\n  const doneCount = completionStates.filter(isDone => isDone).length;\r\n  const totalCount = completionStates.length;\r\n\r\n  return parts.map(part => {\r\n    switch (part.get('type')) {\r\n      case 'fraction-cookie':\r\n        return part.set('fraction', List([doneCount, totalCount]));\r\n      case 'percentage-cookie':\r\n        return part.set('percentage', Math.floor((doneCount / totalCount) * 100));\r\n      default:\r\n        return part;\r\n    }\r\n  });\r\n};\r\n\r\nconst updateCookiesOfHeaderWithId = (state, headerId) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n  const subheaders = subheadersOfHeaderWithId(headers, headerId);\r\n\r\n  const directChildren = [];\r\n  for (let i = 0; i < subheaders.size; ++i) {\r\n    const subheader = subheaders.get(i);\r\n    directChildren.push(subheader);\r\n\r\n    const subheaderSubheaders = subheadersOfHeaderWithId(headers, subheader.get('id'));\r\n    i += subheaderSubheaders.size;\r\n  }\r\n\r\n  let completionStates = directChildren\r\n    .map(header => header.getIn(['titleLine', 'todoKeyword']))\r\n    .filter(todoKeyword => !!todoKeyword)\r\n    .map(todoKeyword =>\r\n      todoKeywordSetForKeyword(state.get('todoKeywordSets'), todoKeyword)\r\n        .get('completedKeywords')\r\n        .contains(todoKeyword)\r\n    );\r\n\r\n  // If there are no headers with possible completion states, check for plain lists instead.\r\n  if (completionStates.length === 0) {\r\n    completionStates = headers\r\n      .get(headerIndex)\r\n      .get('description')\r\n      .filter(part => part.get('type') === 'list')\r\n      .flatMap(listPart => listPart.get('items'))\r\n      .filter(item => item.get('isCheckbox'))\r\n      .map(item => item.get('checkboxState') === 'checked')\r\n      .toJS();\r\n  }\r\n\r\n  return state\r\n    .updateIn(['headers', headerIndex, 'titleLine', 'title'], title =>\r\n      updateCookiesInAttributedStringWithChildCompletionStates(title, completionStates)\r\n    )\r\n    .updateIn(['headers', headerIndex, 'titleLine'], titleLine =>\r\n      titleLine.set('rawTitle', attributedStringToRawText(titleLine.get('title')))\r\n    );\r\n};\r\n\r\nconst updateCookiesOfParentOfHeaderWithId = (state, headerId) => {\r\n  const parentHeaderId = parentIdOfHeaderWithId(state.get('headers'), headerId);\r\n  if (!parentHeaderId) {\r\n    return state;\r\n  }\r\n\r\n  return updateCookiesOfHeaderWithId(state, parentHeaderId);\r\n};\r\n\r\nconst advanceTodoState = (state, action) => {\r\n  const headerId = action.headerId || state.get('selectedHeaderId');\r\n  if (!headerId) {\r\n    return state;\r\n  }\r\n\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const currentTodoState = header.getIn(['titleLine', 'todoKeyword']);\r\n  const currentTodoSet = todoKeywordSetForKeyword(state.get('todoKeywordSets'), currentTodoState);\r\n\r\n  const currentStateIndex = currentTodoSet.get('keywords').indexOf(currentTodoState);\r\n  const newStateIndex = currentStateIndex + 1;\r\n  const newTodoState = currentTodoSet.get('keywords').get(newStateIndex) || '';\r\n\r\n  const indexedPlanningItemsWithRepeaters = header\r\n    .get('planningItems')\r\n    .map((planningItem, index) => [planningItem, index])\r\n    .filter(([planningItem, index]) => !!planningItem.getIn(['timestamp', 'repeaterType']));\r\n\r\n  if (\r\n    currentTodoSet.get('completedKeywords').includes(newTodoState) &&\r\n    indexedPlanningItemsWithRepeaters.size > 0\r\n  ) {\r\n    indexedPlanningItemsWithRepeaters.forEach(([planningItem, planningItemIndex]) => {\r\n      state = state.setIn(\r\n        ['headers', headerIndex, 'planningItems', planningItemIndex, 'timestamp'],\r\n        applyRepeater(planningItem.get('timestamp'), new Date())\r\n      );\r\n    });\r\n\r\n    state = state.setIn(\r\n      ['headers', headerIndex, 'titleLine', 'todoKeyword'],\r\n      currentTodoSet.get('keywords').first()\r\n    );\r\n\r\n    const lastRepeatTimestamp = getCurrentTimestamp({ isActive: false, withStartTime: true });\r\n    const newLastRepeatValue = [\r\n      {\r\n        type: 'timestamp',\r\n        id: generateId(),\r\n        firstTimestamp: lastRepeatTimestamp,\r\n        secondTimestamp: null,\r\n      },\r\n    ];\r\n    state = state.updateIn(['headers', headerIndex, 'propertyListItems'], propertyListItems =>\r\n      propertyListItems.some(item => item.get('property') === 'LAST_REPEAT')\r\n        ? propertyListItems.map(item =>\r\n            item.get('property') === 'LAST_REPEAT'\r\n              ? item.set('value', fromJS(newLastRepeatValue))\r\n              : item\r\n          )\r\n        : propertyListItems.push(\r\n            fromJS({\r\n              property: 'LAST_REPEAT',\r\n              value: newLastRepeatValue,\r\n              id: generateId(),\r\n            })\r\n          )\r\n    );\r\n\r\n    state = state.updateIn(['headers', headerIndex], header => {\r\n      let rawDescription = header.get('rawDescription');\r\n      if (rawDescription.startsWith('\\n')) {\r\n        rawDescription = rawDescription.slice(1);\r\n      }\r\n\r\n      rawDescription =\r\n        `\\n- State \"${newTodoState}\"       from \"${currentTodoState}\"       ${renderAsText(\r\n          fromJS(lastRepeatTimestamp)\r\n        )}\\n` + rawDescription;\r\n\r\n      return header\r\n        .set('rawDescription', rawDescription)\r\n        .set('description', parseRawText(rawDescription));\r\n    });\r\n  } else {\r\n    state = state.setIn(['headers', headerIndex, 'titleLine', 'todoKeyword'], newTodoState);\r\n  }\r\n\r\n  state = updateCookiesOfParentOfHeaderWithId(state, headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst enterEditMode = (state, action) => state.set('editMode', action.editModeType);\r\n\r\nconst exitEditMode = (state, action) => state.set('editMode', null);\r\n\r\nconst updateHeaderTitle = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const newTitleLine = parseTitleLine(action.newRawTitle, state.get('todoKeywordSets'));\r\n\r\n  state = state.setIn(['headers', headerIndex, 'titleLine'], newTitleLine);\r\n\r\n  return updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n};\r\n\r\nconst updateHeaderDescription = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  return state.updateIn(['headers', headerIndex], header => {\r\n    const {\r\n      planningItems,\r\n      propertyListItems,\r\n      strippedDescription,\r\n    } = parseDescriptionPrefixElements(action.newRawDescription);\r\n\r\n    return header\r\n      .set('rawDescription', strippedDescription)\r\n      .set('description', parseRawText(strippedDescription))\r\n      .set('planningItems', planningItems)\r\n      .set('propertyListItems', propertyListItems);\r\n  });\r\n};\r\n\r\nconst addHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  const newHeader = newHeaderWithTitle(\r\n    '',\r\n    header.get('nestingLevel'),\r\n    state.get('todoKeywordSets')\r\n  );\r\n\r\n  if (action.headerId === state.get('focusedHeaderId')) {\r\n    state = state.set('focusedHeaderId', null);\r\n  }\r\n\r\n  return state.update('headers', headers =>\r\n    headers.insert(headerIndex + subheaders.size + 1, newHeader)\r\n  );\r\n};\r\n\r\nconst selectNextSiblingHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  const nextSibling = headers.get(headerIndex + subheaders.size + 1);\r\n\r\n  if (!nextSibling || nextSibling.get('nestingLevel') !== header.get('nestingLevel')) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', nextSibling.get('id'));\r\n};\r\n\r\nconst selectNextVisibleHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n\r\n  if (state.get('selectedHeaderId') === undefined) {\r\n    return state.set('selectedHeaderId', headers.getIn([0, 'id']));\r\n  }\r\n\r\n  const headerIndex = indexOfHeaderWithId(headers, state.get('selectedHeaderId'));\r\n\r\n  const nextVisibleHeader = nextVisibleHeaderAfterIndex(headers, headerIndex);\r\n\r\n  if (!nextVisibleHeader) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', nextVisibleHeader.get('id'));\r\n};\r\n\r\nconst selectPreviousVisibleHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, state.get('selectedHeaderId'));\r\n\r\n  const previousVisibleHeader = previousVisibleHeaderAfterIndex(headers, headerIndex);\r\n\r\n  if (!previousVisibleHeader) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', previousVisibleHeader.get('id'));\r\n};\r\n\r\nconst removeHeader = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  const numHeadersToRemove = 1 + subheaders.size;\r\n\r\n  const parentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  _.times(numHeadersToRemove).forEach(() => {\r\n    headers = headers.delete(headerIndex);\r\n  });\r\n\r\n  if (action.headerId === state.get('focusedHeaderId')) {\r\n    state = state.set('focusedHeaderId', null);\r\n  }\r\n\r\n  state = state.set('headers', headers);\r\n\r\n  if (parentHeaderId) {\r\n    state = updateCookiesOfHeaderWithId(state, parentHeaderId);\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nconst moveHeaderUp = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousSiblingIndex = indexOfPreviousSibling(headers, headerIndex);\r\n  if (previousSiblingIndex === null) {\r\n    return state;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  _.times(1 + subheaders.size).forEach(() => {\r\n    headers = headers.insert(previousSiblingIndex, headers.get(headerIndex + subheaders.size));\r\n    headers = headers.delete(headerIndex + subheaders.size + 1);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst moveHeaderDown = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  const nextSiblingIndex = headerIndex + subheaders.size + 1;\r\n  const nextSibling = headers.get(nextSiblingIndex);\r\n  if (nextSibling.get('nestingLevel') < header.get('nestingLevel')) {\r\n    return state;\r\n  }\r\n\r\n  const nextSiblingSubheaders = subheadersOfHeaderWithId(headers, nextSibling.get('id'));\r\n  _.times(1 + nextSiblingSubheaders.size).forEach(() => {\r\n    headers = headers.insert(\r\n      headerIndex,\r\n      headers.get(nextSiblingIndex + nextSiblingSubheaders.size)\r\n    );\r\n    headers = headers.delete(nextSiblingIndex + nextSiblingSubheaders.size + 1);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst moveHeaderLeft = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(['headers', headerIndex, 'nestingLevel'], nestingLevel =>\r\n    Math.max(nestingLevel - 1, 1)\r\n  );\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveHeaderRight = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel + 1\r\n  );\r\n\r\n  state = openDirectParent(state, action.headerId);\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveSubtreeLeft = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  if (header.get('nestingLevel') === 1) {\r\n    return state;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel - 1\r\n  );\r\n\r\n  subheaders.forEach((_, index) => {\r\n    state = state.updateIn(\r\n      ['headers', headerIndex + index + 1, 'nestingLevel'],\r\n      nestingLevel => nestingLevel - 1\r\n    );\r\n  });\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveSubtreeRight = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel + 1\r\n  );\r\n  subheaders.forEach((_, index) => {\r\n    state = state.updateIn(\r\n      ['headers', headerIndex + index + 1, 'nestingLevel'],\r\n      nestingLevel => nestingLevel + 1\r\n    );\r\n  });\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return openDirectParent(state, action.headerId);\r\n};\r\n\r\nconst focusHeader = (state, action) => {\r\n  return state.set('focusedHeaderId', action.headerId);\r\n};\r\n\r\nconst unfocusHeader = state => state.set('focusedHeaderId', null);\r\n\r\nconst noOp = state => state.update('noOpCounter', counter => (counter || 0) + 1);\r\n\r\nconst applyOpennessState = (state, action) => {\r\n  const opennessState = state.get('opennessState');\r\n  if (!opennessState) {\r\n    return state;\r\n  }\r\n\r\n  const fileOpennessState = opennessState.get(state.get('path'));\r\n  if (!fileOpennessState || fileOpennessState.size === 0) {\r\n    return state;\r\n  }\r\n\r\n  let headers = state.get('headers');\r\n  fileOpennessState.forEach(openHeaderPath => {\r\n    headers = openHeaderWithPath(headers, openHeaderPath);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst setDirty = (state, action) => state.set('isDirty', action.isDirty);\r\n\r\nconst setSelectedTableCellId = (state, action) => state.set('selectedTableCellId', action.cellId);\r\n\r\nconst updateDescriptionOfHeaderContainingTableCell = (state, cellId, header = null) => {\r\n  const headers = state.get('headers');\r\n  if (!header) {\r\n    header = headerThatContainsTableCellId(headers, cellId);\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(headers, header.get('id'));\r\n\r\n  return state.updateIn(['headers', headerIndex], header =>\r\n    header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n  );\r\n};\r\n\r\nconst addNewTableRow = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rows.insert(rowIndex + 1, newEmptyTableRowLikeRows(rows))\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst removeTableRow = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsTableCellId(state.get('headers'), selectedTableCellId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rows.delete(rowIndex)\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedTableCellId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId, containingHeader);\r\n};\r\n\r\nconst addNewTableColumn = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, colIndex) => rows =>\r\n      rows.map(row =>\r\n        row.update('contents', contents => contents.insert(colIndex + 1, newEmptyTableCell()))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst removeTableColumn = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsTableCellId(state.get('headers'), selectedTableCellId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, colIndex) => rows =>\r\n      rows.map(row => row.update('contents', contents => contents.delete(colIndex)))\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedTableCellId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId, containingHeader);\r\n};\r\n\r\nconst moveTableRowDown = state => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rowIndex + 1 === rows.size\r\n        ? rows\r\n        : rows.insert(rowIndex, rows.get(rowIndex + 1)).delete(rowIndex + 2)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableRowUp = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rowIndex === 0 ? rows : rows.insert(rowIndex - 1, rows.get(rowIndex)).delete(rowIndex + 1)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableColumnLeft = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, columnIndex) => rows =>\r\n      columnIndex === 0\r\n        ? rows\r\n        : rows.map(row =>\r\n            row.update('contents', contents =>\r\n              contents.size === 0\r\n                ? contents\r\n                : contents\r\n                    .insert(columnIndex - 1, contents.get(columnIndex))\r\n                    .delete(columnIndex + 1)\r\n            )\r\n          )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableColumnRight = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, columnIndex) => rows =>\r\n      columnIndex + 1 >= rows.getIn([0, 'contents']).size\r\n        ? rows\r\n        : rows.map(row =>\r\n            row.update('contents', contents =>\r\n              contents.size === 0\r\n                ? contents\r\n                : contents\r\n                    .insert(columnIndex, contents.get(columnIndex + 1))\r\n                    .delete(columnIndex + 2)\r\n            )\r\n          )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst updateTableCellValue = (state, action) => {\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, action.cellId, (rowIndex, colIndex) => rows =>\r\n      rows.updateIn([rowIndex, 'contents', colIndex], cell =>\r\n        cell\r\n          .set('rawContents', action.newValue)\r\n          .set('contents', fromJS(parseMarkupAndCookies(action.newValue, { excludeCookies: true })))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, action.cellId);\r\n};\r\n\r\nconst insertCapture = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const { template, content, shouldPrepend } = action;\r\n\r\n  const isTopLevelTarget = template.get('headerPaths').filter(path => path.length !== 0).size === 0;\r\n\r\n  const parentHeader = isTopLevelTarget\r\n    ? null\r\n    : headerWithPath(headers, template.get('headerPaths'));\r\n  if (!parentHeader && !isTopLevelTarget) {\r\n    return state;\r\n  }\r\n\r\n  const newHeader = newHeaderFromText(content, state.get('todoKeywordSets')).set(\r\n    'nestingLevel',\r\n    isTopLevelTarget ? 1 : parentHeader.get('nestingLevel') + 1\r\n  );\r\n\r\n  if (isTopLevelTarget) {\r\n    return state.update('headers', headers => headers.push(newHeader));\r\n  } else {\r\n    const parentHeaderIndex = indexOfHeaderWithId(headers, parentHeader.get('id'));\r\n    const numSubheaders = numSubheadersOfHeaderWithId(headers, parentHeader.get('id'));\r\n    const newIndex = parentHeaderIndex + 1 + (shouldPrepend ? 0 : numSubheaders);\r\n\r\n    state = state.update('headers', headers => headers.insert(newIndex, newHeader));\r\n\r\n    state = updateCookiesOfHeaderWithId(state, parentHeader.get('id'));\r\n\r\n    return state;\r\n  }\r\n};\r\n\r\nconst clearPendingCapture = state => state.set('pendingCapture', null);\r\n\r\nconst updateParentListCheckboxes = (state, itemPath) => {\r\n  const parentListItemPath = itemPath.slice(0, itemPath.length - 4);\r\n  const parentListItem = state.getIn(parentListItemPath);\r\n  if (!parentListItem.has('checkboxState')) {\r\n    return state;\r\n  }\r\n\r\n  const childrenCheckedStates = parentListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .flatMap(listPart =>\r\n      listPart\r\n        .get('items')\r\n        .filter(item => item.get('isCheckbox'))\r\n        .map(checkboxItem => checkboxItem.get('checkboxState'))\r\n    );\r\n\r\n  if (childrenCheckedStates.every(state => state === 'checked')) {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'checked');\r\n  } else if (childrenCheckedStates.every(state => state === 'unchecked')) {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'unchecked');\r\n  } else {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'partial');\r\n  }\r\n\r\n  const childCompletionStates = childrenCheckedStates\r\n    .map(state => {\r\n      switch (state) {\r\n        case 'checked':\r\n          return true;\r\n        case 'unchecked':\r\n          return false;\r\n        case 'partial':\r\n          return false;\r\n        default:\r\n          return false;\r\n      }\r\n    })\r\n    .toJS();\r\n\r\n  state = state.updateIn(parentListItemPath.concat('titleLine'), titleLine =>\r\n    updateCookiesInAttributedStringWithChildCompletionStates(titleLine, childCompletionStates)\r\n  );\r\n\r\n  if (parentListItem.get('isCheckbox')) {\r\n    return updateParentListCheckboxes(state, parentListItemPath);\r\n  } else {\r\n    return state;\r\n  }\r\n};\r\n\r\nconst advanceCheckboxState = (state, action) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(state.get('headers'), action.listItemId);\r\n  const { path, listItemPart } = pathAndPart;\r\n\r\n  const hasDirectCheckboxChildren = listItemPart\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .some(listPart => listPart.get('items').some(item => item.get('isCheckbox')));\r\n  if (hasDirectCheckboxChildren) {\r\n    return state;\r\n  }\r\n\r\n  const newCheckboxState = {\r\n    checked: 'unchecked',\r\n    unchecked: 'checked',\r\n    partial: 'unchecked',\r\n  }[listItemPart.get('checkboxState')];\r\n\r\n  state = state.setIn(['headers'].concat(path).concat(['checkboxState']), newCheckboxState);\r\n  state = updateParentListCheckboxes(state, ['headers'].concat(path));\r\n\r\n  const headerIndex = path[0];\r\n  state = updateCookiesOfHeaderWithId(state, state.getIn(['headers', headerIndex, 'id']));\r\n  state = state.updateIn(['headers', headerIndex], header =>\r\n    header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n  );\r\n\r\n  return state;\r\n};\r\n\r\nconst setSelectedListItemId = (state, action) => state.set('selectedListItemId', action.listItemId);\r\n\r\nconst updateDescriptionOfHeaderContainingListItem = (state, listItemId, header = null) => {\r\n  let headerIndex = -1;\r\n  const headers = state.get('headers');\r\n  if (!header) {\r\n    const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n    headerIndex = pathAndPart.path[0];\r\n  } else {\r\n    headerIndex = indexOfHeaderWithId(headers, header.get('id'));\r\n  }\r\n\r\n  if (headerIndex >= 0) {\r\n    return state.updateIn(['headers', headerIndex], header =>\r\n      header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n    );\r\n  } else {\r\n    return state;\r\n  }\r\n};\r\n\r\nconst updateListTitleValue = (state, action) => {\r\n  const selectedListItemId = action.listItemId;\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.updateIn([itemIndex], item =>\r\n        item.set('titleLine', fromJS(parseMarkupAndCookies(action.newValue)))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst updateListContentsValue = (state, action) => {\r\n  const selectedListItemId = action.listItemId;\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.updateIn([itemIndex], item =>\r\n        item.set('contents', fromJS(parseRawText(action.newValue)))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst addNewListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n\r\n  let newItem = newListItem();\r\n  if (pathAndPart.listItemPart.get('isCheckbox')) {\r\n    newItem = newItem.set('isCheckbox', true).set('checkboxState', 'unchecked');\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.insert(itemIndex + 1, newItem)\r\n    )\r\n  );\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst selectNextSiblingListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path } = pathAndPart;\r\n  path[path.length - 1] = path[path.length - 1] + 1;\r\n\r\n  state = state.set('selectedListItemId', state.getIn(['headers'].concat(path).concat('id')));\r\n\r\n  return state;\r\n};\r\n\r\nconst removeListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsListItemId(state.get('headers'), selectedListItemId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedListItemId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId, containingHeader);\r\n};\r\n\r\nconst moveListItemUp = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex === 0\r\n        ? items\r\n        : items.insert(itemIndex - 1, items.get(itemIndex)).delete(itemIndex + 1)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListItemDown = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex + 1 === items.size\r\n        ? items\r\n        : items.insert(itemIndex, items.get(itemIndex + 1)).delete(itemIndex + 2)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListItemLeft = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n\r\n  const hasChildrenItem = pathAndPart.listItemPart\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .some(listPart => listPart.get('items').size > 0);\r\n  if (hasChildrenItem) {\r\n    return state;\r\n  }\r\n  return moveListSubtreeLeft(state);\r\n};\r\n\r\nconst moveListItemRight = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const listPart = state.getIn(['headers'].concat(path.slice(0, path.length - 2)));\r\n  const prevSiblingItemIndex = path[path.length - 1] - 1;\r\n\r\n  if (prevSiblingItemIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  const prevSiblingItemContentsPath = ['headers']\r\n    .concat(path.slice(0, path.length - 1))\r\n    .concat(prevSiblingItemIndex)\r\n    .concat('contents');\r\n\r\n  const childrenListParts = selectedListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list');\r\n\r\n  selectedListItem = selectedListItem.update('contents', contents =>\r\n    contents.filter(part => part.get('type') !== 'list')\r\n  );\r\n\r\n  state = state.updateIn(prevSiblingItemContentsPath, contents =>\r\n    updateContentsWithListItemAddition(contents, selectedListItem, listPart)\r\n  );\r\n\r\n  childrenListParts.map(listPart =>\r\n    listPart.get('items').forEach((item, itemIndex) => {\r\n      state = state.updateIn(prevSiblingItemContentsPath, contents =>\r\n        updateContentsWithListItemAddition(contents, item, listPart)\r\n      );\r\n    })\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListSubtreeLeft = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const selectedListItemIndex = path[path.length - 1];\r\n  if (path.filter(partOfPath => partOfPath === 'items').length < 2) {\r\n    return state;\r\n  }\r\n\r\n  const parentListItem = parentListItemWithIdInHeaders(\r\n    state.getIn(['headers']),\r\n    selectedListItemId\r\n  );\r\n\r\n  parentListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .map(listPart =>\r\n      listPart.get('items').forEach((item, itemIndex) => {\r\n        if (itemIndex > selectedListItemIndex) {\r\n          selectedListItem = selectedListItem.update('contents', contents =>\r\n            updateContentsWithListItemAddition(contents, item, listPart)\r\n          );\r\n        }\r\n      })\r\n    );\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.filter((_item, index) => index < selectedListItemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, parentListItem.get('id'), itemIndex => items =>\r\n      items.insert(itemIndex + 1, selectedListItem)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListSubtreeRight = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  const { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const listPart = state.getIn(['headers'].concat(path.slice(0, path.length - 2)));\r\n  const prevSiblingItemIndex = path[path.length - 1] - 1;\r\n  if (prevSiblingItemIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex === 0 ? items : items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.updateIn(\r\n    ['headers']\r\n      .concat(path.slice(0, path.length - 1))\r\n      .concat(prevSiblingItemIndex)\r\n      .concat('contents'),\r\n    contents => updateContentsWithListItemAddition(contents, selectedListItem, listPart)\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst setLastSyncAt = (state, action) => state.set('lastSyncAt', action.lastSyncAt);\r\n\r\nconst setHeaderTags = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  if (headerIndex === -1) {\r\n    return state;\r\n  }\r\n\r\n  return state.setIn(['headers', headerIndex, 'titleLine', 'tags'], action.tags);\r\n};\r\n\r\nconst reorderTags = (state, action) => {\r\n  const selectedHeaderId = state.get('selectedHeaderId');\r\n  if (!selectedHeaderId) {\r\n    return state;\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), selectedHeaderId);\r\n\r\n  return state.updateIn(['headers', headerIndex, 'titleLine', 'tags'], tags =>\r\n    tags.splice(action.fromIndex, 1).splice(action.toIndex, 0, tags.get(action.fromIndex))\r\n  );\r\n};\r\n\r\nconst reorderPropertyList = (state, action) => {\r\n  const headerId = action.headerId;\r\n  if (!headerId) {\r\n    return state;\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), headerId);\r\n\r\n  return state.updateIn(['headers', headerIndex, 'propertyListItems'], propertyListItems =>\r\n    propertyListItems\r\n      .splice(action.fromIndex, 1)\r\n      .splice(action.toIndex, 0, propertyListItems.get(action.fromIndex))\r\n  );\r\n};\r\n\r\nconst updateTimestampWithId = (state, action) => {\r\n  const pathAndPart = pathAndPartOfTimestampItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    action.timestampId\r\n  );\r\n  if (!pathAndPart) {\r\n    return state;\r\n  }\r\n\r\n  const { path } = pathAndPart;\r\n  const headerIndex = path[0];\r\n\r\n  return state\r\n    .setIn(['headers'].concat(path), action.newTimestamp)\r\n    .updateIn(['headers', headerIndex], header =>\r\n      header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n    )\r\n    .updateIn(['headers', headerIndex], header =>\r\n      header.setIn(\r\n        ['titleLine', 'rawTitle'],\r\n        attributedStringToRawText(header.getIn(['titleLine', 'title']))\r\n      )\r\n    );\r\n};\r\n\r\nconst updatePlanningItemTimestamp = (state, action) => {\r\n  const { headerId, planningItemIndex, newTimestamp } = action;\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), headerId);\r\n\r\n  return state.setIn(\r\n    ['headers', headerIndex, 'planningItems', planningItemIndex, 'timestamp'],\r\n    newTimestamp\r\n  );\r\n};\r\n\r\nconst addNewPlanningItem = (state, action) => {\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), action.headerId);\r\n\r\n  const newPlanningItem = fromJS({\r\n    id: generateId(),\r\n    type: action.planningType,\r\n    timestamp: getCurrentTimestamp(),\r\n  });\r\n\r\n  return state.updateIn(['headers', headerIndex, 'planningItems'], planningItems =>\r\n    !!planningItems ? planningItems.push(newPlanningItem) : List([newPlanningItem])\r\n  );\r\n};\r\n\r\nexport const updatePropertyListItems = (state, action) => {\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), action.headerId);\r\n\r\n  return state.setIn(['headers', headerIndex, 'propertyListItems'], action.newPropertyListItems);\r\n};\r\n\r\nconst setOrgFileErrorMessage = (state, action) => state.set('orgFileErrorMessage', action.message);\r\n\r\nexport default (state = new Map(), action) => {\r\n  if (action.dirtying) {\r\n    state = state.set('isDirty', true);\r\n  }\r\n\r\n  switch (action.type) {\r\n    case 'DISPLAY_FILE':\r\n      return displayFile(state, action);\r\n    case 'STOP_DISPLAYING_FILE':\r\n      return stopDisplayingFile(state, action);\r\n    case 'TOGGLE_HEADER_OPENED':\r\n      return toggleHeaderOpened(state, action);\r\n    case 'OPEN_HEADER':\r\n      return openHeader(state, action);\r\n    case 'SELECT_HEADER':\r\n      return selectHeader(state, action);\r\n    case 'OPEN_PARENTS_OF_HEADER':\r\n      return openParentsOfHeader(state, action);\r\n    case 'ADVANCE_TODO_STATE':\r\n      return advanceTodoState(state, action);\r\n    case 'ENTER_EDIT_MODE':\r\n      return enterEditMode(state, action);\r\n    case 'EXIT_EDIT_MODE':\r\n      return exitEditMode(state, action);\r\n    case 'UPDATE_HEADER_TITLE':\r\n      return updateHeaderTitle(state, action);\r\n    case 'UPDATE_HEADER_DESCRIPTION':\r\n      return updateHeaderDescription(state, action);\r\n    case 'ADD_HEADER':\r\n      return addHeader(state, action);\r\n    case 'SELECT_NEXT_SIBLING_HEADER':\r\n      return selectNextSiblingHeader(state, action);\r\n    case 'SELECT_NEXT_VISIBLE_HEADER':\r\n      return selectNextVisibleHeader(state, action);\r\n    case 'SELECT_PREVIOUS_VISIBLE_HEADER':\r\n      return selectPreviousVisibleHeader(state, action);\r\n    case 'REMOVE_HEADER':\r\n      return removeHeader(state, action);\r\n    case 'MOVE_HEADER_UP':\r\n      return moveHeaderUp(state, action);\r\n    case 'MOVE_HEADER_DOWN':\r\n      return moveHeaderDown(state, action);\r\n    case 'MOVE_HEADER_LEFT':\r\n      return moveHeaderLeft(state, action);\r\n    case 'MOVE_HEADER_RIGHT':\r\n      return moveHeaderRight(state, action);\r\n    case 'MOVE_SUBTREE_LEFT':\r\n      return moveSubtreeLeft(state, action);\r\n    case 'MOVE_SUBTREE_RIGHT':\r\n      return moveSubtreeRight(state, action);\r\n    case 'NO_OP':\r\n      return noOp(state, action);\r\n    case 'APPLY_OPENNESS_STATE':\r\n      return applyOpennessState(state, action);\r\n    case 'SET_DIRTY':\r\n      return setDirty(state, action);\r\n    case 'FOCUS_HEADER':\r\n      return focusHeader(state, action);\r\n    case 'UNFOCUS_HEADER':\r\n      return unfocusHeader(state, action);\r\n    case 'SET_SELECTED_TABLE_CELL_ID':\r\n      return setSelectedTableCellId(state, action);\r\n    case 'ADD_NEW_TABLE_ROW':\r\n      return addNewTableRow(state, action);\r\n    case 'REMOVE_TABLE_ROW':\r\n      return removeTableRow(state, action);\r\n    case 'ADD_NEW_TABLE_COLUMN':\r\n      return addNewTableColumn(state, action);\r\n    case 'REMOVE_TABLE_COLUMN':\r\n      return removeTableColumn(state, action);\r\n    case 'MOVE_TABLE_ROW_DOWN':\r\n      return moveTableRowDown(state, action);\r\n    case 'MOVE_TABLE_ROW_UP':\r\n      return moveTableRowUp(state, action);\r\n    case 'MOVE_TABLE_COLUMN_LEFT':\r\n      return moveTableColumnLeft(state, action);\r\n    case 'MOVE_TABLE_COLUMN_RIGHT':\r\n      return moveTableColumnRight(state, action);\r\n    case 'UPDATE_TABLE_CELL_VALUE':\r\n      return updateTableCellValue(state, action);\r\n    case 'INSERT_CAPTURE':\r\n      return insertCapture(state, action);\r\n    case 'CLEAR_PENDING_CAPTURE':\r\n      return clearPendingCapture(state, action);\r\n    case 'ADVANCE_CHECKBOX_STATE':\r\n      return advanceCheckboxState(state, action);\r\n    case 'SET_SELECTED_LIST_ITEM_ID':\r\n      return setSelectedListItemId(state, action);\r\n    case 'UPDATE_LIST_TITLE_VALUE':\r\n      return updateListTitleValue(state, action);\r\n    case 'UPDATE_LIST_CONTENTS_VALUE':\r\n      return updateListContentsValue(state, action);\r\n    case 'ADD_NEW_LIST_ITEM':\r\n      return addNewListItem(state, action);\r\n    case 'SELECT_NEXT_SIBLING_LIST_ITEM':\r\n      return selectNextSiblingListItem(state, action);\r\n    case 'REMOVE_LIST_ITEM':\r\n      return removeListItem(state, action);\r\n    case 'MOVE_LIST_ITEM_UP':\r\n      return moveListItemUp(state, action);\r\n    case 'MOVE_LIST_ITEM_DOWN':\r\n      return moveListItemDown(state, action);\r\n    case 'MOVE_LIST_ITEM_LEFT':\r\n      return moveListItemLeft(state, action);\r\n    case 'MOVE_LIST_ITEM_RIGHT':\r\n      return moveListItemRight(state, action);\r\n    case 'MOVE_LIST_SUBTREE_LEFT':\r\n      return moveListSubtreeLeft(state, action);\r\n    case 'MOVE_LIST_SUBTREE_RIGHT':\r\n      return moveListSubtreeRight(state, action);\r\n    case 'SET_LAST_SYNC_AT':\r\n      return setLastSyncAt(state, action);\r\n    case 'SET_HEADER_TAGS':\r\n      return setHeaderTags(state, action);\r\n    case 'REORDER_TAGS':\r\n      return reorderTags(state, action);\r\n    case 'REORDER_PROPERTY_LIST':\r\n      return reorderPropertyList(state, action);\r\n    case 'UPDATE_TIMESTAMP_WITH_ID':\r\n      return updateTimestampWithId(state, action);\r\n    case 'UPDATE_PLANNING_ITEM_TIMESTAMP':\r\n      return updatePlanningItemTimestamp(state, action);\r\n    case 'ADD_NEW_PLANNING_ITEM':\r\n      return addNewPlanningItem(state, action);\r\n    case 'UPDATE_PROPERTY_LIST_ITEMS':\r\n      return updatePropertyListItems(state, action);\r\n    case 'SET_ORG_FILE_ERROR_MESSAGE':\r\n      return setOrgFileErrorMessage(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\n\r\nimport generateId from '../lib/id_generator';\r\nimport { applyCaptureSettingsFromConfig } from '../util/settings_persister';\r\n\r\nconst indexOfTemplateWithId = (templates, templateId) =>\r\n  templates.findIndex(template => template.get('id') === templateId);\r\n\r\nconst addNewEmptyCaptureTemplate = state => {\r\n  if (!state.get('captureTemplates')) {\r\n    state = state.set('captureTemplates', new List());\r\n  }\r\n\r\n  return state.update('captureTemplates', templates =>\r\n    templates.push(\r\n      fromJS({\r\n        id: generateId(),\r\n        description: '',\r\n        letter: '',\r\n        iconName: '',\r\n        isAvailableInAllOrgFiles: true,\r\n        orgFilesWhereAvailable: [''],\r\n        headerPaths: [''],\r\n        shouldPrepend: false,\r\n        template: '',\r\n      })\r\n    )\r\n  );\r\n};\r\n\r\nconst updateTemplateFieldPathValue = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.setIn(['captureTemplates', templateIndex].concat(action.fieldPath), action.newValue);\r\n};\r\n\r\nconst addNewTemplateOrgFileAvailability = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'orgFilesWhereAvailable'], orgFiles =>\r\n    orgFiles.push('')\r\n  );\r\n};\r\n\r\nconst removeTemplateOrgFileAvailability = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'orgFilesWhereAvailable'], orgFiles =>\r\n    orgFiles.delete(action.orgFileAvailabilityIndex)\r\n  );\r\n};\r\n\r\nconst addNewTemplateHeaderPath = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'headerPaths'], headerPaths =>\r\n    headerPaths.push('')\r\n  );\r\n};\r\n\r\nconst removeTemplateHeaderPath = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'headerPaths'], headerPaths =>\r\n    headerPaths.delete(action.headerPathIndex)\r\n  );\r\n};\r\n\r\nconst deleteTemplate = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.update('captureTemplates', templates => templates.delete(templateIndex));\r\n};\r\n\r\nconst restoreCaptureSettings = (state, action) => {\r\n  if (!action.newSettings) {\r\n    return state;\r\n  }\r\n\r\n  return applyCaptureSettingsFromConfig(state, action.newSettings);\r\n};\r\n\r\nconst reorderCaptureTemplate = (state, action) =>\r\n  state.update('captureTemplates', templates =>\r\n    templates.splice(action.fromIndex, 1).splice(action.toIndex, 0, templates.get(action.fromIndex))\r\n  );\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'ADD_NEW_EMPTY_CAPTURE_TEMPLATE':\r\n      return addNewEmptyCaptureTemplate(state, action);\r\n    case 'UPDATE_TEMPLATE_FIELD_PATH_VALUE':\r\n      return updateTemplateFieldPathValue(state, action);\r\n    case 'ADD_NEW_TEMPLATE_ORG_FILE_AVAILABILITY':\r\n      return addNewTemplateOrgFileAvailability(state, action);\r\n    case 'REMOVE_TEMPLATE_ORG_FILE_AVAILABILITY':\r\n      return removeTemplateOrgFileAvailability(state, action);\r\n    case 'ADD_NEW_TEMPLATE_HEADER_PATH':\r\n      return addNewTemplateHeaderPath(state, action);\r\n    case 'REMOVE_TEMPLATE_HEADER_PATH':\r\n      return removeTemplateHeaderPath(state, action);\r\n    case 'DELETE_TEMPLATE':\r\n      return deleteTemplate(state, action);\r\n    case 'RESTORE_CAPTURE_SETTINGS':\r\n      return restoreCaptureSettings(state, action);\r\n    case 'REORDER_CAPTURE_TEMPLATE':\r\n      return reorderCaptureTemplate(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { combineReducers } from 'redux';\r\nimport undoable, { includeAction } from 'redux-linear-undo';\r\n\r\nimport baseReducer from './base';\r\nimport syncBackendReducer from './sync_backend';\r\nimport orgReducer from './org';\r\nimport captureReducer from './capture';\r\n\r\nconst UNDOABLE_ACTIONS = [\r\n  'ADD_HEADER',\r\n  'REMOVE_HEADER',\r\n  'MOVE_HEADER_UP',\r\n  'MOVE_HEADER_DOWN',\r\n  'MOVE_HEADER_LEFT',\r\n  'MOVE_HEADER_RIGHT',\r\n  'MOVE_SUBTREE_LEFT',\r\n  'MOVE_SUBTREE_RIGHT',\r\n  'ADVANCE_TODO_STATE',\r\n  'EDIT_HEADER_TITLE',\r\n  'EDIT_HEADER_DESCRIPTION',\r\n  'NO_OP',\r\n  'ADD_NEW_TABLE_ROW',\r\n  'ADD_NEW_TABLE_COLUMN',\r\n  'MOVE_TABLE_ROW_DOWN',\r\n  'MOVE_TABLE_ROW_UP',\r\n  'MOVE_TABLE_COLUMN_LEFT',\r\n  'MOVE_TABLE_COLUMN_RIGHT',\r\n  'ADD_NEW_LIST_ITEM',\r\n  'REMOVE_LIST_ITEM',\r\n  'MOVE_LIST_ITEM_UP',\r\n  'MOVE_LIST_ITEM_DOWN',\r\n  'MOVE_LIST_ITEM_LEFT',\r\n  'MOVE_LIST_ITEM_RIGHT',\r\n  'MOVE_LIST_SUBTREE_LEFT',\r\n  'MOVE_LIST_SUBTREE_RIGHT',\r\n  'INSERT_CAPTURE',\r\n];\r\n\r\nexport default combineReducers({\r\n  base: baseReducer,\r\n  syncBackend: syncBackendReducer,\r\n  org: undoable(orgReducer, {\r\n    filter: includeAction(UNDOABLE_ACTIONS),\r\n    linearizeHistory: true,\r\n  }),\r\n  capture: captureReducer,\r\n});\r\n","import { Map } from 'immutable';\r\n\r\nconst signOut = (state, action) => state.set('isAuthenticated', false).set('client', null);\r\n\r\nconst setCurrentFileBrowserDirectoryListing = (state, action) =>\r\n  state.set(\r\n    'currentFileBrowserDirectoryListing',\r\n    Map({\r\n      listing: action.directoryListing,\r\n      hasMore: action.hasMore,\r\n      additionalSyncBackendState: action.additionalSyncBackendState,\r\n    })\r\n  );\r\n\r\nconst setIsLoadingMoreDirectoryListing = (state, action) =>\r\n  state\r\n    .update(\r\n      'currentFileBrowserDirectoryListing',\r\n      currentFileBrowserDirectoryListing =>\r\n        !!currentFileBrowserDirectoryListing ? currentFileBrowserDirectoryListing : Map()\r\n    )\r\n    .setIn(['currentFileBrowserDirectoryListing', 'isLoadingMore'], action.isLoadingMore);\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'SIGN_OUT':\r\n      return signOut(state, action);\r\n    case 'SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING':\r\n      return setCurrentFileBrowserDirectoryListing(state, action);\r\n    case 'SET_IS_LOADING_MORE_DIRECTORY_LISTING':\r\n      return setIsLoadingMoreDirectoryListing(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport googleAnalyticsLogger from './middleware/google_analytics_logging';\r\nimport liveSync from './middleware/live_sync';\r\nimport syncOnBecomingVisible from './middleware/sync_on_becoming_visible';\r\nimport rootReducer from './reducers';\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport default initialState =>\r\n  createStore(\r\n    rootReducer,\r\n    initialState,\r\n    composeEnhancers(applyMiddleware(thunk, googleAnalyticsLogger, liveSync, syncOnBecomingVisible))\r\n  );\r\n","import migrateAccessTokenToDropboxAccessToken from './migrate_access_token_to_dropbox_access_token';\r\nimport migrateStoreInDropboxToStoreInSyncBackend from './migrate_store_in_dropbox_to_store_in_sync_backend';\r\n\r\nexport default () => {\r\n  migrateAccessTokenToDropboxAccessToken();\r\n  migrateStoreInDropboxToStoreInSyncBackend();\r\n};\r\n","import { isLocalStorageAvailable } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  if (!isLocalStorageAvailable) {\r\n    return;\r\n  }\r\n\r\n  const accessToken = localStorage.getItem('accessToken');\r\n  if (!accessToken) {\r\n    return;\r\n  }\r\n\r\n  localStorage.setItem('dropboxAccessToken', accessToken);\r\n  localStorage.removeItem('accessToken');\r\n};\r\n","import { isLocalStorageAvailable } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  if (!isLocalStorageAvailable) {\r\n    return;\r\n  }\r\n\r\n  const shouldStoreSettingsInDropbox = localStorage.getItem('shouldStoreSettingsInDropbox');\r\n  if (!shouldStoreSettingsInDropbox) {\r\n    return;\r\n  }\r\n\r\n  localStorage.setItem('shouldStoreSettingsInSyncBackend', shouldStoreSettingsInDropbox);\r\n  localStorage.removeItem('shouldStoreSettingsInDropbox');\r\n};\r\n","const parseQueryString = str => {\r\n  var ret = Object.create(null);\r\n\r\n  if (typeof str !== 'string') {\r\n    return ret;\r\n  }\r\n\r\n  str = str.trim().replace(/^(\\?|#|&)/, '');\r\n\r\n  if (!str) {\r\n    return ret;\r\n  }\r\n\r\n  str.split('&').forEach(function(param) {\r\n    var parts = param.replace(/\\+/g, ' ').split('=');\r\n    // Firefox (pre 40) decodes `%3D` to `=`\r\n    // https://github.com/sindresorhus/query-string/pull/37\r\n    var key = parts.shift();\r\n    var val = parts.length > 0 ? parts.join('=') : undefined;\r\n\r\n    key = decodeURIComponent(key);\r\n\r\n    // missing `=` should be `null`:\r\n    // http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\r\n    val = val === undefined ? null : decodeURIComponent(val);\r\n\r\n    if (ret[key] === undefined) {\r\n      ret[key] = val;\r\n    } else if (Array.isArray(ret[key])) {\r\n      ret[key].push(val);\r\n    } else {\r\n      ret[key] = [ret[key], val];\r\n    }\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nexport default parseQueryString;\r\n","/* global gapi, google */\r\n\r\nimport { setLoadingMessage, hideLoadingMessage, clearModalStack, setIsLoading } from './base';\r\nimport {\r\n  displayFile,\r\n  applyOpennessState,\r\n  setDirty,\r\n  setLastSyncAt,\r\n  setOrgFileErrorMessage,\r\n} from './org';\r\nimport { persistField } from '../util/settings_persister';\r\nimport { Dropbox } from 'dropbox';\r\n\r\nimport { addSeconds } from 'date-fns';\r\n\r\nexport const signOut = () => (dispatch, getState) => {\r\n  switch (getState().syncBackend.get('client', {}).type) {\r\n    case 'Dropbox':\r\n      persistField('dropboxAccessToken', null);\r\n      break;\r\n    case 'Google Drive':\r\n      const token = gapi.client.getToken();\r\n      if (token) {\r\n        persistField('googleDriveAccessToken', null);\r\n        google.accounts.oauth2.revoke(token);\r\n        gapi.client.setToken('');\r\n        window.location.reload();\r\n      }\r\n      break;\r\n    default:\r\n  }\r\n\r\n  persistField('authenticatedSyncService', null);\r\n\r\n  dispatch({ type: 'SIGN_OUT' });\r\n  dispatch(clearModalStack());\r\n  dispatch(hideLoadingMessage());\r\n};\r\n\r\nexport const setCurrentFileBrowserDirectoryListing = (\r\n  directoryListing,\r\n  hasMore,\r\n  additionalSyncBackendState\r\n) => ({\r\n  type: 'SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING',\r\n  directoryListing,\r\n  hasMore,\r\n  additionalSyncBackendState,\r\n});\r\n\r\nexport const setIsLoadingMoreDirectoryListing = isLoadingMore => ({\r\n  type: 'SET_IS_LOADING_MORE_DIRECTORY_LISTING',\r\n  isLoadingMore,\r\n});\r\n\r\nexport const getDirectoryListing = path => (dispatch, getState) => {\r\n  dispatch(setLoadingMessage('Getting listing...'));\r\n\r\n  window.console.log('reading directories');\r\n\r\n  const client = getState().syncBackend.get('client');\r\n  client\r\n    .getDirectoryListing(path)\r\n    .then(({ listing, hasMore, additionalSyncBackendState }) => {\r\n      dispatch(setCurrentFileBrowserDirectoryListing(listing, hasMore, additionalSyncBackendState));\r\n      dispatch(hideLoadingMessage());\r\n    })\r\n    .catch(error => {\r\n      alert(`There was an error retrieving files! (status: ${error.status})`);\r\n\r\n      if (error.status === 401) {\r\n        const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n        const authURL = dropbox.getAuthenticationUrl(window.location.origin + '/');\r\n        window.location = authURL;\r\n      }\r\n\r\n      dispatch(hideLoadingMessage());\r\n    });\r\n};\r\n\r\nexport const loadMoreDirectoryListing = () => (dispatch, getState) => {\r\n  dispatch(setIsLoadingMoreDirectoryListing(true));\r\n\r\n  const client = getState().syncBackend.get('client');\r\n  const currentFileBrowserDirectoryListing = getState().syncBackend.get(\r\n    'currentFileBrowserDirectoryListing'\r\n  );\r\n  client\r\n    .getMoreDirectoryListing(currentFileBrowserDirectoryListing.get('additionalSyncBackendState'))\r\n    .then(({ listing, hasMore, additionalSyncBackendState }) => {\r\n      const extendedListing = currentFileBrowserDirectoryListing.get('listing').concat(listing);\r\n      dispatch(\r\n        setCurrentFileBrowserDirectoryListing(extendedListing, hasMore, additionalSyncBackendState)\r\n      );\r\n      dispatch(setIsLoadingMoreDirectoryListing(false));\r\n    });\r\n};\r\n\r\nexport const pushBackup = (pathOrFileId, contents) => {\r\n  return (dispatch, getState) => {\r\n    const client = getState().syncBackend.get('client');\r\n    switch (client.type) {\r\n      case 'Dropbox':\r\n        client.createFile(`${pathOrFileId}.org-web-bak`, contents);\r\n        break;\r\n      case 'Google Drive':\r\n        pathOrFileId = pathOrFileId.startsWith('/') ? pathOrFileId.substr(1) : pathOrFileId;\r\n        client.duplicateFile(pathOrFileId, fileName => `${fileName}.org-web-bak`);\r\n        break;\r\n      default:\r\n    }\r\n  };\r\n};\r\n\r\nexport const downloadFile = path => {\r\n  return (dispatch, getState) => {\r\n    dispatch(setLoadingMessage('Downloading file...'));\r\n\r\n    getState()\r\n      .syncBackend.get('client')\r\n      .getFileContents(path)\r\n      .then(fileContents => {\r\n        dispatch(setDirty(false));\r\n        dispatch(hideLoadingMessage());\r\n        dispatch(pushBackup(path, fileContents));\r\n        dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n        dispatch(displayFile(path, fileContents));\r\n        dispatch(applyOpennessState());\r\n      })\r\n      .catch((e) => {\r\n        if (e.status === 401) {\r\n          const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n          const authURL = dropbox.getAuthenticationUrl(window.location.origin + '/');\r\n          window.location = authURL;\r\n        }\r\n        dispatch(hideLoadingMessage());\r\n        dispatch(setIsLoading(false));\r\n        dispatch(setOrgFileErrorMessage('File not found'));\r\n      });\r\n  };\r\n};\r\n","import { Dropbox } from 'dropbox';\r\n\r\nimport { fromJS, Map } from 'immutable';\r\n\r\nexport default accessToken => {\r\n  const dropboxClient = new Dropbox({ accessToken, fetch });\r\n\r\n  const isSignedIn = () => new Promise(resolve => resolve(true));\r\n\r\n  const transformDirectoryListing = listing =>\r\n    fromJS(\r\n      listing.map(entry => ({\r\n        id: entry.id,\r\n        name: entry.name,\r\n        isDirectory: entry['.tag'] === 'folder',\r\n        path: entry.path_display,\r\n      }))\r\n    );\r\n\r\n  const getDirectoryListing = path =>\r\n    new Promise((resolve, reject) => {\r\n      dropboxClient\r\n        .filesListFolder({ path })\r\n        .then(response =>\r\n          resolve({\r\n            listing: transformDirectoryListing(response.entries),\r\n            hasMore: response.has_more,\r\n            additionalSyncBackendState: Map({\r\n              cursor: response.cursor,\r\n            }),\r\n          })\r\n        )\r\n        .catch(reject);\r\n    });\r\n\r\n  const getMoreDirectoryListing = additionalSyncBackendState => {\r\n    const cursor = additionalSyncBackendState.get('cursor');\r\n    return new Promise((resolve, reject) =>\r\n      dropboxClient.filesListFolderContinue({ cursor }).then(response =>\r\n        resolve({\r\n          listing: transformDirectoryListing(response.entries),\r\n          hasMore: response.has_more,\r\n          additionalSyncBackendState: Map({\r\n            cursor: response.cursor,\r\n          }),\r\n        })\r\n      )\r\n    );\r\n  };\r\n\r\n  const uploadFile = (path, contents) =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesUpload({\r\n          path,\r\n          contents,\r\n          mode: {\r\n            '.tag': 'overwrite',\r\n          },\r\n          autorename: true,\r\n        })\r\n        .then(resolve)\r\n        .catch(reject)\r\n    );\r\n\r\n  const updateFile = uploadFile;\r\n  const createFile = uploadFile;\r\n\r\n  const getFileContentsAndMetadata = path =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesDownload({ path })\r\n        .then(response => {\r\n          const reader = new FileReader();\r\n          reader.addEventListener('loadend', () =>\r\n            resolve({\r\n              contents: reader.result,\r\n              lastModifiedAt: response.server_modified,\r\n            })\r\n          );\r\n          reader.readAsText(response.fileBlob);\r\n        })\r\n        .catch(error => {\r\n          if (!!error.error && JSON.parse(error.error).error.path['.tag'] === 'not_found') {\r\n            reject();\r\n          }\r\n        })\r\n    );\r\n\r\n  const getFileContents = path =>\r\n    new Promise((resolve, reject) =>\r\n      getFileContentsAndMetadata(path)\r\n        .then(({ contents }) => resolve(contents))\r\n        .catch(reject)\r\n    );\r\n\r\n  const deleteFile = path =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesDelete({ path })\r\n        .then(resolve)\r\n        .catch(error => reject(error.error.error['.tag'] === 'path_lookup', error))\r\n    );\r\n\r\n  return {\r\n    type: 'Dropbox',\r\n    isSignedIn,\r\n    getDirectoryListing,\r\n    getMoreDirectoryListing,\r\n    updateFile,\r\n    createFile,\r\n    getFileContentsAndMetadata,\r\n    getFileContents,\r\n    deleteFile,\r\n  };\r\n};\r\n","/* global process */\r\n\r\nimport { fromJS, Map } from 'immutable';\r\nimport { persistField, getPersistedField } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  const initGoogleDriveAPIClient = () =>\r\n    new Promise((resolve, reject) => {\r\n      window.gapi.load('client', () => {\r\n        window.gapi.client\r\n          .init({\r\n            apiKey: process.env.REACT_APP_GOOGLE_DRIVE_API_KEY,\r\n            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\r\n          })\r\n          .then(async () => {\r\n            const googleDriveAccessTokenString = getPersistedField('googleDriveAccessToken');\r\n            if (googleDriveAccessTokenString) {\r\n              const googleDriveAccessToken = JSON.parse(googleDriveAccessTokenString);\r\n              window.gapi.client.setToken(googleDriveAccessToken);\r\n              resolve();\r\n            } else {\r\n              const tokenClient = window.google.accounts.oauth2.initTokenClient({\r\n                client_id: process.env.REACT_APP_GOOGLE_DRIVE_CLIENT_ID,\r\n                scope: 'https://www.googleapis.com/auth/drive.file',\r\n                callback: accessToken => {\r\n                  persistField('authenticatedSyncService', 'Google Drive');\r\n                  persistField('googleDriveAccessToken', JSON.stringify(accessToken));\r\n                  resolve();\r\n                },\r\n              });\r\n              tokenClient.requestAccessToken({ prompt: 'consent' });\r\n            }\r\n          });\r\n      });\r\n    });\r\n\r\n  const getAPIClient = (() => {\r\n    let isInited = false;\r\n    let isIniting = false;\r\n    const afterInitCallbacks = [];\r\n\r\n    return () => {\r\n      return new Promise((resolve, reject) => {\r\n        if (isInited) {\r\n          resolve(window.gapi);\r\n        } else {\r\n          if (window.gapi && !isIniting) {\r\n            isIniting = true;\r\n            initGoogleDriveAPIClient().then(() => {\r\n              isInited = true;\r\n              afterInitCallbacks.forEach(callback => callback(window.gapi));\r\n              resolve(window.gapi);\r\n            });\r\n          } else {\r\n            afterInitCallbacks.push(resolve);\r\n          }\r\n        }\r\n      });\r\n    };\r\n  })();\r\n\r\n  // Trigger the API client init when the gapi script loads.\r\n  if (window.gapi) {\r\n    getAPIClient();\r\n  } else {\r\n    // This handler will be called when the <script> tag loads.\r\n    window.handleGoogleDriveClientLoad = getAPIClient;\r\n  }\r\n\r\n  const isSignedIn = () =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        resolve(gapi.client.getToken() !== null);\r\n      });\r\n    });\r\n\r\n  const transformDirectoryListing = listing =>\r\n    fromJS(\r\n      listing.map(entry => ({\r\n        id: entry.id,\r\n        name: entry.name,\r\n        isDirectory: entry.mimeType === 'application/vnd.google-apps.folder',\r\n        path: `/${entry.id}`,\r\n      }))\r\n    );\r\n\r\n  const getFiles = (directoryId, nextPageToken = null) => {\r\n    const fileListPromise = new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        gapi.client.drive.files\r\n          .list({\r\n            pageSize: 30,\r\n            fields: 'nextPageToken, files(id, name, mimeType, parents)',\r\n            q: `'${directoryId === '' ? 'root' : directoryId}' in parents and trashed = false`,\r\n            pageToken: nextPageToken,\r\n          })\r\n          .then(response => {\r\n            resolve({\r\n              listing: transformDirectoryListing(response.result.files),\r\n              hasMore: !!response.result.nextPageToken,\r\n              additionalSyncBackendState: Map({\r\n                currentDirectoryId: directoryId,\r\n                nextPageToken: response.result.nextPageToken,\r\n              }),\r\n            });\r\n          })\r\n          .catch(reject);\r\n      });\r\n    });\r\n\r\n    const fileParentPromise = new Promise((resolve, reject) => {\r\n      if (directoryId === '') {\r\n        resolve(null);\r\n      } else {\r\n        getAPIClient()\r\n          .then(gapi =>\r\n            gapi.client.drive.files.get({\r\n              fileId: directoryId,\r\n              fields: 'parents',\r\n            })\r\n          )\r\n          .then(response => {\r\n            if (!response.result.parents) {\r\n              resolve(null);\r\n            } else {\r\n              resolve(response.result.parents[0]);\r\n            }\r\n          })\r\n          .catch(reject);\r\n      }\r\n    });\r\n\r\n    const rootFolderIdPromise = new Promise((resolve, reject) => {\r\n      if (!!window.rootFolderId) {\r\n        resolve(window.rootFolderId);\r\n      } else {\r\n        getAPIClient()\r\n          .then(gapi =>\r\n            gapi.client.drive.files.get({\r\n              fileId: 'root',\r\n              fields: 'id',\r\n            })\r\n          )\r\n          .then(response => {\r\n            window.rootFolderId = response.result.id;\r\n            resolve(response.result.id);\r\n          })\r\n          .catch(reject);\r\n      }\r\n    });\r\n\r\n    return new Promise((resolve, reject) => {\r\n      Promise.all([fileListPromise, fileParentPromise, rootFolderIdPromise]).then(\r\n        ([listing, parentId, rootFolderId]) => {\r\n          const directoryParentId = parentId === rootFolderId ? '' : parentId;\r\n          listing.additionalSyncBackendState = listing.additionalSyncBackendState.set(\r\n            'parentId',\r\n            directoryParentId\r\n          );\r\n          resolve(listing);\r\n        }\r\n      );\r\n    });\r\n  };\r\n\r\n  const getDirectoryListing = directoryId =>\r\n    getFiles(directoryId.startsWith('/') ? directoryId.substr(1) : directoryId);\r\n\r\n  const getMoreDirectoryListing = additionalSyncBackendState => {\r\n    const directoryId = additionalSyncBackendState.get('currentDirectoryId');\r\n    const nextPageToken = additionalSyncBackendState.get('nextPageToken');\r\n    return getFiles(directoryId, nextPageToken);\r\n  };\r\n\r\n  const fileIdByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient()\r\n        .then(gapi =>\r\n          gapi.client.drive.files.list({\r\n            pageSize: 1,\r\n            fields: 'files(id)',\r\n            q: `'${parentId}' in parents and trashed = false and name = '${name}'`,\r\n          })\r\n        )\r\n        .then(response =>\r\n          resolve(response.result.files.length > 0 ? response.result.files[0].id : null)\r\n        )\r\n        .catch(reject);\r\n    });\r\n\r\n  const updateFile = (fileId, contents) => {\r\n    fileId = fileId.startsWith('/') ? fileId.substr(1) : fileId;\r\n\r\n    return getAPIClient().then(gapi => {\r\n      fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          Authorization: `Bearer ${gapi.auth.getToken().access_token}`,\r\n        },\r\n        body: contents,\r\n      });\r\n    });\r\n  };\r\n\r\n  const createFile = (name, parentId, contents) => {\r\n    return new Promise((resolve, reject) => {\r\n      fileIdByNameAndParent(name, parentId)\r\n        .then(fileId =>\r\n          !!fileId\r\n            ? updateFile(fileId, contents).then(resolve).catch(reject)\r\n            : getAPIClient().then(gapi => {\r\n                gapi.client.drive.files\r\n                  .create({\r\n                    name,\r\n                    parents: parentId,\r\n                  })\r\n                  .then(response => updateFile(response.result.id, contents))\r\n                  .then(resolve)\r\n                  .catch(reject);\r\n              })\r\n        )\r\n        .catch(reject);\r\n    });\r\n  };\r\n\r\n  const duplicateFile = (fileId, fileNameCallback) => {\r\n    return new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        gapi.client.drive.files\r\n          .get({\r\n            fileId,\r\n            fields: 'name, parents',\r\n          })\r\n          .then(getResponse => {\r\n            if (!getResponse.result.name) {\r\n              reject();\r\n            } else {\r\n              const newFileName = fileNameCallback(getResponse.result.name);\r\n              const parents = getResponse.result.parents[0];\r\n              fileIdByNameAndParent(newFileName, parents).then(backupFileId => {\r\n                const makeCopy = () => {\r\n                  gapi.client.drive.files\r\n                    .copy({\r\n                      fileId,\r\n                      parents,\r\n                      name: newFileName,\r\n                    })\r\n                    .then(copyResponse => {\r\n                      resolve();\r\n                    })\r\n                    .catch(reject);\r\n                };\r\n\r\n                if (!!backupFileId) {\r\n                  gapi.client.drive.files\r\n                    .delete({ fileId: backupFileId })\r\n                    .then(makeCopy)\r\n                    .catch(reject);\r\n                } else {\r\n                  makeCopy();\r\n                }\r\n              });\r\n            }\r\n          });\r\n      });\r\n    });\r\n  };\r\n\r\n  const getFileContentsAndMetadata = fileId =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        fileId = fileId.startsWith('/') ? fileId.substr(1) : fileId;\r\n\r\n        const fileContentsPromise = new Promise(resolve => {\r\n          gapi.client.drive.files\r\n            .get({\r\n              fileId,\r\n              alt: 'media',\r\n            })\r\n            .then(response => resolve(decodeURIComponent(escape(response.body))))\r\n            .catch(error => {\r\n              if (error.body && JSON.parse(error.body).error.errors[0].reason === 'notFound') {\r\n                reject();\r\n              }\r\n            });\r\n        });\r\n\r\n        const fileModifiedTimePromise = new Promise(resolve => {\r\n          gapi.client.drive.files\r\n            .get({\r\n              fileId,\r\n              fields: 'modifiedTime',\r\n            })\r\n            .then(response => {\r\n              resolve(response.result.modifiedTime);\r\n            })\r\n            .catch(error => {\r\n              if (error.body && JSON.parse(error.body).error.errors[0].reason === 'notFound') {\r\n                reject();\r\n              }\r\n            });\r\n        });\r\n\r\n        Promise.all([fileContentsPromise, fileModifiedTimePromise]).then(\r\n          ([contents, lastModifiedAt]) => {\r\n            resolve({\r\n              contents,\r\n              lastModifiedAt,\r\n            });\r\n          }\r\n        );\r\n      });\r\n    });\r\n\r\n  const getFileContents = fileId =>\r\n    new Promise((resolve, reject) =>\r\n      getFileContentsAndMetadata(fileId)\r\n        .then(({ contents }) => resolve(contents))\r\n        .catch(reject)\r\n    );\r\n\r\n  const getFileContentsByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) =>\r\n      fileIdByNameAndParent(name, parentId).then(fileId => getFileContents(fileId).then(resolve))\r\n    );\r\n\r\n  const deleteFileByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi =>\r\n        gapi.client.drive.files\r\n          .list({\r\n            pageSize: 1,\r\n            fields: 'files(id)',\r\n            q: `'${parentId}' in parents and trashed = false and name = '${name}'`,\r\n          })\r\n          .then(listResponse => {\r\n            if (listResponse.result.files.length > 0) {\r\n              gapi.client.drive.files\r\n                .delete({\r\n                  fileId: listResponse.result.files[0].id,\r\n                })\r\n                .then(resolve)\r\n                .catch(reject);\r\n            } else {\r\n              resolve();\r\n            }\r\n          })\r\n      );\r\n    });\r\n\r\n  return {\r\n    type: 'Google Drive',\r\n    isSignedIn,\r\n    getDirectoryListing,\r\n    getMoreDirectoryListing,\r\n    updateFile,\r\n    createFile,\r\n    duplicateFile,\r\n    getFileContentsAndMetadata,\r\n    getFileContents,\r\n    getFileContentsByNameAndParent,\r\n    deleteFileByNameAndParent,\r\n  };\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nconst PrivacyPolicy = () => {\r\n  return (\r\n    <div className=\"privacy-policy-container\">\r\n      <h1>Privacy Policy</h1>\r\n      <p>Last updated: April 15th, 2019</p>\r\n      <p>\r\n        We (\"us\" or \"our\") operate https://org-web.org (the \"Site\"). This page informs you of our\r\n        policies regarding the collection, use and disclosure of Personal Information we receive\r\n        from users of the Site.\r\n      </p>\r\n      <p>\r\n        We use your Personal Information only for providing and improving the Site. By using the\r\n        Site, you agree to the collection and use of information in accordance with this policy.\r\n      </p>\r\n      <h2>Information Collection And Use</h2>\r\n      <p>\r\n        While using our Site, we may ask you to provide us with certain personally identifiable\r\n        information that can be used to contact or identify you. Personally identifiable information\r\n        may include, but is not limited to your name (\"Personal Information\").\r\n      </p>\r\n      <h2>Log Data</h2>\r\n      <p>\r\n        Like many site operators, we collect information that your browser sends whenever you visit\r\n        our Site (\"Log Data\").\r\n      </p>\r\n      <p>\r\n        This Log Data may include information such as your computer's Internet Protocol (\"IP\")\r\n        address, browser type, browser version, the pages of our Site that you visit, the time and\r\n        date of your visit, the time spent on those pages and other statistics.\r\n      </p>\r\n      <p>\r\n        In addition, we may use third party services such as Google Analytics that collect, monitor\r\n        and analyze this data.\r\n      </p>\r\n      <h2>Cookies</h2>\r\n      <p>\r\n        Cookies are files with small amount of data, which may include an anonymous unique\r\n        identifier. Cookies are sent to your browser from a web site and stored on your computer's\r\n        hard drive.\r\n      </p>\r\n      <p>\r\n        Like many sites, we use \"cookies\" to collect information. You can instruct your browser to\r\n        refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept\r\n        cookies, you may not be able to use some portions of our Site.\r\n      </p>\r\n      <h2>Security</h2>\r\n      <p>\r\n        The security of your Personal Information is important to us, but remember that no method of\r\n        transmission over the Internet, or method of electronic storage, is 100% secure. While we\r\n        strive to use commercially acceptable means to protect your Personal Information, we cannot\r\n        guarantee its absolute security.\r\n      </p>\r\n      <h2>Changes To This Privacy Policy</h2>\r\n      <p>\r\n        This Privacy Policy is effective as of April 15th, 2019 and will remain in effect except\r\n        with respect to any changes in its provisions in the future, which will be in effect\r\n        immediately after being posted on this page.\r\n      </p>\r\n      <p>\r\n        We reserve the right to update or change our Privacy Policy at any time and you should check\r\n        this Privacy Policy periodically. Your continued use of the Service after we post any\r\n        modifications to the Privacy Policy on this page will constitute your acknowledgment of the\r\n        modifications and your consent to abide and be bound by the modified Privacy Policy.\r\n      </p>\r\n      <p>\r\n        If we make any material changes to this Privacy Policy, we will notify you either through\r\n        the email address you have provided us, or by placing a prominent notice on our website.\r\n      </p>\r\n      <h2>Contact</h2>\r\n      <p>Us If you have any questions about this Privacy Policy, please contact us.</p>\r\n    </div>\r\n  );\r\n};\r\nexport default PrivacyPolicy;\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Link, withRouter } from 'react-router-dom';\r\n\r\nimport logo from './org-web.svg';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport * as baseActions from '../../actions/base';\r\nimport { ActionCreators as undoActions } from 'redux-linear-undo';\r\n\r\nimport { List } from 'immutable';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nclass HeaderBar extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleChangelogClick',\r\n      'handleSettingsClick',\r\n      'handleModalPageDoneClick',\r\n      'handleSettingsSubPageBackClick',\r\n      'handleUndoClick',\r\n      'handleHelpClick',\r\n    ]);\r\n  }\r\n\r\n  getPathRoot() {\r\n    const {\r\n      location: { pathname },\r\n    } = this.props;\r\n    return pathname.split('/')[1];\r\n  }\r\n\r\n  renderFileBrowserBackButton() {\r\n    const {\r\n      location: { pathname },\r\n      syncBackendType,\r\n    } = this.props;\r\n    if (syncBackendType === 'Google Drive') {\r\n      return <div />;\r\n    }\r\n\r\n    let directoryPath = pathname.substr('/files'.length);\r\n    if (directoryPath.endsWith('/')) {\r\n      directoryPath = directoryPath.substring(0, directoryPath.length - 1);\r\n    }\r\n\r\n    if (directoryPath === '') {\r\n      return <div />;\r\n    } else {\r\n      const pathParts = directoryPath.split('/');\r\n      const parentDirectoryName = pathParts[pathParts.length - 2];\r\n      const parentPath = pathParts.slice(0, pathParts.length - 1).join('/');\r\n\r\n      return (\r\n        <Link to={`/files${parentPath}`} className=\"header-bar__back-button\">\r\n          <i className=\"fas fa-chevron-left\" />\r\n          <span className=\"header-bar__back-button__directory-path\">{parentDirectoryName}/</span>\r\n        </Link>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderOrgFileBackButton() {\r\n    const {\r\n      location: { pathname },\r\n    } = this.props;\r\n\r\n    let filePath = pathname.substr('/file'.length);\r\n    if (filePath.endsWith('/')) {\r\n      filePath = filePath.substring(0, filePath.length - 1);\r\n    }\r\n\r\n    const pathParts = filePath.split('/');\r\n    const directoryPath = pathParts.slice(0, pathParts.length - 1).join('/');\r\n\r\n    return (\r\n      <Link to={`/files${directoryPath}`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">File browser</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  renderLogo() {\r\n    return (\r\n      <div className=\"header-bar__logo-container\">\r\n        <img className=\"header-bar__logo\" src={logo} alt=\"Logo\" width=\"30\" height=\"30\" />\r\n        <h2 className=\"header-bar__app-name\">org-web</h2>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSampleFileBackButton() {\r\n    return (\r\n      <Link to={`/`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Home</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  renderSignInBackButton() {\r\n    return (\r\n      <Link to={`/`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Home</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  handleSettingsSubPageBackClick() {\r\n    this.props.base.popModalPage();\r\n  }\r\n\r\n  renderSettingsSubPageBackButton() {\r\n    return (\r\n      <div className=\"header-bar__back-button\" onClick={this.handleSettingsSubPageBackClick}>\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Settings</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderBackButton() {\r\n    const { activeModalPage } = this.props;\r\n\r\n    switch (activeModalPage) {\r\n      case 'changelog':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'keyboard_shortcuts_editor':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'capture_templates_editor':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'sample':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'settings':\r\n        return <div />;\r\n      default:\r\n    }\r\n\r\n    switch (this.getPathRoot()) {\r\n      case '':\r\n        return this.renderLogo();\r\n      case 'files':\r\n        return this.renderFileBrowserBackButton();\r\n      case 'file':\r\n        return this.renderOrgFileBackButton();\r\n      case 'sample':\r\n        return this.renderSampleFileBackButton();\r\n      case 'sign_in':\r\n        return this.renderSignInBackButton();\r\n      default:\r\n        return <div />;\r\n    }\r\n  }\r\n\r\n  renderTitle() {\r\n    const titleContainerWithText = text => <div className=\"header-bar__title\">{text}</div>;\r\n\r\n    switch (this.props.activeModalPage) {\r\n      case 'changelog':\r\n        return titleContainerWithText('Changelog');\r\n      case 'settings':\r\n        return titleContainerWithText('Settings');\r\n      case 'keyboard_shortcuts_editor':\r\n        return titleContainerWithText('Shortcuts');\r\n      case 'capture_templates_editor':\r\n        return titleContainerWithText('Capture');\r\n      case 'sample':\r\n        return titleContainerWithText('Sample');\r\n      default:\r\n    }\r\n\r\n    switch (this.getPathRoot()) {\r\n      case 'sample':\r\n        return titleContainerWithText('Sample');\r\n      case 'sign_in':\r\n        return titleContainerWithText('Sign in');\r\n      default:\r\n    }\r\n\r\n    return titleContainerWithText('');\r\n  }\r\n\r\n  handleChangelogClick() {\r\n    this.props.base.pushModalPage('changelog');\r\n  }\r\n\r\n  handleSettingsClick() {\r\n    this.props.base.pushModalPage('settings');\r\n  }\r\n\r\n  handleModalPageDoneClick() {\r\n    this.props.base.clearModalStack();\r\n  }\r\n\r\n  handleUndoClick() {\r\n    if (this.props.isUndoEnabled) {\r\n      this.props.undo.undo();\r\n    }\r\n  }\r\n\r\n  handleHelpClick() {\r\n    this.props.base.pushModalPage('settings');\r\n    this.props.base.pushModalPage('sample');\r\n  }\r\n\r\n  renderActions() {\r\n    const {\r\n      isAuthenticated,\r\n      hasUnseenChangelog,\r\n      activeModalPage,\r\n      path,\r\n      isUndoEnabled,\r\n    } = this.props;\r\n\r\n    if (!!activeModalPage) {\r\n      return (\r\n        <div className=\"header-bar__actions\" onClick={this.handleModalPageDoneClick}>\r\n          Done\r\n        </div>\r\n      );\r\n    } else {\r\n      const undoIconClassName = classNames('fas fa-undo header-bar__actions__item', {\r\n        'header-bar__actions__item--disabled': !isUndoEnabled,\r\n      });\r\n\r\n      const settingsIconClassName = classNames('fas fa-cogs header-bar__actions__item', {\r\n        'settings-icon--has-unseen-changelog': hasUnseenChangelog,\r\n      });\r\n\r\n      return (\r\n        <div className=\"header-bar__actions\">\r\n          {!isAuthenticated &&\r\n            this.getPathRoot() !== 'sign_in' && (\r\n              <Link to=\"/sign_in\">\r\n                <div className=\"header-bar__actions__item\" title=\"Sign in\">\r\n                  Sign in\r\n                </div>\r\n              </Link>\r\n            )}\r\n\r\n          {!isAuthenticated && (\r\n            <a href=\"https://github.com/DanielDe/org-web\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n              <i className=\"fab fa-github header-bar__actions__item\" />\r\n            </a>\r\n          )}\r\n\r\n          {isAuthenticated &&\r\n            !activeModalPage &&\r\n            !!path && (\r\n              <Fragment>\r\n                <i className={undoIconClassName} onClick={this.handleUndoClick} title=\"Undo\" />\r\n                <i\r\n                  className=\"fas fa-question-circle header-bar__actions__item\"\r\n                  onClick={this.handleHelpClick}\r\n                  title=\"Help\"\r\n                />\r\n              </Fragment>\r\n            )}\r\n\r\n          {isAuthenticated && (\r\n            <i\r\n              className={settingsIconClassName}\r\n              onClick={this.handleSettingsClick}\r\n              title=\"Settings\"\r\n            />\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const className = classNames('header-bar', {\r\n      'header-bar--with-logo': this.getPathRoot() === '',\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        {this.renderBackButton()}\r\n        {this.renderTitle()}\r\n        {this.renderActions()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    isAuthenticated: state.syncBackend.get('isAuthenticated'),\r\n    hasUnseenChangelog: state.base.get('hasUnseenChangelog'),\r\n    activeModalPage: state.base.get('modalPageStack', List()).last(),\r\n    path: state.org.present.get('path'),\r\n    isUndoEnabled: state.org.past.length > 0,\r\n    syncBackendType: state.syncBackend.get('client') && state.syncBackend.get('client').type,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n    undo: bindActionCreators(undoActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(HeaderBar)\r\n);\r\n","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default () => {\r\n  return (\r\n    <div className=\"landing-container\">\r\n      <h1 className=\"landing-app-name\">org-web</h1>\r\n      <h2 className=\"landing-tagline\">Edit your org files online.</h2>\r\n      <h2 className=\"landing-tagline\">Optimized for mobile.</h2>\r\n      <h2 className=\"landing-tagline\">\r\n        Syncs with Dropbox\r\n        <br />\r\n        and Google Drive.\r\n      </h2>\r\n\r\n      <Link to=\"/sample\">\r\n        <div className=\"btn landing-button view-sample-button\">View sample</div>\r\n      </Link>\r\n      <Link to=\"/sign_in\">\r\n        <div className=\"btn landing-button\">Sign in</div>\r\n      </Link>\r\n\r\n      <div className=\"mailing-list-signup-container\">\r\n        Interested in getting updates about org-web? Sign up for the{' '}\r\n        <a href=\"http://eepurl.com/dK5F9w\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n          mailing list\r\n        </a>{' '}\r\n        (Or check out some{' '}\r\n        <a\r\n          href=\"https://us19.campaign-archive.com/home/?u=36b9d8082ddb55e6cc7e22339&id=f427625e31\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          past emails\r\n        </a>{' '}\r\n        before you sign up)\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\n\r\nconst FileBrowser = ({\r\n  path,\r\n  listing,\r\n  hasMore,\r\n  isLoadingMore,\r\n  syncBackendType,\r\n  syncBackend,\r\n  additionalSyncBackendState,\r\n}) => {\r\n  useEffect(() => syncBackend.getDirectoryListing(path), [path]);\r\n\r\n  const handleLoadMoreClick = () => syncBackend.loadMoreDirectoryListing();\r\n\r\n  const getParentDirectoryPath = () => {\r\n    switch (syncBackendType) {\r\n      case 'Dropbox':\r\n        const pathParts = path.split('/');\r\n        return pathParts.slice(0, pathParts.length - 1).join('/');\r\n      case 'Google Drive':\r\n        return !!additionalSyncBackendState.get('parentId')\r\n          ? '/' + additionalSyncBackendState.get('parentId')\r\n          : null;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const isTopLevelDirectory = path === '';\r\n\r\n  return (\r\n    <div className=\"file-browser-container\">\r\n      {syncBackendType === 'Dropbox' && (\r\n        <h3 className=\"file-browser__header\">Directory: {isTopLevelDirectory ? '/' : path}</h3>\r\n      )}\r\n\r\n      <ul className=\"file-browser__file-list\">\r\n        {!isTopLevelDirectory && (\r\n          <Link to={`/files${getParentDirectoryPath()}`}>\r\n            <li className=\"file-browser__file-list__element\">\r\n              <i className=\"fas fa-folder file-browser__file-list__icon--directory\" /> ..\r\n            </li>\r\n          </Link>\r\n        )}\r\n\r\n        {(listing || []).map(file => {\r\n          const isDirectory = file.get('isDirectory');\r\n          const isBackupFile = file.get('name').endsWith('.org-web-bak');\r\n          const isOrgFile = file.get('name').endsWith('.org');\r\n          const isSettingsFile = file.get('name') === '.org-web-config.json';\r\n\r\n          const iconClass = classNames('file-browser__file-list__icon fas', {\r\n            'fa-folder': isDirectory,\r\n            'file-browser__file-list__icon--directory': isDirectory,\r\n            'fa-file': !isDirectory && !isBackupFile && !isSettingsFile,\r\n            'file-browser__file-list__icon--not-org': !isOrgFile,\r\n            'fa-copy': isBackupFile,\r\n            'fa-cogs': isSettingsFile,\r\n          });\r\n\r\n          if (file.get('isDirectory')) {\r\n            return (\r\n              <Link to={`/files${file.get('path')}`} key={file.get('id')}>\r\n                <li className=\"file-browser__file-list__element\">\r\n                  <i className={iconClass} /> {file.get('name')}/\r\n                </li>\r\n              </Link>\r\n            );\r\n          } else {\r\n            return (\r\n              <Link to={`/file${file.get('path')}`} key={file.get('id')}>\r\n                <li className=\"file-browser__file-list__element\">\r\n                  <i className={iconClass} /> {file.get('name')}\r\n                </li>\r\n              </Link>\r\n            );\r\n          }\r\n        })}\r\n\r\n        {hasMore &&\r\n          (isLoadingMore ? (\r\n            <li className=\"file-browser__file-list__loading-more-container\">\r\n              <i className=\"fas fa-spinner fa-lg fa-spin\" />\r\n            </li>\r\n          ) : (\r\n            <li\r\n              className=\"file-browser__file-list__element file-browser__file-list__element--load-more-row\"\r\n              onClick={handleLoadMoreClick}\r\n            >\r\n              Load more...\r\n            </li>\r\n          ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const currentFileBrowserDirectoryListing = state.syncBackend.get(\r\n    'currentFileBrowserDirectoryListing'\r\n  );\r\n  return {\r\n    syncBackendType: state.syncBackend.get('client').type,\r\n    listing: !!currentFileBrowserDirectoryListing\r\n      ? currentFileBrowserDirectoryListing.get('listing')\r\n      : null,\r\n    hasMore:\r\n      !!currentFileBrowserDirectoryListing && currentFileBrowserDirectoryListing.get('hasMore'),\r\n    isLoadingMore:\r\n      !!currentFileBrowserDirectoryListing &&\r\n      currentFileBrowserDirectoryListing.get('isLoadingMore'),\r\n    additionalSyncBackendState:\r\n      !!currentFileBrowserDirectoryListing &&\r\n      currentFileBrowserDirectoryListing.get('additionalSyncBackendState'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(FileBrowser);\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ message }) => {\r\n  const [shouldRenderIndicator, setShouldRenderIndicator] = useState(true);\r\n  const [lastMessage, setLastMessage] = useState(message);\r\n\r\n  useEffect(\r\n    () => {\r\n      if (!!message) {\r\n        setLastMessage(message);\r\n        setShouldRenderIndicator(true);\r\n      }\r\n    },\r\n    [message]\r\n  );\r\n\r\n  const handleAnimationRest = () => {\r\n    if (!!message) {\r\n      return;\r\n    }\r\n\r\n    setShouldRenderIndicator(false);\r\n    setLastMessage(null);\r\n  };\r\n\r\n  const handleClick = () => setShouldRenderIndicator(false);\r\n\r\n  if (!shouldRenderIndicator) {\r\n    return null;\r\n  }\r\n\r\n  const style = {\r\n    opacity: spring(!!message ? 0.9 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={style} onRest={handleAnimationRest}>\r\n      {style => (\r\n        <div className=\"loading-indicator\" style={style} onClick={handleClick}>\r\n          {lastMessage}\r\n        </div>\r\n      )}\r\n    </Motion>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({\r\n  subPartDataAndHandlers: {\r\n    onEnterTableEditMode,\r\n    onAddNewTableRow,\r\n    onRemoveTableRow,\r\n    onAddNewTableColumn,\r\n    onRemoveTableColumn,\r\n  },\r\n}) => {\r\n  return (\r\n    <div className=\"table-action-drawer-container\">\r\n      <div className=\" table-action-drawer__edit-icon-container\" onClick={onEnterTableEditMode}>\r\n        <i className=\"fas fa-pencil-alt fa-lg\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onAddNewTableRow}>\r\n        <i className=\"fas fa-plus fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon table-action-drawer__sub-icon--rotated\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onRemoveTableRow}>\r\n        <i className=\"fas fa-times fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon table-action-drawer__sub-icon--rotated\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onAddNewTableColumn}>\r\n        <i className=\"fas fa-plus fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onRemoveTableColumn}>\r\n        <i className=\"fas fa-times fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString';\r\nimport TableActionDrawer from './TableActionDrawer';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class TablePart extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleCellSelect',\r\n      'handleTextareaBlur',\r\n      'handleCellChange',\r\n      'handleInsertTimestamp',\r\n      'handleTextareaRef',\r\n    ]);\r\n\r\n    this.state = {\r\n      rawCellValues: this.generateCellValueMap(props.table),\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const {\r\n      subPartDataAndHandlers: { onTableCellValueUpdate, selectedTableCellId, inTableEditMode },\r\n    } = this.props;\r\n    const { rawCellValues } = this.state;\r\n\r\n    if (prevProps.subPartDataAndHandlers.inTableEditMode && !inTableEditMode) {\r\n      if (rawCellValues.has(selectedTableCellId)) {\r\n        onTableCellValueUpdate(selectedTableCellId, rawCellValues.get(selectedTableCellId));\r\n      }\r\n    }\r\n\r\n    if (this.props.table !== prevProps.table) {\r\n      this.setState({ rawCellValues: this.generateCellValueMap(this.props.table) });\r\n    }\r\n  }\r\n\r\n  generateCellValueMap(table) {\r\n    return Map(\r\n      table\r\n        .get('contents')\r\n        .map(row => row.get('contents').map(cell => [cell.get('id'), cell.get('rawContents')]))\r\n        .flatten()\r\n    );\r\n  }\r\n\r\n  handleCellSelect(cellId) {\r\n    return () => this.props.subPartDataAndHandlers.onTableCellSelect(cellId);\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.subPartDataAndHandlers.onExitTableEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  handleCellChange(event) {\r\n    const { rawCellValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedTableCellId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      rawCellValues: rawCellValues.set(selectedTableCellId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleInsertTimestamp() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { rawCellValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedTableCellId },\r\n    } = this.props;\r\n    const cellValue = rawCellValues.get(selectedTableCellId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      rawCellValues: rawCellValues.set(\r\n        selectedTableCellId,\r\n        cellValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          cellValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      table,\r\n      subPartDataAndHandlers: { selectedTableCellId, inTableEditMode, shouldDisableActions },\r\n    } = this.props;\r\n    const { rawCellValues } = this.state;\r\n\r\n    const isTableSelected = table\r\n      .get('contents')\r\n      .some(row => row.get('contents').some(cell => cell.get('id') === selectedTableCellId));\r\n\r\n    return (\r\n      <Fragment>\r\n        <table className=\"table-part\">\r\n          <tbody>\r\n            {table.get('contents').map(row => (\r\n              <tr key={row.get('id')}>\r\n                {row.get('contents').map(cell => {\r\n                  const isCellSelected = cell.get('id') === selectedTableCellId;\r\n\r\n                  const className = classNames('table-part__cell', {\r\n                    'table-part__cell--selected': isCellSelected,\r\n                  });\r\n\r\n                  return (\r\n                    <td\r\n                      className={className}\r\n                      key={cell.get('id')}\r\n                      onClick={this.handleCellSelect(cell.get('id'))}\r\n                    >\r\n                      {isCellSelected && inTableEditMode ? (\r\n                        <div className=\"table-cell__edit-container\">\r\n                          <textarea\r\n                            autoFocus\r\n                            className=\"textarea\"\r\n                            rows=\"3\"\r\n                            value={rawCellValues.get(cell.get('id'))}\r\n                            onBlur={this.handleTextareaBlur}\r\n                            onChange={this.handleCellChange}\r\n                            ref={this.handleTextareaRef}\r\n                          />\r\n                          <div\r\n                            className=\"table-cell__insert-timestamp-button\"\r\n                            onClick={this.handleInsertTimestamp}\r\n                          >\r\n                            <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                            Insert timestamp\r\n                          </div>\r\n                        </div>\r\n                      ) : cell.get('contents').size > 0 ? (\r\n                        <AttributedString\r\n                          parts={cell.get('contents')}\r\n                          subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n                        />\r\n                      ) : (\r\n                        '   '\r\n                      )}\r\n                    </td>\r\n                  );\r\n                })}\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        <Collapse isOpened={isTableSelected && !shouldDisableActions}>\r\n          <TableActionDrawer subPartDataAndHandlers={this.props.subPartDataAndHandlers} />\r\n        </Collapse>\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n","// Interpolates between two colors.\r\n// colorA and colorB should be objects with keys {r, g, b, a}.\r\n// interpolationFactor should be a number between 0 and 1 representing how far from colorA to\r\n// colorB it should interpolate.\r\n// An object with keys {r, g, b, a} will be returned.\r\nexport const interpolateColors = (colorA, colorB, interpolationFactor) => {\r\n  return {\r\n    r: parseInt((colorB.r - colorA.r) * interpolationFactor + colorA.r, 10),\r\n    g: parseInt((colorB.g - colorA.g) * interpolationFactor + colorA.g, 10),\r\n    b: parseInt((colorB.b - colorA.b) * interpolationFactor + colorA.b, 10),\r\n    a: (colorB.a - colorA.a) * interpolationFactor + colorA.a,\r\n  };\r\n};\r\n\r\nexport const rgbaObject = (r, g, b, a) => {\r\n  return { r, g, b, a };\r\n};\r\n\r\nexport const rgbaString = rgba => {\r\n  return `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;\r\n};\r\n","import React from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../lib/color';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ state, onClick }) => {\r\n  const uncheckedColor = rgbaObject(255, 255, 255, 1);\r\n  const checkedColor = rgbaObject(94, 52, 140, 1);\r\n\r\n  const checkboxStyle = {\r\n    colorFactor: spring(\r\n      {\r\n        checked: 1,\r\n        partial: 1,\r\n        unchecked: 0,\r\n      }[state],\r\n      { stiffness: 300 }\r\n    ),\r\n  };\r\n\r\n  return (\r\n    <Motion style={checkboxStyle}>\r\n      {style => {\r\n        const backgroundColor = rgbaString(\r\n          interpolateColors(uncheckedColor, checkedColor, style.colorFactor)\r\n        );\r\n\r\n        return (\r\n          <div className=\"checkbox\" onClick={onClick} style={{ backgroundColor }}>\r\n            <div className=\"checkbox__inner-container\">\r\n              {state === 'checked' && <i className=\"fas fa-check\" />}\r\n              {state === 'partial' && <i className=\"fas fa-minus\" />}\r\n              {state === 'unchecked' && <i className=\"fas fa-square\" />}\r\n            </div>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({\r\n  subPartDataAndHandlers: {\r\n    onEnterListTitleEditMode,\r\n    onEnterListContentsEditMode,\r\n    onAddNewListItem,\r\n    onRemoveListItem,\r\n  },\r\n}) => {\r\n  return (\r\n    <div className=\"list-action-drawer-container\">\r\n      <div className=\"list-action-drawer__row\">\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onEnterListTitleEditMode}>\r\n          <i className=\"fas fa-pencil-alt fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div\r\n          className=\"list-action-drawer__edit-icon-container\"\r\n          onClick={onEnterListContentsEditMode}\r\n        >\r\n          <i className=\"fas fa-edit fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onAddNewListItem}>\r\n          <i className=\"fas fa-plus fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onRemoveListItem}>\r\n          <i className=\"fas fa-times fa-lg\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString/';\r\nimport Checkbox from '../../../../../UI/Checkbox/';\r\nimport ListActionDrawer from './ListActionDrawer';\r\nimport { attributedStringToRawText } from '../../../../../../lib/export_org';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class ListPart extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleListItemSelect',\r\n      'handleCheckboxClick',\r\n      'handleTextareaBlur',\r\n      'handleListTitleChange',\r\n      'handleListContentsChange',\r\n      'handleInsertTimestampListTitle',\r\n      'handleInsertTimestampListContents',\r\n      'handleTextareaRef',\r\n    ]);\r\n\r\n    this.state = {\r\n      listTitleValues: this.generateListTitleValueMap(props.part),\r\n      listContentsValues: this.generateListContentsValueMap(props.part),\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const {\r\n      subPartDataAndHandlers: {\r\n        onListTitleValueUpdate,\r\n        onListContentsValueUpdate,\r\n        inListTitleEditMode,\r\n        inListContentsEditMode,\r\n        selectedListItemId,\r\n      },\r\n    } = this.props;\r\n    const { listTitleValues, listContentsValues } = this.state;\r\n\r\n    if (prevProps.subPartDataAndHandlers.inListTitleEditMode && !inListTitleEditMode) {\r\n      if (listTitleValues.has(selectedListItemId)) {\r\n        onListTitleValueUpdate(selectedListItemId, listTitleValues.get(selectedListItemId));\r\n      }\r\n    }\r\n\r\n    const prevSelectedListItemId = prevProps.subPartDataAndHandlers.selectedListItemId;\r\n    if ((prevSelectedListItemId !== selectedListItemId) && inListTitleEditMode && prevProps.subPartDataAndHandlers.inListTitleEditMode) {\r\n      if (listTitleValues.has(prevSelectedListItemId)) {\r\n        onListTitleValueUpdate(prevSelectedListItemId, listTitleValues.get(prevSelectedListItemId));\r\n      }\r\n    }\r\n\r\n    if (prevProps.subPartDataAndHandlers.inListContentsEditMode && !inListContentsEditMode) {\r\n      if (listContentsValues.has(selectedListItemId)) {\r\n        onListContentsValueUpdate(selectedListItemId, listContentsValues.get(selectedListItemId));\r\n      }\r\n    }\r\n\r\n    if ((prevSelectedListItemId !== selectedListItemId) && inListContentsEditMode && prevProps.subPartDataAndHandlers.inListContentsEditMode) {\r\n      if (listContentsValues.has(prevSelectedListItemId)) {\r\n        onListContentsValueUpdate(prevSelectedListItemId, listContentsValues.get(prevSelectedListItemId));\r\n      }\r\n    }\r\n\r\n    if (this.props.part !== prevProps.part) {\r\n      this.setState({ listTitleValues: this.generateListTitleValueMap(this.props.part) });\r\n      this.setState({ listContentsValues: this.generateListContentsValueMap(this.props.part) });\r\n    }\r\n  }\r\n\r\n  generateListTitleValueMap(part) {\r\n    return Map(\r\n      part\r\n        .get('items')\r\n        .map(item => [item.get('id'), attributedStringToRawText(item.get('titleLine'))])\r\n    );\r\n  }\r\n\r\n  generateListContentsValueMap(part) {\r\n    return Map(\r\n      part\r\n        .get('items')\r\n        .map(item => [item.get('id'), attributedStringToRawText(item.get('contents'))])\r\n    );\r\n  }\r\n\r\n  handleListItemSelect(itemId) {\r\n    return () => this.props.subPartDataAndHandlers.onListItemSelect(itemId);\r\n  }\r\n\r\n  handleCheckboxClick(itemId) {\r\n    return () => this.props.subPartDataAndHandlers.onCheckboxClick(itemId);\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.subPartDataAndHandlers.onExitListTitleEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  handleListTitleChange(event) {\r\n    const { listTitleValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      listTitleValues: listTitleValues.set(selectedListItemId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleListContentsChange(event) {\r\n    const { listContentsValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      listContentsValues: listContentsValues.set(selectedListItemId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleInsertTimestampListTitle() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { listTitleValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n    const listTitleValue = listTitleValues.get(selectedListItemId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      listTitleValues: listTitleValues.set(\r\n        selectedListItemId,\r\n        listTitleValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          listTitleValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handleInsertTimestampListContents() {\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { listContentsValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n    const listContentsValue = listContentsValues.get(selectedListItemId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      listContentsValues: listContentsValues.set(\r\n        selectedListItemId,\r\n        listContentsValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          listContentsValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  renderContent() {\r\n    const {\r\n      part,\r\n      subPartDataAndHandlers: {\r\n        selectedListItemId,\r\n        inListTitleEditMode,\r\n        inListContentsEditMode,\r\n        shouldDisableActions,\r\n      },\r\n    } = this.props;\r\n    const { listTitleValues, listContentsValues } = this.state;\r\n\r\n    return part.get('items').map(item => {\r\n      const isItemSelected = item.get('id') === selectedListItemId;\r\n      const lineContainerClass = classNames({\r\n        'list-part__not_checkbox-container': !item.get('isCheckbox'),\r\n        'list-part__checkbox-container': item.get('isCheckbox'),\r\n        'list-part__item--selected': isItemSelected,\r\n      });\r\n\r\n      return (\r\n        <li key={item.get('id')} value={item.get('forceNumber')}>\r\n          <div className={lineContainerClass} onClick={this.handleListItemSelect(item.get('id'))}>\r\n            {item.get('isCheckbox') && (\r\n              <Checkbox\r\n                onClick={this.handleCheckboxClick(item.get('id'))}\r\n                state={item.get('checkboxState')}\r\n              />\r\n            )}\r\n            {isItemSelected && inListTitleEditMode ? (\r\n              <div className=\"list-title-line__edit-container\">\r\n                <textarea\r\n                  autoFocus\r\n                  className=\"textarea\"\r\n                  rows=\"3\"\r\n                  ref={this.handleTextareaRef}\r\n                  value={listTitleValues.get(item.get('id'))}\r\n                  onBlur={this.handleTextareaBlur}\r\n                  onChange={this.handleListTitleChange}\r\n                />\r\n                <div\r\n                  className=\"list-title-line__insert-timestamp-button\"\r\n                  onClick={this.handleInsertTimestampListTitle}\r\n                >\r\n                  <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                  Insert timestamp\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              listTitleValues.get(item.get('id'))) ? (\r\n                <AttributedString\r\n                parts={item.get('titleLine')}\r\n                subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n              />\r\n              ) : (\r\n                <span>&nbsp;</span>\r\n              )}\r\n          </div>\r\n          <Collapse isOpened={isItemSelected && !shouldDisableActions}>\r\n            <ListActionDrawer subPartDataAndHandlers={this.props.subPartDataAndHandlers} />\r\n          </Collapse>\r\n          {isItemSelected && inListContentsEditMode ? (\r\n            <div className=\"list-contents__edit-container\">\r\n              <textarea\r\n                autoFocus\r\n                className=\"textarea\"\r\n                rows=\"8\"\r\n                ref={this.handleTextareaRef}\r\n                value={listContentsValues.get(item.get('id'))}\r\n                onBlur={this.handleTextareaBlur}\r\n                onChange={this.handleListContentsChange}\r\n              />\r\n              <div\r\n                className=\"list-contents__insert-timestamp-button\"\r\n                onClick={this.handleInsertTimestampListContents}\r\n              >\r\n                <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                Insert timestamp\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <AttributedString\r\n              parts={item.get('contents')}\r\n              subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n            />\r\n          )}\r\n        </li>\r\n      );\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        {this.props.part.get('isOrdered') ? (\r\n          <ol className=\"attributed-string__list-part attributed-string__list-part--ordered\">\r\n            {this.renderContent()}\r\n          </ol>\r\n        ) : (\r\n          <ul className=\"attributed-string__list-part\">{this.renderContent()}</ul>\r\n        )}\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nexport default ({ part, subPartDataAndHandlers: { onTimestampClick, shouldDisableActions } }) => {\r\n  const handleClick = () => (shouldDisableActions ? void 0 : onTimestampClick(part.get('id')));\r\n\r\n  const firstTimestamp = part.get('firstTimestamp');\r\n  const secondTimestamp = part.get('secondTimestamp');\r\n\r\n  return (\r\n    <span className=\"attributed-string__timestamp-part\" onClick={handleClick}>\r\n      {!!firstTimestamp && renderAsText(firstTimestamp)}\r\n      {!!secondTimestamp && (\r\n        <Fragment>\r\n          {'--'}\r\n          {renderAsText(secondTimestamp)}\r\n        </Fragment>\r\n      )}\r\n    </span>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TablePart from './components/TablePart';\r\nimport ListPart from './components/ListPart';\r\nimport TimestampPart from './components/TimestampPart';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ parts, subPartDataAndHandlers }) => {\r\n  let className;\r\n\r\n  return (\r\n    <span>\r\n      {parts.map(part => {\r\n        switch (part.get('type')) {\r\n          case 'text':\r\n            return part.get('contents');\r\n          case 'link':\r\n            const uri = part.getIn(['contents', 'uri']);\r\n            const title = part.getIn(['contents', 'title']) || uri;\r\n\r\n            return (\r\n              <a key={part.get('id')} href={uri} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                {title}\r\n              </a>\r\n            );\r\n          case 'percentage-cookie':\r\n            className = classNames('attributed-string__cookie-part', {\r\n              'attributed-string__cookie-part--complete':\r\n                parseInt(part.get('percentage'), 10) === 100,\r\n            });\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                [{part.get('percentage')}\r\n                %]\r\n              </span>\r\n            );\r\n          case 'fraction-cookie':\r\n            className = classNames('attributed-string__cookie-part', {\r\n              'attributed-string__cookie-part--complete':\r\n                part.getIn(['fraction', 0]) !== '' &&\r\n                part.getIn(['fraction', 0]) === part.getIn(['fraction', 1]),\r\n            });\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                [{part.getIn(['fraction', 0])}/{part.getIn(['fraction', 1])}]\r\n              </span>\r\n            );\r\n          case 'table':\r\n            return (\r\n              <TablePart\r\n                key={part.get('id')}\r\n                table={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          case 'list':\r\n            return (\r\n              <ListPart\r\n                key={part.get('id')}\r\n                part={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          case 'inline-markup':\r\n            className = classNames(\r\n              'attributed-string__inline-markup',\r\n              `attributed-string__inline-markup--${part.get('markupType')}`\r\n            );\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                {part.get('content')}\r\n              </span>\r\n            );\r\n          case 'timestamp':\r\n            return (\r\n              <TimestampPart\r\n                key={part.get('id')}\r\n                part={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          default:\r\n            console.error(`Unrecognized attributed string part type! ${part.get('type')}`);\r\n            return '';\r\n        }\r\n      })}\r\n    </span>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../lib/timestamps';\r\n\r\nimport AttributedString from '../AttributedString';\r\n\r\nclass TitleLine extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleTitleSpanRef',\r\n      'handleTextareaRef',\r\n      'handleTitleClick',\r\n      'handleTextareaBlur',\r\n      'handleTitleChange',\r\n      'handleTitleFieldClick',\r\n      'handleTodoClick',\r\n      'handleTimestampClick',\r\n      'handleInsertTimestamp',\r\n    ]);\r\n\r\n    this.state = {\r\n      titleValue: this.calculateRawTitle(props.header),\r\n      containerWidth: null,\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  storeContainerWidth() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.storeContainerWidth();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { header } = this.props;\r\n\r\n    if (prevProps.inEditMode && !this.props.inEditMode) {\r\n      this.props.org.updateHeaderTitle(header.get('id'), this.state.titleValue);\r\n    }\r\n\r\n    if (prevProps.header !== this.props.header) {\r\n      this.setState(\r\n        {\r\n          titleValue: this.calculateRawTitle(this.props.header),\r\n        },\r\n        () => this.storeContainerWidth()\r\n      );\r\n    }\r\n  }\r\n\r\n  handleRef(div) {\r\n    this.containerDiv = div;\r\n  }\r\n\r\n  handleTitleSpanRef(span) {\r\n    this.titleSpan = span;\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  calculateRawTitle(header) {\r\n    const todoKeyword = header.getIn(['titleLine', 'todoKeyword']);\r\n    const tags = header.getIn(['titleLine', 'tags']);\r\n\r\n    let titleValue = header.getIn(['titleLine', 'rawTitle']);\r\n\r\n    if (!!todoKeyword) {\r\n      titleValue = `${todoKeyword} ${titleValue}`;\r\n    }\r\n\r\n    if (!!tags && tags.size > 0) {\r\n      titleValue = `${titleValue} :${tags.join(':')}:`;\r\n    }\r\n\r\n    return titleValue;\r\n  }\r\n\r\n  handleTitleClick(event) {\r\n    const { header, hasContent, isSelected, onClick } = this.props;\r\n\r\n    if (!!onClick) {\r\n      onClick();\r\n    } else {\r\n      if (hasContent && (!header.get('opened') || isSelected)) {\r\n        this.props.org.toggleHeaderOpened(header.get('id'));\r\n      }\r\n\r\n      this.props.org.selectHeader(header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleTodoClick(event) {\r\n    const { header, shouldTapTodoToAdvance, onClick } = this.props;\r\n\r\n    if (!!onClick) {\r\n      onClick();\r\n      event.stopPropagation();\r\n    } else {\r\n      this.props.org.selectHeader(header.get('id'));\r\n\r\n      if (shouldTapTodoToAdvance) {\r\n        this.props.org.advanceTodoState();\r\n      }\r\n    }\r\n  }\r\n\r\n  handleTextareaBlur(event) {\r\n    // Give the \"Insert timestamp\" button click a chance to tell us to ignore the blur event.\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.org.exitEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  handleTitleChange(event) {\r\n    // If the last character typed was a newline at the end, exit edit mode.\r\n    const newTitle = event.target.value;\r\n    const lastCharacter = newTitle[newTitle.length - 1];\r\n    if (\r\n      this.state.titleValue === newTitle.substring(0, newTitle.length - 1) &&\r\n      lastCharacter === '\\n'\r\n    ) {\r\n      this.props.org.exitEditMode();\r\n      return;\r\n    }\r\n\r\n    this.setState({ titleValue: newTitle });\r\n  }\r\n\r\n  handleTitleFieldClick(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  handleTimestampClick(timestampId) {\r\n    this.props.base.activatePopup('timestamp-editor', { timestampId });\r\n  }\r\n\r\n  handleInsertTimestamp(event) {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { titleValue } = this.state;\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      titleValue:\r\n        titleValue.substring(0, insertionIndex) +\r\n        getCurrentTimestampAsText() +\r\n        titleValue.substring(this.textarea.selectionEnd || insertionIndex),\r\n    });\r\n\r\n    this.textarea.focus();\r\n\r\n    event.stopPropagation();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      color,\r\n      hasContent,\r\n      inEditMode,\r\n      shouldDisableActions,\r\n      shouldDisableExplicitWidth,\r\n    } = this.props;\r\n    const { containerWidth } = this.state;\r\n    const todoKeyword = header.getIn(['titleLine', 'todoKeyword']);\r\n\r\n    const titleStyle = {\r\n      color,\r\n      wordBreak: 'break-word',\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className=\"title-line\"\r\n        onClick={this.handleTitleClick}\r\n        ref={this.handleRef}\r\n        style={{ width: shouldDisableExplicitWidth ? '' : containerWidth }}\r\n      >\r\n        {!inEditMode && !!todoKeyword ? (\r\n          <span\r\n            className={classNames('todo-keyword', `todo-keyword--${todoKeyword.toLowerCase()}`)}\r\n            onClick={this.handleTodoClick}\r\n          >\r\n            {todoKeyword}\r\n          </span>\r\n        ) : (\r\n          ''\r\n        )}\r\n\r\n        {inEditMode ? (\r\n          <div className=\"title-line__edit-container\">\r\n            <textarea\r\n              autoFocus\r\n              className=\"textarea\"\r\n              rows=\"3\"\r\n              ref={this.handleTextareaRef}\r\n              value={this.state.titleValue}\r\n              onBlur={this.handleTextareaBlur}\r\n              onChange={this.handleTitleChange}\r\n              onClick={this.handleTitleFieldClick}\r\n            />\r\n            <div\r\n              className=\"title-line__insert-timestamp-button\"\r\n              onClick={this.handleInsertTimestamp}\r\n            >\r\n              <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n              Insert timestamp\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <span style={titleStyle} ref={this.handleTitleSpanRef}>\r\n              <AttributedString\r\n                parts={header.getIn(['titleLine', 'title'])}\r\n                subPartDataAndHandlers={{\r\n                  onTimestampClick: this.handleTimestampClick,\r\n                  shouldDisableActions,\r\n                }}\r\n              />\r\n              {!header.get('opened') && hasContent ? '...' : ''}\r\n            </span>\r\n\r\n            {header.getIn(['titleLine', 'tags']).size > 0 && (\r\n              <div>\r\n                {header\r\n                  .getIn(['titleLine', 'tags'])\r\n                  .toSet()\r\n                  .toList()\r\n                  .filter(tag => !!tag)\r\n                  .map(tag => (\r\n                    <div className=\"header-tag\" key={tag}>\r\n                      {tag}\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode:\r\n      state.org.present.get('editMode') === 'title' &&\r\n      state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    shouldTapTodoToAdvance: state.base.get('shouldTapTodoToAdvance'),\r\n    isSelected: state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TitleLine);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\n\r\nexport default class PlanningItems extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleTimestampClick']);\r\n  }\r\n\r\n  handleTimestampClick(planningItemIndex) {\r\n    return () => this.props.onClick(planningItemIndex);\r\n  }\r\n\r\n  render() {\r\n    const { planningItems } = this.props;\r\n\r\n    if (planningItems.size === 0) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        {planningItems.map((planningItem, index) => (\r\n          <div key={planningItem.get('id')} className=\"planning-items__item-container\">\r\n            <div className=\"planning-item__type\">{planningItem.get('type')}: </div>\r\n            <div className=\"planning-item__timestamp\" onClick={this.handleTimestampClick(index)}>\r\n              {renderAsText(planningItem.get('timestamp'))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment, useState } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString';\r\n\r\nexport default ({ propertyListItems, shouldDisableActions, onTimestampClick, onEdit }) => {\r\n  const [isDrawerCollapsed, setIsDrawerCollapsed] = useState(true);\r\n\r\n  const handleCollapseToggle = () => setIsDrawerCollapsed(!isDrawerCollapsed);\r\n\r\n  return propertyListItems.size === 0 ? null : (\r\n    <div className=\"property-list-container\">\r\n      <div className=\"property-list__property\" onClick={handleCollapseToggle}>\r\n        :PROPERTIES:\r\n        {isDrawerCollapsed ? '...' : ''}\r\n      </div>\r\n\r\n      {!isDrawerCollapsed && (\r\n        <Fragment>\r\n          {propertyListItems.map(propertyListItem => (\r\n            <div className=\"property-list__item-container\" key={propertyListItem.get('id')}>\r\n              <div\r\n                className=\"property-list__property\"\r\n                onClick={shouldDisableActions ? null : onEdit}\r\n              >\r\n                :{propertyListItem.get('property')}:\r\n              </div>\r\n              <div className=\"property-list__value\">\r\n                <AttributedString\r\n                  parts={propertyListItem.get('value') || []}\r\n                  subPartDataAndHandlers={{\r\n                    onTimestampClick,\r\n                    shouldDisableActions,\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          <div className=\"property-list__property\" onClick={onEdit}>\r\n            :END:\r\n          </div>\r\n        </Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport PlanningItems from './components/PlanningItems';\r\nimport PropertyListItems from './components/PropertyListItems';\r\n\r\nimport _ from 'lodash';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport { renderAsText, getCurrentTimestampAsText } from '../../../../lib/timestamps';\r\nimport { attributedStringToRawText } from '../../../../lib/export_org';\r\n\r\nimport AttributedString from '../AttributedString';\r\n\r\nclass HeaderContent extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleTextareaRef',\r\n      'handleDescriptionChange',\r\n      'handleTextareaBlur',\r\n      'handleTableCellSelect',\r\n      'handleExitTableEditMode',\r\n      'handleTableCellValueUpdate',\r\n      'handleEnterTableEditMode',\r\n      'handleAddNewTableRow',\r\n      'handleRemoveTableRow',\r\n      'handleAddNewTableColumn',\r\n      'handleRemoveTableColumn',\r\n      'handleCheckboxClick',\r\n      'handleListItemSelect',\r\n      'handleEnterListTitleEditMode',\r\n      'handleExitListTitleEditMode',\r\n      'handleListTitleValueUpdate',\r\n      'handleEnterListContentsEditMode',\r\n      'handleExitListContentsEditMode',\r\n      'handleListContentsValueUpdate',\r\n      'handleAddNewListItem',\r\n      'handleRemoveListItem',\r\n      'handleTimestampClick',\r\n      'handleInsertTimestamp',\r\n      'handlePlanningItemTimestampClick',\r\n      'handlePropertyListEdit',\r\n    ]);\r\n\r\n    this.state = {\r\n      descriptionValue: this.calculateRawDescription(props.header),\r\n      containerWidth: null,\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  storeContainerWidth() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.storeContainerWidth();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { header } = this.props;\r\n\r\n    if (prevProps.inEditMode && !this.props.inEditMode) {\r\n      this.props.org.updateHeaderDescription(header.get('id'), this.state.descriptionValue);\r\n    }\r\n\r\n    if (prevProps.header !== this.props.header) {\r\n      this.setState(\r\n        {\r\n          descriptionValue: this.calculateRawDescription(this.props.header),\r\n        },\r\n        () => this.storeContainerWidth()\r\n      );\r\n    }\r\n  }\r\n\r\n  calculateRawDescription(header) {\r\n    const planningItems = header.get('planningItems');\r\n    const propertyListItems = header.get('propertyListItems');\r\n\r\n    const planningItemsText = planningItems\r\n      .map(\r\n        planningItem =>\r\n          `${planningItem.get('type')}: ${renderAsText(planningItem.get('timestamp'))}`\r\n      )\r\n      .join(' ');\r\n\r\n    let propertyListItemsText = '';\r\n    if (propertyListItems.size > 0) {\r\n      propertyListItemsText += ':PROPERTIES:\\n';\r\n      propertyListItemsText += propertyListItems\r\n        .map(\r\n          propertyListItem =>\r\n            `:${propertyListItem.get('property')}: ${attributedStringToRawText(\r\n              propertyListItem.get('value')\r\n            )}`\r\n        )\r\n        .join('\\n');\r\n      propertyListItemsText += '\\n:END:';\r\n    }\r\n\r\n    let descriptionText = '';\r\n    if (!!planningItemsText) {\r\n      descriptionText += planningItemsText + '\\n';\r\n    }\r\n    if (!!propertyListItemsText) {\r\n      descriptionText += propertyListItemsText + '\\n';\r\n    }\r\n    descriptionText += header.get('rawDescription');\r\n    return descriptionText;\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  handleRef(div) {\r\n    this.containerDiv = div;\r\n  }\r\n\r\n  handleDescriptionChange(event) {\r\n    this.setState({ descriptionValue: event.target.value });\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    // Give the \"Insert timestamp\" button click a chance to tell us to ignore the blur event.\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.org.exitEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  handleTableCellSelect(cellId) {\r\n    this.props.org.setSelectedTableCellId(cellId);\r\n  }\r\n\r\n  handleExitTableEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleTableCellValueUpdate(cellId, newValue) {\r\n    this.props.org.updateTableCellValue(cellId, newValue);\r\n  }\r\n\r\n  handleEnterTableEditMode() {\r\n    this.props.org.enterEditMode('table');\r\n  }\r\n\r\n  handleAddNewTableRow() {\r\n    this.props.org.addNewTableRow();\r\n  }\r\n\r\n  handleRemoveTableRow() {\r\n    this.props.org.removeTableRow();\r\n  }\r\n\r\n  handleAddNewTableColumn() {\r\n    this.props.org.addNewTableColumn();\r\n  }\r\n\r\n  handleRemoveTableColumn() {\r\n    this.props.org.removeTableColumn();\r\n  }\r\n\r\n  handleCheckboxClick(listItemId) {\r\n    this.props.org.advanceCheckboxState(listItemId);\r\n  }\r\n\r\n  handleListItemSelect(listItemId) {\r\n    this.props.org.setSelectedListItemId(listItemId);\r\n  }\r\n\r\n  handleEnterListTitleEditMode() {\r\n    this.props.org.enterEditMode('list-title');\r\n  }\r\n\r\n  handleExitListTitleEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleListTitleValueUpdate(listItemId, newValue) {\r\n    this.props.org.updateListTitleValue(listItemId, newValue);\r\n  }\r\n\r\n  handleEnterListContentsEditMode() {\r\n    this.props.org.enterEditMode('list-contents');\r\n  }\r\n\r\n  handleExitListContentsEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleListContentsValueUpdate(listItemId, newValue) {\r\n    this.props.org.updateListContentsValue(listItemId, newValue);\r\n  }\r\n\r\n  handleAddNewListItem() {\r\n    this.props.org.addNewListItemAndEdit();\r\n  }\r\n\r\n  handleRemoveListItem() {\r\n    this.props.org.removeListItem();\r\n  }\r\n\r\n  handleTimestampClick(timestampId) {\r\n    this.props.base.activatePopup('timestamp-editor', { timestampId });\r\n  }\r\n\r\n  handleInsertTimestamp() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { descriptionValue } = this.state;\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      descriptionValue:\r\n        descriptionValue.substring(0, insertionIndex) +\r\n        getCurrentTimestampAsText() +\r\n        descriptionValue.substring(this.textarea.selectionEnd || insertionIndex),\r\n    });\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handlePlanningItemTimestampClick(headerId) {\r\n    return planningItemIndex =>\r\n      this.props.base.activatePopup('timestamp-editor', { headerId, planningItemIndex });\r\n  }\r\n\r\n  handlePropertyListEdit() {\r\n    const { header } = this.props;\r\n    this.props.base.activatePopup('property-list-editor', { headerId: header.get('id') });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      inEditMode,\r\n      selectedTableCellId,\r\n      inTableEditMode,\r\n      shouldDisableActions,\r\n      selectedListItemId,\r\n      inListTitleEditMode,\r\n      inListContentsEditMode,\r\n    } = this.props;\r\n    const { containerWidth } = this.state;\r\n\r\n    if (!header.get('opened')) {\r\n      return <div />;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className=\"header-content-container nice-scroll\"\r\n        ref={this.handleRef}\r\n        style={{ width: containerWidth }}\r\n      >\r\n        {inEditMode ? (\r\n          <div className=\"header-content__edit-container\">\r\n            <textarea\r\n              autoFocus\r\n              className=\"textarea\"\r\n              rows={this.state.descriptionValue.split('\\n').length}\r\n              ref={this.handleTextareaRef}\r\n              value={this.state.descriptionValue}\r\n              onBlur={this.handleTextareaBlur}\r\n              onChange={this.handleDescriptionChange}\r\n            />\r\n            <div\r\n              className=\"header-content__insert-timestamp-button\"\r\n              onClick={this.handleInsertTimestamp}\r\n            >\r\n              <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n              Insert timestamp\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <Fragment>\r\n            <PlanningItems\r\n              planningItems={header.get('planningItems')}\r\n              onClick={this.handlePlanningItemTimestampClick(header.get('id'))}\r\n            />\r\n            <PropertyListItems\r\n              propertyListItems={header.get('propertyListItems')}\r\n              onTimestampClick={this.handleTimestampClick}\r\n              shouldDisableActions={shouldDisableActions}\r\n              onEdit={this.handlePropertyListEdit}\r\n            />\r\n            <AttributedString\r\n              parts={header.get('description')}\r\n              subPartDataAndHandlers={{\r\n                onTableCellSelect: this.handleTableCellSelect,\r\n                selectedTableCellId: selectedTableCellId,\r\n                inTableEditMode: inTableEditMode,\r\n                onExitTableEditMode: this.handleExitTableEditMode,\r\n                onTableCellValueUpdate: this.handleTableCellValueUpdate,\r\n                onEnterTableEditMode: this.handleEnterTableEditMode,\r\n                onAddNewTableRow: this.handleAddNewTableRow,\r\n                onRemoveTableRow: this.handleRemoveTableRow,\r\n                onAddNewTableColumn: this.handleAddNewTableColumn,\r\n                onRemoveTableColumn: this.handleRemoveTableColumn,\r\n                onCheckboxClick: this.handleCheckboxClick,\r\n                onListItemSelect: this.handleListItemSelect,\r\n                onEnterListTitleEditMode: this.handleEnterListTitleEditMode,\r\n                onExitListTitleEditMode: this.handleExitListTitleEditMode,\r\n                onListTitleValueUpdate: this.handleListTitleValueUpdate,\r\n                onEnterListContentsEditMode: this.handleEnterListContentsEditMode,\r\n                onExitListContentsEditMode: this.handleExitListContentsEditMode,\r\n                onListContentsValueUpdate: this.handleListContentsValueUpdate,\r\n                onAddNewListItem: this.handleAddNewListItem,\r\n                onRemoveListItem: this.handleRemoveListItem,\r\n                selectedListItemId: selectedListItemId,\r\n                inListTitleEditMode: inListTitleEditMode,\r\n                inListContentsEditMode: inListContentsEditMode,\r\n                onTimestampClick: this.handleTimestampClick,\r\n                shouldDisableActions,\r\n              }}\r\n            />\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode:\r\n      state.org.present.get('editMode') === 'description' &&\r\n      state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    isSelected: state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    selectedTableCellId: state.org.present.get('selectedTableCellId'),\r\n    inTableEditMode: state.org.present.get('editMode') === 'table',\r\n    selectedListItemId: state.org.present.get('selectedListItemId'),\r\n    inListTitleEditMode: state.org.present.get('editMode') === 'list-title',\r\n    inListContentsEditMode: state.org.present.get('editMode') === 'list-contents',\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HeaderContent);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default class HeaderActionDrawer extends PureComponent {\r\n  // A nasty hack required to get click handling to work properly in Firefox. No idea why its\r\n  // broken in the first place or why this fixes it.\r\n  iconWithFFClickCatcher(className, onClick) {\r\n    return (\r\n      <div onClick={onClick} className=\"header-action-drawer__ff-click-catcher-container\">\r\n        <div className=\"header-action-drawer__ff-click-catcher\" />\r\n        <i className={className} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      onEnterTitleEditMode,\r\n      onEnterDescriptionEditMode,\r\n      onTagsClick,\r\n      isFocused,\r\n      onFocus,\r\n      onUnfocus,\r\n      onAddNewHeader,\r\n      onDeadlineClick,\r\n      onScheduledClick,\r\n    } = this.props;\r\n\r\n    return (\r\n      <div className=\"header-action-drawer-container\">\r\n        <div className=\"header-action-drawer__row\">\r\n          {this.iconWithFFClickCatcher('fas fa-pencil-alt fa-lg', onEnterTitleEditMode)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-edit fa-lg', onEnterDescriptionEditMode)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-tags fa-lg', onTagsClick)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {isFocused\r\n            ? this.iconWithFFClickCatcher('fas fa-expand fa-lg', onUnfocus)\r\n            : this.iconWithFFClickCatcher('fas fa-compress fa-lg', onFocus)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-plus fa-lg', onAddNewHeader)}\r\n          <div\r\n            className=\"header-action-drawer__deadline-scheduled-button\"\r\n            onClick={onDeadlineClick}\r\n          >\r\n            Deadline\r\n          </div>\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          <div\r\n            className=\"header-action-drawer__deadline-scheduled-button\"\r\n            onClick={onScheduledClick}\r\n          >\r\n            Scheduled\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\n\r\nimport TitleLine from '../TitleLine';\r\nimport HeaderContent from '../HeaderContent';\r\nimport HeaderActionDrawer from './components/HeaderActionDrawer';\r\n\r\nimport { headerWithId } from '../../../../lib/org_utils';\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../../lib/color';\r\n\r\nclass Header extends PureComponent {\r\n  SWIPE_ACTION_ACTIVATION_DISTANCE = 80;\r\n  FREE_DRAG_ACTIVATION_DISTANCE = 10;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleMouseDown',\r\n      'handleMouseMove',\r\n      'handleMouseUp',\r\n      'handleMouseOut',\r\n      'handleTouchMove',\r\n      'handleTouchStart',\r\n      'handleTouchEnd',\r\n      'handleTouchCancel',\r\n      'handleHeaderClick',\r\n      'handleEnterTitleEditMode',\r\n      'handleEnterDescriptionEditMode',\r\n      'handleShowTagsModal',\r\n      'handleFocus',\r\n      'handleUnfocus',\r\n      'handleAddNewHeader',\r\n      'handleRest',\r\n      'handleDeadlineClick',\r\n      'handleScheduledClick',\r\n    ]);\r\n\r\n    this.state = {\r\n      isDraggingFreely: false,\r\n      dragStartX: null,\r\n      dragStartY: null,\r\n      currentDragX: null,\r\n      containerWidth: null,\r\n      isPlayingRemoveAnimation: false,\r\n      heightBeforeRemove: null,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  handleRef(containerDiv) {\r\n    this.containerDiv = containerDiv;\r\n    this.props.onRef(containerDiv);\r\n  }\r\n\r\n  handleDragStart(event, dragX, dragY) {\r\n    if (this.props.shouldDisableActions) {\r\n      return;\r\n    }\r\n    if (this.props.inEditMode) {\r\n      return;\r\n    }\r\n\r\n    if (!!event.target.closest('.table-part')) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      dragStartX: dragX,\r\n      dragStartY: dragY,\r\n    });\r\n  }\r\n\r\n  handleDragMove(dragX, dragY) {\r\n    const { dragStartX, dragStartY } = this.state;\r\n    if (dragStartX === null) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.isDraggingFreely) {\r\n      if (Math.abs(dragX - dragStartX) >= this.FREE_DRAG_ACTIVATION_DISTANCE) {\r\n        this.setState({ isDraggingFreely: true });\r\n      }\r\n    }\r\n\r\n    if (Math.abs(dragY - dragStartY) >= this.SWIPE_ACTION_ACTIVATION_DISTANCE / 2) {\r\n      this.setState({ dragStartX: null });\r\n    } else {\r\n      this.setState({ currentDragX: dragX });\r\n    }\r\n  }\r\n\r\n  handleDragEnd() {\r\n    const { dragStartX, currentDragX } = this.state;\r\n\r\n    if (!!dragStartX && !!currentDragX) {\r\n      const swipeDistance = currentDragX - dragStartX;\r\n\r\n      if (swipeDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE) {\r\n        this.props.org.advanceTodoState(this.props.header.get('id'));\r\n      }\r\n\r\n      if (-1 * swipeDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE) {\r\n        this.setState({\r\n          isPlayingRemoveAnimation: true,\r\n          heightBeforeRemove: this.containerDiv.offsetHeight,\r\n        });\r\n      }\r\n    }\r\n\r\n    this.setState({\r\n      dragStartX: null,\r\n      currentDragX: null,\r\n      isDraggingFreely: false,\r\n    });\r\n  }\r\n\r\n  handleDragCancel() {\r\n    this.setState({\r\n      dragStartX: null,\r\n      currentDragX: null,\r\n      isDraggingFreely: false,\r\n    });\r\n  }\r\n\r\n  handleMouseDown(event) {\r\n    this.handleDragStart(event, event.clientX, event.clientY);\r\n  }\r\n\r\n  handleMouseMove(event) {\r\n    this.handleDragMove(event.clientX, event.clientY);\r\n  }\r\n\r\n  handleMouseUp() {\r\n    this.handleDragEnd();\r\n  }\r\n\r\n  handleMouseOut() {\r\n    this.handleDragCancel();\r\n  }\r\n\r\n  handleTouchStart(event) {\r\n    this.handleDragStart(event, event.changedTouches[0].clientX, event.changedTouches[0].clientY);\r\n  }\r\n\r\n  handleTouchMove(event) {\r\n    this.handleDragMove(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\r\n  }\r\n\r\n  handleTouchEnd() {\r\n    this.handleDragEnd();\r\n  }\r\n\r\n  handleTouchCancel() {\r\n    this.handleDragCancel();\r\n  }\r\n\r\n  handleHeaderClick(event) {\r\n    const classList = event.target.classList;\r\n    if (classList.contains('header') || classList.contains('header__bullet')) {\r\n      const { header, hasContent, isSelected } = this.props;\r\n\r\n      if (hasContent && (!header.get('opened') || isSelected)) {\r\n        this.props.org.toggleHeaderOpened(header.get('id'));\r\n      }\r\n\r\n      this.props.org.selectHeader(header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleEnterTitleEditMode() {\r\n    this.props.org.enterEditMode('title');\r\n  }\r\n\r\n  handleEnterDescriptionEditMode() {\r\n    this.props.org.openHeader(this.props.header.get('id'));\r\n    this.props.org.enterEditMode('description');\r\n  }\r\n\r\n  handleShowTagsModal() {\r\n    this.props.base.activatePopup('tags-editor');\r\n  }\r\n\r\n  handleFocus() {\r\n    this.props.org.focusHeader(this.props.header.get('id'));\r\n  }\r\n\r\n  handleUnfocus() {\r\n    this.props.org.unfocusHeader();\r\n  }\r\n\r\n  handleAddNewHeader() {\r\n    this.props.org.addHeaderAndEdit(this.props.header.get('id'));\r\n  }\r\n\r\n  handleRest() {\r\n    if (this.state.isPlayingRemoveAnimation) {\r\n      this.props.org.removeHeader(this.props.header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleDeadlineAndScheduledClick(planningType) {\r\n    const { header } = this.props;\r\n\r\n    const existingDeadlinePlanningItemIndex = header\r\n      .get('planningItems', [])\r\n      .findIndex(planningItem => planningItem.get('type') === planningType);\r\n\r\n    if (existingDeadlinePlanningItemIndex === -1) {\r\n      this.props.org.addNewPlanningItem(header.get('id'), planningType);\r\n      this.props.base.activatePopup('timestamp-editor', {\r\n        headerId: header.get('id'),\r\n        planningItemIndex: header.get('planningItems').size,\r\n      });\r\n    } else {\r\n      this.props.base.activatePopup('timestamp-editor', {\r\n        headerId: header.get('id'),\r\n        planningItemIndex: existingDeadlinePlanningItemIndex,\r\n      });\r\n    }\r\n\r\n    this.props.org.openHeader(header.get('id'));\r\n  }\r\n\r\n  handleDeadlineClick() {\r\n    this.handleDeadlineAndScheduledClick('DEADLINE');\r\n  }\r\n\r\n  handleScheduledClick() {\r\n    this.handleDeadlineAndScheduledClick('SCHEDULED');\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      color,\r\n      hasContent,\r\n      isSelected,\r\n      bulletStyle,\r\n      focusedHeader,\r\n      isFocused,\r\n      shouldDisableActions,\r\n    } = this.props;\r\n\r\n    const indentLevel = !!focusedHeader\r\n      ? header.get('nestingLevel') - focusedHeader.get('nestingLevel') + 1\r\n      : header.get('nestingLevel');\r\n\r\n    const {\r\n      dragStartX,\r\n      currentDragX,\r\n      isDraggingFreely,\r\n      isPlayingRemoveAnimation,\r\n      containerWidth,\r\n    } = this.state;\r\n    const marginLeft =\r\n      !!dragStartX && !!currentDragX && isDraggingFreely\r\n        ? currentDragX - dragStartX\r\n        : isPlayingRemoveAnimation\r\n          ? spring(-1 * containerWidth, { stiffness: 300 })\r\n          : spring(0, { stiffness: 300 });\r\n\r\n    const style = {\r\n      paddingLeft: 20 * indentLevel,\r\n      marginLeft,\r\n      heightFactor: isPlayingRemoveAnimation ? spring(0, { stiffness: 300 }) : 1,\r\n    };\r\n\r\n    const className = classNames('header', {\r\n      'header--selected': isSelected,\r\n      'header--removing': isPlayingRemoveAnimation,\r\n    });\r\n\r\n    return (\r\n      <Motion style={style} onRest={this.handleRest}>\r\n        {interpolatedStyle => {\r\n          const swipedDistance = interpolatedStyle.marginLeft;\r\n          const isLeftActionActivated = swipedDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE;\r\n          const isRightActionActivated =\r\n            -1 * swipedDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE;\r\n\r\n          const disabledColor = rgbaObject(211, 211, 211, 1);\r\n          const leftActivatedColor = rgbaObject(0, 128, 0, 1);\r\n          const rightActivatedColor = rgbaObject(255, 0, 0, 1);\r\n\r\n          const leftSwipeActionContainerStyle = {\r\n            width: interpolatedStyle.marginLeft,\r\n            backgroundColorFactor: spring(isLeftActionActivated ? 1 : 0, { stiffness: 300 }),\r\n          };\r\n          const rightSwipeActionContainerStyle = {\r\n            width: -1 * interpolatedStyle.marginLeft,\r\n            backgroundColorFactor: spring(isRightActionActivated ? 1 : 0, { stiffness: 300 }),\r\n          };\r\n\r\n          const leftIconStyle = {\r\n            display: swipedDistance > 30 ? '' : 'none',\r\n          };\r\n          const rightIconStyle = {\r\n            display: -1 * swipedDistance > 30 ? '' : 'none',\r\n          };\r\n\r\n          const { heightFactor, ...headerStyle } = interpolatedStyle;\r\n\r\n          if (isPlayingRemoveAnimation) {\r\n            headerStyle.height = this.state.heightBeforeRemove * heightFactor;\r\n          }\r\n\r\n          return (\r\n            <div\r\n              className={className}\r\n              style={headerStyle}\r\n              ref={this.handleRef}\r\n              onClick={this.handleHeaderClick}\r\n              onMouseDown={this.handleMouseDown}\r\n              onMouseMove={this.handleMouseMove}\r\n              onMouseUp={this.handleMouseUp}\r\n              onMouseOut={this.handleMouseOut}\r\n              onTouchStart={this.handleTouchStart}\r\n              onTouchMove={this.handleTouchMove}\r\n              onTouchEnd={this.handleTouchEnd}\r\n              onTouchCancel={this.handleTouchCancel}\r\n            >\r\n              <Motion style={leftSwipeActionContainerStyle}>\r\n                {leftInterpolatedStyle => {\r\n                  const leftStyle = {\r\n                    width: leftInterpolatedStyle.width,\r\n                    backgroundColor: rgbaString(\r\n                      interpolateColors(\r\n                        disabledColor,\r\n                        leftActivatedColor,\r\n                        leftInterpolatedStyle.backgroundColorFactor\r\n                      )\r\n                    ),\r\n                  };\r\n\r\n                  return (\r\n                    <div className=\"left-swipe-action-container\" style={leftStyle}>\r\n                      <i\r\n                        className=\"fas fa-check swipe-action-container__icon swipe-action-container__icon--left\"\r\n                        style={leftIconStyle}\r\n                      />\r\n                    </div>\r\n                  );\r\n                }}\r\n              </Motion>\r\n              <Motion style={rightSwipeActionContainerStyle}>\r\n                {rightInterpolatedStyle => {\r\n                  const rightStyle = {\r\n                    width: rightInterpolatedStyle.width,\r\n                    backgroundColor: rgbaString(\r\n                      interpolateColors(\r\n                        disabledColor,\r\n                        rightActivatedColor,\r\n                        rightInterpolatedStyle.backgroundColorFactor\r\n                      )\r\n                    ),\r\n                  };\r\n\r\n                  return (\r\n                    <div className=\"right-swipe-action-container\" style={rightStyle}>\r\n                      <i\r\n                        className=\"fas fa-times swipe-action-container__icon swipe-action-container__icon--right\"\r\n                        style={rightIconStyle}\r\n                      />\r\n                    </div>\r\n                  );\r\n                }}\r\n              </Motion>\r\n\r\n              <div style={{ marginLeft: -16, color }} className=\"header__bullet\">\r\n                {bulletStyle === 'Fancy' ? '●' : '*'}\r\n              </div>\r\n              <TitleLine\r\n                header={header}\r\n                color={color}\r\n                hasContent={hasContent}\r\n                isSelected={isSelected}\r\n                shouldDisableActions={shouldDisableActions}\r\n              />\r\n\r\n              <Collapse\r\n                isOpened={isSelected && !shouldDisableActions}\r\n                springConfig={{ stiffness: 300 }}\r\n                style={{ marginRight: rightSwipeActionContainerStyle.width }}\r\n              >\r\n                <HeaderActionDrawer\r\n                  onEnterTitleEditMode={this.handleEnterTitleEditMode}\r\n                  onEnterDescriptionEditMode={this.handleEnterDescriptionEditMode}\r\n                  isFocused={isFocused}\r\n                  onTagsClick={this.handleShowTagsModal}\r\n                  onFocus={this.handleFocus}\r\n                  onUnfocus={this.handleUnfocus}\r\n                  onAddNewHeader={this.handleAddNewHeader}\r\n                  onDeadlineClick={this.handleDeadlineClick}\r\n                  onScheduledClick={this.handleScheduledClick}\r\n                />\r\n              </Collapse>\r\n\r\n              <HeaderContent header={header} shouldDisableActions={shouldDisableActions} />\r\n            </div>\r\n          );\r\n        }}\r\n      </Motion>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const focusedHeader = !!state.org.present.get('focusedHeaderId')\r\n    ? headerWithId(state.org.present.get('headers'), state.org.present.get('focusedHeaderId'))\r\n    : null;\r\n\r\n  return {\r\n    bulletStyle: state.base.get('bulletStyle'),\r\n    focusedHeader,\r\n    isFocused: !!focusedHeader && focusedHeader.get('id') === props.header.get('id'),\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  org: bindActionCreators(orgActions, dispatch),\r\n  base: bindActionCreators(baseActions, dispatch),\r\n});\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Header);\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Header from '../Header';\r\n\r\nimport { numSubheadersOfHeaderWithId } from '../../../../lib/org_utils';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nclass HeaderList extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.headerRefs = {};\r\n\r\n    _.bindAll(this, ['handleHeaderRef']);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.selectedHeaderId !== this.props.selectedHeaderId) {\r\n      const selectedHeaderDiv = this.headerRefs[this.props.selectedHeaderId];\r\n      if (!!selectedHeaderDiv) {\r\n        const boundingRectangle = selectedHeaderDiv.getBoundingClientRect();\r\n        const viewportHeight = document.documentElement.clientHeight;\r\n\r\n        if (boundingRectangle.top > viewportHeight * 0.9 || boundingRectangle.bottom < 0) {\r\n          selectedHeaderDiv.scrollIntoView();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  handleHeaderRef(headerId) {\r\n    return div => (this.headerRefs[headerId] = div);\r\n  }\r\n\r\n  render() {\r\n    const { headers, selectedHeaderId, focusedHeaderId, shouldDisableActions } = this.props;\r\n\r\n    const headerRenderData = headers\r\n      .map(header => {\r\n        return {\r\n          header,\r\n          displayed: false,\r\n          hasContent:\r\n            !!header.get('rawDescription') ||\r\n            header.get('planningItems').size !== 0 ||\r\n            header.get('propertyListItems').size !== 0,\r\n        };\r\n      })\r\n      .toArray();\r\n\r\n    headerRenderData.forEach((headerRenderDatum, index) => {\r\n      const nestingLevel = headerRenderDatum.header.get('nestingLevel');\r\n\r\n      const hasNoParents = headerRenderData\r\n        .slice(0, index)\r\n        .every(\r\n          previousRenderDatum => previousRenderDatum.header.get('nestingLevel') >= nestingLevel\r\n        );\r\n      if (hasNoParents) {\r\n        headerRenderDatum.displayed = true;\r\n      }\r\n\r\n      const followingHeaders = headerRenderData.slice(index + 1);\r\n      for (\r\n        let followingHeaderIndex = 0;\r\n        followingHeaderIndex < followingHeaders.length;\r\n        ++followingHeaderIndex\r\n      ) {\r\n        const followingHeader = followingHeaders[followingHeaderIndex];\r\n        if (followingHeader.header.get('nestingLevel') <= nestingLevel) {\r\n          break;\r\n        }\r\n\r\n        headerRenderDatum.hasContent = true;\r\n\r\n        followingHeader.displayed =\r\n          headerRenderDatum.header.get('opened') && headerRenderDatum.displayed;\r\n      }\r\n    });\r\n\r\n    if (!!focusedHeaderId) {\r\n      const focusedHeaderIndex = headerRenderData.findIndex(\r\n        headerRenderDatum => headerRenderDatum.header.get('id') === focusedHeaderId\r\n      );\r\n\r\n      const previousHeaders = headerRenderData.slice(0, focusedHeaderIndex);\r\n      previousHeaders.forEach(headerRenderDatum => (headerRenderDatum.displayed = false));\r\n\r\n      const numSubheaders = numSubheadersOfHeaderWithId(headers, focusedHeaderId);\r\n      const followingHeaders = headerRenderData.slice(focusedHeaderIndex + numSubheaders + 1);\r\n      followingHeaders.forEach(headerRenderDatum => (headerRenderDatum.displayed = false));\r\n    }\r\n\r\n    const headerColors = [\r\n      'rgba(38, 143, 214, 1)',\r\n      'rgba(42, 164, 168, 1)',\r\n      'rgba(181, 142, 78, 1)',\r\n      'rgba(220, 64, 95, 1)',\r\n      'rgba(101, 128, 152, 1)',\r\n      'rgba(146, 164, 175, 1)',\r\n      'rgba(203, 85, 83, 1)',\r\n      'rgba(108, 119, 202, 1)',\r\n    ];\r\n\r\n    const displayedHeaderRenderData = headerRenderData.filter(\r\n      headerRenderDatum => headerRenderDatum.displayed\r\n    );\r\n\r\n    const className = classNames('header-list-container', {\r\n      'header-list-container--focused': !!focusedHeaderId,\r\n    });\r\n    return (\r\n      <div className={className}>\r\n        {displayedHeaderRenderData.map((headerRenderDatum, index) => {\r\n          const header = headerRenderDatum.header;\r\n          const color = headerColors[(header.get('nestingLevel') - 1) % headerColors.length];\r\n\r\n          return (\r\n            <Header\r\n              key={header.get('id')}\r\n              header={header}\r\n              color={color}\r\n              hasContent={headerRenderDatum.hasContent}\r\n              isSelected={header.get('id') === selectedHeaderId}\r\n              onRef={this.handleHeaderRef(header.get('id'))}\r\n              shouldDisableActions={shouldDisableActions}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    headers: state.org.present.get('headers'),\r\n    selectedHeaderId: state.org.present.get('selectedHeaderId'),\r\n    focusedHeaderId: state.org.present.get('focusedHeaderId'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {};\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(HeaderList);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\n\r\nexport default class ActionButton extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleClick']);\r\n  }\r\n\r\n  handleClick() {\r\n    const { onClick, isDisabled } = this.props;\r\n\r\n    if (isDisabled) {\r\n      return;\r\n    }\r\n\r\n    onClick();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      iconName,\r\n      subIconName,\r\n      isDisabled,\r\n      shouldRotateSubIcon,\r\n      letter,\r\n      additionalClassName,\r\n      style,\r\n      tooltip,\r\n      shouldSpinSubIcon,\r\n      onRef,\r\n    } = this.props;\r\n\r\n    const className = classNames(\r\n      'btn',\r\n      'btn--circle',\r\n      'action-drawer__btn',\r\n      additionalClassName || '',\r\n      {\r\n        fas: !letter,\r\n        'fa-lg': !letter,\r\n        [`fa-${iconName}`]: !letter,\r\n        'action-drawer__btn--with-sub-icon': !!subIconName,\r\n        'btn--disabled': isDisabled,\r\n        'action-drawer__btn--letter': !!letter,\r\n      }\r\n    );\r\n\r\n    const subIconClassName = classNames(\r\n      'fas',\r\n      'fa-xs',\r\n      `fa-${subIconName}`,\r\n      'action-drawer__btn__sub-icon',\r\n      {\r\n        'action-drawer__btn__sub-icon--rotated': shouldRotateSubIcon,\r\n        'fa-spin': shouldSpinSubIcon,\r\n      }\r\n    );\r\n\r\n    return (\r\n      <button\r\n        className={className}\r\n        onClick={this.handleClick}\r\n        style={style}\r\n        title={tooltip}\r\n        ref={onRef}\r\n      >\r\n        {!!letter && letter}\r\n        {!!subIconName && <i className={subIconClassName} />}\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment, useState, useEffect, useMemo, useRef } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { List } from 'immutable';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as captureActions from '../../../../actions/capture';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport sampleCaptureTemplates from '../../../../lib/sample_capture_templates';\r\n\r\nimport ActionButton from './components/ActionButton/';\r\n\r\nconst ActionDrawer = ({\r\n  org,\r\n  selectedHeaderId,\r\n  base,\r\n  staticFile,\r\n  captureTemplates,\r\n  path,\r\n  selectedTableCellId,\r\n  selectedListItemId,\r\n  inEditMode,\r\n  isLoading,\r\n  shouldDisableSyncButtons,\r\n}) => {\r\n  const [isDisplayingArrowButtons, setIsDisplayingArrowButtons] = useState(false);\r\n  const [isDisplayingCaptureButtons, setIsDisplayingCaptureButtons] = useState(false);\r\n\r\n  // Send a no-op action to take care of the bug where redux-undo won't allow the first\r\n  // action to be undone.\r\n  useEffect(() => {\r\n    org.noOp();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    document.querySelector('html').style.paddingBottom = '90px';\r\n\r\n    return () => (document.querySelector('html').style.paddingBottom = '0px');\r\n  });\r\n\r\n  const mainArrowButton = useRef(null);\r\n\r\n  const mainArrowButtonBoundingRect = useMemo(\r\n    () => (!!mainArrowButton.current ? mainArrowButton.current.getBoundingClientRect() : null),\r\n    [mainArrowButton.current]\r\n  );\r\n\r\n  const handleUpClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderUp(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableRowUp()\r\n      : org.moveListItemUp();\r\n\r\n  const handleDownClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderDown(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableRowDown()\r\n      : org.moveListItemDown();\r\n\r\n  const handleLeftClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderLeft(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableColumnLeft()\r\n      : org.moveListItemLeft();\r\n\r\n  const handleRightClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderRight(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableColumnRight()\r\n      : org.moveListItemRight();\r\n\r\n  const handleMoveSubtreeLeftClick = () =>\r\n    !!selectedHeaderId ? org.moveSubtreeLeft(selectedHeaderId) : org.moveListSubtreeLeft();\r\n\r\n  const handleMoveSubtreeRightClick = () =>\r\n    !!selectedHeaderId ? org.moveSubtreeRight(selectedHeaderId) : org.moveListSubtreeRight();\r\n\r\n  const handleDoneClick = () => org.exitEditMode();\r\n\r\n  const handleCaptureButtonClick = templateId => () => {\r\n    setIsDisplayingCaptureButtons(false);\r\n    base.activatePopup('capture', { templateId });\r\n  };\r\n\r\n  const getSampleCaptureTemplates = () => sampleCaptureTemplates;\r\n\r\n  const getAvailableCaptureTemplates = () =>\r\n    staticFile === 'sample'\r\n      ? getSampleCaptureTemplates()\r\n      : captureTemplates.filter(\r\n          template =>\r\n            template.get('isAvailableInAllOrgFiles') ||\r\n            template\r\n              .get('orgFilesWhereAvailable')\r\n              .map(availablePath =>\r\n                availablePath.trim().startsWith('/')\r\n                  ? availablePath.trim()\r\n                  : '/' + availablePath.trim()\r\n              )\r\n              .includes((path || '').trim())\r\n        );\r\n\r\n  const handleSync = () => org.sync();\r\n\r\n  const handleMainArrowButtonClick = () => setIsDisplayingArrowButtons(!isDisplayingArrowButtons);\r\n\r\n  const handleMainCaptureButtonClick = () => {\r\n    if (!isDisplayingCaptureButtons && getAvailableCaptureTemplates().size === 0) {\r\n      alert(\r\n        `You don't have any capture templates set up for this file! Add some in Settings > Capture Templates`\r\n      );\r\n      return;\r\n    }\r\n\r\n    setIsDisplayingCaptureButtons(!isDisplayingCaptureButtons);\r\n  };\r\n\r\n  const renderCaptureButtons = () => {\r\n    const availableCaptureTemplates = getAvailableCaptureTemplates();\r\n\r\n    const baseCaptureButtonStyle = {\r\n      position: 'absolute',\r\n      zIndex: 0,\r\n      left: 0,\r\n      opacity: isDisplayingArrowButtons ? 0 : 1,\r\n    };\r\n    if (!isDisplayingCaptureButtons) {\r\n      baseCaptureButtonStyle.boxShadow = 'none';\r\n    }\r\n\r\n    const mainButtonStyle = {\r\n      opacity: isDisplayingArrowButtons ? 0 : 1,\r\n      position: 'relative',\r\n      zIndex: 1,\r\n    };\r\n\r\n    const animatedStyle = {\r\n      bottom: spring(isDisplayingCaptureButtons ? 70 : 0, { stiffness: 300 }),\r\n    };\r\n\r\n    return (\r\n      <Motion style={animatedStyle}>\r\n        {style => (\r\n          <div className=\"action-drawer__capture-buttons-container\">\r\n            <ActionButton\r\n              iconName={isDisplayingCaptureButtons ? 'times' : 'list-ul'}\r\n              isDisabled={false}\r\n              onClick={handleMainCaptureButtonClick}\r\n              style={mainButtonStyle}\r\n              tooltip={\r\n                isDisplayingCaptureButtons ? 'Hide capture templates' : 'Show capture templates'\r\n              }\r\n            />\r\n\r\n            {availableCaptureTemplates.map((template, index) => (\r\n              <ActionButton\r\n                key={template.get('id')}\r\n                letter={template.get('letter')}\r\n                iconName={template.get('iconName')}\r\n                isDisabled={false}\r\n                onClick={handleCaptureButtonClick(template.get('id'))}\r\n                style={{ ...baseCaptureButtonStyle, bottom: style.bottom * (index + 1) }}\r\n                tooltip={`Activate \"${template.get('description')}\" capture template`}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Motion>\r\n    );\r\n  };\r\n\r\n  const renderMovementButtons = () => {\r\n    const baseArrowButtonStyle = {\r\n      opacity: isDisplayingCaptureButtons ? 0 : 1,\r\n    };\r\n    if (!isDisplayingArrowButtons) {\r\n      baseArrowButtonStyle.boxShadow = 'none';\r\n    }\r\n\r\n    let centerXOffset = 0;\r\n    if (!!mainArrowButtonBoundingRect) {\r\n      centerXOffset =\r\n        window.screen.width / 2 -\r\n        (mainArrowButtonBoundingRect.x + mainArrowButtonBoundingRect.width / 2);\r\n    }\r\n\r\n    const animatedStyles = {\r\n      centerXOffset: spring(isDisplayingArrowButtons ? centerXOffset : 0, { stiffness: 300 }),\r\n      topRowYOffset: spring(isDisplayingArrowButtons ? 150 : 0, { stiffness: 300 }),\r\n      bottomRowYOffset: spring(isDisplayingArrowButtons ? 80 : 0, { stiffness: 300 }),\r\n      firstColumnXOffset: spring(isDisplayingArrowButtons ? 70 : 0, {\r\n        stiffness: 300,\r\n      }),\r\n      secondColumnXOffset: spring(isDisplayingArrowButtons ? 140 : 0, {\r\n        stiffness: 300,\r\n      }),\r\n    };\r\n\r\n    let subIconNameStr = null;\r\n    let tooltipUpStr = 'Move header up';\r\n    let tooltipDownStr = 'Move header down';\r\n    let tooltipLeftStr = 'Move header left';\r\n    let tooltipRightStr = 'Move header right';\r\n    if (!!selectedTableCellId) {\r\n      subIconNameStr = 'table';\r\n      tooltipUpStr = 'Move row up';\r\n      tooltipDownStr = 'Move row down';\r\n      tooltipLeftStr = 'Move column left';\r\n      tooltipRightStr = 'Move column right';\r\n    } else if (!!selectedListItemId) {\r\n      subIconNameStr = 'list';\r\n      tooltipUpStr = 'Move list up';\r\n      tooltipDownStr = 'Move list down';\r\n      tooltipLeftStr = 'Move list left';\r\n      tooltipRightStr = 'Move list right';\r\n    }\r\n\r\n    return (\r\n      <Motion style={animatedStyles}>\r\n        {style => (\r\n          <div\r\n            className=\"action-drawer__arrow-buttons-container\"\r\n            style={{ left: style.centerXOffset }}\r\n          >\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-up\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleUpClick}\r\n              style={{ ...baseArrowButtonStyle, bottom: style.topRowYOffset }}\r\n              tooltip={tooltipUpStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-down\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleDownClick}\r\n              style={{ ...baseArrowButtonStyle, bottom: style.bottomRowYOffset }}\r\n              tooltip={tooltipDownStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-left\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleLeftClick}\r\n              style={{\r\n                ...baseArrowButtonStyle,\r\n                bottom: style.bottomRowYOffset,\r\n                right: style.firstColumnXOffset,\r\n              }}\r\n              tooltip={tooltipLeftStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-right\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleRightClick}\r\n              style={{\r\n                ...baseArrowButtonStyle,\r\n                bottom: style.bottomRowYOffset,\r\n                left: style.firstColumnXOffset,\r\n              }}\r\n              tooltip={tooltipRightStr}\r\n            />\r\n            {!selectedTableCellId && (\r\n              <Fragment>\r\n                <ActionButton\r\n                  additionalClassName=\"action-drawer__arrow-button\"\r\n                  iconName=\"chevron-left\"\r\n                  subIconName={subIconNameStr}\r\n                  isDisabled={false}\r\n                  onClick={handleMoveSubtreeLeftClick}\r\n                  style={{\r\n                    ...baseArrowButtonStyle,\r\n                    bottom: style.bottomRowYOffset,\r\n                    right: style.secondColumnXOffset,\r\n                  }}\r\n                  tooltip=\"Move entire subtree left\"\r\n                />\r\n                <ActionButton\r\n                  additionalClassName=\"action-drawer__arrow-button\"\r\n                  iconName=\"chevron-right\"\r\n                  subIconName={subIconNameStr}\r\n                  isDisabled={false}\r\n                  onClick={handleMoveSubtreeRightClick}\r\n                  style={{\r\n                    ...baseArrowButtonStyle,\r\n                    bottom: style.bottomRowYOffset,\r\n                    left: style.secondColumnXOffset,\r\n                  }}\r\n                  tooltip=\"Move entire subtree right\"\r\n                />\r\n              </Fragment>\r\n            )}\r\n\r\n            <ActionButton\r\n              iconName={isDisplayingArrowButtons ? 'times' : 'arrows-alt'}\r\n              subIconName={subIconNameStr}\r\n              additionalClassName=\"action-drawer__main-arrow-button\"\r\n              isDisabled={false}\r\n              onClick={handleMainArrowButtonClick}\r\n              style={{ opacity: isDisplayingCaptureButtons ? 0 : 1 }}\r\n              tooltip={isDisplayingArrowButtons ? 'Hide movement buttons' : 'Show movement buttons'}\r\n              onRef={mainArrowButton}\r\n            />\r\n          </div>\r\n        )}\r\n      </Motion>\r\n    );\r\n  };\r\n\r\n  const handleAgendaClick = () => base.activatePopup('agenda');\r\n\r\n  return (\r\n    <div className=\"action-drawer-container nice-scroll\">\r\n      {inEditMode ? (\r\n        <button className=\"btn action-drawer__done-btn\" onClick={handleDoneClick}>\r\n          Done\r\n        </button>\r\n      ) : (\r\n        <Fragment>\r\n          <ActionButton\r\n            iconName=\"cloud\"\r\n            subIconName=\"sync-alt\"\r\n            shouldSpinSubIcon={isLoading}\r\n            isDisabled={shouldDisableSyncButtons}\r\n            onClick={handleSync}\r\n            style={{ opacity: isDisplayingArrowButtons || isDisplayingCaptureButtons ? 0 : 1 }}\r\n            tooltip=\"Sync changes\"\r\n          />\r\n\r\n          {renderMovementButtons()}\r\n\r\n          <ActionButton\r\n            iconName=\"calendar-alt\"\r\n            shouldSpinSubIcon={isLoading}\r\n            isDisabled={false}\r\n            onClick={handleAgendaClick}\r\n            style={{ opacity: isDisplayingArrowButtons || isDisplayingCaptureButtons ? 0 : 1 }}\r\n            tooltip=\"Show agenda\"\r\n          />\r\n\r\n          {renderCaptureButtons()}\r\n        </Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n    selectedHeaderId: state.org.present.get('selectedHeaderId'),\r\n    isDirty: state.org.present.get('isDirty'),\r\n    isFocusedHeaderActive: !!state.org.present.get('focusedHeaderId'),\r\n    selectedTableCellId: state.org.present.get('selectedTableCellId'),\r\n    selectedListItemId: state.org.present.get('selectedListItemId'),\r\n    captureTemplates: state.capture.get('captureTemplates', new List()),\r\n    path: state.org.present.get('path'),\r\n    isLoading: state.base.get('isLoading'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(ActionDrawer);\r\n","import React from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../lib/color';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ isEnabled, onToggle }) => {\r\n  const disabledColor = rgbaObject(255, 255, 255, 1);\r\n  const enabledColor = rgbaObject(94, 52, 140, 1);\r\n\r\n  const switchStyle = {\r\n    colorFactor: spring(isEnabled ? 1 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  const grabberStyle = {\r\n    marginLeft: spring(isEnabled ? 42 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={switchStyle}>\r\n      {style => {\r\n        const backgroundColor = rgbaString(\r\n          interpolateColors(disabledColor, enabledColor, style.colorFactor)\r\n        );\r\n\r\n        return (\r\n          <div className=\"switch\" style={{ backgroundColor }} onClick={onToggle}>\r\n            <Motion style={grabberStyle}>\r\n              {style => <div className=\"switch__grabber\" style={style} />}\r\n            </Motion>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ children, shouldIncludeCloseButton, onClose }) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [dragOffsetY, setDragOffsetY] = useState(null);\r\n\r\n  useLayoutEffect(() => {\r\n    setIsVisible(true);\r\n  }, []);\r\n\r\n  const initialClientY = useRef();\r\n  const innerContainer = useRef();\r\n\r\n  const innerContainerHeight = useRef();\r\n  useLayoutEffect(() => {\r\n    innerContainerHeight.current = innerContainer.current.offsetHeight;\r\n  });\r\n  const endInnerContainerDrag = () => {\r\n    setIsVisible(dragOffsetY <= innerContainerHeight.current * 0.3);\r\n    setDragOffsetY(null);\r\n  };\r\n\r\n  const handleInnerContainerClick = event => event.stopPropagation();\r\n\r\n  const handleClose = () => setIsVisible(false);\r\n\r\n  const handleAnimationRest = () => (!isVisible && !!onClose ? onClose() : void 0);\r\n\r\n  const handleTouchStart = event => (initialClientY.current = event.targetTouches[0].clientY);\r\n\r\n  const handleTouchMove = event => {\r\n    if (event.target.classList.contains('drag-handle')) {\r\n      return;\r\n    }\r\n\r\n    const isScrollingDown = initialClientY.current > event.targetTouches[0].clientY;\r\n\r\n    if (\r\n      isScrollingDown &&\r\n      innerContainer.current.scrollHeight - innerContainer.current.scrollTop <=\r\n        innerContainer.current.clientHeight\r\n    ) {\r\n      event.preventDefault();\r\n    } else if (!isScrollingDown && innerContainer.current.scrollTop === 0) {\r\n      event.preventDefault();\r\n\r\n      setDragOffsetY(event.targetTouches[0].clientY - initialClientY.current);\r\n    }\r\n  };\r\n\r\n  const handleTouchEndOrCancel = event => endInnerContainerDrag();\r\n\r\n  useEffect(\r\n    () => {\r\n      if (!!innerContainer.current) {\r\n        // Super annoying logic for disabling scrolling of the body when a slide up is active.\r\n        // Briefly: if we're already at the top of our Drawer and trying to scroll up, disable\r\n        // scrolling. Likewise, if we're already at the bottom of our Drawer and trying to scroll\r\n        // down, disable scrolling.\r\n        innerContainer.current.addEventListener('touchstart', handleTouchStart);\r\n        innerContainer.current.addEventListener('touchmove', handleTouchMove);\r\n        innerContainer.current.addEventListener('touchend', handleTouchEndOrCancel);\r\n        innerContainer.current.addEventListener('touchcancel', handleTouchEndOrCancel);\r\n\r\n        return () => {\r\n          innerContainer.current.removeEventListener('touchstart', handleTouchStart);\r\n          innerContainer.current.removeEventListener('touchmove', handleTouchMove);\r\n          innerContainer.current.removeEventListener('touchend', handleTouchEndOrCancel);\r\n          innerContainer.current.removeEventListener('touchcancel', handleTouchEndOrCancel);\r\n        };\r\n      } else {\r\n        return null;\r\n      }\r\n    },\r\n    [innerContainer.current, dragOffsetY]\r\n  );\r\n\r\n  useEffect(\r\n    () => {\r\n      // A ridiculous hack to get around what is presumably a Mobile Safari bug in iOS 12.\r\n      // Without this, I can't scroll the inner container in the agenda view.\r\n      setTimeout(() => {\r\n        innerContainer.current.style.left = '0';\r\n        setTimeout(() => {\r\n          innerContainer.current.style.left = '-1px';\r\n        }, 0);\r\n      }, 0);\r\n    },\r\n    [children]\r\n  );\r\n\r\n  const outerClassName = classNames('drawer-outer-container', {\r\n    'drawer-outer-container--visible': isVisible,\r\n  });\r\n\r\n  const innerStyle = {\r\n    offsetY:\r\n      dragOffsetY ||\r\n      spring(isVisible ? 0 : innerContainerHeight.current || window.innerHeight, {\r\n        stiffness: 300,\r\n      }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={innerStyle} onRest={handleAnimationRest}>\r\n      {style => {\r\n        const interpolatedStyle = {\r\n          transform: `translateY(${style.offsetY}px)`,\r\n        };\r\n\r\n        return (\r\n          <div className={outerClassName} onClick={!!onClose ? handleClose : null}>\r\n            <div\r\n              onClick={handleInnerContainerClick}\r\n              className=\"drawer-inner-container nice-scroll\"\r\n              ref={innerContainer}\r\n              style={interpolatedStyle}\r\n            >\r\n              <div className=\"drawer__grabber\" />\r\n\r\n              {shouldIncludeCloseButton && (\r\n                <button className=\"fas fa-times fa-lg drawer__close-button\" onClick={handleClose} />\r\n              )}\r\n\r\n              {children}\r\n            </div>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React, { Fragment, useState, useEffect, useRef, useMemo } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport ActionButton from '../ActionDrawer/components/ActionButton/';\r\nimport Switch from '../../../UI/Switch/';\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport { headerWithPath } from '../../../../lib/org_utils';\r\nimport substituteTemplateVariables from '../../../../lib/capture_template_substitution';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ template, onCapture, headers, onClose }) => {\r\n  const [substitutedTemplate, initialCursorIndex] = useMemo(\r\n    () => substituteTemplateVariables(template.get('template')),\r\n    [template.get('template')]\r\n  );\r\n\r\n  const isTopLevelTarget = template.get('headerPaths').filter(path => path.length !== 0).size === 0;\r\n  const targetHeader = useMemo(() => headerWithPath(headers, template.get('headerPaths')), [\r\n    headers,\r\n    template.get('headerPaths'),\r\n  ]);\r\n\r\n  const [textareaValue, setTextareaValue] = useState(substitutedTemplate);\r\n  const [shouldPrepend, setShouldPrepend] = useState(template.get('shouldPrepend'));\r\n\r\n  const textarea = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (textarea.current) {\r\n      textarea.current.focus();\r\n      if (initialCursorIndex !== null) {\r\n        textarea.current.selectionStart = initialCursorIndex;\r\n        textarea.current.selectionEnd = initialCursorIndex;\r\n      }\r\n    }\r\n  }, [textarea]);\r\n\r\n  const handleCaptureClick = () => onCapture(template.get('id'), textareaValue, shouldPrepend);\r\n\r\n  const handleTextareaChange = event => setTextareaValue(event.target.value);\r\n\r\n  const handlePrependSwitchToggle = () => setShouldPrepend(!shouldPrepend);\r\n\r\n  return (\r\n    <Drawer onClose={onClose}>\r\n      <div className=\"capture-modal-header\">\r\n        <ActionButton\r\n          letter={template.get('letter')}\r\n          iconName={template.get('iconName')}\r\n          isDisabled={false}\r\n          onClick={() => {}}\r\n          style={{ marginRight: 20 }}\r\n        />\r\n\r\n        <span>{template.get('description')}</span>\r\n      </div>\r\n\r\n      <div\r\n        className={classNames('capture-modal-header-path', {\r\n          'capture-modal-header-path--top-level': isTopLevelTarget,\r\n        })}\r\n      >\r\n        {isTopLevelTarget ? 'Top level header' : template.get('headerPaths').join(' > ')}\r\n      </div>\r\n\r\n      {!!targetHeader || isTopLevelTarget ? (\r\n        <Fragment>\r\n          <textarea\r\n            className=\"textarea capture-modal-textarea\"\r\n            rows=\"4\"\r\n            value={textareaValue}\r\n            onChange={handleTextareaChange}\r\n            ref={textarea}\r\n          />\r\n\r\n          <div className=\"capture-modal-button-container\">\r\n            <div className=\"capture-modal-prepend-container\">\r\n              <span className=\"capture-modal-prepend-label\">Prepend:</span>\r\n              <Switch isEnabled={shouldPrepend} onToggle={handlePrependSwitchToggle} />\r\n            </div>\r\n\r\n            <button className=\"btn capture-modal-button\" onClick={handleCaptureClick}>\r\n              Capture\r\n            </button>\r\n          </div>\r\n        </Fragment>\r\n      ) : (\r\n        <div className=\"capture-modal-error-message\">\r\n          The specified header path doesn't exist in this org file!\r\n        </div>\r\n      )}\r\n\r\n      <br />\r\n    </Drawer>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport formatDate from 'date-fns/format';\r\nimport { distanceInWordsToNow } from 'date-fns';\r\n\r\nexport default ({ lastServerModifiedAt, onPull, onPush, onCancel }) => {\r\n  return (\r\n    <Drawer>\r\n      <h2 className=\"sync-confirmation-modal__header\">Sync conflict</h2>\r\n      Since you last pulled, a newer version of the file has been pushed to the server. The newer\r\n      version is from:\r\n      <br />\r\n      <br />\r\n      <div className=\"sync-confirmation-modal__last-sync-time\">\r\n        {formatDate(lastServerModifiedAt, 'MMMM Do, YYYY [at] h:mm:ss a')}\r\n        <br />({distanceInWordsToNow(lastServerModifiedAt)} ago)\r\n      </div>\r\n      <div className=\"sync-confirmation-modal__buttons-container\">\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onPull}>\r\n          Pull latest version from server\r\n        </button>\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onPush}>\r\n          Overwrite server version\r\n        </button>\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onCancel}>\r\n          Cancel sync\r\n        </button>\r\n      </div>\r\n      <br />\r\n    </Drawer>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nexport default class TagsEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleRemoveTag', 'handleAddNewTag', 'handleTagChange']);\r\n\r\n    this.state = {\r\n      allTags: props.allTags,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const prevTags = prevProps.header.getIn(['titleLine', 'tags']);\r\n    const currentTags = this.props.header.getIn(['titleLine', 'tags']);\r\n    if (prevTags.size === currentTags.size - 1 && currentTags.last() === '') {\r\n      if (this.lastTextfield) {\r\n        this.lastTextfield.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  handleTagChange(tagIndex) {\r\n    return event => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      this.props.onChange(tags.set(tagIndex, event.target.value.replace(/(\\s+|:)/g, '')));\r\n    };\r\n  }\r\n\r\n  handleRemoveTag(tagIndex) {\r\n    return () => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      this.props.onChange(tags.delete(tagIndex));\r\n    };\r\n  }\r\n\r\n  handleAddNewTag() {\r\n    const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n    this.props.onChange(tags.push(''));\r\n  }\r\n\r\n  handleExistingTagClick(newTag) {\r\n    return () => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      if (tags.includes(newTag)) {\r\n        this.props.onChange(tags.filter(tag => tag !== newTag));\r\n      } else {\r\n        this.props.onChange(tags.push(newTag));\r\n      }\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const { header, onClose } = this.props;\r\n    const { allTags } = this.state;\r\n\r\n    const headerTags = header.getIn(['titleLine', 'tags']);\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"drawer-modal__title\">Edit tags</h2>\r\n\r\n        {headerTags.size === 0 ? (\r\n          <div className=\"no-tags-message\">\r\n            This header doesn't have any tags.\r\n            <br />\r\n            <br />\r\n            Click the <i className=\"fas fa-plus\" /> button to add a new one, or choose from the list\r\n            of all of your tags below.\r\n          </div>\r\n        ) : (\r\n          <Droppable droppableId=\"tags-editor-droppable\" type=\"TAG\">\r\n            {(provided, snapshot) => (\r\n              <div className=\"tags-container\" ref={provided.innerRef} {...provided.droppableProps}>\r\n                <Fragment>\r\n                  {headerTags.map((tag, index) => (\r\n                    <Draggable draggableId={`tag--${index}`} index={index} key={index}>\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          className={classNames('tag-container', {\r\n                            'tag-container--dragging': snapshot.isDragging,\r\n                          })}\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                        >\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"textfield tag-container__textfield\"\r\n                            value={tag}\r\n                            onChange={this.handleTagChange(index)}\r\n                            ref={textfield => (this.lastTextfield = textfield)}\r\n                          />\r\n                          <div className=\"tag-container__actions-container\">\r\n                            <i\r\n                              className=\"fas fa-times fa-lg\"\r\n                              onClick={this.handleRemoveTag(index)}\r\n                            />\r\n                            <i\r\n                              className=\"fas fa-bars fa-lg tag-container__drag-handle drag-handle\"\r\n                              {...provided.dragHandleProps}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  ))}\r\n\r\n                  {provided.placeholder}\r\n                </Fragment>\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        )}\r\n\r\n        <div className=\"tags-editor__add-new-container\">\r\n          <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={this.handleAddNewTag} />\r\n        </div>\r\n\r\n        <hr className=\"tags-editor__separator\" />\r\n\r\n        <h2 className=\"tags-editor__title\">All tags</h2>\r\n\r\n        <div className=\"all-tags-container\">\r\n          {allTags.filter(tag => !!tag).map(tag => {\r\n            const className = classNames('all-tags__tag', {\r\n              'all-tags__tag--in-use': headerTags.includes(tag),\r\n            });\r\n\r\n            return (\r\n              <div className={className} key={tag} onClick={this.handleExistingTagClick(tag)}>\r\n                {tag}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ buttons, selectedButton, useEqualWidthTabs, onSelect }) => {\r\n  const handleButtonClick = buttonName => () => onSelect(buttonName);\r\n\r\n  const containerClassName = classNames('tab-buttons', {\r\n    'tab-buttons--equal-width-tabs': useEqualWidthTabs,\r\n  });\r\n\r\n  const style = {\r\n    gridTemplateColumns: useEqualWidthTabs ? `repeat(${buttons.length}, 1fr)` : null,\r\n  };\r\n\r\n  return (\r\n    <div className={containerClassName} style={style}>\r\n      {buttons.map(buttonName => {\r\n        const className = classNames('tab-buttons__btn', {\r\n          'tab-buttons__btn--selected': buttonName === selectedButton,\r\n        });\r\n\r\n        return (\r\n          <div key={buttonName} className={className} onClick={handleButtonClick(buttonName)}>\r\n            {buttonName}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Switch from '../../../../../UI/Switch/';\r\nimport TabButtons from '../../../../../UI/TabButtons/';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport parseDate from 'date-fns/parse';\r\nimport formatDate from 'date-fns/format';\r\n\r\nexport default class TimestampEditor extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleActiveToggle',\r\n      'handleDateChange',\r\n      'handleAddRepeater',\r\n      'handleRemoveRepeater',\r\n      'handleRepeaterTypeChange',\r\n      'handleRepeaterValueChange',\r\n      'handleRepeaterUnitChange',\r\n      'handleAddDelay',\r\n      'handleRemoveDelay',\r\n      'handleDelayTypeChange',\r\n      'handleDelayValueChange',\r\n      'handleDelayUnitChange',\r\n    ]);\r\n  }\r\n\r\n  handleActiveToggle() {\r\n    this.props.onChange(this.props.timestamp.update('isActive', isActive => !isActive));\r\n  }\r\n\r\n  handleDateChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n\r\n    const [newYear, newMonth, newDay, newDayName] = formatDate(\r\n      parseDate(event.target.value),\r\n      'YYYY MM DD ddd'\r\n    ).split(' ');\r\n    onChange(\r\n      timestamp\r\n        .set('year', newYear)\r\n        .set('month', newMonth)\r\n        .set('day', newDay)\r\n        .set('dayName', newDayName)\r\n    );\r\n  }\r\n\r\n  handleAddTime(startOrEnd) {\r\n    return () => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      const [hour, minute] = formatDate(new Date(), 'HH:mm').split(':');\r\n      onChange(timestamp.set(hourKey, hour).set(minuteKey, minute));\r\n    };\r\n  }\r\n\r\n  handleRemoveTime(startOrEnd) {\r\n    return () => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      onChange(timestamp.set(hourKey, null).set(minuteKey, null));\r\n    };\r\n  }\r\n\r\n  handleTimeChange(startOrEnd) {\r\n    return event => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      let [hour, minute] = event.target.value.split(':');\r\n      hour = hour.startsWith('0') ? hour.substring(1) : hour;\r\n      onChange(timestamp.set(hourKey, hour).set(minuteKey, minute));\r\n    };\r\n  }\r\n\r\n  handleAddRepeater() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('repeaterType', '+')\r\n        .set('repeaterValue', 1)\r\n        .set('repeaterUnit', 'h')\r\n    );\r\n  }\r\n\r\n  handleRemoveRepeater() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('repeaterType', null)\r\n        .set('repeaterValue', null)\r\n        .set('repeaterUnit', null)\r\n    );\r\n  }\r\n\r\n  handleRepeaterTypeChange(newRepeaterType) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterType', newRepeaterType));\r\n  }\r\n\r\n  handleRepeaterValueChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterValue', event.target.value));\r\n  }\r\n\r\n  handleRepeaterUnitChange(newRepeaterUnit) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterUnit', newRepeaterUnit));\r\n  }\r\n\r\n  handleAddDelay() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('delayType', '-')\r\n        .set('delayValue', 1)\r\n        .set('delayUnit', 'h')\r\n    );\r\n  }\r\n\r\n  handleRemoveDelay() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('delayType', null)\r\n        .set('delayValue', null)\r\n        .set('delayUnit', null)\r\n    );\r\n  }\r\n\r\n  handleDelayTypeChange(newDelayType) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayType', newDelayType));\r\n  }\r\n\r\n  handleDelayValueChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayValue', event.target.value));\r\n  }\r\n\r\n  handleDelayUnitChange(newDelayUnit) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayUnit', newDelayUnit));\r\n  }\r\n\r\n  renderTimeField(label, timeKey, hour, minute, showRemoveButton = true) {\r\n    return (\r\n      <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n        <div className=\"timestamp-editor__field-title\">{label}</div>\r\n        <div className=\"timestamp-editor__field\">\r\n          {!!hour ? (\r\n            <Fragment>\r\n              <input\r\n                type=\"time\"\r\n                className=\"timestamp-editor__time-input\"\r\n                value={`${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`}\r\n                onChange={this.handleTimeChange(timeKey)}\r\n              />\r\n              {showRemoveButton && (\r\n                <i\r\n                  className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                  onClick={this.handleRemoveTime(timeKey)}\r\n                />\r\n              )}\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddTime(timeKey)}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderRepeater() {\r\n    const { repeaterType, repeaterValue, repeaterUnit } = this.props.timestamp.toJS();\r\n\r\n    return (\r\n      <div className=\"timestamp-editor__field-container\">\r\n        <div className=\"timestamp-editor__field-title\">Repeater</div>\r\n        <div className=\"timestamp-editor__field timestamp-editor__field--delay-repeater\">\r\n          {!!repeaterType ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__delay-repeater-type\">\r\n                <TabButtons\r\n                  buttons={['+', '++', '.+']}\r\n                  selectedButton={repeaterType || '+'}\r\n                  onSelect={this.handleRepeaterTypeChange}\r\n                />\r\n              </div>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                className=\"textfield delay-repeater-value-input\"\r\n                value={repeaterValue || 1}\r\n                onChange={this.handleRepeaterValueChange}\r\n              />\r\n              <div>\r\n                <TabButtons\r\n                  buttons={'hdwmy'.split('')}\r\n                  selectedButton={repeaterUnit || 'h'}\r\n                  onSelect={this.handleRepeaterUnitChange}\r\n                />\r\n              </div>\r\n              <i\r\n                className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                onClick={this.handleRemoveRepeater}\r\n              />\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddRepeater}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderDelay() {\r\n    const { delayType, delayValue, delayUnit } = this.props.timestamp.toJS();\r\n\r\n    return (\r\n      <div className=\"timestamp-editor__field-container\">\r\n        <div className=\"timestamp-editor__field-title\">Delay</div>\r\n        <div className=\"timestamp-editor__field\">\r\n          {!!delayType ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__delay-repeater-type\">\r\n                <TabButtons\r\n                  buttons={['-', '--']}\r\n                  selectedButton={delayType || '-'}\r\n                  onSelect={this.handleDelayTypeChange}\r\n                />\r\n              </div>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                className=\"textfield delay-repeater-value-input\"\r\n                value={delayValue || 1}\r\n                onChange={this.handleDelayValueChange}\r\n              />\r\n              <div>\r\n                <TabButtons\r\n                  buttons={'hdwmy'.split('')}\r\n                  selectedButton={delayUnit || 'h'}\r\n                  onSelect={this.handleDelayUnitChange}\r\n                />\r\n              </div>\r\n              <i\r\n                className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                onClick={this.handleRemoveDelay}\r\n              />\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddDelay}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { timestamp } = this.props;\r\n    const {\r\n      isActive,\r\n      year,\r\n      month,\r\n      day,\r\n      startHour,\r\n      startMinute,\r\n      endHour,\r\n      endMinute,\r\n    } = timestamp.toJS();\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"timestamp-editor__render\">{renderAsText(timestamp)}</div>\r\n\r\n        <div className=\"timestamp-editor__date-time-fields-container\">\r\n          <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n            <div className=\"timestamp-editor__field-title\">Active</div>\r\n            <div className=\"timestamp-editor__field\">\r\n              <Switch isEnabled={isActive} onToggle={this.handleActiveToggle} />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n            <div className=\"timestamp-editor__field-title\">Date</div>\r\n            <div className=\"timestamp-editor__field\">\r\n              <input\r\n                type=\"date\"\r\n                className=\"timestamp-editor__date-input\"\r\n                onChange={this.handleDateChange}\r\n                value={`${year}-${month}-${day}`}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {this.renderTimeField('Start time', 'start', startHour, startMinute, !endHour)}\r\n          {!!startHour && this.renderTimeField('End time', 'end', endHour, endMinute)}\r\n        </div>\r\n\r\n        {this.renderRepeater()}\r\n        {this.renderDelay()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TimestampEditor from './components/TimestampEditor';\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport _ from 'lodash';\r\nimport formatDate from 'date-fns/format';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class TimestampEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleAddEndTimestamp', 'handleRemoveEndTimestamp']);\r\n  }\r\n\r\n  handleChange(key) {\r\n    return newTimestamp => this.props.onChange(this.props.timestamp.set(key, newTimestamp));\r\n  }\r\n\r\n  handleAddEndTimestamp() {\r\n    const { timestamp } = this.props;\r\n    const [year, month, day, dayName] = formatDate(new Date(), 'YYYY MM DD ddd').split(' ');\r\n    this.props.onChange(\r\n      timestamp.set(\r\n        'secondTimestamp',\r\n        Map({\r\n          year,\r\n          month,\r\n          day,\r\n          dayName,\r\n          isActive: timestamp.getIn(['firstTimestamp', 'isActive']),\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  handleRemoveEndTimestamp() {\r\n    this.props.onChange(this.props.timestamp.set('secondTimestamp', null));\r\n  }\r\n\r\n  render() {\r\n    const { timestamp, onClose, singleTimestampOnly } = this.props;\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"timestamp-editor__title\">Edit timestamp</h2>\r\n\r\n        <TimestampEditor\r\n          timestamp={timestamp.get('firstTimestamp')}\r\n          onChange={this.handleChange('firstTimestamp')}\r\n        />\r\n\r\n        {!singleTimestampOnly &&\r\n          (!!timestamp.get('secondTimestamp') ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__separator\">\r\n                <div className=\"timestamp-editor__separator__margin-line\" />\r\n                to\r\n                <div className=\"timestamp-editor__separator__margin-line\" />\r\n              </div>\r\n\r\n              <TimestampEditor\r\n                timestamp={timestamp.get('secondTimestamp')}\r\n                onChange={this.handleChange('secondTimestamp')}\r\n              />\r\n\r\n              <div className=\"timestamp-editor__button-container\">\r\n                <button\r\n                  className=\"btn timestamp-editor__add-new-button\"\r\n                  onClick={this.handleRemoveEndTimestamp}\r\n                >\r\n                  Remove end timestamp\r\n                </button>\r\n              </div>\r\n            </Fragment>\r\n          ) : (\r\n            <div className=\"timestamp-editor__button-container\">\r\n              <button\r\n                className=\"btn timestamp-editor__add-new-button\"\r\n                onClick={this.handleAddEndTimestamp}\r\n              >\r\n                Add end timestamp\r\n              </button>\r\n            </div>\r\n          ))}\r\n\r\n        <br />\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer';\r\n\r\nimport { attributedStringToRawText } from '../../../../lib/export_org';\r\nimport generateId from '../../../../lib/id_generator';\r\nimport { parseMarkupAndCookies } from '../../../../lib/parse_org';\r\n\r\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\r\nimport classNames from 'classnames';\r\nimport { fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nexport default class PropertyListEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleAddNewItem']);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const prevItems = prevProps.propertyListItems;\r\n    const currentItems = this.props.propertyListItems;\r\n    if (prevItems.size === currentItems.size - 1 && currentItems.last().get('property') === '') {\r\n      if (this.lastTextfield) {\r\n        this.lastTextfield.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  handlePropertyChange(propertyListItemId) {\r\n    return event => {\r\n      const propertyListItemIndex = this.props.propertyListItems.findIndex(\r\n        propertyListItem => propertyListItem.get('id') === propertyListItemId\r\n      );\r\n      this.props.onChange(\r\n        this.props.propertyListItems.setIn([propertyListItemIndex, 'property'], event.target.value)\r\n      );\r\n    };\r\n  }\r\n\r\n  handleValueChange(propertyListItemId) {\r\n    return event => {\r\n      const { propertyListItems, onChange } = this.props;\r\n\r\n      const propertyListItemIndex = propertyListItems.findIndex(\r\n        propertyListItem => propertyListItem.get('id') === propertyListItemId\r\n      );\r\n      onChange(\r\n        propertyListItems.setIn(\r\n          [propertyListItemIndex, 'value'],\r\n          fromJS(parseMarkupAndCookies(event.target.value))\r\n        )\r\n      );\r\n    };\r\n  }\r\n\r\n  handleRemoveItem(propertyListItemId) {\r\n    return () =>\r\n      this.props.onChange(\r\n        this.props.propertyListItems.filter(\r\n          propertyListItem => propertyListItem.get('id') !== propertyListItemId\r\n        )\r\n      );\r\n  }\r\n\r\n  handleAddNewItem() {\r\n    this.props.onChange(\r\n      this.props.propertyListItems.push(\r\n        fromJS({\r\n          property: '',\r\n          value: '',\r\n          id: generateId(),\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { onClose, propertyListItems } = this.props;\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"drawer-modal__title\">Edit property list</h2>\r\n\r\n        {propertyListItems.size === 0 ? (\r\n          <div className=\"no-items-message\">\r\n            There are no items in this property list.\r\n            <br />\r\n            <br />\r\n            Click the <i className=\"fas fa-plus\" /> button to add a new one.\r\n          </div>\r\n        ) : (\r\n          <Droppable droppableId=\"property-list-editor-droppable\" type=\"PROPERTY-LIST\">\r\n            {(provided, snapshot) => (\r\n              <div\r\n                className=\"property-list-editor__items-container\"\r\n                ref={provided.innerRef}\r\n                {...provided.droppableProps}\r\n              >\r\n                <Fragment>\r\n                  {propertyListItems.map((propertyListItem, index) => (\r\n                    <Draggable\r\n                      draggableId={`property-list-item--${index}`}\r\n                      index={index}\r\n                      key={propertyListItem.get('id')}\r\n                    >\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          className={classNames('property-list-editor__item-container', {\r\n                            'property-list-editor__item-container--dragging': snapshot.isDragging,\r\n                          })}\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                        >\r\n                          <div className=\"item__textfields-container\">\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"textfield item-container__textfield\"\r\n                              value={propertyListItem.get('property')}\r\n                              onChange={this.handlePropertyChange(propertyListItem.get('id'))}\r\n                              ref={textfield => (this.lastTextfield = textfield)}\r\n                            />\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"textfield item-container__textfield\"\r\n                              value={attributedStringToRawText(propertyListItem.get('value'))}\r\n                              onChange={this.handleValueChange(propertyListItem.get('id'))}\r\n                            />\r\n                          </div>\r\n                          <div className=\"item-container__actions-container\">\r\n                            <i\r\n                              className=\"fas fa-times fa-lg\"\r\n                              onClick={this.handleRemoveItem(propertyListItem.get('id'))}\r\n                            />\r\n                            <i\r\n                              className=\"fas fa-bars fa-lg item-container__drag-handle drag-handle\"\r\n                              {...provided.dragHandleProps}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  ))}\r\n\r\n                  {provided.placeholder}\r\n                </Fragment>\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        )}\r\n\r\n        <div className=\"property-list-editor__add-new-container\">\r\n          <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={this.handleAddNewItem} />\r\n        </div>\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TitleLine from '../../../TitleLine';\r\n\r\nimport { isTodoKeywordCompleted } from '../../../../../../lib/org_utils';\r\nimport {\r\n  dateForTimestamp,\r\n  subtractTimestampUnitFromDate,\r\n  addTimestampUnitToDate,\r\n} from '../../../../../../lib/timestamps';\r\n\r\nimport {\r\n  isToday,\r\n  startOfDay,\r\n  endOfDay,\r\n  isBefore,\r\n  isAfter,\r\n  isEqual,\r\n  isWithinRange,\r\n  isPast,\r\n  distanceInWordsToNow,\r\n} from 'date-fns';\r\nimport formatDate from 'date-fns/format';\r\nimport classNames from 'classnames';\r\n\r\nexport default class AgendaDay extends PureComponent {\r\n  handleHeaderClick(headerId) {\r\n    return () => this.props.onHeaderClick(headerId);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      date,\r\n      headers,\r\n      todoKeywordSets,\r\n      dateDisplayType,\r\n      onToggleDateDisplayType,\r\n      agendaDefaultDeadlineDelayValue,\r\n      agendaDefaultDeadlineDelayUnit,\r\n    } = this.props;\r\n\r\n    const dateStart = startOfDay(date);\r\n    const dateEnd = endOfDay(date);\r\n\r\n    const planningItemsAndHeaders = headers\r\n      .flatMap(header => {\r\n        const planningItemsforDate = header.get('planningItems').filter(planningItem => {\r\n          const timestamp = planningItem.get('timestamp');\r\n          if (!timestamp.get('isActive')) {\r\n            return false;\r\n          }\r\n\r\n          const planningItemDate = dateForTimestamp(timestamp);\r\n          const isCompletedTodo =\r\n            !!header.getIn(['titleLine', 'todoKeyword']) &&\r\n            isTodoKeywordCompleted(todoKeywordSets, header.getIn(['titleLine', 'todoKeyword']));\r\n          if (isCompletedTodo) {\r\n            return false;\r\n          }\r\n\r\n          if (planningItem.get('type') === 'DEADLINE') {\r\n            if (isToday(date)) {\r\n              if (isBefore(planningItemDate, new Date())) {\r\n                return true;\r\n              }\r\n\r\n              const [delayValue, delayUnit] = !!timestamp.get('delayType')\r\n                ? [timestamp.get('delayValue'), timestamp.get('delayUnit')]\r\n                : [agendaDefaultDeadlineDelayValue, agendaDefaultDeadlineDelayUnit];\r\n\r\n              const appearDate = subtractTimestampUnitFromDate(\r\n                planningItemDate,\r\n                delayValue,\r\n                delayUnit\r\n              );\r\n              return isAfter(date, appearDate) || isEqual(date, appearDate);\r\n            } else {\r\n              return isWithinRange(planningItemDate, dateStart, dateEnd);\r\n            }\r\n          } else if (planningItem.get('type') === 'SCHEDULED') {\r\n            let appearDate = planningItemDate;\r\n            if (!!timestamp.get('delayType')) {\r\n              const hasBeenRepeated = header\r\n                .get('propertyListItems')\r\n                .some(propertyListItem => propertyListItem.get('property') === 'LAST_REPEAT');\r\n              if (timestamp.get('delayType') === '--' && !hasBeenRepeated) {\r\n                appearDate = addTimestampUnitToDate(\r\n                  planningItemDate,\r\n                  timestamp.get('delayValue'),\r\n                  timestamp.get('delayUnit')\r\n                );\r\n              }\r\n            }\r\n\r\n            if (isToday(date) && isAfter(date, appearDate)) {\r\n              return true;\r\n            }\r\n\r\n            return isWithinRange(appearDate, dateStart, dateEnd);\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n\r\n        return planningItemsforDate.map(planningItem => [planningItem, header]);\r\n      })\r\n      .sortBy(([planningItem, header]) => {\r\n        const { startHour, startMinute, endHour, endMinute, month, day } = planningItem\r\n          .get('timestamp')\r\n          .toJS();\r\n\r\n        return [!!startHour ? 0 : 1, startHour, startMinute, endHour, endMinute, month, day];\r\n      });\r\n\r\n    return (\r\n      <div className=\"agenda-day__container\">\r\n        <div className=\"agenda-day__title\">\r\n          {isToday(date) && <div className=\"agenda-day__today-indicator\" />}\r\n          <div className=\"agenda-day__title__day-name\">{formatDate(date, 'dddd')}</div>\r\n          <div className=\"agenda-day__title__date\">{formatDate(date, 'MMMM Do, YYYY')}</div>\r\n        </div>\r\n\r\n        <div className=\"agenda-day__headers-container\">\r\n          {planningItemsAndHeaders.map(([planningItem, header]) => {\r\n            const planningItemDate = dateForTimestamp(planningItem.get('timestamp'));\r\n            const hasTodoKeyword = !!header.getIn(['titleLine', 'todoKeyword']);\r\n\r\n            const dateClassName = classNames('agenda-day__header-planning-date', {\r\n              'agenda-day__header-planning-date--overdue':\r\n                hasTodoKeyword && isPast(planningItemDate),\r\n            });\r\n\r\n            return (\r\n              <div key={planningItem.get('id')} className=\"agenda-day__header-container\">\r\n                <div className=\"agenda-day__header__planning-item-container\">\r\n                  <div className=\"agenda-day__header-planning-type\">{planningItem.get('type')}</div>\r\n                  <div className={dateClassName} onClick={onToggleDateDisplayType}>\r\n                    {dateDisplayType === 'absolute'\r\n                      ? formatDate(planningItemDate, 'MM/DD')\r\n                      : `${distanceInWordsToNow(planningItemDate)} ago`}\r\n\r\n                    {!!planningItem.getIn(['timestamp', 'startHour']) && (\r\n                      <Fragment>\r\n                        <br />\r\n                        {formatDate(planningItemDate, 'h:mma')}\r\n                      </Fragment>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"agenda-day__header__header-container\">\r\n                  <TitleLine\r\n                    header={header}\r\n                    color=\"black\"\r\n                    hasContent={false}\r\n                    isSelected={false}\r\n                    shouldDisableActions\r\n                    shouldDisableExplicitWidth\r\n                    onClick={this.handleHeaderClick(header.get('id'))}\r\n                  />\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AgendaDay from './components/AgendaDay';\r\nimport Drawer from '../../../UI/Drawer';\r\nimport TabButtons from '../../../UI/TabButtons';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\n\r\nimport _ from 'lodash';\r\nimport {\r\n  addDays,\r\n  addWeeks,\r\n  addMonths,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  startOfWeek,\r\n  startOfMonth,\r\n  getDaysInMonth,\r\n} from 'date-fns';\r\nimport formatDate from 'date-fns/format';\r\n\r\nclass AgendaModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleTimeframeTypeChange',\r\n      'handleNextDateClick',\r\n      'handlePreviousDateClick',\r\n      'handleHeaderClick',\r\n      'handleToggleDateDisplayType',\r\n    ]);\r\n\r\n    this.state = {\r\n      selectedDate: new Date(),\r\n      timeframeType: 'Week',\r\n      dateDisplayType: 'absolute',\r\n    };\r\n  }\r\n\r\n  handleTimeframeTypeChange(timeframeType) {\r\n    this.setState({ timeframeType });\r\n  }\r\n\r\n  handleNextDateClick() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        this.setState({ selectedDate: addDays(selectedDate, 1) });\r\n        break;\r\n      case 'Week':\r\n        this.setState({ selectedDate: addWeeks(selectedDate, 1) });\r\n        break;\r\n      case 'Month':\r\n        this.setState({ selectedDate: addMonths(selectedDate, 1) });\r\n        break;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  handleHeaderClick(headerId) {\r\n    this.props.onClose();\r\n    this.props.org.selectHeaderAndOpenParents(headerId);\r\n  }\r\n\r\n  handlePreviousDateClick() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        this.setState({ selectedDate: subDays(selectedDate, 1) });\r\n        break;\r\n      case 'Week':\r\n        this.setState({ selectedDate: subWeeks(selectedDate, 1) });\r\n        break;\r\n      case 'Month':\r\n        this.setState({ selectedDate: subMonths(selectedDate, 1) });\r\n        break;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  handleToggleDateDisplayType() {\r\n    const { dateDisplayType } = this.state;\r\n\r\n    this.setState({\r\n      dateDisplayType: dateDisplayType === 'absolute' ? 'relative' : 'absolute',\r\n    });\r\n  }\r\n\r\n  calculateTimeframeHeader() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        return formatDate(selectedDate, 'MMMM Do');\r\n      case 'Week':\r\n        const weekStart = startOfWeek(selectedDate);\r\n        const weekEnd = addWeeks(weekStart, 1);\r\n        return `${formatDate(weekStart, 'MMM Do')} - ${formatDate(\r\n          weekEnd,\r\n          'MMM Do'\r\n        )} (W${formatDate(weekStart, 'W')})`;\r\n      case 'Month':\r\n        return formatDate(selectedDate, 'MMMM');\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      onClose,\r\n      headers,\r\n      todoKeywordSets,\r\n      agendaDefaultDeadlineDelayValue,\r\n      agendaDefaultDeadlineDelayUnit,\r\n    } = this.props;\r\n    const { timeframeType, selectedDate, dateDisplayType } = this.state;\r\n\r\n    let dates = [];\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        dates = [selectedDate];\r\n        break;\r\n      case 'Week':\r\n        const weekStart = startOfWeek(selectedDate);\r\n        dates = _.range(7).map(daysAfter => addDays(weekStart, daysAfter));\r\n        break;\r\n      case 'Month':\r\n        const monthStart = startOfMonth(selectedDate);\r\n        dates = _.range(getDaysInMonth(selectedDate)).map(daysAfter =>\r\n          addDays(monthStart, daysAfter)\r\n        );\r\n        break;\r\n      default:\r\n    }\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"agenda__title\">Agenda</h2>\r\n\r\n        <div className=\"agenda__tab-container\">\r\n          <TabButtons\r\n            buttons={['Day', 'Week', 'Month']}\r\n            selectedButton={timeframeType}\r\n            onSelect={this.handleTimeframeTypeChange}\r\n            useEqualWidthTabs\r\n          />\r\n        </div>\r\n\r\n        <div className=\"agenda__timeframe-header-container\">\r\n          <i className=\"fas fa-chevron-left fa-lg\" onClick={this.handlePreviousDateClick} />\r\n          <div className=\"agenda__timeframe-header\">{this.calculateTimeframeHeader()}</div>\r\n          <i className=\"fas fa-chevron-right fa-lg\" onClick={this.handleNextDateClick} />\r\n        </div>\r\n\r\n        <div className=\"agenda__days-container\">\r\n          {dates.map(date => (\r\n            <AgendaDay\r\n              key={formatDate(date)}\r\n              date={date}\r\n              headers={headers}\r\n              onHeaderClick={this.handleHeaderClick}\r\n              todoKeywordSets={todoKeywordSets}\r\n              dateDisplayType={dateDisplayType}\r\n              onToggleDateDisplayType={this.handleToggleDateDisplayType}\r\n              agendaDefaultDeadlineDelayValue={agendaDefaultDeadlineDelayValue}\r\n              agendaDefaultDeadlineDelayUnit={agendaDefaultDeadlineDelayUnit}\r\n            />\r\n          ))}\r\n        </div>\r\n\r\n        <br />\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  todoKeywordSets: state.org.present.get('todoKeywordSets'),\r\n  agendaDefaultDeadlineDelayValue: state.base.get('agendaDefaultDeadlineDelayValue') || 5,\r\n  agendaDefaultDeadlineDelayUnit: state.base.get('agendaDefaultDeadlineDelayUnit') || 'd',\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  org: bindActionCreators(orgActions, dispatch),\r\n});\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(AgendaModal);\r\n","const DEFAULT_BINDINGS = [\r\n  ['Select next header', 'selectNextVisibleHeader', 'ctrl+n'],\r\n  ['Select previous header', 'selectPreviousVisibleHeader', 'ctrl+p'],\r\n  ['Toggle header opened', 'toggleHeaderOpened', 'tab'],\r\n  ['Advance todo state', 'advanceTodo', 'ctrl+t'],\r\n  ['Edit title', 'editTitle', 'ctrl+h'],\r\n  ['Edit description', 'editDescription', 'ctrl+d'],\r\n  ['Exit edit mode', 'exitEditMode', 'command+enter'],\r\n  ['Add header', 'addHeader', 'ctrl+enter'],\r\n  ['Remove header', 'removeHeader', 'backspace'],\r\n  ['Move header up', 'moveHeaderUp', 'ctrl+command+p'],\r\n  ['Move header down', 'moveHeaderDown', 'ctrl+command+n'],\r\n  ['Move header left', 'moveHeaderLeft', 'ctrl+command+b'],\r\n  ['Move header right', 'moveHeaderRight', 'ctrl+command+f'],\r\n  ['Undo', 'undo', 'ctrl+shift+-'],\r\n];\r\n\r\nexport const calculateNamedKeybindings = customKeybindings =>\r\n  DEFAULT_BINDINGS.map(([bindingName, _bindingAction, binding]) => [\r\n    bindingName,\r\n    customKeybindings.get(bindingName, binding),\r\n  ]);\r\n\r\nexport const calculateActionedKeybindings = customKeybindings =>\r\n  DEFAULT_BINDINGS.map(([bindingName, bindingAction, binding]) => [\r\n    bindingAction,\r\n    customKeybindings.get(bindingName, binding),\r\n  ]);\r\n","/* global ga */\r\n\r\nimport React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nimport { HotKeys } from 'react-hotkeys';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport HeaderList from './components/HeaderList';\r\nimport ActionDrawer from './components/ActionDrawer';\r\nimport CaptureModal from './components/CaptureModal';\r\nimport SyncConfirmationModal from './components/SyncConfirmationModal';\r\nimport TagsEditorModal from './components/TagsEditorModal';\r\nimport TimestampEditorModal from './components/TimestampEditorModal';\r\nimport PropertyListEditorModal from './components/PropertyListEditorModal';\r\nimport AgendaModal from './components/AgendaModal';\r\n\r\nimport * as baseActions from '../../actions/base';\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as orgActions from '../../actions/org';\r\nimport * as captureActions from '../../actions/capture';\r\nimport { ActionCreators as undoActions } from 'redux-linear-undo';\r\n\r\nimport sampleCaptureTemplates from '../../lib/sample_capture_templates';\r\nimport { calculateActionedKeybindings } from '../../lib/keybindings';\r\nimport { timestampWithId, headerWithId } from '../../lib/org_utils';\r\n\r\nimport _ from 'lodash';\r\nimport { fromJS, OrderedSet } from 'immutable';\r\n\r\nclass OrgFile extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleSelectNextVisibleHeaderHotKey',\r\n      'handleSelectPreviousVisibleHeaderHotKey',\r\n      'handleToggleHeaderOpenedHotKey',\r\n      'handleAdvanceTodoHotKey',\r\n      'handleEditTitleHotKey',\r\n      'handleEditDescriptionHotKey',\r\n      'handleExitEditModeHotKey',\r\n      'handleAddHeaderHotKey',\r\n      'handleRemoveHeaderHotKey',\r\n      'handleMoveHeaderUpHotKey',\r\n      'handleMoveHeaderDownHotKey',\r\n      'handleMoveHeaderLeftHotKey',\r\n      'handleMoveHeaderRightHotKey',\r\n      'handleUndoHotKey',\r\n      'handleContainerRef',\r\n      'handleCapture',\r\n      'handlePopupClose',\r\n      'handleSyncConfirmationPull',\r\n      'handleSyncConfirmationPush',\r\n      'handleSyncConfirmationCancel',\r\n      'handleTagsChange',\r\n      'handlePropertyListItemsChange',\r\n    ]);\r\n\r\n    this.state = {\r\n      hasUncaughtError: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { staticFile, path, loadedPath } = this.props;\r\n\r\n    if (!!staticFile) {\r\n      this.props.base.loadStaticFile(staticFile);\r\n\r\n      if (staticFile === 'changelog') {\r\n        this.props.base.setHasUnseenChangelog(false);\r\n      }\r\n\r\n      setTimeout(() => (document.querySelector('html').scrollTop = 0), 0);\r\n    } else if (!!path && path !== loadedPath) {\r\n      this.props.syncBackend.downloadFile(path);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { staticFile } = this.props;\r\n\r\n    if (!!staticFile) {\r\n      this.props.base.unloadStaticFile();\r\n    } else {\r\n      this.props.org.stopDisplayingFile();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const { headers, pendingCapture } = this.props;\r\n    if (!!pendingCapture && !!headers && headers.size > 0) {\r\n      this.props.org.insertPendingCapture();\r\n    }\r\n  }\r\n\r\n  componentDidCatch(error) {\r\n    ga('send', 'event', 'error', 'OrgFile componentDidCatch', error);\r\n\r\n    this.setState({ hasUncaughtError: true });\r\n  }\r\n\r\n  handleSelectNextVisibleHeaderHotKey() {\r\n    this.props.org.selectNextVisibleHeader();\r\n  }\r\n\r\n  handleSelectPreviousVisibleHeaderHotKey() {\r\n    this.props.org.selectPreviousVisibleHeader();\r\n  }\r\n\r\n  handleToggleHeaderOpenedHotKey() {\r\n    const { selectedHeaderId } = this.props;\r\n\r\n    if (selectedHeaderId) {\r\n      this.props.org.toggleHeaderOpened(selectedHeaderId);\r\n    }\r\n  }\r\n\r\n  handleAdvanceTodoHotKey() {\r\n    this.props.org.advanceTodoState();\r\n  }\r\n\r\n  handleEditTitleHotKey() {\r\n    this.props.org.enterEditMode('title');\r\n  }\r\n\r\n  handleEditDescriptionHotKey() {\r\n    this.props.org.openHeader(this.props.selectedHeaderId);\r\n    this.props.org.enterEditMode('description');\r\n  }\r\n\r\n  handleExitEditModeHotKey() {\r\n    this.props.org.exitEditMode();\r\n    this.container.focus();\r\n  }\r\n\r\n  handleAddHeaderHotKey() {\r\n    this.props.org.addHeaderAndEdit(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleRemoveHeaderHotKey() {\r\n    const { selectedHeaderId } = this.props;\r\n\r\n    this.props.org.selectNextSiblingHeader(selectedHeaderId);\r\n    this.props.org.removeHeader(selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderUpHotKey() {\r\n    this.props.org.moveHeaderUp(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderDownHotKey() {\r\n    this.props.org.moveHeaderDown(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderLeftHotKey() {\r\n    this.props.org.moveHeaderLeft(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderRightHotKey() {\r\n    this.props.org.moveHeaderRight(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleUndoHotKey() {\r\n    this.props.undo.undo();\r\n  }\r\n\r\n  handleContainerRef(container) {\r\n    this.container = container;\r\n    if (this.container) {\r\n      this.container.focus();\r\n    }\r\n  }\r\n\r\n  handleCapture(templateId, content, shouldPrepend) {\r\n    this.props.org.insertCapture(templateId, content, shouldPrepend);\r\n  }\r\n\r\n  handlePopupClose() {\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationPull() {\r\n    this.props.org.sync({ forceAction: 'pull' });\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationPush() {\r\n    this.props.org.sync({ forceAction: 'push' });\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationCancel() {\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleTagsChange(newTags) {\r\n    this.props.org.setHeaderTags(this.props.selectedHeaderId, newTags);\r\n  }\r\n\r\n  handlePropertyListItemsChange(newPropertyListItems) {\r\n    this.props.org.updatePropertyListItems(\r\n      this.props.activePopupData.get('headerId'),\r\n      newPropertyListItems\r\n    );\r\n  }\r\n\r\n  handleTimestampChange(popupData) {\r\n    if (!!popupData.get('timestampId')) {\r\n      return newTimestamp =>\r\n        this.props.org.updateTimestampWithId(popupData.get('timestampId'), newTimestamp);\r\n    } else {\r\n      return newTimestamp =>\r\n        this.props.org.updatePlanningItemTimestamp(\r\n          popupData.get('headerId'),\r\n          popupData.get('planningItemIndex'),\r\n          newTimestamp.get('firstTimestamp')\r\n        );\r\n    }\r\n  }\r\n\r\n  renderActivePopup() {\r\n    const {\r\n      activePopupType,\r\n      activePopupData,\r\n      captureTemplates,\r\n      headers,\r\n      selectedHeader,\r\n    } = this.props;\r\n\r\n    switch (activePopupType) {\r\n      case 'sync-confirmation':\r\n        return (\r\n          <SyncConfirmationModal\r\n            lastServerModifiedAt={activePopupData.get('lastServerModifiedAt')}\r\n            onPull={this.handleSyncConfirmationPull}\r\n            onPush={this.handleSyncConfirmationPush}\r\n            onCancel={this.handleSyncConfirmationCancel}\r\n          />\r\n        );\r\n      case 'capture':\r\n        return (\r\n          <CaptureModal\r\n            template={captureTemplates.find(\r\n              template => template.get('id') === activePopupData.get('templateId')\r\n            )}\r\n            headers={headers}\r\n            onCapture={this.handleCapture}\r\n            onClose={this.handlePopupClose}\r\n          />\r\n        );\r\n      case 'tags-editor':\r\n        return !!selectedHeader ? (\r\n          <TagsEditorModal\r\n            header={selectedHeader}\r\n            allTags={OrderedSet(\r\n              headers.flatMap(header => header.getIn(['titleLine', 'tags']))\r\n            ).sort()}\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handleTagsChange}\r\n          />\r\n        ) : null;\r\n      case 'timestamp-editor':\r\n        let editingTimestamp = null;\r\n        if (activePopupData.get('timestampId')) {\r\n          editingTimestamp = timestampWithId(headers, activePopupData.get('timestampId'));\r\n        } else {\r\n          editingTimestamp = fromJS({\r\n            firstTimestamp: headerWithId(headers, activePopupData.get('headerId')).getIn([\r\n              'planningItems',\r\n              activePopupData.get('planningItemIndex'),\r\n              'timestamp',\r\n            ]),\r\n          });\r\n        }\r\n\r\n        return (\r\n          <TimestampEditorModal\r\n            timestamp={editingTimestamp}\r\n            singleTimestampOnly={!activePopupData.get('timestampId')}\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handleTimestampChange(activePopupData)}\r\n          />\r\n        );\r\n\r\n      case 'property-list-editor':\r\n        return (\r\n          <PropertyListEditorModal\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handlePropertyListItemsChange}\r\n            propertyListItems={headerWithId(headers, activePopupData.get('headerId')).get(\r\n              'propertyListItems'\r\n            )}\r\n          />\r\n        );\r\n      case 'agenda':\r\n        return <AgendaModal onClose={this.handlePopupClose} headers={headers} />;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      headers,\r\n      shouldDisableDirtyIndicator,\r\n      shouldDisableSyncButtons,\r\n      shouldDisableActions,\r\n      isDirty,\r\n      parsingErrorMessage,\r\n      path,\r\n      staticFile,\r\n      customKeybindings,\r\n      inEditMode,\r\n      orgFileErrorMessage,\r\n    } = this.props;\r\n\r\n    if (!path && !staticFile) {\r\n      return <Redirect to=\"/files\" />;\r\n    }\r\n\r\n    if (this.state.hasUncaughtError) {\r\n      return (\r\n        <div className=\"error-message-container\">\r\n          Uh oh, you ran into a bug!\r\n          <br />\r\n          <br />\r\n          This was probably the result of an error in attempting to parse your org file. It'd be\r\n          super helpful if you could{' '}\r\n          <a\r\n            href=\"https://github.com/DanielDe/org-web/issues/new\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            create an issue\r\n          </a>{' '}\r\n          (and include the org file if possible!)\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (!!orgFileErrorMessage) {\r\n      return <div className=\"error-message-container\">{orgFileErrorMessage}</div>;\r\n    }\r\n\r\n    if (!headers) {\r\n      return <div />;\r\n    }\r\n\r\n    const keyMap = _.fromPairs(calculateActionedKeybindings(customKeybindings));\r\n\r\n    // Automatically call preventDefault on all the keyboard events that come through for\r\n    // these hotkeys.\r\n    const preventDefaultAndHandleEditMode = (callback, ignoreInEditMode = false) => event => {\r\n      if (ignoreInEditMode && inEditMode) {\r\n        return;\r\n      }\r\n\r\n      if (ignoreInEditMode && ['TEXTAREA', 'INPUT'].includes(document.activeElement.nodeName)) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n      callback(event);\r\n    };\r\n\r\n    const handlers = {\r\n      selectNextVisibleHeader: preventDefaultAndHandleEditMode(\r\n        this.handleSelectNextVisibleHeaderHotKey\r\n      ),\r\n      selectPreviousVisibleHeader: preventDefaultAndHandleEditMode(\r\n        this.handleSelectPreviousVisibleHeaderHotKey\r\n      ),\r\n      toggleHeaderOpened: preventDefaultAndHandleEditMode(\r\n        this.handleToggleHeaderOpenedHotKey,\r\n        true\r\n      ),\r\n      advanceTodo: preventDefaultAndHandleEditMode(this.handleAdvanceTodoHotKey),\r\n      editTitle: preventDefaultAndHandleEditMode(this.handleEditTitleHotKey),\r\n      editDescription: preventDefaultAndHandleEditMode(this.handleEditDescriptionHotKey),\r\n      exitEditMode: preventDefaultAndHandleEditMode(this.handleExitEditModeHotKey),\r\n      addHeader: preventDefaultAndHandleEditMode(this.handleAddHeaderHotKey),\r\n      removeHeader: preventDefaultAndHandleEditMode(this.handleRemoveHeaderHotKey, true),\r\n      moveHeaderUp: preventDefaultAndHandleEditMode(this.handleMoveHeaderUpHotKey),\r\n      moveHeaderDown: preventDefaultAndHandleEditMode(this.handleMoveHeaderDownHotKey),\r\n      moveHeaderLeft: preventDefaultAndHandleEditMode(this.handleMoveHeaderLeftHotKey),\r\n      moveHeaderRight: preventDefaultAndHandleEditMode(this.handleMoveHeaderRightHotKey),\r\n      undo: preventDefaultAndHandleEditMode(this.handleUndoHotKey),\r\n    };\r\n\r\n    return (\r\n      <HotKeys keyMap={keyMap} handlers={handlers}>\r\n        <div className=\"org-file-container\" tabIndex=\"-1\" ref={this.handleContainerRef}>\r\n          {headers.size === 0 ? (\r\n            <div className=\"org-file__parsing-error-message\">\r\n              <h3>Couldn't parse file</h3>\r\n\r\n              {!!parsingErrorMessage ? (\r\n                <Fragment>{parsingErrorMessage}</Fragment>\r\n              ) : (\r\n                <Fragment>\r\n                  If you think this is a bug, please{' '}\r\n                  <a\r\n                    href=\"https://github.com/DanielDe/org-web/issues/new\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                  >\r\n                    create an issue\r\n                  </a>{' '}\r\n                  and include the org file if possible!\r\n                </Fragment>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <HeaderList shouldDisableActions={shouldDisableActions} />\r\n          )}\r\n\r\n          {isDirty &&\r\n            !shouldDisableDirtyIndicator && <div className=\"dirty-indicator\">Unpushed changes</div>}\r\n\r\n          {!shouldDisableActions && (\r\n            <ActionDrawer\r\n              shouldDisableSyncButtons={shouldDisableSyncButtons}\r\n              staticFile={staticFile}\r\n            />\r\n          )}\r\n\r\n          {this.renderActivePopup()}\r\n        </div>\r\n      </HotKeys>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const headers = state.org.present.get('headers');\r\n  const selectedHeaderId = state.org.present.get('selectedHeaderId');\r\n  const activePopup = state.base.get('activePopup');\r\n\r\n  return {\r\n    headers,\r\n    selectedHeaderId,\r\n    isDirty: state.org.present.get('isDirty'),\r\n    loadedPath: state.org.present.get('path'),\r\n    selectedHeader: headers && headers.find(header => header.get('id') === selectedHeaderId),\r\n    customKeybindings: state.base.get('customKeybindings'),\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n    activePopupType: !!activePopup ? activePopup.get('type') : null,\r\n    activePopupData: !!activePopup ? activePopup.get('data') : null,\r\n    captureTemplates: state.capture.get('captureTemplates').concat(sampleCaptureTemplates),\r\n    pendingCapture: state.org.present.get('pendingCapture'),\r\n    orgFileErrorMessage: state.org.present.get('orgFileErrorMessage'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    undo: bindActionCreators(undoActions, dispatch),\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(OrgFile);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as baseActions from '../../actions/base';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TabButtons from '../UI/TabButtons';\r\nimport Switch from '../UI/Switch';\r\n\r\nconst Settings = ({\r\n  fontSize,\r\n  bulletStyle,\r\n  shouldTapTodoToAdvance,\r\n  shouldStoreSettingsInSyncBackend,\r\n  shouldLiveSync,\r\n  shouldSyncOnBecomingVisibile,\r\n  agendaDefaultDeadlineDelayValue,\r\n  agendaDefaultDeadlineDelayUnit,\r\n  hasUnseenChangelog,\r\n  syncBackend,\r\n  base,\r\n}) => {\r\n  const handleSignOutClick = () =>\r\n    window.confirm('Are you sure you want to sign out?') ? syncBackend.signOut() : void 0;\r\n\r\n  const handleKeyboardShortcutsClick = () => base.pushModalPage('keyboard_shortcuts_editor');\r\n\r\n  const handleCaptureTemplatesClick = () => base.pushModalPage('capture_templates_editor');\r\n\r\n  const handleFontSizeChange = newFontSize => base.setFontSize(newFontSize);\r\n\r\n  const handleBulletStyleChange = newBulletStyle => base.setBulletStyle(newBulletStyle);\r\n\r\n  const handleShouldTapTodoToAdvanceChange = () =>\r\n    base.setShouldTapTodoToAdvance(!shouldTapTodoToAdvance);\r\n\r\n  const handleAgendaDefaultDeadlineDelayValueChange = event =>\r\n    base.setAgendaDefaultDeadlineDelayValue(event.target.value);\r\n\r\n  const handleAgendaDefaultDeadlineDelayUnitChange = newDelayUnit =>\r\n    base.setAgendaDefaultDeadlineDelayUnit(newDelayUnit);\r\n\r\n  const handleShouldLiveSyncChange = () => base.setShouldLiveSync(!shouldLiveSync);\r\n\r\n  const handleShouldSyncOnBecomingVisibleChange = () => base.setShouldSyncOnBecomingVisibile(!shouldSyncOnBecomingVisibile);\r\n\r\n  const handleShouldStoreSettingsInSyncBackendChange = () =>\r\n    base.setShouldStoreSettingsInSyncBackend(!shouldStoreSettingsInSyncBackend);\r\n\r\n  const handleChangelogClick = () => base.pushModalPage('changelog');\r\n\r\n  const handleHelpClick = () => base.pushModalPage('sample');\r\n\r\n  return (\r\n    <div className=\"settings-container\">\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Font size</div>\r\n        <TabButtons\r\n          buttons={['Regular', 'Large']}\r\n          selectedButton={fontSize}\r\n          onSelect={handleFontSizeChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Bullet style</div>\r\n        <TabButtons\r\n          buttons={['Classic', 'Fancy']}\r\n          selectedButton={bulletStyle}\r\n          onSelect={handleBulletStyleChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Tap TODO to advance state</div>\r\n        <Switch isEnabled={shouldTapTodoToAdvance} onToggle={handleShouldTapTodoToAdvanceChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Live sync\r\n          <div className=\"setting-label__description\">\r\n            If enabled, changes are automatically pushed to the sync backend as you make them.\r\n          </div>\r\n        </div>\r\n        <Switch isEnabled={shouldLiveSync} onToggle={handleShouldLiveSyncChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Sync on application becoming visible\r\n          <div className=\"setting-label__description\">\r\n            If enabled, the current org file is pulled from the sync backend when the browser tab becomes visible. This prevents you from having a stale file before starting to make changes to it.\r\n          </div>\r\n        </div>\r\n        <Switch isEnabled={shouldSyncOnBecomingVisibile} onToggle={handleShouldSyncOnBecomingVisibleChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Store settings in sync backend\r\n          <div className=\"setting-label__description\">\r\n            Store settings and keyboard shortcuts in a .org-web-config.json file in your sync\r\n            backend to sync betweeen multiple devices.\r\n          </div>\r\n        </div>\r\n        <Switch\r\n          isEnabled={shouldStoreSettingsInSyncBackend}\r\n          onToggle={handleShouldStoreSettingsInSyncBackendChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container setting-container--vertical\">\r\n        <div className=\"setting-label\">Default DEADLINE warning period</div>\r\n\r\n        <div className=\"default-deadline-warning-container\">\r\n          <input\r\n            type=\"number\"\r\n            min=\"0\"\r\n            className=\"textfield default-deadline-value-textfield\"\r\n            value={agendaDefaultDeadlineDelayValue}\r\n            onChange={handleAgendaDefaultDeadlineDelayValueChange}\r\n          />\r\n\r\n          <TabButtons\r\n            buttons={'hdwmy'.split('')}\r\n            selectedButton={agendaDefaultDeadlineDelayUnit}\r\n            onSelect={handleAgendaDefaultDeadlineDelayUnitChange}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"settings-buttons-container\">\r\n        <button className=\"btn settings-btn\" onClick={handleCaptureTemplatesClick}>\r\n          Capture templates\r\n        </button>\r\n        <button className=\"btn settings-btn\" onClick={handleKeyboardShortcutsClick}>\r\n          Keyboard shortcuts\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\" onClick={handleChangelogClick}>\r\n          Changelog\r\n          {hasUnseenChangelog && (\r\n            <div className=\"changelog-badge-container\">\r\n              <i className=\"fas fa-gift\" />\r\n            </div>\r\n          )}\r\n        </button>\r\n        <button className=\"btn settings-btn\" onClick={handleHelpClick}>\r\n          Help\r\n        </button>\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"https://github.com/DanielDe/org-web\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Github repo <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"http://eepurl.com/dK5F9w\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Mailing list <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <div className=\"settings-button-help-text\">\r\n          Sign up for the mailing list if you're interested in getting occasional ({'<'}1 per week)\r\n          updates on org-web. Or take a look at some{' '}\r\n          <a\r\n            href=\"https://us19.campaign-archive.com/home/?u=36b9d8082ddb55e6cc7e22339&id=f427625e31\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            past emails\r\n          </a>{' '}\r\n          before you sign up. You can unsubscribe at any time!\r\n        </div>\r\n\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"https://twitter.com/org_web_org\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Twitter <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\" onClick={handleSignOutClick}>\r\n          Sign out\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    fontSize: state.base.get('fontSize') || 'Regular',\r\n    bulletStyle: state.base.get('bulletStyle') || 'Classic',\r\n    shouldTapTodoToAdvance: state.base.get('shouldTapTodoToAdvance'),\r\n    agendaDefaultDeadlineDelayValue: state.base.get('agendaDefaultDeadlineDelayValue') || 5,\r\n    agendaDefaultDeadlineDelayUnit: state.base.get('agendaDefaultDeadlineDelayUnit') || 'd',\r\n    shouldStoreSettingsInSyncBackend: state.base.get('shouldStoreSettingsInSyncBackend'),\r\n    shouldLiveSync: state.base.get('shouldLiveSync'),\r\n    shouldSyncOnBecomingVisibile: state.base.get('shouldSyncOnBecomingVisibile'),\r\n    hasUnseenChangelog: state.base.get('hasUnseenChangelog'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(Settings)\r\n);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nexport default class ShortcutRow extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleRebindClick', 'handleKeyPress']);\r\n\r\n    this.state = {\r\n      isEditMode: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.rebindArea.addEventListener('blur', () => this.setState({ isEditMode: false }));\r\n  }\r\n\r\n  handleRebindClick() {\r\n    this.setState({ isEditMode: true });\r\n    document.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress(event) {\r\n    this.setState({ isEditMode: false });\r\n    document.removeEventListener('keypress', this.handleKeyPress);\r\n\r\n    let key = null;\r\n    if (event.code.startsWith('Key')) {\r\n      key = event.code.substr(3).toLowerCase();\r\n    } else if (event.code.startsWith('Digit')) {\r\n      key = event.code.substr(5);\r\n    } else {\r\n      key = {\r\n        Minus: '-',\r\n        Equal: '=',\r\n        Backspace: 'backspace',\r\n        Enter: 'enter',\r\n        Return: 'return',\r\n        Tab: 'tab',\r\n        BracketLeft: '[',\r\n        BracketRight: ']',\r\n        Semicolon: ';',\r\n        Quote: '\"',\r\n        Backslash: '\\\\',\r\n        Comma: ',',\r\n        Period: '.',\r\n        Slash: '/',\r\n      }[event.code];\r\n    }\r\n\r\n    if (!key) {\r\n      return;\r\n    }\r\n\r\n    const modifiers = [\r\n      ['ctrlKey', 'ctrl'],\r\n      ['altKey', 'alt'],\r\n      ['metaKey', 'meta'],\r\n      ['shiftKey', 'shift'],\r\n    ];\r\n\r\n    const newModifiers = modifiers\r\n      .filter(([modifier, _]) => event[modifier])\r\n      .map(([_, symbol]) => symbol)\r\n      .join('+');\r\n    const newBinding = `${newModifiers}${!!newModifiers ? '+' : ''}${key}`;\r\n\r\n    this.props.onBindingChange(this.props.name, newBinding);\r\n  }\r\n\r\n  symbolizeKeybinding(binding) {\r\n    if (!binding) {\r\n      return '';\r\n    }\r\n\r\n    const replacements = [\r\n      ['ctrl', '^'],\r\n      ['alt', '⌥'],\r\n      ['option', '⌥'],\r\n      ['command', '⌘'],\r\n      ['meta', '⌘'],\r\n      ['shift', '⇧'],\r\n      ['backspace', '⌫'],\r\n      ['return', '⏎'],\r\n      ['enter', '⏎'],\r\n      ['left', '←'],\r\n      ['right', '→'],\r\n      ['up', '↑'],\r\n      ['down', '↓'],\r\n    ];\r\n\r\n    return replacements.reduce(\r\n      (currentBinding, [name, symbol]) => currentBinding.replace(RegExp(`${name}\\\\+?`), symbol),\r\n      binding\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { name, binding } = this.props;\r\n    const { isEditMode } = this.state;\r\n\r\n    const rebindAreaClassName = classNames('keyboard-shortcut-container__shortcut-key', {\r\n      'keyboard-shortcut-container__shortcut-key--edit-mode': isEditMode,\r\n    });\r\n\r\n    return (\r\n      <div className=\"keyboard-shortcut-container\">\r\n        <div className=\"keyboard-shortcut-container__shortcut-name\">{name}</div>\r\n        <div\r\n          className={rebindAreaClassName}\r\n          onClick={this.handleRebindClick}\r\n          tabIndex=\"-1\"\r\n          ref={div => (this.rebindArea = div)}\r\n        >\r\n          {isEditMode ? '...' : this.symbolizeKeybinding(binding)}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport { Map } from 'immutable';\r\n\r\nimport ShortcutRow from './components/ShortcutRow';\r\n\r\nimport * as baseActions from '../../actions/base';\r\n\r\nimport { calculateNamedKeybindings } from '../../lib/keybindings';\r\n\r\nimport './stylesheet.css';\r\n\r\nconst KeyboardShortcutsEditor = ({ customKeybindings, base }) => {\r\n  const handleBindingChange = (bindingName, newBinding) => {\r\n    const alreadyInUseBinding = calculateNamedKeybindings(customKeybindings).filter(\r\n      ([_, binding]) => binding === newBinding\r\n    )[0];\r\n\r\n    if (!!alreadyInUseBinding) {\r\n      alert(`That binding is already in use for \"${alreadyInUseBinding[0]}\"`);\r\n      return;\r\n    }\r\n\r\n    base.setCustomKeybinding(bindingName, newBinding);\r\n  };\r\n\r\n  return (\r\n    <div className=\"keyboard-shortcuts-editor-container\">\r\n      {calculateNamedKeybindings(customKeybindings).map(([name, binding]) => (\r\n        <ShortcutRow\r\n          key={name}\r\n          name={name}\r\n          binding={binding}\r\n          onBindingChange={handleBindingChange}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    customKeybindings: state.base.get('customKeybindings') || Map(),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(KeyboardShortcutsEditor)\r\n);\r\n","import React, { Fragment, useState } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport { Draggable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport ActionButton from '../../../OrgFile/components/ActionDrawer/components/ActionButton';\r\nimport Switch from '../../../UI/Switch/';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({\r\n  template,\r\n  index,\r\n  onFieldPathUpdate,\r\n  onAddNewTemplateOrgFileAvailability,\r\n  onRemoveTemplateOrgFileAvailability,\r\n  onAddNewTemplateHeaderPath,\r\n  onRemoveTemplateHeaderPath,\r\n  onDeleteTemplate,\r\n  syncBackendType,\r\n}) => {\r\n  const [isCollapsed, setIsCollapsed] = useState(!!template.get('description'));\r\n  const handleHeaderBarClick = () => setIsCollapsed(!isCollapsed);\r\n\r\n  const updateField = fieldName => event =>\r\n    onFieldPathUpdate(template.get('id'), [fieldName], event.target.value);\r\n\r\n  const toggleAvailabilityInAllOrgFiles = () =>\r\n    onFieldPathUpdate(\r\n      template.get('id'),\r\n      ['isAvailableInAllOrgFiles'],\r\n      !template.get('isAvailableInAllOrgFiles')\r\n    );\r\n\r\n  const togglePrepend = () =>\r\n    onFieldPathUpdate(template.get('id'), ['shouldPrepend'], !template.get('shouldPrepend'));\r\n\r\n  const handleAddNewOrgFileAvailability = () => {\r\n    onAddNewTemplateOrgFileAvailability(template.get('id'));\r\n  };\r\n\r\n  const handleRemoveOrgFileAvailability = index => () =>\r\n    onRemoveTemplateOrgFileAvailability(template.get('id'), index);\r\n\r\n  const handleOrgFileAvailabilityChange = orgFileAvailabilityIndex => event =>\r\n    onFieldPathUpdate(\r\n      template.get('id'),\r\n      ['orgFilesWhereAvailable', orgFileAvailabilityIndex],\r\n      event.target.value\r\n    );\r\n\r\n  const handleAddNewHeaderPath = () => onAddNewTemplateHeaderPath(template.get('id'));\r\n\r\n  const handleRemoveHeaderPath = headerPathIndex => () =>\r\n    onRemoveTemplateHeaderPath(template.get('id'), headerPathIndex);\r\n\r\n  const handleHeaderPathChange = headerPathIndex => event =>\r\n    onFieldPathUpdate(template.get('id'), ['headerPaths', headerPathIndex], event.target.value);\r\n\r\n  const handleDeleteClick = () => {\r\n    if (\r\n      window.confirm(\r\n        `Are you sure you want to delete the \"${template.get('description')}\" template?`\r\n      )\r\n    ) {\r\n      onDeleteTemplate(template.get('id'));\r\n    }\r\n  };\r\n\r\n  const renderDescriptionField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Description:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield\"\r\n          value={template.get('description', '')}\r\n          onChange={updateField('description')}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderIconField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Letter:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield capture-template__letter-textfield\"\r\n          maxLength=\"1\"\r\n          value={template.get('letter', '')}\r\n          onChange={updateField('letter')}\r\n          autoCapitalize=\"none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__field__or-container\">\r\n        <div className=\"capture-template__field__or-line\" />\r\n        <div className=\"capture-template__field__or\">or</div>\r\n        <div className=\"capture-template__field__or-line\" />\r\n      </div>\r\n\r\n      <div className=\"capture-template__field\">\r\n        <div>Icon name:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield\"\r\n          value={template.get('iconName')}\r\n          onChange={updateField('iconName')}\r\n          autoCapitalize=\"none\"\r\n          autoCorrect=\"none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        Instead of a letter, you can specify the name of any free Font Awesome icon (like lemon or\r\n        calendar-plus) to use as the capture icon. You can search the available icons{' '}\r\n        <a\r\n          href=\"https://fontawesome.com/icons?d=gallery&s=solid&m=free\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          here\r\n        </a>\r\n        .\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderOrgFileAvailability = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Available in all org files?</div>\r\n        <Switch\r\n          isEnabled={template.get('isAvailableInAllOrgFiles')}\r\n          onToggle={toggleAvailabilityInAllOrgFiles}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        You can make this capture template available in all org files, or just the ones you specify.\r\n        {syncBackendType === 'Dropbox' && (\r\n          <Fragment>\r\n            {' '}\r\n            Specify full paths starting from the root of your Dropbox, like{' '}\r\n            <code>/org/todo.org</code>\r\n          </Fragment>\r\n        )}\r\n        {syncBackendType === 'Google Drive' && (\r\n          <Fragment>\r\n            {' '}\r\n            Specify the file id of each file. You can find the file id in the URL of the file in\r\n            org-web (e.g.,{' '}\r\n            <code>\r\n              /file/\r\n              {'<file id>'}\r\n            </code>\r\n            ).\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n\r\n      <Collapse\r\n        isOpened={!template.get('isAvailableInAllOrgFiles')}\r\n        springConfig={{ stiffness: 300 }}\r\n      >\r\n        <div className=\"multi-textfields-container\">\r\n          {template.get('orgFilesWhereAvailable').map((orgFilePath, index) => (\r\n            <div key={`org-file-availability-${index}`} className=\"multi-textfield-container\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"e.g., /org/todo.org\"\r\n                className=\"textfield multi-textfield-field\"\r\n                value={orgFilePath}\r\n                onChange={handleOrgFileAvailabilityChange(index)}\r\n              />\r\n              <button\r\n                className=\"fas fa-times fa-lg remove-multi-textfield-button\"\r\n                onClick={handleRemoveOrgFileAvailability(index)}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"add-new-multi-textfield-button-container\">\r\n          <button\r\n            className=\"fas fa-plus add-new-multi-textfield-button\"\r\n            onClick={handleAddNewOrgFileAvailability}\r\n          />\r\n        </div>\r\n      </Collapse>\r\n    </div>\r\n  );\r\n\r\n  const renderHeaderPaths = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\" style={{ marginTop: 7 }}>\r\n        <div>Header path</div>\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        Specify the path to the header under which the new header should be filed. One header per\r\n        textfield.\r\n      </div>\r\n\r\n      <div className=\"multi-textfields-container\">\r\n        {template.get('headerPaths').map((headerPath, index) => (\r\n          <div key={`header-path-${index}`} className=\"multi-textfield-container\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"e.g., Todos\"\r\n              className=\"textfield multi-textfield-field\"\r\n              value={headerPath}\r\n              onChange={handleHeaderPathChange(index)}\r\n            />\r\n            <button\r\n              className=\"fas fa-times fa-lg remove-multi-textfield-button\"\r\n              onClick={handleRemoveHeaderPath(index)}\r\n            />\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"add-new-multi-textfield-button-container\">\r\n        <button\r\n          className=\"fas fa-plus add-new-multi-textfield-button\"\r\n          onClick={handleAddNewHeaderPath}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderPrependField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Prepend?</div>\r\n        <Switch isEnabled={template.get('shouldPrepend')} onToggle={togglePrepend} />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        By default, new captured headers are appended to the specified header path. Enable this\r\n        setting to prepend them instead.\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderTemplateField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\" style={{ marginTop: 7 }}>\r\n        <div>Template</div>\r\n      </div>\r\n\r\n      <textarea\r\n        className=\"textarea template-textarea\"\r\n        rows=\"3\"\r\n        value={template.get('template')}\r\n        onChange={updateField('template')}\r\n      />\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        The template for creating the capture item. You can use the following template variables\r\n        that will be expanded upon capture:\r\n        <ul>\r\n          <li>\r\n            <code>%?</code> - Place the cursor here.\r\n          </li>\r\n          <li>\r\n            <code>%t</code> - Timestamp, date only.\r\n          </li>\r\n          <li>\r\n            <code>%T</code> - Timestamp, with date and time.\r\n          </li>\r\n          <li>\r\n            <code>%u</code> - Inactive timestamp, date only.\r\n          </li>\r\n          <li>\r\n            <code>%U</code> - Inactive timestamp, with date and time.\r\n          </li>\r\n          <li>\r\n            <code>%{'<custom variable>'}</code> - A custom variable from a URL param capture. See{' '}\r\n            <a href=\"https://github.com/DanielDe/org-web/#capture-params-and-siri-support\">\r\n              the README file\r\n            </a>{' '}\r\n            for more details.\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderDeleteButton = template => (\r\n    <div className=\"capture-template__field-container capture-template__delete-button-container\">\r\n      <button\r\n        className=\"btn settings-btn capture-template__delete-button\"\r\n        onClick={handleDeleteClick}\r\n      >\r\n        Delete template\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const caretClassName = classNames(\r\n    'fas fa-2x fa-caret-right capture-template-container__header__caret',\r\n    {\r\n      'capture-template-container__header__caret--rotated': !isCollapsed,\r\n    }\r\n  );\r\n\r\n  return (\r\n    <Draggable draggableId={`capture-template--${template.get('id')}`} index={index}>\r\n      {(provided, snapshot) => (\r\n        <div\r\n          className={classNames('capture-template-container', {\r\n            'capture-template-container--dragging': snapshot.isDragging,\r\n          })}\r\n          ref={provided.innerRef}\r\n          {...provided.draggableProps}\r\n        >\r\n          <div className=\"capture-template-container__header\" onClick={handleHeaderBarClick}>\r\n            <i className={caretClassName} />\r\n            <ActionButton\r\n              iconName={template.get('iconName')}\r\n              letter={template.get('letter')}\r\n              onClick={() => {}}\r\n              style={{ marginRight: 20 }}\r\n            />\r\n            <span className=\"capture-template-container__header__title\">\r\n              {template.get('description')}\r\n            </span>\r\n            <i\r\n              className=\"fas fa-bars fa-lg capture-template-container__header__drag-handle\"\r\n              {...provided.dragHandleProps}\r\n            />\r\n          </div>\r\n\r\n          <Collapse isOpened={!isCollapsed} springConfig={{ stiffness: 300 }}>\r\n            <div className=\"capture-template-container__content\">\r\n              {renderDescriptionField(template)}\r\n              {renderIconField(template)}\r\n              {renderOrgFileAvailability(template)}\r\n              {renderHeaderPaths(template)}\r\n              {renderPrependField(template)}\r\n              {renderTemplateField(template)}\r\n              {renderDeleteButton(template)}\r\n            </div>\r\n          </Collapse>\r\n        </div>\r\n      )}\r\n    </Draggable>\r\n  );\r\n};\r\n","import React, { Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Droppable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport * as captureActions from '../../actions/capture';\r\n\r\nimport CaptureTemplate from './components/CaptureTemplate';\r\n\r\nimport { List } from 'immutable';\r\n\r\nconst CaptureTemplatesEditor = ({ captureTemplates, syncBackendType, capture }) => {\r\n  const handleAddNewTemplateClick = () => capture.addNewEmptyCaptureTemplate();\r\n\r\n  const handleFieldPathUpdate = (templateId, fieldPath, newValue) =>\r\n    capture.updateTemplateFieldPathValue(templateId, fieldPath, newValue);\r\n\r\n  const handleAddNewTemplateOrgFileAvailability = templateId =>\r\n    capture.addNewTemplateOrgFileAvailability(templateId);\r\n\r\n  const handleRemoveTemplateOrgFileAvailability = (templateId, orgFileAvailabilityIndex) =>\r\n    capture.removeTemplateOrgFileAvailability(templateId, orgFileAvailabilityIndex);\r\n\r\n  const handleAddNewTemplateHeaderPath = templateId => capture.addNewTemplateHeaderPath(templateId);\r\n\r\n  const handleRemoveTemplateHeaderPath = (templateId, headerPathIndex) =>\r\n    capture.removeTemplateHeaderPath(templateId, headerPathIndex);\r\n\r\n  const handleDeleteTemplate = templateId => capture.deleteTemplate(templateId);\r\n\r\n  const handleReorderTemplate = (fromIndex, toIndex) =>\r\n    capture.reorderCaptureTemplate(fromIndex, toIndex);\r\n\r\n  return (\r\n    <div>\r\n      <Droppable droppableId=\"capture-templates-editor-droppable\" type=\"CAPTURE-TEMPLATE\">\r\n        {(provided, snapshot) => (\r\n          <div\r\n            className=\"capture-templates-container\"\r\n            ref={provided.innerRef}\r\n            {...provided.droppableProps}\r\n          >\r\n            {captureTemplates.size === 0 ? (\r\n              <div className=\"no-capture-templates-message\">\r\n                You don't currently have any capture templates - add one by pressing the{' '}\r\n                <i className=\"fas fa-plus\" /> button.\r\n                <br />\r\n                <br />\r\n                Capture templates show up in the action drawer and give you quick access to creating\r\n                new headers (like org-capture).\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                {captureTemplates.map((template, index) => (\r\n                  <CaptureTemplate\r\n                    key={template.get('id')}\r\n                    index={index}\r\n                    template={template}\r\n                    syncBackendType={syncBackendType}\r\n                    onFieldPathUpdate={handleFieldPathUpdate}\r\n                    onAddNewTemplateOrgFileAvailability={handleAddNewTemplateOrgFileAvailability}\r\n                    onRemoveTemplateOrgFileAvailability={handleRemoveTemplateOrgFileAvailability}\r\n                    onAddNewTemplateHeaderPath={handleAddNewTemplateHeaderPath}\r\n                    onRemoveTemplateHeaderPath={handleRemoveTemplateHeaderPath}\r\n                    onDeleteTemplate={handleDeleteTemplate}\r\n                    onReorder={handleReorderTemplate}\r\n                  />\r\n                ))}\r\n\r\n                {provided.placeholder}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Droppable>\r\n\r\n      <div className=\"new-capture-template-button-container\">\r\n        <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={handleAddNewTemplateClick} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    captureTemplates: state.capture.get('captureTemplates', new List()),\r\n    syncBackendType: state.syncBackend.get('client').type,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(CaptureTemplatesEditor);\r\n","/* global process, gapi, google */\r\n\r\nimport React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport DropboxLogo from './dropbox.svg';\r\nimport GoogleDriveLogo from './google_drive.png';\r\n\r\nimport { persistField } from '../../util/settings_persister';\r\n\r\nimport { Dropbox } from 'dropbox';\r\n\r\nimport _ from 'lodash';\r\n\r\nexport default class SyncServiceSignIn extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleDropboxClick', 'handleGoogleDriveClick']);\r\n  }\r\n\r\n  handleDropboxClick() {\r\n    persistField('authenticatedSyncService', 'Dropbox');\r\n\r\n    const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n    const authURL = dropbox.getAuthenticationUrl(window.location.origin + '/');\r\n    window.location = authURL;\r\n  }\r\n\r\n  handleGoogleDriveClick() {\r\n    try {\r\n      gapi.load('client', () => {\r\n        window.gapi.client\r\n          .init({\r\n            apiKey: process.env.REACT_APP_GOOGLE_DRIVE_API_KEY,\r\n            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\r\n          })\r\n          .then(async () => {\r\n            const tokenClient = google.accounts.oauth2.initTokenClient({\r\n              client_id: process.env.REACT_APP_GOOGLE_DRIVE_CLIENT_ID,\r\n              scope: 'https://www.googleapis.com/auth/drive.file',\r\n              callback: (accessToken) => {\r\n                persistField('authenticatedSyncService', 'Google Drive');\r\n                persistField('googleDriveAccessToken', JSON.stringify(accessToken));\r\n                window.location.reload();\r\n              },\r\n            });\r\n            tokenClient.requestAccessToken({ prompt: 'consent' });\r\n          });\r\n      });\r\n    } catch (error) {\r\n      alert(\r\n        `The Google Drive API client isn't available - you might be blocking it with an ad blocker`\r\n      );\r\n      return;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"sync-service-sign-in-container\">\r\n        <p className=\"sync-service-sign-in__help-text\">\r\n          org-web syncs your files with Dropbox or Google Drive. Choose your preferred sync backend\r\n          below to sign in.\r\n        </p>\r\n\r\n        <div className=\"sync-service-container\" onClick={this.handleDropboxClick}>\r\n          <img src={DropboxLogo} alt=\"Dropbox logo\" className=\"dropbox-logo\" />\r\n        </div>\r\n\r\n        <div className=\"sync-service-container\" onClick={this.handleGoogleDriveClick}>\r\n          <img src={GoogleDriveLogo} alt=\"Google Drive logo\" className=\"google-drive-logo\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Route, Switch, Redirect, Prompt, withRouter } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { List } from 'immutable';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nimport { parseOrg } from '../../lib/parse_org';\r\n\r\nimport raw from 'raw.macro';\r\n\r\nimport PrivacyPolicy from '../PrivacyPolicy';\r\nimport HeaderBar from '../HeaderBar';\r\nimport Landing from '../Landing';\r\nimport FileBrowser from '../FileBrowser';\r\nimport LoadingIndicator from '../LoadingIndicator';\r\nimport OrgFile from '../OrgFile';\r\nimport Settings from '../Settings';\r\nimport KeyboardShortcutsEditor from '../KeyboardShortcutsEditor';\r\nimport CaptureTemplatesEditor from '../CaptureTemplatesEditor';\r\nimport SyncServiceSignIn from '../SyncServiceSignIn';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as orgActions from '../../actions/org';\r\nimport * as baseActions from '../../actions/base';\r\n\r\nclass Entry extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['renderChangelogFile', 'renderSampleFile', 'renderFileBrowser', 'renderFile']);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { lastSeenChangelogHeader, isAuthenticated } = this.props;\r\n\r\n    const changelogFile = parseOrg(raw('../../../changelog.org'));\r\n    const firstHeaderTitle = changelogFile.getIn(['headers', 0, 'titleLine', 'rawTitle']);\r\n    if (\r\n      isAuthenticated &&\r\n      !!lastSeenChangelogHeader &&\r\n      firstHeaderTitle !== lastSeenChangelogHeader\r\n    ) {\r\n      this.props.base.setHasUnseenChangelog(true);\r\n    }\r\n    this.props.base.setLastSeenChangelogHeader(firstHeaderTitle);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.shouldPromptWhenLeaving()\r\n      ? (window.onbeforeunload = () => true)\r\n      : (window.onbeforeunload = undefined);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.onbeforeunload = undefined;\r\n  }\r\n\r\n  renderChangelogFile() {\r\n    return (\r\n      <OrgFile\r\n        staticFile=\"changelog\"\r\n        shouldDisableDirtyIndicator={true}\r\n        shouldDisableActions={true}\r\n        shouldDisableSyncButtons={false}\r\n        parsingErrorMessage={\r\n          \"The contents of changelog.org couldn't be loaded. You probably forgot to set the environment variable - see the Development section of README.org for details!\"\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  renderSampleFile() {\r\n    return (\r\n      <OrgFile\r\n        staticFile=\"sample\"\r\n        shouldDisableDirtyIndicator={true}\r\n        shouldDisableActionDrawer={false}\r\n        shouldDisableSyncButtons={true}\r\n        parsingErrorMessage={\r\n          \"The contents of sample.org couldn't be loaded. You probably forgot to set the environment variable - see the Development section of README.org for details!\"\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  renderFileBrowser({\r\n    match: {\r\n      params: { path = '' },\r\n    },\r\n  }) {\r\n    if (!!path) {\r\n      path = '/' + path;\r\n    }\r\n\r\n    return <FileBrowser path={path} />;\r\n  }\r\n\r\n  renderFile({\r\n    match: {\r\n      params: { path },\r\n    },\r\n  }) {\r\n    if (!!path) {\r\n      path = '/' + path;\r\n    }\r\n\r\n    return (\r\n      <OrgFile\r\n        path={path}\r\n        shouldDisableDirtyIndicator={false}\r\n        shouldDisableActionDrawer={false}\r\n        shouldDisableSyncButtons={false}\r\n      />\r\n    );\r\n  }\r\n\r\n  shouldPromptWhenLeaving() {\r\n    return this.props.location.pathname.startsWith('/file/') && this.props.isDirty;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isAuthenticated,\r\n      loadingMessage,\r\n      fontSize,\r\n      activeModalPage,\r\n      pendingCapture,\r\n      location: { pathname },\r\n    } = this.props;\r\n\r\n    const pendingCapturePath = !!pendingCapture && `/file${pendingCapture.get('capturePath')}`;\r\n    const shouldRedirectToCapturePath = pendingCapturePath && pendingCapturePath !== pathname;\r\n\r\n    const className = classNames('entry-container', {\r\n      'entry-container--large-font': fontSize === 'Large',\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        <HeaderBar />\r\n\r\n        <LoadingIndicator message={loadingMessage} />\r\n\r\n        <Prompt\r\n          when={this.shouldPromptWhenLeaving()}\r\n          message={() => 'You have unpushed changes - are you sure you want to leave this page?'}\r\n        />\r\n\r\n        {activeModalPage === 'changelog' ? (\r\n          this.renderChangelogFile()\r\n        ) : isAuthenticated ? (\r\n          ['keyboard_shortcuts_editor', 'settings', 'capture_templates_editor', 'sample'].includes(\r\n            activeModalPage\r\n          ) ? (\r\n            <Fragment>\r\n              {activeModalPage === 'settings' && <Settings />}\r\n              {activeModalPage === 'keyboard_shortcuts_editor' && <KeyboardShortcutsEditor />}\r\n              {activeModalPage === 'capture_templates_editor' && <CaptureTemplatesEditor />}\r\n              {activeModalPage === 'sample' && this.renderSampleFile()}\r\n            </Fragment>\r\n          ) : (\r\n            <Switch>\r\n              {shouldRedirectToCapturePath && <Redirect to={pendingCapturePath} />}\r\n              <Route path=\"/privacy-policy\" exact component={PrivacyPolicy} />\r\n              <Route path=\"/file/:path+\" render={this.renderFile} />\r\n              <Route path=\"/files/:path*\" render={this.renderFileBrowser} />\r\n              <Redirect to=\"/files\" />\r\n            </Switch>\r\n          )\r\n        ) : (\r\n          <Switch>\r\n            <Route path=\"/privacy-policy\" exact component={PrivacyPolicy} />\r\n            <Route path=\"/sample\" exact={true} render={this.renderSampleFile} />\r\n            <Route path=\"/sign_in\" exact={true} component={SyncServiceSignIn} />\r\n            <Route path=\"/\" exact={true} component={Landing} />\r\n            <Redirect to=\"/\" />\r\n          </Switch>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    loadingMessage: state.base.get('loadingMessage'),\r\n    isAuthenticated: state.syncBackend.get('isAuthenticated'),\r\n    fontSize: state.base.get('fontSize'),\r\n    lastSeenChangelogHeader: state.base.get('lastSeenChangelogHeader'),\r\n    activeModalPage: state.base.get('modalPageStack', List()).last(),\r\n    pendingCapture: state.org.present.get('pendingCapture'),\r\n    isDirty: state.org.present.get('isDirty'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(Entry)\r\n);\r\n","import React, { PureComponent } from 'react';\r\nimport { Provider } from 'react-redux';\r\nimport Store from './store';\r\nimport {\r\n  readInitialState,\r\n  loadSettingsFromConfigFile,\r\n  subscribeToChanges,\r\n  persistField,\r\n  getPersistedField,\r\n} from './util/settings_persister';\r\nimport runAllMigrations from './migrations';\r\nimport parseQueryString from './util/parse_query_string';\r\nimport { BrowserRouter as Router } from 'react-router-dom';\r\n\r\nimport { DragDropContext } from 'react-beautiful-dnd';\r\n\r\nimport { reorderCaptureTemplate } from './actions/capture';\r\nimport { reorderTags, reorderPropertyList } from './actions/org';\r\nimport { signOut } from './actions/sync_backend';\r\nimport { setDisappearingLoadingMessage } from './actions/base';\r\n\r\nimport createDropboxSyncBackendClient from './sync_backend_clients/dropbox_sync_backend_client';\r\nimport createGoogleDriveSyncBackendClient from './sync_backend_clients/google_drive_sync_backend_client';\r\n\r\nimport './base.css';\r\n\r\nimport Entry from './components/Entry';\r\n\r\nimport _ from 'lodash';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class App extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    runAllMigrations();\r\n\r\n    const initialState = readInitialState();\r\n\r\n    window.initialHash = window.location.hash.substring(0);\r\n    const hashContents = parseQueryString(window.location.hash);\r\n    const authenticatedSyncService = getPersistedField('authenticatedSyncService', true);\r\n    let client = null;\r\n\r\n    if (!!authenticatedSyncService) {\r\n      switch (authenticatedSyncService) {\r\n        case 'Dropbox':\r\n          const dropboxAccessToken = hashContents.access_token;\r\n          if (dropboxAccessToken) {\r\n            client = createDropboxSyncBackendClient(dropboxAccessToken);\r\n            initialState.syncBackend = Map({\r\n              isAuthenticated: true,\r\n              client,\r\n            });\r\n            persistField('dropboxAccessToken', dropboxAccessToken);\r\n            window.location.hash = '';\r\n          } else {\r\n            const persistedDropboxAccessToken = getPersistedField('dropboxAccessToken', true);\r\n            if (!!persistedDropboxAccessToken) {\r\n              client = createDropboxSyncBackendClient(persistedDropboxAccessToken);\r\n              initialState.syncBackend = Map({\r\n                isAuthenticated: true,\r\n                client,\r\n              });\r\n            }\r\n          }\r\n          break;\r\n        case 'Google Drive':\r\n          client = createGoogleDriveSyncBackendClient();\r\n          initialState.syncBackend = Map({\r\n            isAuthenticated: true,\r\n            client,\r\n          });\r\n          break;\r\n        default:\r\n      }\r\n    }\r\n\r\n    const queryStringContents = parseQueryString(window.location.search);\r\n    const { captureFile, captureTemplateName, captureContent } = queryStringContents;\r\n    if (!!captureFile && !!captureTemplateName) {\r\n      const capturePath = captureFile.startsWith('/') ? captureFile : `/${captureFile}`;\r\n      const customCaptureVariables = Map(\r\n        Object.entries(queryStringContents)\r\n          .map(([key, value]) => {\r\n            const CUSTOM_VARIABLE_PREFIX = 'captureVariable_';\r\n            if (key.startsWith(CUSTOM_VARIABLE_PREFIX)) {\r\n              return [key.substring(CUSTOM_VARIABLE_PREFIX.length), value];\r\n            }\r\n\r\n            return null;\r\n          })\r\n          .filter(item => !!item)\r\n      );\r\n      initialState.org.present = initialState.org.present.set(\r\n        'pendingCapture',\r\n        Map({\r\n          capturePath,\r\n          captureTemplateName,\r\n          captureContent,\r\n          customCaptureVariables,\r\n        })\r\n      );\r\n    }\r\n\r\n    this.store = Store(initialState);\r\n    this.store.subscribe(subscribeToChanges(this.store));\r\n\r\n    if (!!client) {\r\n      client.isSignedIn().then(isSignedIn => {\r\n        if (isSignedIn) {\r\n          loadSettingsFromConfigFile(this.store.dispatch, this.store.getState);\r\n        } else {\r\n          this.store.dispatch(signOut());\r\n        }\r\n      });\r\n    } else {\r\n      if (!!this.store.getState().org.present.get('pendingCapture')) {\r\n        this.store.dispatch(\r\n          setDisappearingLoadingMessage(\r\n            `You need to sign in before you can use capture templates`,\r\n            5000\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n    _.bindAll(this, ['handleDragEnd']);\r\n  }\r\n\r\n  handleDragEnd(result) {\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n\r\n    if (result.type === 'CAPTURE-TEMPLATE') {\r\n      this.store.dispatch(reorderCaptureTemplate(result.source.index, result.destination.index));\r\n    } else if (result.type === 'TAG') {\r\n      this.store.dispatch(reorderTags(result.source.index, result.destination.index));\r\n    } else if (result.type === 'PROPERTY-LIST') {\r\n      this.store.dispatch(reorderPropertyList(result.source.index, result.destination.index));\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <DragDropContext onDragEnd={this.handleDragEnd}>\r\n        <Router>\r\n          <Provider store={this.store}>\r\n            <div className=\"App\">\r\n              <Entry />\r\n            </div>\r\n          </Provider>\r\n        </Router>\r\n      </DragDropContext>\r\n    );\r\n  }\r\n}\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}