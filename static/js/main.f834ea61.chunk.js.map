{"version":3,"sources":["components/HeaderBar/org-web.svg","components/SyncServiceSignIn/dropbox.svg","components/SyncServiceSignIn/google_drive.png","middleware/google_analytics_logging.js","actions/base.js","lib/timestamps.js","lib/export_org.js","lib/capture_template_substitution.js","lib/id_generator.js","lib/org_utils.js","lib/sample_capture_templates.js","actions/org.js","middleware/live_sync.js","middleware/sync_on_becoming_visible.js","actions/capture.js","util/settings_persister.js","reducers/base.js","lib/parse_org.js","reducers/org.js","reducers/capture.js","reducers/index.js","reducers/sync_backend.js","store.js","migrations/index.js","migrations/migrate_access_token_to_dropbox_access_token.js","migrations/migrate_store_in_dropbox_to_store_in_sync_backend.js","util/parse_query_string.js","actions/sync_backend.js","sync_backend_clients/dropbox_sync_backend_client.js","sync_backend_clients/google_drive_sync_backend_client.js","components/PrivacyPolicy/index.js","components/HeaderBar/index.js","components/Landing/index.js","components/FileBrowser/index.js","components/LoadingIndicator/index.js","components/OrgFile/components/AttributedString/components/TablePart/TableActionDrawer/index.js","components/OrgFile/components/AttributedString/components/TablePart/index.js","lib/color.js","components/UI/Checkbox/index.js","components/OrgFile/components/AttributedString/components/ListPart/ListActionDrawer/index.js","components/OrgFile/components/AttributedString/components/ListPart/index.js","components/OrgFile/components/AttributedString/components/TimestampPart/index.js","components/OrgFile/components/AttributedString/index.js","components/OrgFile/components/TitleLine/index.js","components/OrgFile/components/HeaderContent/components/PlanningItems/index.js","components/OrgFile/components/HeaderContent/components/PropertyListItems/index.js","components/OrgFile/components/HeaderContent/index.js","components/OrgFile/components/Header/components/HeaderActionDrawer/index.js","components/OrgFile/components/Header/index.js","components/OrgFile/components/HeaderList/index.js","components/OrgFile/components/ActionDrawer/components/ActionButton/index.js","components/OrgFile/components/ActionDrawer/index.js","components/UI/Switch/index.js","components/UI/Drawer/index.js","components/OrgFile/components/CaptureModal/index.js","components/OrgFile/components/SyncConfirmationModal/index.js","components/OrgFile/components/TagsEditorModal/index.js","components/UI/TabButtons/index.js","components/OrgFile/components/TimestampEditorModal/components/TimestampEditor/index.js","components/OrgFile/components/TimestampEditorModal/index.js","components/OrgFile/components/PropertyListEditorModal/index.js","components/OrgFile/components/AgendaModal/components/AgendaDay/index.js","components/OrgFile/components/AgendaModal/index.js","lib/keybindings.js","components/OrgFile/index.js","components/Settings/index.js","components/KeyboardShortcutsEditor/components/ShortcutRow/index.js","components/KeyboardShortcutsEditor/index.js","components/CaptureTemplatesEditor/components/CaptureTemplate/index.js","components/CaptureTemplatesEditor/index.js","components/SyncServiceSignIn/index.js","components/Entry/index.js","App.js","registerServiceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","google_analytics_logging","store","next","action","type","payload","Object","objectWithoutProperties","eventFieldsToRedact","SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING","AUTHENTICATE","DISPLAY_FILE","forEach","field","objectSpread","defineProperty","ga","JSON","stringify","setLoadingMessage","loadingMessage","hideLoadingMessage","setIsLoading","isLoading","setDisappearingLoadingMessage","delay","dispatch","setTimeout","setLastViewedFile","lastViewedPath","lastViewedContents","loadStaticFile","staticFile","getState","org","present","get","displayFile","changelog","sample","unloadStaticFile","stopDisplayingFile","base","setFontSize","newFontSize","setBulletStyle","newBulletStyle","setShouldTapTodoToAdvance","newShouldTapTodoToAdvance","setAgendaDefaultDeadlineDelayUnit","newAgendaDefaultDeadlineDelayUnit","setAgendaDefaultDeadlineDelayValue","newAgendaDefaultDeadlineDelayValue","setShouldLiveSync","shouldLiveSync","setShouldSyncOnBecomingVisibile","shouldSyncOnBecomingVisibile","setShouldStoreSettingsInSyncBackend","newShouldStoreSettingsInSyncBackend","client","syncBackend","deleteFile","catch","doesFileNotExist","error","alert","concat","deleteFileByNameAndParent","window","previousSettingsFileContents","setHasUnseenChangelog","newHasUnseenChangelog","setLastSeenChangelogHeader","newLastSeenChangelogHeader","setCustomKeybinding","keybindingName","keybinding","restoreBaseSettings","newSettings","pushModalPage","modalPage","popModalPage","clearModalStack","activatePopup","popupType","data","closePopup","renderAsText","timestamp","_timestamp$toJS","toJS","isActive","year","month","day","dayName","startHour","startMinute","endHour","endMinute","repeaterType","repeaterValue","repeaterUnit","delayType","delayValue","delayUnit","timestampText","getCurrentTimestamp","_ref","arguments","length","undefined","_ref$isActive","_ref$withStartTime","withStartTime","time","Date","formatDate","getCurrentTimestampAsText","dateForTimestamp","_timestamp$toJS2","timestampString","padStart","parseDate","addTimestampUnitToDate","date","numUnits","timestampUnit","h","addHours","d","addDays","w","addWeeks","m","addMonths","y","addYears","formattedAttributedStringText","parts","map","part","getIn","join","attributedStringToRawText","prevParts","unshift","zip","linkPart","_ref2","slicedToArray","prevPart","text","tablePart","rowHeights","row","Math","max","apply","toConsumableArray","cell","_","countBy","numColumns","size","columnWidths","times","columnIndex","content","lineLengths","split","line","trim","dropRight","flatten","rowIndex","rowHeight","contentRows","lineIndex","formattedLineLengths","padCount","repeat","contentRow","separator","columnWidth","tablePartToRawText","listPart","bulletCharacter","previousNumber","item","optionalLeadingSpace","titleText","contentText","indentedContentText","listItemText","number","forceNumber","stateCharacter","checked","unchecked","partial","listPartToRawText","timestampPartToRawText","console","optionalNewlinePrefix","includes","endsWith","capture_template_substitution","templateString","customVariables","Map","substitutions","%t","%T","%u","%U","entrySeq","key","value","substitutedString","entries","_ref3","_ref4","formatString","replace","RegExp","cursorIndex","indexOf","id_generator","nextId","indexOfHeaderWithId","headers","headerId","findIndex","header","headerWithId","subheadersOfHeaderWithId","headerIndex","afterHeaders","slice","nextSiblingHeaderIndex","siblingHeader","numSubheadersOfHeaderWithId","parentIdOfHeaderWithId","parentHeader","reverse","find","previousHeader","isHeaderVisible","parentHeaderId","openDirectParent","state","i","directParentIdOfHeaderWithId","parentHeaderIndex","setIn","headerWithPath","headerPath","firstHeader","first","skip","tablePartContainsCellId","cellId","some","headerThatContainsTableCellId","doesAttributedStringContainTableCellId","filter","pathAndPartOfTimestampItemWithIdInAttributedString","timestampId","partIndex","path","timestampPart","itemIndex","pathAndPart","result","cellIndex","pathAndPartOfListContainingItemIdInAttributedString","itemId","listPartContainsItemId","pathAndPartOfListItemWithIdInHeaders","listItemId","pathAndPartOfListItemWithIdInAttributedString","listItemPart","pathAndPartOfTableContainingCellIdInHeaders","pathAndPartOfTableContainingCellIdInAttributedString","updateTableContainingCellId","updaterCallbackGenerator","_pathAndPartOfTableCo","rowIndexContainingCellId","columnIndexContainingCellId","updateIn","updateListContainingListItemId","_pathAndPartOfListCon","pathAndPartOfListContainingItemIdInHeaders","itemIndexContainingId","updateContentsWithListItemAddition","listItem","last","insertIdx","insert","set","generateId","List","fromJS","id","items","numberTerminatorCharacter","isOrdered","update","push","timestampWithIdInAttributedString","todoKeywordSetForKeyword","todoKeywordSets","keyword","keywordSet","contains","description","headerPaths","iconName","isAvailableInAllOrgFiles","letter","orgFilesWhereAvailable","shouldPrepend","template","isSample","contents","setLastSyncAt","lastSyncAt","ActionTypes","CLEAR_HISTORY","unfocusHeader","sync","_ref$forceAction","forceAction","_ref$successMessage","successMessage","_ref$shouldSuppressMe","shouldSuppressMessages","setOrgFileErrorMessage","getFileContentsAndMetadata","then","lastModifiedAt","isDirty","lastServerModifiedAt","isAfter","updateFile","fileConfigLines","linesBeforeHeadings","configContent","todoKeywordSet","nestingLevel","titleLine","todoKeyword","rawTitle","tags","tag","planningItems","planningItemsContent","planningItem","trimRight","propertyListItems","propertyListItem","property","rawDescription","startsWith","exportOrg","setDirty","addSeconds","toString","applyOpennessState","openHeader","toggleHeaderOpened","selectHeader","setSelectedTableCellId","setSelectedListItemId","selectHeaderAndOpenParents","advanceTodoState","dirtying","enterEditMode","editModeType","exitEditMode","updateHeaderTitle","newRawTitle","updateHeaderDescription","newRawDescription","addHeader","selectNextSiblingHeader","addHeaderAndEdit","selectNextVisibleHeader","selectPreviousVisibleHeader","removeHeader","moveHeaderUp","moveHeaderDown","moveHeaderLeft","moveHeaderRight","moveSubtreeLeft","moveSubtreeRight","focusHeader","noOp","addNewTableRow","removeTableRow","addNewTableColumn","removeTableColumn","moveTableRowDown","moveTableRowUp","moveTableColumnLeft","moveTableColumnRight","updateTableCellValue","newValue","insertCapture","templateId","capture","sampleCaptureTemplates","clearPendingCapture","insertPendingCapture","pendingCapture","templateName","captureContent","customCaptureVariables","history","pushState","location","pathname","_substituteTemplateVa","substituteTemplateVariables","_substituteTemplateVa2","substitutedTemplate","initialCursorIndex","substring","advanceCheckboxState","updateListTitleValue","updateListContentsValue","addNewListItem","selectNextSiblingListItem","addNewListItemAndEdit","removeListItem","moveListItemUp","moveListItemDown","moveListItemLeft","moveListItemRight","moveListSubtreeLeft","moveListSubtreeRight","setHeaderTags","reorderTags","fromIndex","toIndex","reorderPropertyList","updateTimestampWithId","newTimestamp","updatePlanningItemTimestamp","planningItemIndex","addNewPlanningItem","planningType","updatePropertyListItems","newPropertyListItems","message","live_sync","debouncedDispatchSync","debounce","sync_on_becoming_visible","addEventListener","addNewEmptyCaptureTemplate","updateTemplateFieldPathValue","fieldPath","addNewTemplateOrgFileAvailability","removeTemplateOrgFileAvailability","orgFileAvailabilityIndex","addNewTemplateHeaderPath","removeTemplateHeaderPath","headerPathIndex","deleteTemplate","restoreCaptureSettings","reorderCaptureTemplate","isLocalStorageAvailable","localStorage","setItem","getItem","e","debouncedPushConfigToSyncBackend","syncBackendClient","createFile","maxWait","persistableFields","category","name","shouldStoreInConfig","default","getFieldsToPersist","fields","depreacted","getConfigFileContents","fieldsToPersist","fromPairs","readInitialState","initialState","past","future","parse","templates","opennessState","opennessStateJSONString","readOpennessState","loadSettingsFromConfigFile","fileContentsPromise","getFileContents","getFileContentsByNameAndParent","configFileContents","config","_error","subscribeToChanges","settingsFileContents","currentFilePath","openHeaderPaths","getOpenHeaderPaths","openedHeaders","_loop","_i","title","subheaders","openSubheaderPaths","openedSubheaderPath","persistField","getPersistedField","nullable","applyCategorySettingsFromConfig","markupAndCookieRegex","timestampRegex","timestampFromRegexMatch","match","partIndices","_partIndices$map","_partIndices$map2","typeBracket","timeStart","timeEnd","firstDelayRepeatType","firstDelayRepeatValue","firstDelayRepeatUnit","secondDelayRepeatType","secondDelayRepeatValue","secondDelayRepeatUnit","parseMarkupAndCookies","rawText","_ref5","_ref5$shouldAppendNew","shouldAppendNewline","matches","excludeCookies","exec","uri","index","percentCookieMatch","percentage","fractionCookieMatch","fraction","markupType","~","*","/","+","=","markupPrefixLength","firstTimestamp","range","secondTimestamp","lineParts","startIndex","trailingText","parseTable","tableLines","table","columnProperties","lastRow","lineCells","substr","cellContents","rawContents","maxNumColumns","parseRawText","_ref6$excludeContentE","excludeContentElements","lines","LIST_HEADER_REGEX","currentListHeaderNestingLevel","rawLineParts","numLeadingSpaces","processedLineParts","linePart","takeWhile","contentLines","checkboxState","isCheckbox"," ","X","-","newListItem","lastIndex","parseDescriptionPrefixElements","planningItemsParse","singlePlanningItemRegex","concatRegexes","optionalSinglePlanningItemRegex","planningRegex","planningMatch","planningTypeIndex","strippedDescription","_parsePlanningItems","propertyListParse","propertiesLineIndex","endLineIndex","parsePropertyList","defaultKeywordSets","keywords","completedKeywords","parseTitleLine","flatMap","titleParts","possibleTags","test","newHeaderWithTitle","opened","_len","regexes","Array","_key","reduce","prev","curr","parseOrg","fileContents","keywordTokens","pipeIndex","configLine","_parseDescriptionPref2","updateCookiesInAttributedStringWithChildCompletionStates","completionStates","doneCount","isDone","totalCount","floor","updateCookiesOfHeaderWithId","directChildren","subheader","updateCookiesOfParentOfHeaderWithId","currentTodoState","currentTodoSet","newStateIndex","newTodoState","indexedPlanningItemsWithRepeaters","currentDate","newDate","isBefore","applyRepeater","lastRepeatTimestamp","newLastRepeatValue","nextVisibleHeader","nextVisibleHeaderAfterIndex","previousVisibleHeader","previousVisibleHeaderAfterIndex","fileOpennessState","openHeaderPath","openHeaderWithPath","maxNestingLevel","firstTitle","rest","take","takeLast","updateDescriptionOfHeaderContainingTableCell","selectedTableCellId","rows","newEmptyTableRowLikeRows","_rowIndex","colIndex","isTopLevelTarget","newHeader","_parseDescriptionPref","newHeaderFromText","numSubheaders","newIndex","newCheckboxState","updateParentListCheckboxes","itemPath","parentListItemPath","parentListItem","has","childrenCheckedStates","checkboxItem","every","childCompletionStates","updateDescriptionOfHeaderContainingListItem","selectedListItemId","newItem","containingHeader","headerThatContainsListItemId","delete","selectedListItem","selectedListItemIndex","partOfPath","parentListItemWithIdInHeaders","_item","_pathAndPart2","_pathAndPart3","propertyListItemIndex","plistPathAndPart","indexOfTemplateWithId","captureTemplates","applyCaptureSettingsFromConfig","combineReducers","stack","pop","signOut","listing","directoryListing","hasMore","additionalSyncBackendState","setCurrentFileBrowserDirectoryListing","currentFileBrowserDirectoryListing","isLoadingMore","setIsLoadingMoreDirectoryListing","undoable","parsedFile","isOpened","openParentsOfHeader","newTitleLine","nextSibling","numHeadersToRemove","previousSiblingIndex","indexOfPreviousSibling","nextSiblingIndex","nextSiblingSubheaders","previousParentHeaderId","counter","prevSiblingItemIndex","prevSiblingItemContentsPath","childrenListParts","selectedHeaderId","splice","newPlanningItem","includeAction","linearizeHistory","templateIndex","orgFiles","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","src_store","createStore","rootReducer","applyMiddleware","thunk","googleAnalyticsLogger","liveSync","syncOnBecomingVisible","migrations","accessToken","removeItem","migrateAccessTokenToDropboxAccessToken","shouldStoreSettingsInDropbox","migrateStoreInDropboxToStoreInSyncBackend","parseQueryString","str","ret","create","param","shift","val","decodeURIComponent","isArray","token","gapi","getToken","google","accounts","oauth2","revoke","setToken","reload","getDirectoryListing","log","status","process","authURL","Dropbox","clientId","fetch","getAuthenticationUrl","origin","loadMoreDirectoryListing","getMoreDirectoryListing","extendedListing","pushBackup","pathOrFileId","duplicateFile","fileName","downloadFile","dropbox_sync_backend_client","dropboxClient","transformDirectoryListing","entry","isDirectory","path_display","uploadFile","Promise","resolve","reject","filesUpload","mode",".tag","autorename","filesDownload","response","reader","FileReader","server_modified","readAsText","fileBlob","isSignedIn","filesListFolder","has_more","cursor","filesListFolderContinue","filesDelete","google_drive_sync_backend_client","getAPIClient","isInited","isIniting","afterInitCallbacks","load","init","apiKey","discoveryDocs","asyncToGenerator","regenerator_default","a","mark","_callee","googleDriveAccessTokenString","googleDriveAccessToken","wrap","_context","initTokenClient","client_id","scope","callback","requestAccessToken","prompt","stop","handleGoogleDriveClientLoad","getFiles","directoryId","nextPageToken","fileListPromise","drive","files","list","pageSize","q","pageToken","mimeType","currentDirectoryId","fileParentPromise","fileId","parents","rootFolderIdPromise","rootFolderId","all","parentId","directoryParentId","fileIdByNameAndParent","method","Authorization","auth","access_token","body","alt","escape","errors","reason","fileModifiedTimePromise","modifiedTime","_ref6","fileNameCallback","getResponse","newFileName","backupFileId","makeCopy","copy","copyResponse","listResponse","PrivacyPolicy","react_default","createElement","className","HeaderBar","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","bindAll","assertThisInitialized","_this$props","syncBackendType","directoryPath","pathParts","parentDirectoryName","parentPath","Link","to","filePath","src","logo","width","height","onClick","handleSettingsSubPageBackClick","activeModalPage","renderSettingsSubPageBackButton","getPathRoot","renderLogo","renderFileBrowserBackButton","renderOrgFileBackButton","renderSampleFileBackButton","renderSignInBackButton","titleContainerWithText","isUndoEnabled","undo","_this$props2","isAuthenticated","hasUnseenChangelog","handleModalPageDoneClick","undoIconClassName","classNames","header-bar__actions__item--disabled","settingsIconClassName","settings-icon--has-unseen-changelog","href","target","rel","react","handleUndoClick","handleHelpClick","handleSettingsClick","header-bar--with-logo","renderBackButton","renderTitle","renderActions","PureComponent","withRouter","connect","bindActionCreators","baseActions","undoActions","Landing","syncBackendActions","useEffect","isTopLevelDirectory","getParentDirectoryPath","file","isBackupFile","isOrgFile","isSettingsFile","iconClass","fa-folder","file-browser__file-list__icon--directory","fa-file","file-browser__file-list__icon--not-org","fa-copy","fa-cogs","LoadingIndicator","_useState","useState","_useState2","shouldRenderIndicator","setShouldRenderIndicator","_useState3","_useState4","lastMessage","setLastMessage","handleClick","style","opacity","spring","stiffness","react_motion","onRest","TableActionDrawer","_ref$subPartDataAndHa","subPartDataAndHandlers","onEnterTableEditMode","onAddNewTableRow","onRemoveTableRow","onAddNewTableColumn","onRemoveTableColumn","TablePart","rawCellValues","generateCellValueMap","shouldIgnoreBlur","prevProps","_this$props$subPartDa","onTableCellValueUpdate","inTableEditMode","setState","_this2","onTableCellSelect","_this3","onExitTableEditMode","event","cellValue","insertionIndex","textarea","selectionStart","selectionEnd","focus","_this4","_this$props$subPartDa2","shouldDisableActions","isTableSelected","isCellSelected","table-part__cell--selected","handleCellSelect","autoFocus","onBlur","handleTextareaBlur","onChange","handleCellChange","ref","handleTextareaRef","handleInsertTimestamp","AttributedString","react_collapse_lib","interpolateColors","colorA","colorB","interpolationFactor","r","parseInt","g","b","rgbaObject","rgbaString","rgba","Checkbox","uncheckedColor","checkedColor","checkboxStyle","colorFactor","backgroundColor","ListActionDrawer","onEnterListTitleEditMode","onEnterListContentsEditMode","onAddNewListItem","onRemoveListItem","ListPart","listTitleValues","generateListTitleValueMap","listContentsValues","generateListContentsValueMap","onListTitleValueUpdate","onListContentsValueUpdate","inListTitleEditMode","inListContentsEditMode","_this$state","prevSelectedListItemId","onListItemSelect","onCheckboxClick","onExitListTitleEditMode","listTitleValue","listContentsValue","_this5","_this$state2","isItemSelected","lineContainerClass","list-part__not_checkbox-container","list-part__checkbox-container","list-part__item--selected","handleListItemSelect","handleCheckboxClick","handleListTitleChange","handleInsertTimestampListTitle","handleListContentsChange","handleInsertTimestampListContents","renderContent","TimestampPart","onTimestampClick","attributed-string__cookie-part--complete","TablePart_TablePart","ListPart_ListPart","TitleLine","titleValue","calculateRawTitle","containerWidth","containerDiv","offsetWidth","storeContainerWidth","inEditMode","div","span","titleSpan","hasContent","isSelected","shouldTapTodoToAdvance","stopPropagation","newTitle","lastCharacter","_this$props3","color","shouldDisableExplicitWidth","titleStyle","wordBreak","handleTitleClick","handleRef","toLowerCase","handleTodoClick","handleTitleChange","handleTitleFieldClick","handleTitleSpanRef","handleTimestampClick","toSet","toList","orgActions","PlanningItems","PropertyListItems","onEdit","isDrawerCollapsed","setIsDrawerCollapsed","HeaderContent","descriptionValue","calculateRawDescription","planningItemsText","propertyListItemsText","descriptionText","min","handleDescriptionChange","onFocus","scrollTop","scrollHeight","PlanningItems_PlanningItems","handlePlanningItemTimestampClick","handlePropertyListEdit","handleTableCellSelect","handleExitTableEditMode","handleTableCellValueUpdate","handleEnterTableEditMode","handleAddNewTableRow","handleRemoveTableRow","handleAddNewTableColumn","handleRemoveTableColumn","handleEnterListTitleEditMode","handleExitListTitleEditMode","handleListTitleValueUpdate","handleEnterListContentsEditMode","onExitListContentsEditMode","handleExitListContentsEditMode","handleListContentsValueUpdate","handleAddNewListItem","handleRemoveListItem","HeaderActionDrawer","onEnterTitleEditMode","onEnterDescriptionEditMode","onTagsClick","isFocused","onUnfocus","onAddNewHeader","onDeadlineClick","onScheduledClick","iconWithFFClickCatcher","Header","SWIPE_ACTION_ACTIVATION_DISTANCE","FREE_DRAG_ACTIVATION_DISTANCE","isDraggingFreely","dragStartX","dragStartY","currentDragX","isPlayingRemoveAnimation","heightBeforeRemove","onRef","dragX","dragY","closest","abs","swipeDistance","offsetHeight","handleDragStart","clientX","clientY","handleDragMove","handleDragEnd","handleDragCancel","changedTouches","classList","existingDeadlinePlanningItemIndex","handleDeadlineAndScheduledClick","bulletStyle","focusedHeader","indentLevel","_this$state3","paddingLeft","marginLeft","heightFactor","header--selected","header--removing","handleRest","interpolatedStyle","swipedDistance","isLeftActionActivated","isRightActionActivated","disabledColor","leftActivatedColor","rightActivatedColor","leftSwipeActionContainerStyle","backgroundColorFactor","rightSwipeActionContainerStyle","leftIconStyle","display","rightIconStyle","headerStyle","handleHeaderClick","onMouseDown","handleMouseDown","onMouseMove","handleMouseMove","onMouseUp","handleMouseUp","onMouseOut","handleMouseOut","onTouchStart","handleTouchStart","onTouchMove","handleTouchMove","onTouchEnd","handleTouchEnd","onTouchCancel","handleTouchCancel","leftInterpolatedStyle","leftStyle","rightInterpolatedStyle","rightStyle","components_TitleLine","springConfig","marginRight","HeaderActionDrawer_HeaderActionDrawer","handleEnterTitleEditMode","handleEnterDescriptionEditMode","handleShowTagsModal","handleFocus","handleUnfocus","handleAddNewHeader","handleDeadlineClick","handleScheduledClick","components_HeaderContent","HeaderList","headerRefs","selectedHeaderDiv","boundingRectangle","getBoundingClientRect","viewportHeight","document","documentElement","clientHeight","top","bottom","scrollIntoView","focusedHeaderId","headerRenderData","displayed","toArray","headerRenderDatum","previousRenderDatum","followingHeaders","followingHeaderIndex","followingHeader","focusedHeaderIndex","headerColors","displayedHeaderRenderData","header-list-container--focused","components_Header","handleHeaderRef","ActionButton","isDisabled","_classNames","subIconName","shouldRotateSubIcon","additionalClassName","tooltip","shouldSpinSubIcon","fas","fa-lg","subIconClassName","action-drawer__btn__sub-icon--rotated","fa-spin","isFocusedHeaderActive","captureActions","shouldDisableSyncButtons","isDisplayingArrowButtons","setIsDisplayingArrowButtons","isDisplayingCaptureButtons","setIsDisplayingCaptureButtons","querySelector","paddingBottom","mainArrowButton","useRef","mainArrowButtonBoundingRect","useMemo","current","handleUpClick","handleDownClick","handleLeftClick","handleRightClick","handleMoveSubtreeLeftClick","handleMoveSubtreeRightClick","getAvailableCaptureTemplates","availablePath","handleMainArrowButtonClick","handleMainCaptureButtonClick","ActionButton_ActionButton","baseArrowButtonStyle","boxShadow","centerXOffset","screen","x","animatedStyles","topRowYOffset","bottomRowYOffset","firstColumnXOffset","secondColumnXOffset","subIconNameStr","tooltipUpStr","tooltipDownStr","tooltipLeftStr","tooltipRightStr","left","right","renderMovementButtons","availableCaptureTemplates","baseCaptureButtonStyle","position","zIndex","mainButtonStyle","animatedStyle","renderCaptureButtons","UI_Switch","isEnabled","onToggle","enabledColor","switchStyle","grabberStyle","Drawer","children","shouldIncludeCloseButton","onClose","isVisible","setIsVisible","dragOffsetY","setDragOffsetY","useLayoutEffect","initialClientY","innerContainer","innerContainerHeight","handleInnerContainerClick","handleClose","targetTouches","isScrollingDown","preventDefault","handleTouchEndOrCancel","removeEventListener","outerClassName","drawer-outer-container--visible","innerStyle","offsetY","innerHeight","transform","CaptureModal","onCapture","_useMemo","_useMemo2","targetHeader","textareaValue","setTextareaValue","setShouldPrepend","capture-modal-header-path--top-level","SyncConfirmationModal","onPull","onPush","onCancel","distanceInWordsToNow","TagsEditorModal","allTags","prevTags","currentTags","lastTextfield","tagIndex","newTag","headerTags","react_beautiful_dnd_esm","droppableId","provided","snapshot","assign","innerRef","droppableProps","draggableId","tag-container--dragging","isDragging","draggableProps","handleTagChange","textfield","handleRemoveTag","dragHandleProps","placeholder","handleAddNewTag","all-tags__tag--in-use","handleExistingTagClick","TabButtons","buttons","selectedButton","useEqualWidthTabs","onSelect","handleButtonClick","buttonName","containerClassName","tab-buttons--equal-width-tabs","gridTemplateColumns","tab-buttons__btn--selected","TimestampEditor","_formatDate$split","_formatDate$split2","newYear","newMonth","newDay","newDayName","startOrEnd","_this2$props","hourKey","minuteKey","_formatDate$split3","_formatDate$split4","hour","minute","_this3$props","_this4$props","_event$target$value$s","_event$target$value$s2","newRepeaterType","_this$props4","_this$props5","newRepeaterUnit","_this$props6","_this$props7","_this$props8","newDelayType","_this$props9","_this$props10","newDelayUnit","_this$props11","label","timeKey","showRemoveButton","handleTimeChange","handleRemoveTime","handleAddTime","_this$props$timestamp","handleRepeaterTypeChange","handleRepeaterValueChange","handleRepeaterUnitChange","handleRemoveRepeater","handleAddRepeater","_this$props$timestamp2","handleDelayTypeChange","handleDelayValueChange","handleDelayUnitChange","handleRemoveDelay","handleAddDelay","handleActiveToggle","handleDateChange","renderTimeField","renderRepeater","renderDelay","TimestampEditorModal","singleTimestampOnly","TimestampEditor_TimestampEditor","handleChange","handleRemoveEndTimestamp","handleAddEndTimestamp","PropertyListEditorModal","prevItems","currentItems","propertyListItemId","property-list-editor__item-container--dragging","handlePropertyChange","handleValueChange","handleRemoveItem","handleAddNewItem","AgendaDay","onHeaderClick","dateDisplayType","onToggleDateDisplayType","agendaDefaultDeadlineDelayValue","agendaDefaultDeadlineDelayUnit","dateStart","startOfDay","dateEnd","endOfDay","planningItemsAndHeaders","planningItemDate","isTodoKeywordCompleted","isToday","appearDate","subHours","subDays","subWeeks","subMonths","subYears","subtractTimestampUnitFromDate","isEqual","isWithinRange","hasBeenRepeated","sortBy","_planningItem$get$toJ","hasTodoKeyword","dateClassName","agenda-day__header-planning-date--overdue","isPast","AgendaModal","selectedDate","timeframeType","weekStart","startOfWeek","weekEnd","_this$state4","dates","daysAfter","monthStart","startOfMonth","getDaysInMonth","handleTimeframeTypeChange","handlePreviousDateClick","calculateTimeframeHeader","handleNextDateClick","AgendaDay_AgendaDay","handleToggleDateDisplayType","DEFAULT_BINDINGS","calculateNamedKeybindings","customKeybindings","bindingName","binding","OrgFile","hasUncaughtError","loadedPath","container","newTags","activePopupData","popupData","activePopupType","selectedHeader","handleSyncConfirmationPull","handleSyncConfirmationPush","handleSyncConfirmationCancel","handleCapture","handlePopupClose","TagsEditorModal_TagsEditorModal","OrderedSet","sort","handleTagsChange","editingTimestamp","timestampWithId","TimestampEditorModal_TimestampEditorModal","handleTimestampChange","PropertyListEditorModal_PropertyListEditorModal","handlePropertyListItemsChange","components_AgendaModal","shouldDisableDirtyIndicator","parsingErrorMessage","orgFileErrorMessage","Redirect","keyMap","bindingAction","calculateActionedKeybindings","preventDefaultAndHandleEditMode","ignoreInEditMode","activeElement","nodeName","handlers","handleSelectNextVisibleHeaderHotKey","handleSelectPreviousVisibleHeaderHotKey","handleToggleHeaderOpenedHotKey","advanceTodo","handleAdvanceTodoHotKey","editTitle","handleEditTitleHotKey","editDescription","handleEditDescriptionHotKey","handleExitEditModeHotKey","handleAddHeaderHotKey","handleRemoveHeaderHotKey","handleMoveHeaderUpHotKey","handleMoveHeaderDownHotKey","handleMoveHeaderLeftHotKey","handleMoveHeaderRightHotKey","handleUndoHotKey","index_es","tabIndex","handleContainerRef","components_HeaderList","components_ActionDrawer","renderActivePopup","activePopup","fontSize","shouldStoreSettingsInSyncBackend","confirm","ShortcutRow","isEditMode","rebindArea","handleKeyPress","code","Minus","Equal","Backspace","Enter","Return","Tab","BracketLeft","BracketRight","Semicolon","Quote","Backslash","Comma","Period","Slash","newModifiers","modifier","newBinding","onBindingChange","currentBinding","symbol","rebindAreaClassName","keyboard-shortcut-container__shortcut-key--edit-mode","handleRebindClick","symbolizeKeybinding","handleBindingChange","alreadyInUseBinding","ShortcutRow_ShortcutRow","CaptureTemplate","onFieldPathUpdate","onAddNewTemplateOrgFileAvailability","onRemoveTemplateOrgFileAvailability","onAddNewTemplateHeaderPath","onRemoveTemplateHeaderPath","onDeleteTemplate","isCollapsed","setIsCollapsed","handleHeaderBarClick","updateField","fieldName","toggleAvailabilityInAllOrgFiles","togglePrepend","handleAddNewOrgFileAvailability","handleRemoveOrgFileAvailability","handleOrgFileAvailabilityChange","handleAddNewHeaderPath","handleRemoveHeaderPath","handleHeaderPathChange","handleDeleteClick","caretClassName","capture-template-container__header__caret--rotated","capture-template-container--dragging","renderDescriptionField","maxLength","autoCapitalize","autoCorrect","renderIconField","orgFilePath","renderOrgFileAvailability","marginTop","renderHeaderPaths","renderPrependField","renderTemplateField","handleFieldPathUpdate","handleAddNewTemplateOrgFileAvailability","handleRemoveTemplateOrgFileAvailability","handleAddNewTemplateHeaderPath","handleRemoveTemplateHeaderPath","handleDeleteTemplate","handleReorderTemplate","onReorder","SyncServiceSignIn","handleDropboxClick","DropboxLogo","handleGoogleDriveClick","GoogleDriveLogo","Entry","lastSeenChangelogHeader","firstHeaderTitle","shouldPromptWhenLeaving","onbeforeunload","components_OrgFile","shouldDisableActionDrawer","_ref$match$params$pat","params","components_FileBrowser","pendingCapturePath","shouldRedirectToCapturePath","entry-container--large-font","components_HeaderBar","Prompt","when","renderChangelogFile","components_Settings","components_KeyboardShortcutsEditor","components_CaptureTemplatesEditor","renderSampleFile","Switch","Route","exact","component","render","renderFile","renderFileBrowser","App","runAllMigrations","initialHash","hash","hashContents","authenticatedSyncService","dropboxAccessToken","createDropboxSyncBackendClient","persistedDropboxAccessToken","createGoogleDriveSyncBackendClient","queryStringContents","search","captureFile","captureTemplateName","capturePath","Store","subscribe","destination","source","onDragEnd","BrowserRouter","basename","es","components_Entry","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","App_App","getElementById","URL","ready","unregister","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.f834ea61.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/org-web.b087bbb4.svg\";","module.exports = __webpack_public_path__ + \"static/media/dropbox.44db08f0.svg\";","module.exports = __webpack_public_path__ + \"static/media/google_drive.f5fd3e02.png\";","/* global ga */\r\n\r\nexport default store => next => action => {\r\n  let { type, ...payload } = action;\r\n\r\n  const eventFieldsToRedact = {\r\n    SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING: ['directoryListing'],\r\n    AUTHENTICATE: ['dropboxAccessToken'],\r\n    DISPLAY_FILE: ['contents'],\r\n  };\r\n\r\n  if (!!eventFieldsToRedact[type]) {\r\n    eventFieldsToRedact[type].forEach(field => {\r\n      payload = { ...payload, [field]: '--REDACTED--' };\r\n    });\r\n  }\r\n\r\n  ga('send', 'event', 'action', type, JSON.stringify(payload));\r\n\r\n  return next(action);\r\n};\r\n","import { displayFile, stopDisplayingFile } from './org';\r\n\r\nimport raw from 'raw.macro';\r\n\r\nexport const setLoadingMessage = loadingMessage => ({\r\n  type: 'SET_LOADING_MESSAGE',\r\n  loadingMessage,\r\n});\r\n\r\nexport const hideLoadingMessage = () => ({\r\n  type: 'HIDE_LOADING_MESSAGE',\r\n});\r\n\r\nexport const setIsLoading = isLoading => ({\r\n  type: 'SET_IS_LOADING',\r\n  isLoading,\r\n});\r\n\r\nexport const setDisappearingLoadingMessage = (loadingMessage, delay) => dispatch => {\r\n  dispatch(setLoadingMessage(loadingMessage));\r\n  setTimeout(() => dispatch(hideLoadingMessage()), delay);\r\n};\r\n\r\nexport const setLastViewedFile = (lastViewedPath, lastViewedContents) => ({\r\n  type: 'SET_LAST_VIEWED_FILE',\r\n  lastViewedPath,\r\n  lastViewedContents,\r\n});\r\n\r\nexport const loadStaticFile = staticFile => {\r\n  return (dispatch, getState) => {\r\n    dispatch(\r\n      setLastViewedFile(getState().org.present.get('path'), getState().org.present.get('contents'))\r\n    );\r\n\r\n    const fileContents = {\r\n      changelog: raw('../../changelog.org'),\r\n      sample: raw('../../sample.org'),\r\n    }[staticFile];\r\n\r\n    dispatch(displayFile(null, fileContents));\r\n  };\r\n};\r\n\r\nexport const unloadStaticFile = () => {\r\n  return (dispatch, getState) => {\r\n    dispatch(stopDisplayingFile());\r\n\r\n    if (!!getState().base.get('lastViewedPath')) {\r\n      dispatch(\r\n        displayFile(\r\n          getState().base.get('lastViewedPath'),\r\n          getState().base.get('lastViewedContents')\r\n        )\r\n      );\r\n    }\r\n  };\r\n};\r\n\r\nexport const setFontSize = newFontSize => ({\r\n  type: 'SET_FONT_SIZE',\r\n  newFontSize,\r\n});\r\n\r\nexport const setBulletStyle = newBulletStyle => ({\r\n  type: 'SET_BULLET_STYLE',\r\n  newBulletStyle,\r\n});\r\n\r\nexport const setShouldTapTodoToAdvance = newShouldTapTodoToAdvance => ({\r\n  type: 'SET_SHOULD_TAP_TODO_TO_ADVANCE',\r\n  newShouldTapTodoToAdvance,\r\n});\r\n\r\nexport const setAgendaDefaultDeadlineDelayUnit = newAgendaDefaultDeadlineDelayUnit => ({\r\n  type: 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_UNIT',\r\n  newAgendaDefaultDeadlineDelayUnit,\r\n});\r\n\r\nexport const setAgendaDefaultDeadlineDelayValue = newAgendaDefaultDeadlineDelayValue => ({\r\n  type: 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_VALUE',\r\n  newAgendaDefaultDeadlineDelayValue,\r\n});\r\n\r\nexport const setShouldLiveSync = shouldLiveSync => ({\r\n  type: 'SET_SHOULD_LIVE_SYNC',\r\n  shouldLiveSync,\r\n});\r\n\r\nexport const setShouldSyncOnBecomingVisibile = shouldSyncOnBecomingVisibile => ({\r\n  type: 'SET_SHOULD_SYNC_ON_BECOMING_VISIBLE',\r\n  shouldSyncOnBecomingVisibile,\r\n});\r\n\r\nexport const setShouldStoreSettingsInSyncBackend = newShouldStoreSettingsInSyncBackend => {\r\n  return (dispatch, getState) => {\r\n    dispatch({\r\n      type: 'SET_SHOULD_STORE_SETTINGS_IN_SYNC_BACKEND',\r\n      newShouldStoreSettingsInSyncBackend,\r\n    });\r\n\r\n    if (!newShouldStoreSettingsInSyncBackend) {\r\n      const client = getState().syncBackend.get('client');\r\n      switch (client.type) {\r\n        case 'Dropbox':\r\n          client\r\n            .deleteFile('/.org-web-config.json')\r\n            .catch(\r\n              (doesFileNotExist, error) =>\r\n                doesFileNotExist\r\n                  ? null\r\n                  : alert(\r\n                      `There was an error trying to delete the .org-web-config.json file: ${error}`\r\n                    )\r\n            );\r\n          break;\r\n        case 'Google Drive':\r\n          client.deleteFileByNameAndParent('.org-web-config.json', 'root');\r\n          break;\r\n        default:\r\n      }\r\n\r\n      window.previousSettingsFileContents = null;\r\n    }\r\n  };\r\n};\r\n\r\nexport const setHasUnseenChangelog = newHasUnseenChangelog => ({\r\n  type: 'SET_HAS_UNSEEN_CHANGELOG',\r\n  newHasUnseenChangelog,\r\n});\r\n\r\nexport const setLastSeenChangelogHeader = newLastSeenChangelogHeader => ({\r\n  type: 'SET_LAST_SEEN_CHANGELOG_HEADER',\r\n  newLastSeenChangelogHeader,\r\n});\r\n\r\nexport const setCustomKeybinding = (keybindingName, keybinding) => ({\r\n  type: 'SET_CUSTOM_KEYBINDING',\r\n  keybindingName,\r\n  keybinding,\r\n});\r\n\r\nexport const restoreBaseSettings = newSettings => ({\r\n  type: 'RESTORE_BASE_SETTINGS',\r\n  newSettings,\r\n});\r\n\r\nexport const pushModalPage = modalPage => ({\r\n  type: 'PUSH_MODAL_PAGE',\r\n  modalPage,\r\n});\r\n\r\nexport const popModalPage = () => ({\r\n  type: 'POP_MODAL_PAGE',\r\n});\r\n\r\nexport const clearModalStack = () => ({\r\n  type: 'CLEAR_MODAL_STACK',\r\n});\r\n\r\nexport const activatePopup = (popupType, data) => ({\r\n  type: 'ACTIVATE_POPUP',\r\n  popupType,\r\n  data,\r\n});\r\n\r\nexport const closePopup = () => ({\r\n  type: 'CLOSE_POPUP',\r\n});\r\n","import formatDate from 'date-fns/format';\r\nimport parseDate from 'date-fns/parse';\r\nimport {\r\n  addHours,\r\n  addDays,\r\n  addWeeks,\r\n  addMonths,\r\n  addYears,\r\n  subHours,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  subYears,\r\n  isBefore,\r\n} from 'date-fns';\r\n\r\nexport const renderAsText = timestamp => {\r\n  const {\r\n    isActive,\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    startHour,\r\n    startMinute,\r\n    endHour,\r\n    endMinute,\r\n    repeaterType,\r\n    repeaterValue,\r\n    repeaterUnit,\r\n    delayType,\r\n    delayValue,\r\n    delayUnit,\r\n  } = timestamp.toJS();\r\n\r\n  let timestampText = '';\r\n  timestampText += isActive ? '<' : '[';\r\n  timestampText += `${year}-${month}-${day}`;\r\n  timestampText += !!dayName ? ` ${dayName}` : '';\r\n  timestampText += !!startHour ? ` ${startHour}:${startMinute}` : '';\r\n  timestampText += !!endHour ? `-${endHour}:${endMinute}` : '';\r\n  timestampText += !!repeaterType ? ` ${repeaterType}${repeaterValue}${repeaterUnit}` : '';\r\n  timestampText += !!delayType ? ` ${delayType}${delayValue}${delayUnit}` : '';\r\n  timestampText += isActive ? '>' : ']';\r\n\r\n  return timestampText;\r\n};\r\n\r\nexport const getCurrentTimestamp = ({ isActive = true, withStartTime = false } = {}) => {\r\n  const time = new Date();\r\n\r\n  const timestamp = {\r\n    isActive,\r\n    year: formatDate(time, 'YYYY'),\r\n    month: formatDate(time, 'MM'),\r\n    day: formatDate(time, 'DD'),\r\n    dayName: formatDate(time, 'ddd'),\r\n    startHour: null,\r\n    startMinute: null,\r\n    endHour: null,\r\n    endMinute: null,\r\n    repeaterType: null,\r\n    repeaterValue: null,\r\n    repeaterUnit: null,\r\n    delayType: null,\r\n    delayValue: null,\r\n    delayUnit: null,\r\n  };\r\n\r\n  if (withStartTime) {\r\n    timestamp.startHour = formatDate(time, 'HH');\r\n    timestamp.startMinute = formatDate(time, 'mm');\r\n  }\r\n\r\n  return timestamp;\r\n};\r\n\r\nexport const getCurrentTimestampAsText = () => `<${formatDate(new Date(), 'YYYY-MM-DD ddd')}>`;\r\n\r\nexport const dateForTimestamp = timestamp => {\r\n  const { year, month, day, startHour, startMinute } = timestamp.toJS();\r\n\r\n  let timestampString = `${year}-${month}-${day}`;\r\n  if (!!startHour && !!startMinute) {\r\n    timestampString += ` ${startHour.padStart(2, '0')}:${startMinute}`;\r\n  }\r\n\r\n  return parseDate(timestampString);\r\n};\r\n\r\nexport const addTimestampUnitToDate = (date, numUnits, timestampUnit) =>\r\n  ({\r\n    h: addHours(date, numUnits),\r\n    d: addDays(date, numUnits),\r\n    w: addWeeks(date, numUnits),\r\n    m: addMonths(date, numUnits),\r\n    y: addYears(date, numUnits),\r\n  }[timestampUnit]);\r\n\r\nexport const subtractTimestampUnitFromDate = (date, numUnits, timestampUnit) =>\r\n  ({\r\n    h: subHours(date, numUnits),\r\n    d: subDays(date, numUnits),\r\n    w: subWeeks(date, numUnits),\r\n    m: subMonths(date, numUnits),\r\n    y: subYears(date, numUnits),\r\n  }[timestampUnit]);\r\n\r\nexport const applyRepeater = (timestamp, currentDate) => {\r\n  if (!timestamp.get('repeaterType')) {\r\n    return timestamp;\r\n  }\r\n\r\n  let newDate = null;\r\n  switch (timestamp.get('repeaterType')) {\r\n    case '+':\r\n      newDate = addTimestampUnitToDate(\r\n        dateForTimestamp(timestamp),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      break;\r\n    case '++':\r\n      newDate = addTimestampUnitToDate(\r\n        dateForTimestamp(timestamp),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      while (isBefore(newDate, currentDate)) {\r\n        newDate = addTimestampUnitToDate(\r\n          newDate,\r\n          timestamp.get('repeaterValue'),\r\n          timestamp.get('repeaterUnit')\r\n        );\r\n      }\r\n      break;\r\n    case '.+':\r\n      newDate = addTimestampUnitToDate(\r\n        new Date(),\r\n        timestamp.get('repeaterValue'),\r\n        timestamp.get('repeaterUnit')\r\n      );\r\n      break;\r\n    default:\r\n      console.error(`Unrecognized timestamp repeater type: ${timestamp.get('repeaterType')}`);\r\n      return timestamp;\r\n  }\r\n\r\n  timestamp = timestamp\r\n    .set('day', formatDate(newDate, 'DD'))\r\n    .set('dayName', formatDate(newDate, 'ddd'))\r\n    .set('month', formatDate(newDate, 'MM'))\r\n    .set('year', formatDate(newDate, 'YYYY'));\r\n\r\n  if (timestamp.get('startHour') !== undefined && timestamp.get('startHour') !== null) {\r\n    timestamp = timestamp\r\n      .set('startHour', formatDate(newDate, 'HH'))\r\n      .set('startMinute', formatDate(newDate, 'mm'));\r\n  }\r\n\r\n  return timestamp;\r\n};\r\n","import _ from 'lodash';\r\nimport { fromJS } from 'immutable';\r\n\r\nimport { renderAsText } from './timestamps';\r\n\r\nconst linkPartToRawText = linkPart => {\r\n  if (!!linkPart.getIn(['contents', 'title'])) {\r\n    return `[[${linkPart.getIn(['contents', 'uri'])}][${linkPart.getIn(['contents', 'title'])}]]`;\r\n  } else {\r\n    return `[[${linkPart.getIn(['contents', 'uri'])}]]`;\r\n  }\r\n};\r\n\r\nconst formattedAttributedStringText = parts => {\r\n  return parts\r\n    .map(part => {\r\n      switch (part.get('type')) {\r\n        case 'text':\r\n          return part.get('contents');\r\n        case 'link':\r\n          if (part.getIn(['contents', 'title'])) {\r\n            return part.getIn(['contents', 'title']);\r\n          } else {\r\n            return part.getIn(['contents', 'uri']);\r\n          }\r\n        case 'table':\r\n          return '';\r\n        default:\r\n          return '';\r\n      }\r\n    })\r\n    .join('');\r\n};\r\n\r\nconst tablePartToRawText = tablePart => {\r\n  const rowHeights = tablePart\r\n    .get('contents')\r\n    .map(row =>\r\n      Math.max(\r\n        ...row.get('contents').map(cell => (_.countBy(cell.get('rawContents'))['\\n'] || 0) + 1)\r\n      )\r\n    )\r\n    .toJS();\r\n\r\n  const numColumns = tablePart.getIn(['contents', 0, 'contents']).size;\r\n  const columnWidths = _.times(numColumns).map(columnIndex =>\r\n    Math.max(\r\n      ...tablePart.get('contents').map(row => {\r\n        const content = row.getIn(['contents', columnIndex, 'contents']);\r\n        const formattedText = formattedAttributedStringText(content);\r\n        const lineLengths = formattedText.split('\\n').map(line => line.trim().length);\r\n        return Math.max(...lineLengths);\r\n      })\r\n    )\r\n  );\r\n\r\n  const rowStrings = _.dropRight(\r\n    _.flatten(\r\n      tablePart\r\n        .get('contents')\r\n        .map((row, rowIndex) => {\r\n          const rowHeight = rowHeights[rowIndex];\r\n\r\n          const contentRows = _.times(rowHeight)\r\n            .map(lineIndex =>\r\n              row\r\n                .get('contents')\r\n                .map((cell, columnIndex) => {\r\n                  const content = cell.get('contents');\r\n                  const formattedText = formattedAttributedStringText(content);\r\n                  const formattedLineLengths = formattedText\r\n                    .split('\\n')\r\n                    .map(line => line.trim().length);\r\n                  const line = (cell.get('rawContents').split('\\n')[lineIndex] || '').trim();\r\n\r\n                  const padCount = columnWidths[columnIndex] - formattedLineLengths[lineIndex];\r\n\r\n                  return line + ' '.repeat(padCount);\r\n                })\r\n                .toJS()\r\n                .join(' | ')\r\n            )\r\n            .map(contentRow => `| ${contentRow} |`);\r\n\r\n          const separator =\r\n            '|' + columnWidths.map(columnWidth => '-'.repeat(columnWidth + 2)).join('+') + '|';\r\n\r\n          return contentRows.concat(separator);\r\n        })\r\n        .toJS()\r\n    )\r\n  );\r\n\r\n  return rowStrings.join('\\n');\r\n};\r\n\r\nconst listPartToRawText = listPart => {\r\n  const bulletCharacter = listPart.get('bulletCharacter');\r\n\r\n  let previousNumber = 0;\r\n  return listPart\r\n    .get('items')\r\n    .map(item => {\r\n      const optionalLeadingSpace = !listPart.get('isOrdered') && bulletCharacter === '*' ? ' ' : '';\r\n\r\n      const titleText = attributedStringToRawText(item.get('titleLine'));\r\n\r\n      const contentText = attributedStringToRawText(item.get('contents'));\r\n      const indentedContentText = contentText\r\n        .split('\\n')\r\n        .map(line => (!!line.trim() ? `${optionalLeadingSpace}  ${line}` : ''))\r\n        .join('\\n');\r\n\r\n      let listItemText = null;\r\n      if (listPart.get('isOrdered')) {\r\n        let number = ++previousNumber;\r\n        let forceNumber = item.get('forceNumber');\r\n        if (!!forceNumber) {\r\n          number = forceNumber;\r\n          previousNumber = number;\r\n        }\r\n\r\n        listItemText = `${number}${listPart.get('numberTerminatorCharacter')}`;\r\n\r\n        if (!!forceNumber) {\r\n          listItemText += ` [@${forceNumber}]`;\r\n        }\r\n\r\n        if (item.get('isCheckbox')) {\r\n          const stateCharacter = {\r\n            checked: 'X',\r\n            unchecked: ' ',\r\n            partial: '-',\r\n          }[item.get('checkboxState')];\r\n\r\n          listItemText += ` [${stateCharacter}]`;\r\n        }\r\n\r\n        listItemText += ` ${titleText}`;\r\n      } else {\r\n        listItemText = `${optionalLeadingSpace}${bulletCharacter}`;\r\n\r\n        if (item.get('isCheckbox')) {\r\n          const stateCharacter = {\r\n            checked: 'X',\r\n            unchecked: ' ',\r\n            partial: '-',\r\n          }[item.get('checkboxState')];\r\n\r\n          listItemText += ` [${stateCharacter}]`;\r\n        }\r\n\r\n        listItemText += ` ${titleText}`;\r\n      }\r\n\r\n      if (!!contentText) {\r\n        listItemText += `\\n${indentedContentText}`;\r\n      }\r\n\r\n      return listItemText;\r\n    })\r\n    .join('\\n');\r\n};\r\n\r\nconst timestampPartToRawText = part => {\r\n  let text = renderAsText(part.get('firstTimestamp'));\r\n  if (part.get('secondTimestamp')) {\r\n    text += `--${renderAsText(part.get('secondTimestamp'))}`;\r\n  }\r\n\r\n  return text;\r\n};\r\n\r\nexport const attributedStringToRawText = parts => {\r\n  if (!parts) {\r\n    return '';\r\n  }\r\n\r\n  const prevParts = parts.unshift(null);\r\n\r\n  return parts\r\n    .zip(prevParts)\r\n    .map(([part, prevPart]) => {\r\n      let text = '';\r\n      switch (part.get('type')) {\r\n        case 'text':\r\n          text = part.get('contents');\r\n          break;\r\n        case 'link':\r\n          text = linkPartToRawText(part);\r\n          break;\r\n        case 'fraction-cookie':\r\n          text = `[${part.getIn(['fraction', 0]) || ''}/${part.getIn(['fraction', 1]) || ''}]`;\r\n          break;\r\n        case 'percentage-cookie':\r\n          text = `[${part.get('percentage') || ''}%]`;\r\n          break;\r\n        case 'table':\r\n          text = tablePartToRawText(part);\r\n          break;\r\n        case 'list':\r\n          text = listPartToRawText(part);\r\n          break;\r\n        case 'timestamp':\r\n          text = timestampPartToRawText(part);\r\n          break;\r\n        default:\r\n          console.error(\r\n            `Unknown attributed string part type in attributedStringToRawText: ${part.get('type')}`\r\n          );\r\n      }\r\n\r\n      let optionalNewlinePrefix = '';\r\n      if (!!prevPart) {\r\n        if (['list', 'table'].includes(prevPart.get('type'))) {\r\n          optionalNewlinePrefix = '\\n';\r\n        } else if (\r\n          part.get('type') === 'list' &&\r\n          prevPart.get('type') === 'text' &&\r\n          !prevPart.get('contents').endsWith('\\n')\r\n        ) {\r\n          optionalNewlinePrefix = '\\n';\r\n        }\r\n      }\r\n      return optionalNewlinePrefix + text;\r\n    })\r\n    .join('');\r\n};\r\n\r\nexport default (headers, todoKeywordSets, fileConfigLines, linesBeforeHeadings) => {\r\n  let configContent = '';\r\n\r\n  if (fileConfigLines.size > 0) {\r\n    configContent = fileConfigLines.join('\\n') + '\\n';\r\n  }\r\n\r\n  if (!todoKeywordSets.get(0).get('default')) {\r\n    configContent =\r\n      configContent +\r\n      todoKeywordSets\r\n        .map(todoKeywordSet => {\r\n          return todoKeywordSet.get('configLine');\r\n        })\r\n        .join('\\n') +\r\n      '\\n';\r\n  }\r\n\r\n  if (linesBeforeHeadings.size > 0) {\r\n    configContent = configContent + linesBeforeHeadings.join('\\n');\r\n  }\r\n\r\n  // TODO: maybe this adds empty lines?\r\n  if (configContent.length > 0) {\r\n    configContent = configContent + '\\n';\r\n  }\r\n\r\n  const headerContent = headers\r\n    .toJS()\r\n    .map(header => {\r\n      let contents = '';\r\n      contents += '*'.repeat(header.nestingLevel);\r\n\r\n      if (header.titleLine.todoKeyword) {\r\n        contents += ` ${header.titleLine.todoKeyword}`;\r\n      }\r\n      contents += ` ${header.titleLine.rawTitle}`;\r\n\r\n      if (header.titleLine.tags.length > 0) {\r\n        contents += ` :${header.titleLine.tags.filter(tag => !!tag).join(':')}:`;\r\n      }\r\n\r\n      if (header.planningItems.length > 0) {\r\n        const planningItemsContent = header.planningItems\r\n          .map(\r\n            planningItem => `${planningItem.type}: ${renderAsText(fromJS(planningItem.timestamp))}`\r\n          )\r\n          .join(' ')\r\n          .trimRight();\r\n        contents += `\\n  ${planningItemsContent}`;\r\n      }\r\n\r\n      if (header.propertyListItems.length > 0) {\r\n        contents += '\\n:PROPERTIES:';\r\n        header.propertyListItems.forEach(propertyListItem => {\r\n          contents += `\\n:${propertyListItem.property}: ${attributedStringToRawText(\r\n            fromJS(propertyListItem.value)\r\n          )}`;\r\n        });\r\n        contents += '\\n:END:\\n';\r\n      }\r\n\r\n      if (header.description) {\r\n        if (!header.rawDescription.startsWith('\\n') && header.rawDescription.length !== 0) {\r\n          contents += '\\n';\r\n        }\r\n        contents += header.rawDescription;\r\n      }\r\n\r\n      return contents;\r\n    })\r\n    .join('\\n');\r\n\r\n  return configContent + headerContent;\r\n};\r\n","import { Map } from 'immutable';\r\nimport formatDate from 'date-fns/format';\r\nimport _ from 'lodash';\r\n\r\nexport default (templateString, customVariables = Map()) => {\r\n  if (!templateString) {\r\n    return ['', null];\r\n  }\r\n\r\n  const substitutions = {\r\n    '%t': `<${formatDate(new Date(), 'YYYY-MM-DD ddd')}>`,\r\n    '%T': `<${formatDate(new Date(), 'YYYY-MM-DD ddd HH:mm')}>`,\r\n    '%u': `[${formatDate(new Date(), 'YYYY-MM-DD ddd')}]`,\r\n    '%U': `[${formatDate(new Date(), 'YYYY-MM-DD ddd HH:mm')}]`,\r\n  };\r\n\r\n  customVariables.entrySeq().forEach(([key, value]) => {\r\n    substitutions[`%${key}`] = value;\r\n  });\r\n\r\n  let substitutedString = templateString;\r\n  _.entries(substitutions).forEach(\r\n    ([formatString, value]) =>\r\n      (substitutedString = substitutedString.replace(RegExp(formatString, 'g'), value))\r\n  );\r\n\r\n  const cursorIndex = substitutedString.includes('%?') ? substitutedString.indexOf('%?') : null;\r\n  substitutedString = substitutedString.replace(/%\\?/, '');\r\n\r\n  return [substitutedString, cursorIndex];\r\n};\r\n","export default (() => {\r\n  let nextId = 1;\r\n  return () => nextId++;\r\n})();\r\n","import generateId from './id_generator';\r\n\r\nimport { List, fromJS } from 'immutable';\r\n\r\nexport const indexOfHeaderWithId = (headers, headerId) => {\r\n  return headers.findIndex(header => header.get('id') === headerId);\r\n};\r\n\r\nexport const headerWithId = (headers, headerId) => {\r\n  return headers.get(indexOfHeaderWithId(headers, headerId));\r\n};\r\n\r\nexport const subheadersOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const afterHeaders = headers.slice(headerIndex + 1);\r\n  const nextSiblingHeaderIndex = afterHeaders.findIndex(siblingHeader => {\r\n    return siblingHeader.get('nestingLevel') <= header.get('nestingLevel');\r\n  });\r\n\r\n  if (nextSiblingHeaderIndex === -1) {\r\n    return afterHeaders;\r\n  } else {\r\n    return afterHeaders.slice(0, nextSiblingHeaderIndex);\r\n  }\r\n};\r\n\r\nexport const numSubheadersOfHeaderWithId = (headers, headerId) =>\r\n  subheadersOfHeaderWithId(headers, headerId).size;\r\n\r\nexport const directParentIdOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  for (let i = headerIndex - 1; i >= 0; --i) {\r\n    const previousHeader = headers.get(i);\r\n\r\n    if (previousHeader.get('nestingLevel') === header.get('nestingLevel') - 1) {\r\n      return previousHeader.get('id');\r\n    }\r\n\r\n    if (previousHeader.get('nestingLevel') < header.get('nestingLevel')) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const parentIdOfHeaderWithId = (headers, headerId) => {\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const previousHeaders = headers.slice(0, headerIndex).reverse();\r\n  const parentHeader = previousHeaders.find(\r\n    previousHeader => previousHeader.get('nestingLevel') < header.get('nestingLevel')\r\n  );\r\n\r\n  if (!parentHeader) {\r\n    return null;\r\n  }\r\n\r\n  return parentHeader.get('id');\r\n};\r\n\r\nexport const indexOfPreviousSibling = (headers, headerIndex) => {\r\n  const nestingLevel = headers.getIn([headerIndex, 'nestingLevel']);\r\n\r\n  for (let i = headerIndex - 1; i >= 0; --i) {\r\n    const header = headers.get(i);\r\n\r\n    if (header.get('nestingLevel') < nestingLevel) {\r\n      return null;\r\n    }\r\n\r\n    if (header.get('nestingLevel') === nestingLevel) {\r\n      return i;\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst isHeaderVisible = (headers, headerId) => {\r\n  const parentHeaderId = parentIdOfHeaderWithId(headers, headerId);\r\n  if (!parentHeaderId) {\r\n    return true;\r\n  }\r\n\r\n  const parentHeader = headerWithId(headers, parentHeaderId);\r\n  return parentHeader.get('opened') && isHeaderVisible(headers, parentHeader.get('id'));\r\n};\r\n\r\nexport const nextVisibleHeaderAfterIndex = (headers, headerIndex) => {\r\n  const followingHeaders = headers.slice(headerIndex + 1);\r\n  return followingHeaders.find(header => isHeaderVisible(headers, header.get('id')));\r\n};\r\n\r\nexport const previousVisibleHeaderAfterIndex = (headers, headerIndex) => {\r\n  const previousHeaders = headers.slice(0, headerIndex).reverse();\r\n  return previousHeaders.find(header => isHeaderVisible(headers, header.get('id')));\r\n};\r\n\r\nexport const openDirectParent = (state, headerId) => {\r\n  const parentHeaderId = directParentIdOfHeaderWithId(state.get('headers'), headerId);\r\n  if (parentHeaderId !== null) {\r\n    const parentHeaderIndex = indexOfHeaderWithId(state.get('headers'), parentHeaderId);\r\n    state = state.setIn(['headers', parentHeaderIndex, 'opened'], true);\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const getOpenHeaderPaths = headers => {\r\n  let openedHeaders = [];\r\n  for (let i = 0; i < headers.size; ++i) {\r\n    const header = headers.get(i);\r\n    if (!header.get('opened')) {\r\n      continue;\r\n    }\r\n\r\n    const title = header.getIn(['titleLine', 'rawTitle']);\r\n\r\n    const subheaders = subheadersOfHeaderWithId(headers, header.get('id'));\r\n    const openSubheaderPaths = getOpenHeaderPaths(subheaders);\r\n\r\n    if (openSubheaderPaths.length > 0) {\r\n      openSubheaderPaths.forEach(openedSubheaderPath => {\r\n        openedHeaders.push([title].concat(openedSubheaderPath));\r\n      });\r\n    } else {\r\n      openedHeaders.push([title]);\r\n    }\r\n\r\n    i += subheaders.size;\r\n  }\r\n\r\n  return openedHeaders;\r\n};\r\n\r\nexport const headerWithPath = (headers, headerPath) => {\r\n  if (headerPath.size === 0) {\r\n    return null;\r\n  }\r\n\r\n  const firstHeader = headers.find(\r\n    header =>\r\n      parentIdOfHeaderWithId(headers, header.get('id')) === null &&\r\n      header.getIn(['titleLine', 'rawTitle']).trim() === headerPath.first().trim()\r\n  );\r\n  if (!firstHeader) {\r\n    return null;\r\n  }\r\n\r\n  if (headerPath.size === 1) {\r\n    return firstHeader;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, firstHeader.get('id'));\r\n  return headerWithPath(subheaders, headerPath.skip(1));\r\n};\r\n\r\nexport const openHeaderWithPath = (headers, headerPath, maxNestingLevel = 1) => {\r\n  if (headerPath.size === 0) {\r\n    return headers;\r\n  }\r\n\r\n  const firstTitle = headerPath.first();\r\n  const headerIndex = headers.findIndex(header => {\r\n    const rawTitle = header.getIn(['titleLine', 'rawTitle']);\r\n    const nestingLevel = header.get('nestingLevel');\r\n    return rawTitle === firstTitle && nestingLevel <= maxNestingLevel;\r\n  });\r\n  if (headerIndex === -1) {\r\n    return headers;\r\n  }\r\n\r\n  headers = headers.update(headerIndex, header => header.set('opened', true));\r\n\r\n  let subheaders = subheadersOfHeaderWithId(headers, headers.getIn([headerIndex, 'id']));\r\n  subheaders = openHeaderWithPath(subheaders, headerPath.rest(), maxNestingLevel + 1);\r\n\r\n  headers = headers\r\n    .take(headerIndex + 1)\r\n    .concat(subheaders)\r\n    .concat(headers.takeLast(headers.size - (headerIndex + 1 + subheaders.size)));\r\n\r\n  return headers;\r\n};\r\n\r\nconst tablePartContainsCellId = (tablePart, cellId) =>\r\n  tablePart\r\n    .get('contents')\r\n    .some(row => row.get('contents').some(cell => cell.get('id') === cellId));\r\n\r\nconst doesAttributedStringContainTableCellId = (parts, cellId) =>\r\n  parts\r\n    .filter(part => ['table', 'list'].includes(part.get('type')))\r\n    .some(\r\n      part =>\r\n        part.get('type') === 'table'\r\n          ? tablePartContainsCellId(part, cellId)\r\n          : part\r\n              .get('items')\r\n              .some(item => doesAttributedStringContainTableCellId(item.get('contents'), cellId))\r\n    );\r\n\r\nexport const headerThatContainsTableCellId = (headers, cellId) =>\r\n  headers.find(header => doesAttributedStringContainTableCellId(header.get('description'), cellId));\r\n\r\nexport const pathAndPartOfTimestampItemWithIdInAttributedString = (parts, timestampId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'timestamp' && part.get('id') === timestampId) {\r\n        return {\r\n          path: [partIndex],\r\n          timestampPart: part,\r\n        };\r\n      } else if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n              item.get('contents'),\r\n              timestampId\r\n            );\r\n            if (!!pathAndPart) {\r\n              const { path, timestampPart } = pathAndPart;\r\n              return {\r\n                path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                timestampPart,\r\n              };\r\n            } else {\r\n              let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n                item.get('titleLine'),\r\n                timestampId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, timestampPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'titleLine'].concat(path),\r\n                  timestampPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else if (part.get('type') === 'table') {\r\n        return part\r\n          .get('contents')\r\n          .map((row, rowIndex) => {\r\n            return row\r\n              .get('contents')\r\n              .map((cell, cellIndex) => {\r\n                const pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n                  cell.get('contents'),\r\n                  timestampId\r\n                );\r\n                if (!!pathAndPart) {\r\n                  const { path, timestampPart } = pathAndPart;\r\n                  return {\r\n                    path: [\r\n                      partIndex,\r\n                      'contents',\r\n                      rowIndex,\r\n                      'contents',\r\n                      cellIndex,\r\n                      'contents',\r\n                    ].concat(path),\r\n                    timestampPart,\r\n                  };\r\n                } else {\r\n                  return null;\r\n                }\r\n              })\r\n              .filter(result => !!result)\r\n              .first();\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nconst listPartContainsItemId = (listPart, itemId) =>\r\n  listPart.get('items').some(item => item.get('id') === itemId);\r\n\r\nexport const headerThatContainsListItemId = (headers, listItemId) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n  const headerIndex = pathAndPart.path[0];\r\n  return headers.get(headerIndex);\r\n};\r\n\r\nexport const pathAndPartOfListItemWithIdInAttributedString = (parts, listItemId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            if (item.get('id') === listItemId) {\r\n              return {\r\n                path: [partIndex, 'items', itemIndex],\r\n                listItemPart: item,\r\n              };\r\n            } else {\r\n              const pathAndPart = pathAndPartOfListItemWithIdInAttributedString(\r\n                item.get('contents'),\r\n                listItemId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, listItemPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                  listItemPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTableContainingCellIdInAttributedString = (parts, cellId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'table') {\r\n        if (tablePartContainsCellId(part, cellId)) {\r\n          return { path: [partIndex], tablePart: part };\r\n        } else {\r\n          return null;\r\n        }\r\n      } else if (part.get('type') === 'list') {\r\n        return part\r\n          .get('items')\r\n          .map((item, itemIndex) => {\r\n            const pathAndPart = pathAndPartOfTableContainingCellIdInAttributedString(\r\n              item.get('contents'),\r\n              cellId\r\n            );\r\n            if (!!pathAndPart) {\r\n              const { path, tablePart } = pathAndPart;\r\n              return {\r\n                path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                tablePart,\r\n              };\r\n            } else {\r\n              return null;\r\n            }\r\n          })\r\n          .filter(result => !!result)\r\n          .first();\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListContainingItemIdInHeaders = (headers, itemId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfListContainingItemIdInAttributedString(\r\n        header.get('description'),\r\n        itemId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, listPart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        listPart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListContainingItemIdInAttributedString = (parts, itemId) =>\r\n  parts\r\n    .map((part, partIndex) => {\r\n      if (part.get('type') === 'list') {\r\n        if (listPartContainsItemId(part, itemId)) {\r\n          return { path: [partIndex], listPart: part };\r\n        } else {\r\n          return part\r\n            .get('items')\r\n            .map((item, itemIndex) => {\r\n              const pathAndPart = pathAndPartOfListContainingItemIdInAttributedString(\r\n                item.get('contents'),\r\n                itemId\r\n              );\r\n              if (!!pathAndPart) {\r\n                const { path, listPart } = pathAndPart;\r\n                return {\r\n                  path: [partIndex, 'items', itemIndex, 'contents'].concat(path),\r\n                  listPart,\r\n                };\r\n              } else {\r\n                return null;\r\n              }\r\n            })\r\n            .filter(result => !!result)\r\n            .first();\r\n        }\r\n      } else {\r\n        return null;\r\n      }\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTimestampItemWithIdInHeaders = (headers, timestampId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      let pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n        header.getIn(['titleLine', 'title']),\r\n        timestampId\r\n      );\r\n      if (!!pathAndPart) {\r\n        const { path, timestampPart } = pathAndPart;\r\n        return {\r\n          path: [headerIndex, 'titleLine', 'title'].concat(path),\r\n          timestampPart,\r\n        };\r\n      }\r\n\r\n      pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n        header.get('description'),\r\n        timestampId\r\n      );\r\n      if (!!pathAndPart) {\r\n        const { path, timestampPart } = pathAndPart;\r\n        return {\r\n          path: [headerIndex, 'description'].concat(path),\r\n          timestampPart,\r\n        };\r\n      }\r\n\r\n      pathAndPart = header\r\n        .get('propertyListItems')\r\n        .map((propertyListItem, propertyListItemIndex) => {\r\n          if (!propertyListItem.get('value')) {\r\n            return null;\r\n          }\r\n\r\n          const plistPathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(\r\n            propertyListItem.get('value'),\r\n            timestampId\r\n          );\r\n          if (!!plistPathAndPart) {\r\n            const { path, timestampPart } = plistPathAndPart;\r\n            return {\r\n              path: [headerIndex, 'propertyListItems', propertyListItemIndex, 'value'].concat(path),\r\n              timestampPart,\r\n            };\r\n          }\r\n\r\n          return null;\r\n        })\r\n        .filter(result => !!result)\r\n        .first();\r\n      if (!!pathAndPart) {\r\n        return pathAndPart;\r\n      }\r\n\r\n      return null;\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfListItemWithIdInHeaders = (headers, listItemId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfListItemWithIdInAttributedString(\r\n        header.get('description'),\r\n        listItemId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, listItemPart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        listItemPart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const pathAndPartOfTableContainingCellIdInHeaders = (headers, cellId) =>\r\n  headers\r\n    .map((header, headerIndex) => {\r\n      const pathAndPart = pathAndPartOfTableContainingCellIdInAttributedString(\r\n        header.get('description'),\r\n        cellId\r\n      );\r\n      if (!pathAndPart) {\r\n        return null;\r\n      }\r\n\r\n      const { path, tablePart } = pathAndPart;\r\n      return {\r\n        path: [headerIndex, 'description'].concat(path),\r\n        tablePart,\r\n      };\r\n    })\r\n    .filter(result => !!result)\r\n    .first();\r\n\r\nexport const updateTableContainingCellId = (headers, cellId, updaterCallbackGenerator) => {\r\n  const { path, tablePart } = pathAndPartOfTableContainingCellIdInHeaders(headers, cellId);\r\n\r\n  const rowIndexContainingCellId = tablePart\r\n    .get('contents')\r\n    .findIndex(row => row.get('contents').some(cell => cell.get('id') === cellId));\r\n  const columnIndexContainingCellId = tablePart\r\n    .getIn(['contents', rowIndexContainingCellId, 'contents'])\r\n    .findIndex(cell => cell.get('id') === cellId);\r\n\r\n  return headers.updateIn(\r\n    path.concat(['contents']),\r\n    updaterCallbackGenerator(rowIndexContainingCellId, columnIndexContainingCellId)\r\n  );\r\n};\r\n\r\nexport const newEmptyTableRowLikeRows = rows =>\r\n  rows\r\n    .get(0)\r\n    .set('id', generateId())\r\n    .update('contents', contents =>\r\n      contents.map(cell =>\r\n        cell\r\n          .set('id', generateId())\r\n          .set('contents', new List())\r\n          .set('rawContents', '')\r\n      )\r\n    );\r\n\r\nexport const newEmptyTableCell = () =>\r\n  fromJS({\r\n    id: generateId(),\r\n    contents: [],\r\n    rawContents: '',\r\n  });\r\n\r\nexport const newListPart = () =>\r\n  fromJS({\r\n    type: 'list',\r\n    id: generateId(),\r\n    items: [],\r\n    bulletCharacter: '-',\r\n    numberTerminatorCharacter: null,\r\n    isOrdered: false,\r\n  });\r\n\r\nexport const newListPartLikePart = part => part.set('id', generateId()).set('items', new List());\r\n\r\nexport const newListItem = () =>\r\n  fromJS({\r\n    id: generateId(),\r\n    titleLine: [],\r\n    contents: [],\r\n    forceNumber: null,\r\n    isCheckbox: false,\r\n  });\r\n\r\nexport const parentListItemWithIdInHeaders = (headers, listItemId) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n  let { path } = pathAndPart;\r\n  return headers.getIn(path.slice(0, path.length - 4));\r\n};\r\n\r\nexport const updateListContainingListItemId = (headers, listItemId, updaterCallbackGenerator) => {\r\n  const { path, listPart } = pathAndPartOfListContainingItemIdInHeaders(headers, listItemId);\r\n\r\n  const itemIndexContainingId = listPart\r\n    .get('items')\r\n    .findIndex(item => item.get('id') === listItemId);\r\n\r\n  return headers.updateIn(path.concat(['items']), updaterCallbackGenerator(itemIndexContainingId));\r\n};\r\n\r\nexport const updateContentsWithListItemAddition = (parts, listItem, listPart = null) => {\r\n  if ((parts.size === 0) || (parts.last().get('type') !== 'list')) {\r\n    const insertIdx = parts.size;\r\n    if (!!listPart) {\r\n      parts = parts.insert(insertIdx, newListPartLikePart(listPart));\r\n    } else {\r\n      parts = parts.insert(insertIdx, newListPart());\r\n    }\r\n  }\r\n\r\n  return parts.map(part => {\r\n    switch (part.get('type')) {\r\n      case 'list':\r\n        return part.update('items', items => items.push(listItem));\r\n      default:\r\n        return part;\r\n    }\r\n  });\r\n};\r\n\r\nexport const timestampWithIdInAttributedString = (parts, timestampId) => {\r\n  if (!parts) {\r\n    return null;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfTimestampItemWithIdInAttributedString(parts, timestampId);\r\n  if (!!pathAndPart) {\r\n    return pathAndPart.timestampPart;\r\n  } else {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const timestampWithId = (headers, timestampId) =>\r\n  headers\r\n    .map(\r\n      header =>\r\n        timestampWithIdInAttributedString(header.getIn(['titleLine', 'title']), timestampId) ||\r\n        timestampWithIdInAttributedString(header.get('description'), timestampId) ||\r\n        header\r\n          .get('propertyListItems')\r\n          .map(propertyListItem =>\r\n            timestampWithIdInAttributedString(propertyListItem.get('value'), timestampId)\r\n          )\r\n          .filter(result => !!result)\r\n          .first()\r\n    )\r\n    .find(result => !!result);\r\n\r\nexport const todoKeywordSetForKeyword = (todoKeywordSets, keyword) =>\r\n  todoKeywordSets.find(keywordSet => keywordSet.get('keywords').contains(keyword)) ||\r\n  todoKeywordSets.first();\r\n\r\nexport const isTodoKeywordCompleted = (todoKeywordSets, keyword) =>\r\n  todoKeywordSetForKeyword(todoKeywordSets, keyword)\r\n    .get('completedKeywords')\r\n    .includes(keyword);\r\n","import generateId from './id_generator';\r\n\r\nimport { fromJS } from 'immutable';\r\n\r\nexport default fromJS([\r\n  {\r\n    description: 'Groceries',\r\n    headerPaths: ['Capture', 'Groceries'],\r\n    iconName: 'lemon',\r\n    id: generateId(),\r\n    isAvailableInAllOrgFiles: false,\r\n    letter: '',\r\n    orgFilesWhereAvailable: [],\r\n    shouldPrepend: false,\r\n    template: '* TODO %?',\r\n    isSample: true,\r\n  },\r\n  {\r\n    description: 'Deeply nested header',\r\n    headerPaths: ['Capture', 'Deeply', 'Nested', 'Headers', 'Work', 'Too!'],\r\n    iconName: 'fighter-jet',\r\n    id: generateId(),\r\n    isAvailableInAllOrgFiles: false,\r\n    letter: '',\r\n    orgFilesWhereAvailable: [],\r\n    shouldPrepend: true,\r\n    template: '* You can insert timestamps too! %T %?',\r\n    isSample: true,\r\n  },\r\n]);\r\n","import { ActionTypes } from 'redux-linear-undo';\r\nimport {\r\n  setLoadingMessage,\r\n  hideLoadingMessage,\r\n  setIsLoading,\r\n  setDisappearingLoadingMessage,\r\n  activatePopup,\r\n  closePopup,\r\n} from './base';\r\nimport exportOrg from '../lib/export_org';\r\nimport substituteTemplateVariables from '../lib/capture_template_substitution';\r\nimport { headerWithPath } from '../lib/org_utils';\r\n\r\nimport sampleCaptureTemplates from '../lib/sample_capture_templates';\r\n\r\nimport { isAfter, addSeconds } from 'date-fns';\r\nimport parseDate from 'date-fns/parse';\r\n\r\nexport const displayFile = (path, contents) => ({\r\n  type: 'DISPLAY_FILE',\r\n  path,\r\n  contents,\r\n});\r\n\r\nexport const setLastSyncAt = lastSyncAt => ({\r\n  type: 'SET_LAST_SYNC_AT',\r\n  lastSyncAt,\r\n});\r\n\r\nexport const stopDisplayingFile = () => {\r\n  return (dispatch, getState) => {\r\n    dispatch({ type: 'STOP_DISPLAYING_FILE' });\r\n    dispatch({ type: ActionTypes.CLEAR_HISTORY });\r\n    dispatch(unfocusHeader());\r\n    dispatch(closePopup());\r\n    dispatch(setLastSyncAt(null));\r\n  };\r\n};\r\n\r\nexport const sync = ({\r\n  forceAction = null,\r\n  successMessage = 'Changes pushed',\r\n  shouldSuppressMessages = false,\r\n} = {}) => (dispatch, getState) => {\r\n  const client = getState().syncBackend.get('client');\r\n  const path = getState().org.present.get('path');\r\n  if (path === null) {\r\n    return;\r\n  }\r\n\r\n  if (!shouldSuppressMessages) {\r\n    dispatch(setLoadingMessage('Syncing...'));\r\n  }\r\n  dispatch(setIsLoading(true));\r\n  dispatch(setOrgFileErrorMessage(null));\r\n\r\n  client\r\n    .getFileContentsAndMetadata(path)\r\n    .then(({ contents, lastModifiedAt }) => {\r\n      const isDirty = getState().org.present.get('isDirty');\r\n      const lastServerModifiedAt = parseDate(lastModifiedAt);\r\n      const lastSyncAt = getState().org.present.get('lastSyncAt');\r\n\r\n      if (isAfter(lastSyncAt, lastServerModifiedAt) || forceAction === 'push') {\r\n        if (isDirty) {\r\n          client\r\n            .updateFile(\r\n              path,\r\n              exportOrg(\r\n                getState().org.present.get('headers'),\r\n                getState().org.present.get('todoKeywordSets'),\r\n                getState().org.present.get('fileConfigLines'),\r\n                getState().org.present.get('linesBeforeHeadings')\r\n              )\r\n            )\r\n            .then(() => {\r\n              if (!shouldSuppressMessages) {\r\n                dispatch(setDisappearingLoadingMessage(successMessage, 2000));\r\n              }\r\n              dispatch(setIsLoading(false));\r\n              dispatch(setDirty(false));\r\n              dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n            })\r\n            .catch(error => {\r\n              alert(`There was an error pushing the file: ${error.toString()}`);\r\n              dispatch(hideLoadingMessage());\r\n              dispatch(setIsLoading(false));\r\n            });\r\n        } else {\r\n          if (!shouldSuppressMessages) {\r\n            dispatch(setDisappearingLoadingMessage('Nothing to sync', 2000));\r\n          }\r\n          dispatch(setIsLoading(false));\r\n        }\r\n      } else {\r\n        if (isDirty && forceAction !== 'pull') {\r\n          dispatch(hideLoadingMessage());\r\n          dispatch(setIsLoading(false));\r\n          dispatch(activatePopup('sync-confirmation', { lastServerModifiedAt }));\r\n        } else {\r\n          dispatch(displayFile(path, contents));\r\n          dispatch(applyOpennessState());\r\n          dispatch(setDirty(false));\r\n          dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n          if (!shouldSuppressMessages) {\r\n            dispatch(setDisappearingLoadingMessage('Latest version pulled', 2000));\r\n          }\r\n          dispatch(setIsLoading(false));\r\n        }\r\n      }\r\n    })\r\n    .catch(() => {\r\n      dispatch(hideLoadingMessage());\r\n      dispatch(setIsLoading(false));\r\n      dispatch(setOrgFileErrorMessage('File not found'));\r\n    });\r\n};\r\n\r\nexport const openHeader = headerId => ({\r\n  type: 'OPEN_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const toggleHeaderOpened = headerId => ({\r\n  type: 'TOGGLE_HEADER_OPENED',\r\n  headerId,\r\n});\r\n\r\nexport const selectHeader = headerId => dispatch => {\r\n  dispatch({ type: 'SELECT_HEADER', headerId });\r\n\r\n  if (!!headerId) {\r\n    dispatch(setSelectedTableCellId(null));\r\n    dispatch(setSelectedListItemId(null));\r\n  }\r\n};\r\n\r\nexport const selectHeaderAndOpenParents = headerId => dispatch => {\r\n  dispatch(selectHeader(headerId));\r\n  dispatch({ type: 'OPEN_PARENTS_OF_HEADER', headerId });\r\n};\r\n\r\nexport const advanceTodoState = (headerId = null) => ({\r\n  type: 'ADVANCE_TODO_STATE',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const enterEditMode = editModeType => ({\r\n  type: 'ENTER_EDIT_MODE',\r\n  editModeType,\r\n});\r\n\r\nexport const exitEditMode = () => ({\r\n  type: 'EXIT_EDIT_MODE',\r\n});\r\n\r\nexport const updateHeaderTitle = (headerId, newRawTitle) => ({\r\n  type: 'UPDATE_HEADER_TITLE',\r\n  headerId,\r\n  newRawTitle,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateHeaderDescription = (headerId, newRawDescription) => ({\r\n  type: 'UPDATE_HEADER_DESCRIPTION',\r\n  headerId,\r\n  newRawDescription,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addHeader = headerId => ({\r\n  type: 'ADD_HEADER',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const selectNextSiblingHeader = headerId => ({\r\n  type: 'SELECT_NEXT_SIBLING_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const addHeaderAndEdit = headerId => dispatch => {\r\n  dispatch(addHeader(headerId));\r\n  dispatch(selectNextSiblingHeader(headerId));\r\n  dispatch(enterEditMode('title'));\r\n};\r\n\r\nexport const selectNextVisibleHeader = headerId => ({\r\n  type: 'SELECT_NEXT_VISIBLE_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const selectPreviousVisibleHeader = headerId => ({\r\n  type: 'SELECT_PREVIOUS_VISIBLE_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const removeHeader = headerId => ({\r\n  type: 'REMOVE_HEADER',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderUp = headerId => ({\r\n  type: 'MOVE_HEADER_UP',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderDown = headerId => ({\r\n  type: 'MOVE_HEADER_DOWN',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderLeft = headerId => ({\r\n  type: 'MOVE_HEADER_LEFT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveHeaderRight = headerId => ({\r\n  type: 'MOVE_HEADER_RIGHT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveSubtreeLeft = headerId => ({\r\n  type: 'MOVE_SUBTREE_LEFT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveSubtreeRight = headerId => ({\r\n  type: 'MOVE_SUBTREE_RIGHT',\r\n  headerId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const focusHeader = headerId => ({\r\n  type: 'FOCUS_HEADER',\r\n  headerId,\r\n});\r\n\r\nexport const unfocusHeader = () => ({\r\n  type: 'UNFOCUS_HEADER',\r\n});\r\n\r\nexport const noOp = () => ({\r\n  type: 'NO_OP',\r\n});\r\n\r\nexport const applyOpennessState = () => ({\r\n  type: 'APPLY_OPENNESS_STATE',\r\n});\r\n\r\nexport const setDirty = isDirty => ({\r\n  type: 'SET_DIRTY',\r\n  isDirty,\r\n});\r\n\r\nexport const setSelectedTableCellId = cellId => dispatch => {\r\n  dispatch({ type: 'SET_SELECTED_TABLE_CELL_ID', cellId });\r\n\r\n  if (!!cellId) {\r\n    dispatch(selectHeader(null));\r\n    dispatch(setSelectedListItemId(null));\r\n  }\r\n};\r\n\r\nexport const addNewTableRow = () => ({\r\n  type: 'ADD_NEW_TABLE_ROW',\r\n  dirtying: true,\r\n});\r\n\r\nexport const removeTableRow = () => ({\r\n  type: 'REMOVE_TABLE_ROW',\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewTableColumn = () => ({\r\n  type: 'ADD_NEW_TABLE_COLUMN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const removeTableColumn = () => ({\r\n  type: 'REMOVE_TABLE_COLUMN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableRowDown = () => ({\r\n  type: 'MOVE_TABLE_ROW_DOWN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableRowUp = () => ({\r\n  type: 'MOVE_TABLE_ROW_UP',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableColumnLeft = () => ({\r\n  type: 'MOVE_TABLE_COLUMN_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveTableColumnRight = () => ({\r\n  type: 'MOVE_TABLE_COLUMN_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateTableCellValue = (cellId, newValue) => ({\r\n  type: 'UPDATE_TABLE_CELL_VALUE',\r\n  cellId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const insertCapture = (templateId, content, shouldPrepend) => (dispatch, getState) => {\r\n  dispatch(closePopup());\r\n\r\n  const template = getState()\r\n    .capture.get('captureTemplates')\r\n    .concat(sampleCaptureTemplates)\r\n    .find(template => template.get('id') === templateId);\r\n  dispatch({ type: 'INSERT_CAPTURE', template, content, shouldPrepend, dirtying: true });\r\n};\r\n\r\nexport const clearPendingCapture = () => ({\r\n  type: 'CLEAR_PENDING_CAPTURE',\r\n});\r\n\r\nexport const insertPendingCapture = () => (dispatch, getState) => {\r\n  const pendingCapture = getState().org.present.get('pendingCapture');\r\n  const templateName = pendingCapture.get('captureTemplateName');\r\n  const captureContent = pendingCapture.get('captureContent');\r\n  const customCaptureVariables = pendingCapture.get('customCaptureVariables');\r\n\r\n  dispatch(clearPendingCapture());\r\n  window.history.pushState({}, '', window.location.pathname);\r\n\r\n  const template = getState()\r\n    .capture.get('captureTemplates')\r\n    .filter(\r\n      template =>\r\n        template.get('isAvailableInAllOrgFiles') ||\r\n        template.get('orgFilesWhereAvailable').includes(getState().org.present.get('path'))\r\n    )\r\n    .find(template => template.get('description').trim() === templateName.trim());\r\n  if (!template) {\r\n    dispatch(\r\n      setDisappearingLoadingMessage(\r\n        `Capture failed: \"${templateName}\" template not found or not available in this file`,\r\n        8000\r\n      )\r\n    );\r\n    return;\r\n  }\r\n\r\n  const targetHeader = headerWithPath(\r\n    getState().org.present.get('headers'),\r\n    template.get('headerPaths')\r\n  );\r\n  if (!targetHeader) {\r\n    dispatch(\r\n      setDisappearingLoadingMessage(\r\n        `Capture failed: \"${template.get('description')}\" header path invalid in this file`,\r\n        8000\r\n      )\r\n    );\r\n    return;\r\n  }\r\n\r\n  const [substitutedTemplate, initialCursorIndex] = substituteTemplateVariables(\r\n    template.get('template'),\r\n    customCaptureVariables\r\n  );\r\n\r\n  const content = !!initialCursorIndex\r\n    ? `${substitutedTemplate.substring(\r\n        0,\r\n        initialCursorIndex\r\n      )}${captureContent}${substitutedTemplate.substring(initialCursorIndex)}`\r\n    : `${substitutedTemplate}${captureContent}`;\r\n\r\n  dispatch(insertCapture(template.get('id'), content, template.get('shouldPrepend')));\r\n  dispatch(sync({ successMessage: 'Item captured' }));\r\n};\r\n\r\nexport const advanceCheckboxState = listItemId => ({\r\n  type: 'ADVANCE_CHECKBOX_STATE',\r\n  listItemId,\r\n  dirtying: true,\r\n});\r\n\r\nexport const setSelectedListItemId = listItemId => dispatch => {\r\n  dispatch({ type: 'SET_SELECTED_LIST_ITEM_ID', listItemId });\r\n\r\n  if (!!listItemId) {\r\n    dispatch(selectHeader(null));\r\n    dispatch(setSelectedTableCellId(null));\r\n  }\r\n};\r\n\r\nexport const updateListTitleValue = (listItemId, newValue) => ({\r\n  type: 'UPDATE_LIST_TITLE_VALUE',\r\n  listItemId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updateListContentsValue = (listItemId, newValue) => ({\r\n  type: 'UPDATE_LIST_CONTENTS_VALUE',\r\n  listItemId,\r\n  newValue,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewListItem = () => ({\r\n  type: 'ADD_NEW_LIST_ITEM',\r\n  dirtying: true,\r\n});\r\n\r\nexport const selectNextSiblingListItem = () => ({\r\n  type: 'SELECT_NEXT_SIBLING_LIST_ITEM',\r\n});\r\n\r\nexport const addNewListItemAndEdit = () => dispatch => {\r\n  dispatch(addNewListItem());\r\n  dispatch(selectNextSiblingListItem());\r\n  dispatch(enterEditMode('list-title'));\r\n};\r\n\r\nexport const removeListItem = () => ({\r\n  type: 'REMOVE_LIST_ITEM',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemUp = () => ({\r\n  type: 'MOVE_LIST_ITEM_UP',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemDown = () => ({\r\n  type: 'MOVE_LIST_ITEM_DOWN',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemLeft = () => ({\r\n  type: 'MOVE_LIST_ITEM_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListItemRight = () => ({\r\n  type: 'MOVE_LIST_ITEM_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListSubtreeLeft = () => ({\r\n  type: 'MOVE_LIST_SUBTREE_LEFT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const moveListSubtreeRight = () => ({\r\n  type: 'MOVE_LIST_SUBTREE_RIGHT',\r\n  dirtying: true,\r\n});\r\n\r\nexport const setHeaderTags = (headerId, tags) => ({\r\n  type: 'SET_HEADER_TAGS',\r\n  headerId,\r\n  tags,\r\n  dirtying: true,\r\n});\r\n\r\nexport const reorderTags = (fromIndex, toIndex) => ({\r\n  type: 'REORDER_TAGS',\r\n  fromIndex,\r\n  toIndex,\r\n  dirtying: true,\r\n});\r\n\r\nexport const reorderPropertyList = (fromIndex, toIndex) => (dispatch, getState) =>\r\n  dispatch({\r\n    type: 'REORDER_PROPERTY_LIST',\r\n    fromIndex,\r\n    toIndex,\r\n    headerId: getState().base.getIn(['activePopup', 'data', 'headerId']),\r\n    dirtying: true,\r\n  });\r\n\r\nexport const updateTimestampWithId = (timestampId, newTimestamp) => ({\r\n  type: 'UPDATE_TIMESTAMP_WITH_ID',\r\n  timestampId,\r\n  newTimestamp,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updatePlanningItemTimestamp = (headerId, planningItemIndex, newTimestamp) => ({\r\n  type: 'UPDATE_PLANNING_ITEM_TIMESTAMP',\r\n  headerId,\r\n  planningItemIndex,\r\n  newTimestamp,\r\n  dirtying: true,\r\n});\r\n\r\nexport const addNewPlanningItem = (headerId, planningType) => ({\r\n  type: 'ADD_NEW_PLANNING_ITEM',\r\n  headerId,\r\n  planningType,\r\n  dirtying: true,\r\n});\r\n\r\nexport const updatePropertyListItems = (headerId, newPropertyListItems) => ({\r\n  type: 'UPDATE_PROPERTY_LIST_ITEMS',\r\n  headerId,\r\n  newPropertyListItems,\r\n  dirtying: true,\r\n});\r\n\r\nexport const setOrgFileErrorMessage = message => ({\r\n  type: 'SET_ORG_FILE_ERROR_MESSAGE',\r\n  message,\r\n});\r\n","import { sync } from '../actions/org';\r\n\r\nexport default store => next => action => {\r\n  if (action.dirtying && store.getState().base.get('shouldLiveSync')) {\r\n    store.dispatch(sync({ shouldSuppressMessages: true }));\r\n  }\r\n\r\n  return next(action);\r\n};\r\n","import { sync } from '../actions/org';\r\nimport { debounce } from 'lodash';\r\n\r\nconst dispatchSync = store => store.dispatch(sync({ shouldSuppressMessages: true }));\r\n\r\n// The 'visibilitychange' event might get triggered in some browsers many times for one 'real'\r\n// event of the browser becoming visible to the user. Debouncing through lodash ensures that\r\n// it is called at maximum once every second.\r\nvar debouncedDispatchSync = debounce(dispatchSync, 1000);\r\n\r\nexport default store => next => action => {\r\n  window.addEventListener('visibilitychange', () => {\r\n    if (store.getState().base.get('shouldSyncOnBecomingVisibile')) {\r\n      debouncedDispatchSync(store);\r\n    }\r\n  });\r\n\r\n  return next(action);\r\n};\r\n","export const addNewEmptyCaptureTemplate = () => ({\r\n  type: 'ADD_NEW_EMPTY_CAPTURE_TEMPLATE',\r\n});\r\n\r\nexport const updateTemplateFieldPathValue = (templateId, fieldPath, newValue) => ({\r\n  type: 'UPDATE_TEMPLATE_FIELD_PATH_VALUE',\r\n  templateId,\r\n  fieldPath,\r\n  newValue,\r\n});\r\n\r\nexport const addNewTemplateOrgFileAvailability = templateId => ({\r\n  type: 'ADD_NEW_TEMPLATE_ORG_FILE_AVAILABILITY',\r\n  templateId,\r\n});\r\n\r\nexport const removeTemplateOrgFileAvailability = (templateId, orgFileAvailabilityIndex) => ({\r\n  type: 'REMOVE_TEMPLATE_ORG_FILE_AVAILABILITY',\r\n  templateId,\r\n  orgFileAvailabilityIndex,\r\n});\r\n\r\nexport const addNewTemplateHeaderPath = templateId => ({\r\n  type: 'ADD_NEW_TEMPLATE_HEADER_PATH',\r\n  templateId,\r\n});\r\n\r\nexport const removeTemplateHeaderPath = (templateId, headerPathIndex) => ({\r\n  type: 'REMOVE_TEMPLATE_HEADER_PATH',\r\n  templateId,\r\n  headerPathIndex,\r\n});\r\n\r\nexport const deleteTemplate = templateId => ({\r\n  type: 'DELETE_TEMPLATE',\r\n  templateId,\r\n});\r\n\r\nexport const restoreCaptureSettings = newSettings => ({\r\n  type: 'RESTORE_CAPTURE_SETTINGS',\r\n  newSettings,\r\n});\r\n\r\nexport const reorderCaptureTemplate = (fromIndex, toIndex) => ({\r\n  type: 'REORDER_CAPTURE_TEMPLATE',\r\n  fromIndex,\r\n  toIndex,\r\n});\r\n","import { Map, List, fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nimport { getOpenHeaderPaths } from '../lib/org_utils';\r\n\r\nimport { restoreBaseSettings } from '../actions/base';\r\nimport { restoreCaptureSettings } from '../actions/capture';\r\n\r\nimport generateId from '../lib/id_generator';\r\n\r\nexport const isLocalStorageAvailable = () => {\r\n  try {\r\n    localStorage.setItem('test', 'test');\r\n    return localStorage.getItem('test') === 'test';\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst debouncedPushConfigToSyncBackend = _.debounce(\r\n  (syncBackendClient, contents) => {\r\n    switch (syncBackendClient.type) {\r\n      case 'Dropbox':\r\n        syncBackendClient\r\n          .createFile('/.org-web-config.json', contents)\r\n          .catch(error =>\r\n            alert(`There was an error trying to push settings to your sync backend: ${error}`)\r\n          );\r\n        break;\r\n      case 'Google Drive':\r\n        syncBackendClient\r\n          .createFile('.org-web-config.json', 'root', contents)\r\n          .catch(error =>\r\n            alert(`There was an error trying to push settings to your sync backend: ${error}`)\r\n          );\r\n        break;\r\n      default:\r\n    }\r\n  },\r\n  1000,\r\n  { maxWait: 3000 }\r\n);\r\n\r\nexport const persistableFields = [\r\n  {\r\n    category: 'base',\r\n    name: 'fontSize',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'bulletStyle',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldTapTodoToAdvance',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n\r\n  {\r\n    category: 'base',\r\n    name: 'agendaDefaultDeadlineDelayUnit',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'agendaDefaultDeadlineDelayValue',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n\r\n  {\r\n    category: 'base',\r\n    name: 'shouldStoreSettingsInSyncBackend',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'lastSeenChangelogHeader',\r\n    type: 'nullable',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'customKeybindings',\r\n    type: 'json',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldLiveSync',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: false,\r\n  },\r\n  {\r\n    category: 'base',\r\n    name: 'shouldSyncOnBecomingVisibile',\r\n    type: 'boolean',\r\n    shouldStoreInConfig: true,\r\n  },\r\n  {\r\n    category: 'capture',\r\n    name: 'captureTemplates',\r\n    type: 'json',\r\n    shouldStoreInConfig: true,\r\n    default: new List(),\r\n  },\r\n];\r\n\r\nexport const readOpennessState = () => {\r\n  const opennessStateJSONString = localStorage.getItem('headerOpenness');\r\n  return !!opennessStateJSONString ? JSON.parse(opennessStateJSONString) : null;\r\n};\r\n\r\nconst getFieldsToPersist = (state, fields) =>\r\n  fields\r\n    .filter(field => !field.depreacted)\r\n    .filter(field => field.category === 'org')\r\n    .map(field => field.name)\r\n    .map(field => [field, state.org.present.get(field)])\r\n    .concat(\r\n      persistableFields\r\n        .filter(field => field.category !== 'org')\r\n        .map(field =>\r\n          field.type === 'json'\r\n            ? [\r\n                field.name,\r\n                JSON.stringify(state[field.category].get(field.name) || field.default || {}),\r\n              ]\r\n            : [field.name, state[field.category].get(field.name)]\r\n        )\r\n    );\r\n\r\nconst getConfigFileContents = fieldsToPersist =>\r\n  JSON.stringify(\r\n    _.fromPairs(\r\n      fieldsToPersist.filter(([name, _value]) => !['lastSeenChangelogHeader'].includes(name))\r\n    ),\r\n    null,\r\n    2\r\n  );\r\n\r\nexport const applyCategorySettingsFromConfig = (state, config, category) => {\r\n  persistableFields\r\n    .filter(field => field.category === category)\r\n    .filter(field => field.shouldStoreInConfig)\r\n    .filter(\r\n      field =>\r\n        // I accidentally included this field in some config files, so I need to forever\r\n        // filter it out here. Whoops...\r\n        field.name !== 'lastSeenChangelogHeader'\r\n    )\r\n    .forEach(field => {\r\n      field.type === 'json'\r\n        ? (state = state.set(field.name, fromJS(JSON.parse(config[field.name]))))\r\n        : (state = state.set(field.name, config[field.name]));\r\n    });\r\n\r\n  return state;\r\n};\r\n\r\nexport const applyCaptureSettingsFromConfig = (state, config) => {\r\n  const captureTemplates = fromJS(JSON.parse(config.captureTemplates)).map(template =>\r\n    template.set('id', generateId())\r\n  );\r\n\r\n  return state.set('captureTemplates', captureTemplates);\r\n};\r\n\r\nexport const readInitialState = () => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return undefined;\r\n  }\r\n\r\n  let initialState = {\r\n    syncBackend: Map(),\r\n    org: {\r\n      past: [],\r\n      present: Map(),\r\n      future: [],\r\n    },\r\n    base: Map(),\r\n    capture: Map(),\r\n  };\r\n\r\n  persistableFields.forEach(field => {\r\n    let value = localStorage.getItem(field.name);\r\n\r\n    if (field.type === 'nullable') {\r\n      if (value === 'null') {\r\n        value = null;\r\n      }\r\n    } else if (field.type === 'boolean') {\r\n      value = value === 'true';\r\n    } else if (field.type === 'json') {\r\n      if (!value) {\r\n        value = field.default || new Map();\r\n      } else {\r\n        value = fromJS(JSON.parse(value));\r\n      }\r\n    }\r\n\r\n    if (field.category === 'org') {\r\n      initialState[field.category].present = initialState[field.category].present.set(\r\n        field.name,\r\n        value\r\n      );\r\n    } else {\r\n      initialState[field.category] = initialState[field.category].set(field.name, value);\r\n    }\r\n  });\r\n\r\n  // Assign new ids to the capture templates.\r\n  if (initialState.capture.get('captureTemplates')) {\r\n    initialState.capture = initialState.capture.update('captureTemplates', templates =>\r\n      templates.map(template => template.set('id', generateId()))\r\n    );\r\n  }\r\n\r\n  const opennessState = readOpennessState();\r\n  if (!!opennessState) {\r\n    initialState.org.present = initialState.org.present.set('opennessState', fromJS(opennessState));\r\n  }\r\n\r\n  // Cache the config file contents locally so we don't overwrite on initial page load.\r\n  window.previousSettingsFileContents = getConfigFileContents(\r\n    getFieldsToPersist(initialState, persistableFields)\r\n  );\r\n\r\n  return initialState;\r\n};\r\n\r\nexport const loadSettingsFromConfigFile = (dispatch, getState) => {\r\n  const syncBackendClient = getState().syncBackend.get('client');\r\n  if (!syncBackendClient) {\r\n    return;\r\n  }\r\n\r\n  let fileContentsPromise = null;\r\n  switch (syncBackendClient.type) {\r\n    case 'Dropbox':\r\n      fileContentsPromise = syncBackendClient.getFileContents('/.org-web-config.json');\r\n      break;\r\n    case 'Google Drive':\r\n      fileContentsPromise = syncBackendClient.getFileContentsByNameAndParent(\r\n        '.org-web-config.json',\r\n        'root'\r\n      );\r\n      break;\r\n    default:\r\n  }\r\n\r\n  fileContentsPromise\r\n    .then(configFileContents => {\r\n      try {\r\n        const config = JSON.parse(configFileContents);\r\n        dispatch(restoreBaseSettings(config));\r\n        dispatch(restoreCaptureSettings(config));\r\n      } catch (_error) {\r\n        // Something went wrong parsing the config file, but we don't care, we'll just\r\n        // overwrite it with a good local copy.\r\n      }\r\n    })\r\n    .catch(() => {});\r\n};\r\n\r\nexport const subscribeToChanges = store => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return () => {};\r\n  } else {\r\n    return () => {\r\n      const state = store.getState();\r\n\r\n      const fieldsToPersist = getFieldsToPersist(state, persistableFields);\r\n\r\n      fieldsToPersist.forEach(([name, value]) => localStorage.setItem(name, value));\r\n\r\n      if (state.base.get('shouldStoreSettingsInSyncBackend')) {\r\n        const settingsFileContents = getConfigFileContents(fieldsToPersist);\r\n\r\n        if (window.previousSettingsFileContents !== settingsFileContents) {\r\n          debouncedPushConfigToSyncBackend(state.syncBackend.get('client'), settingsFileContents);\r\n        }\r\n\r\n        window.previousSettingsFileContents = settingsFileContents;\r\n      }\r\n\r\n      const currentFilePath = state.org.present.get('path');\r\n      if (!!currentFilePath && state.org.present.get('headers')) {\r\n        const openHeaderPaths = getOpenHeaderPaths(state.org.present.get('headers'));\r\n\r\n        let opennessState = {};\r\n        const opennessStateJSONString = localStorage.getItem('headerOpenness');\r\n        if (opennessStateJSONString) {\r\n          opennessState = JSON.parse(opennessStateJSONString);\r\n        }\r\n\r\n        opennessState[currentFilePath] = openHeaderPaths;\r\n        localStorage.setItem('headerOpenness', JSON.stringify(opennessState));\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport const persistField = (field, value) => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return;\r\n  } else {\r\n    localStorage.setItem(field, value);\r\n  }\r\n};\r\n\r\nexport const getPersistedField = (field, nullable = false) => {\r\n  if (!isLocalStorageAvailable()) {\r\n    return null;\r\n  } else {\r\n    const value = localStorage.getItem(field);\r\n    if (nullable) {\r\n      return value === 'null' ? null : value;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\n\r\nimport { applyCategorySettingsFromConfig } from '../util/settings_persister';\r\n\r\nconst setLoadingMessage = (state, action) => state.set('loadingMessage', action.loadingMessage);\r\n\r\nconst hideLoadingMessage = (state, action) => state.set('loadingMessage', null);\r\n\r\nconst setFontSize = (state, action) => state.set('fontSize', action.newFontSize);\r\n\r\nconst setBulletStyle = (state, action) => state.set('bulletStyle', action.newBulletStyle);\r\n\r\nconst setShouldTapTodoToAdvance = (state, action) =>\r\n  state.set('shouldTapTodoToAdvance', action.newShouldTapTodoToAdvance);\r\n\r\nconst setAgendaDefaultDeadlineDelayUnit = (state, action) =>\r\n  state.set('agendaDefaultDeadlineDelayUnit', action.newAgendaDefaultDeadlineDelayUnit);\r\n\r\nconst setAgendaDefaultDeadlineDelayValue = (state, action) =>\r\n  state.set('agendaDefaultDeadlineDelayValue', action.newAgendaDefaultDeadlineDelayValue);\r\n\r\nconst setShouldStoreSettingsInSyncBackend = (state, action) =>\r\n  state.set('shouldStoreSettingsInSyncBackend', action.newShouldStoreSettingsInSyncBackend);\r\n\r\nconst setShouldLiveSync = (state, action) => state.set('shouldLiveSync', action.shouldLiveSync);\r\n\r\nconst setShouldSyncOnBecomingVisibile = (state, action) =>\r\n  state.set('shouldSyncOnBecomingVisibile', action.shouldSyncOnBecomingVisibile);\r\n\r\nconst setHasUnseenChangelog = (state, action) =>\r\n  state.set('hasUnseenChangelog', action.newHasUnseenChangelog);\r\n\r\nconst setLastSeenChangelogHeader = (state, action) =>\r\n  state.set('lastSeenChangelogHeader', action.newLastSeenChangelogHeader);\r\n\r\nconst setLastViewedFile = (state, action) =>\r\n  state\r\n    .set('lastViewedPath', action.lastViewedPath)\r\n    .set('lastViewedContents', action.lastViewedContents);\r\n\r\nconst setCustomKeybinding = (state, action) => {\r\n  if (!state.get('customKeybindings')) {\r\n    state = state.set('customKeybindings', new Map());\r\n  }\r\n\r\n  return state.setIn(['customKeybindings', action.keybindingName], action.keybinding);\r\n};\r\n\r\nconst restoreBaseSettings = (state, action) => {\r\n  if (!action.newSettings) {\r\n    return state;\r\n  }\r\n\r\n  return applyCategorySettingsFromConfig(state, action.newSettings, 'base');\r\n};\r\n\r\nconst pushModalPage = (state, action) =>\r\n  state.update('modalPageStack', stack =>\r\n    !!stack ? stack.push(action.modalPage) : List([action.modalPage])\r\n  );\r\n\r\nconst popModalPage = state =>\r\n  state.update('modalPageStack', stack => (!!stack ? stack.pop() : stack));\r\n\r\nconst clearModalStack = state => state.set('modalPageStack', List());\r\n\r\nconst activatePopup = (state, action) =>\r\n  state.set(\r\n    'activePopup',\r\n    fromJS({\r\n      type: action.popupType,\r\n      data: action.data,\r\n    })\r\n  );\r\n\r\nconst closePopup = state => state.set('activePopup', null);\r\n\r\nconst setIsLoading = (state, action) => state.set('isLoading', action.isLoading);\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'SET_LOADING_MESSAGE':\r\n      return setLoadingMessage(state, action);\r\n    case 'HIDE_LOADING_MESSAGE':\r\n      return hideLoadingMessage(state, action);\r\n    case 'SET_FONT_SIZE':\r\n      return setFontSize(state, action);\r\n    case 'SET_BULLET_STYLE':\r\n      return setBulletStyle(state, action);\r\n    case 'SET_SHOULD_TAP_TODO_TO_ADVANCE':\r\n      return setShouldTapTodoToAdvance(state, action);\r\n    case 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_UNIT':\r\n      return setAgendaDefaultDeadlineDelayUnit(state, action);\r\n    case 'SET_AGENDA_DEFAULT_DEADLINE_DELAY_VALUE':\r\n      return setAgendaDefaultDeadlineDelayValue(state, action);\r\n    case 'SET_SHOULD_STORE_SETTINGS_IN_SYNC_BACKEND':\r\n      return setShouldStoreSettingsInSyncBackend(state, action);\r\n    case 'SET_SHOULD_LIVE_SYNC':\r\n      return setShouldLiveSync(state, action);\r\n    case 'SET_SHOULD_SYNC_ON_BECOMING_VISIBLE':\r\n      return setShouldSyncOnBecomingVisibile(state, action);\r\n    case 'SET_HAS_UNSEEN_CHANGELOG':\r\n      return setHasUnseenChangelog(state, action);\r\n    case 'SET_LAST_SEEN_CHANGELOG_HEADER':\r\n      return setLastSeenChangelogHeader(state, action);\r\n    case 'SET_LAST_VIEWED_FILE':\r\n      return setLastViewedFile(state, action);\r\n    case 'SET_CUSTOM_KEYBINDING':\r\n      return setCustomKeybinding(state, action);\r\n    case 'RESTORE_BASE_SETTINGS':\r\n      return restoreBaseSettings(state, action);\r\n    case 'PUSH_MODAL_PAGE':\r\n      return pushModalPage(state, action);\r\n    case 'POP_MODAL_PAGE':\r\n      return popModalPage(state, action);\r\n    case 'CLEAR_MODAL_STACK':\r\n      return clearModalStack(state, action);\r\n    case 'ACTIVATE_POPUP':\r\n      return activatePopup(state, action);\r\n    case 'CLOSE_POPUP':\r\n      return closePopup(state, action);\r\n    case 'SET_IS_LOADING':\r\n      return setIsLoading(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import generateId from './id_generator';\r\n\r\nimport { fromJS, List } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\n// Yeah, this thing is pretty wild. I use https://www.debuggex.com/ to edit it, then paste the results in here.\r\n// But fixing this mess is on my todo list...\r\nconst markupAndCookieRegex = /(\\[\\[([^\\]]*)\\]\\]|\\[\\[([^\\]]*)\\]\\[([^\\]]*)\\]\\])|(\\[((\\d*%)|(\\d*\\/\\d*))\\])|(([\\s({'\"]?)([*/~=_+])([^\\s,'](.*)[^\\s,'])\\11([\\s\\-.,:!?'\")}]?))|(([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]](?:--([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]])?)/g;\r\nconst timestampRegex = /([<[])(\\d{4})-(\\d{2})-(\\d{2})(?: ([^0-9]{1,9}))?(?: ([012]?\\d:[0-5]\\d))?(?:-([012]?\\d:[0-5]\\d))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?(?: ((?:\\+)|(?:\\+\\+)|(?:\\.\\+)|(?:-)|(?:--))(\\d+)(h|d|w|m|y))?[>\\]]/;\r\n\r\nconst timestampFromRegexMatch = (match, partIndices) => {\r\n  const [\r\n    typeBracket,\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    timeStart,\r\n    timeEnd,\r\n    firstDelayRepeatType,\r\n    firstDelayRepeatValue,\r\n    firstDelayRepeatUnit,\r\n    secondDelayRepeatType,\r\n    secondDelayRepeatValue,\r\n    secondDelayRepeatUnit,\r\n  ] = partIndices.map(partIndex => match[partIndex]);\r\n\r\n  if (!year) {\r\n    return null;\r\n  }\r\n\r\n  const [startHour, startMinute] = !!timeStart ? timeStart.split(':') : [];\r\n  const [endHour, endMinute] = !!timeEnd ? timeEnd.split(':') : [];\r\n\r\n  let repeaterType, repeaterValue, repeaterUnit;\r\n  let delayType, delayValue, delayUnit;\r\n\r\n  if (['+', '++', '.+'].includes(firstDelayRepeatType)) {\r\n    repeaterType = firstDelayRepeatType;\r\n    repeaterValue = firstDelayRepeatValue;\r\n    repeaterUnit = firstDelayRepeatUnit;\r\n  } else if (['-', '--'].includes(firstDelayRepeatType)) {\r\n    delayType = firstDelayRepeatType;\r\n    delayValue = firstDelayRepeatValue;\r\n    delayUnit = firstDelayRepeatUnit;\r\n  }\r\n  if (['+', '++', '.+'].includes(secondDelayRepeatType)) {\r\n    repeaterType = secondDelayRepeatType;\r\n    repeaterValue = secondDelayRepeatValue;\r\n    repeaterUnit = secondDelayRepeatUnit;\r\n  } else if (['-', '--'].includes(secondDelayRepeatType)) {\r\n    delayType = secondDelayRepeatType;\r\n    delayValue = secondDelayRepeatValue;\r\n    delayUnit = secondDelayRepeatUnit;\r\n  }\r\n\r\n  return {\r\n    isActive: typeBracket === '<',\r\n    year,\r\n    month,\r\n    day,\r\n    dayName,\r\n    startHour,\r\n    startMinute,\r\n    endHour,\r\n    endMinute,\r\n    repeaterType,\r\n    repeaterValue,\r\n    repeaterUnit,\r\n    delayType,\r\n    delayValue,\r\n    delayUnit,\r\n  };\r\n};\r\n\r\nexport const parseMarkupAndCookies = (\r\n  rawText,\r\n  { shouldAppendNewline = false, excludeCookies = true } = {}\r\n) => {\r\n  const matches = [];\r\n  let match = markupAndCookieRegex.exec(rawText);\r\n  while (match) {\r\n    if (!!match[2]) {\r\n      matches.push({\r\n        type: 'link',\r\n        rawText: match[0],\r\n        uri: match[2],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[3] && !!match[4]) {\r\n      matches.push({\r\n        type: 'link',\r\n        rawText: match[0],\r\n        uri: match[3],\r\n        title: match[4],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[7]) {\r\n      const percentCookieMatch = match[7].match(/(\\d*)%/);\r\n      matches.push({\r\n        type: 'percentage-cookie',\r\n        rawText: match[0],\r\n        percentage: percentCookieMatch[1],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[8]) {\r\n      const fractionCookieMatch = match[8].match(/(\\d*)\\/(\\d*)/);\r\n      matches.push({\r\n        type: 'fraction-cookie',\r\n        rawText: match[0],\r\n        fraction: [fractionCookieMatch[1], fractionCookieMatch[2]],\r\n        index: match.index,\r\n      });\r\n    } else if (!!match[11]) {\r\n      const markupType = {\r\n        '~': 'inline-code',\r\n        '*': 'bold',\r\n        '/': 'italic',\r\n        '+': 'strikethrough',\r\n        _: 'underline',\r\n        '=': 'verbatim',\r\n      }[match[11]];\r\n\r\n      const markupPrefixLength = match[10].length;\r\n\r\n      matches.push({\r\n        type: 'inline-markup',\r\n        rawText: match[0].substring(markupPrefixLength, match[12].length + 2 + markupPrefixLength),\r\n        index: match.index + markupPrefixLength,\r\n        content: match[12],\r\n        markupType,\r\n      });\r\n    } else if (!!match[15]) {\r\n      const firstTimestamp = timestampFromRegexMatch(match, _.range(16, 29));\r\n      const secondTimestamp = timestampFromRegexMatch(match, _.range(29, 42));\r\n\r\n      matches.push({\r\n        type: 'timestamp',\r\n        rawText: match[0],\r\n        index: match.index,\r\n        firstTimestamp,\r\n        secondTimestamp,\r\n      });\r\n    }\r\n    match = markupAndCookieRegex.exec(rawText);\r\n  }\r\n\r\n  const lineParts = [];\r\n  let startIndex = 0;\r\n  matches.forEach(match => {\r\n    let index = match.index;\r\n\r\n    if (index !== startIndex) {\r\n      const text = rawText.substring(startIndex, index);\r\n      lineParts.push({\r\n        type: 'text',\r\n        contents: text,\r\n      });\r\n    }\r\n\r\n    if (match.type === 'link') {\r\n      const linkPart = {\r\n        id: generateId(),\r\n        type: 'link',\r\n        contents: {\r\n          uri: match.uri,\r\n        },\r\n      };\r\n      if (match.title) {\r\n        linkPart.contents.title = match.title;\r\n      }\r\n      lineParts.push(linkPart);\r\n    } else if (match.type === 'percentage-cookie') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'percentage-cookie',\r\n        percentage: match.percentage,\r\n      });\r\n    } else if (match.type === 'fraction-cookie') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'fraction-cookie',\r\n        fraction: match.fraction,\r\n      });\r\n    } else if (match.type === 'inline-markup') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'inline-markup',\r\n        content: match.content,\r\n        markupType: match.markupType,\r\n      });\r\n    } else if (match.type === 'timestamp') {\r\n      lineParts.push({\r\n        id: generateId(),\r\n        type: 'timestamp',\r\n        firstTimestamp: match.firstTimestamp,\r\n        secondTimestamp: match.secondTimestamp,\r\n      });\r\n    }\r\n\r\n    startIndex = match.index + match.rawText.length;\r\n  });\r\n\r\n  if (startIndex !== rawText.length || shouldAppendNewline) {\r\n    const trailingText =\r\n      rawText.substring(startIndex, rawText.length) + (shouldAppendNewline ? '\\n' : '');\r\n    lineParts.push({\r\n      type: 'text',\r\n      contents: trailingText,\r\n    });\r\n  }\r\n\r\n  return lineParts;\r\n};\r\n\r\nconst parseTable = tableLines => {\r\n  const table = {\r\n    id: generateId(),\r\n    type: 'table',\r\n    contents: [[]],\r\n    columnProperties: [],\r\n  };\r\n\r\n  tableLines\r\n    .map(line => line.trim())\r\n    .forEach(line => {\r\n      if (line.startsWith('|-')) {\r\n        table.contents.push([]);\r\n      } else {\r\n        const lastRow = _.last(table.contents);\r\n        const lineCells = line.substr(1, line.length - 2).split('|');\r\n\r\n        if (lastRow.length === 0) {\r\n          lineCells.forEach(cell => lastRow.push(cell));\r\n        } else {\r\n          lineCells.forEach((cellContents, cellIndex) => {\r\n            lastRow[cellIndex] += `\\n${cellContents}`;\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n  // Parse the contents of each cell.\r\n  table.contents = table.contents.map(row => ({\r\n    id: generateId(),\r\n    contents: row.map(rawContents => ({\r\n      id: generateId(),\r\n      contents: parseMarkupAndCookies(rawContents, { excludeCookies: true }),\r\n      rawContents,\r\n    })),\r\n  }));\r\n\r\n  // We sometimes end up with an extra, empty row - remove it if so.\r\n  if (_.last(table.contents).contents.length === 0) {\r\n    table.contents = table.contents.slice(0, table.contents.length - 1);\r\n  }\r\n\r\n  // Make sure each row has the same number of columns.\r\n  const maxNumColumns = Math.max(...table.contents.map(row => row.contents.length));\r\n  table.contents.forEach(row => {\r\n    if (row.contents.length < maxNumColumns) {\r\n      _.times(maxNumColumns - row.contents.length, () => {\r\n        row.contents.push({\r\n          id: generateId(),\r\n          contents: [],\r\n          rawContents: '',\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n  return table;\r\n};\r\n\r\nexport const parseRawText = (rawText, { excludeContentElements = false } = {}) => {\r\n  const lines = rawText.split('\\n');\r\n\r\n  const LIST_HEADER_REGEX = /^\\s*([-+*]|(\\d+(\\.|\\)))) (.*)/;\r\n\r\n  let currentListHeaderNestingLevel = null;\r\n  const rawLineParts = _.flatten(\r\n    lines.map((line, lineIndex) => {\r\n      const numLeadingSpaces = line.match(/^( *)/)[0].length;\r\n\r\n      if (\r\n        currentListHeaderNestingLevel !== null &&\r\n        (numLeadingSpaces > currentListHeaderNestingLevel || !line.trim())\r\n      ) {\r\n        return [\r\n          {\r\n            type: 'raw-list-content',\r\n            line,\r\n          },\r\n        ];\r\n      } else {\r\n        currentListHeaderNestingLevel = null;\r\n\r\n        if (!!line.match(LIST_HEADER_REGEX) && !excludeContentElements) {\r\n          currentListHeaderNestingLevel = numLeadingSpaces;\r\n\r\n          return [\r\n            {\r\n              type: 'raw-list-header',\r\n              line,\r\n            },\r\n          ];\r\n        } else if (line.trim().startsWith('|') && !excludeContentElements) {\r\n          return [\r\n            {\r\n              type: 'raw-table',\r\n              line,\r\n            },\r\n          ];\r\n        } else {\r\n          return parseMarkupAndCookies(line, {\r\n            shouldAppendNewline: lineIndex !== lines.length - 1,\r\n            excludeCookies: true,\r\n          });\r\n        }\r\n      }\r\n    })\r\n  );\r\n\r\n  const processedLineParts = [];\r\n  for (let partIndex = 0; partIndex < rawLineParts.length; ++partIndex) {\r\n    const linePart = rawLineParts[partIndex];\r\n    if (linePart.type === 'raw-table') {\r\n      const tableLines = _.takeWhile(\r\n        rawLineParts.slice(partIndex),\r\n        part => part.type === 'raw-table'\r\n      ).map(part => part.line);\r\n\r\n      processedLineParts.push(parseTable(tableLines));\r\n\r\n      partIndex += tableLines.length - 1;\r\n    } else if (linePart.type === 'raw-list-header') {\r\n      const numLeadingSpaces = linePart.line.match(/^( *)/)[0].length;\r\n      const contentLines = _.takeWhile(\r\n        rawLineParts.slice(partIndex + 1),\r\n        part => part.type === 'raw-list-content'\r\n      )\r\n        .map(part => part.line)\r\n        .map(line =>\r\n          line.startsWith(' '.repeat(numLeadingSpaces + 2))\r\n            ? line.substr(numLeadingSpaces + 2)\r\n            : line.substr(numLeadingSpaces + 1)\r\n        );\r\n      if (contentLines[contentLines.length - 1] === '') {\r\n        contentLines[contentLines.length - 1] = ' ';\r\n      }\r\n      const contents = parseRawText(contentLines.join('\\n')).toJS();\r\n\r\n      partIndex += contentLines.length;\r\n\r\n      const isOrdered = !!linePart.line.match(/^\\s*\\d+[.)]/);\r\n\r\n      // Remove the leading -, +, *, or number characters.\r\n      let line = linePart.line.match(LIST_HEADER_REGEX)[4];\r\n\r\n      let forceNumber = null;\r\n      if (line.match(/^\\s*\\[@\\d+\\]/)) {\r\n        forceNumber = line.match(/^\\s*\\[@(\\d+)\\]/)[1];\r\n        line = line.replace(/^\\s*\\[@\\d+\\]\\s*/, '');\r\n      }\r\n\r\n      let checkboxState = null;\r\n      const isCheckbox = !!line.match(/^\\s*\\[[ X-]\\]/);\r\n      if (isCheckbox) {\r\n        const stateCharacter = line.match(/^\\s*\\[([ X-])\\]/)[1];\r\n        checkboxState = {\r\n          ' ': 'unchecked',\r\n          X: 'checked',\r\n          '-': 'partial',\r\n        }[stateCharacter];\r\n\r\n        line = line.replace(/^\\s*\\[[ X-]\\]\\s*/, '');\r\n      }\r\n\r\n      const newListItem = {\r\n        id: generateId(),\r\n        titleLine: parseMarkupAndCookies(line),\r\n        contents,\r\n        forceNumber,\r\n        isCheckbox,\r\n        checkboxState,\r\n      };\r\n\r\n      const lastIndex = processedLineParts.length - 1;\r\n      if (lastIndex >= 0 && processedLineParts[lastIndex].type === 'list') {\r\n        processedLineParts[lastIndex].items.push(newListItem);\r\n      } else {\r\n        processedLineParts.push({\r\n          type: 'list',\r\n          id: generateId(),\r\n          items: [newListItem],\r\n          bulletCharacter: linePart.line.trim()[0],\r\n          numberTerminatorCharacter: isOrdered ? linePart.line.match(/\\s*\\d+([.)])/)[1] : null,\r\n          isOrdered,\r\n        });\r\n      }\r\n    } else {\r\n      processedLineParts.push(linePart);\r\n    }\r\n  }\r\n\r\n  return fromJS(processedLineParts);\r\n};\r\n\r\nexport const _parsePlanningItems = rawText => {\r\n  const singlePlanningItemRegex = concatRegexes(/(DEADLINE|SCHEDULED|CLOSED):\\s*/, timestampRegex);\r\n  const optionalSinglePlanningItemRegex = RegExp(\r\n    '(' +\r\n      singlePlanningItemRegex\r\n        .toString()\r\n        .substring(1, singlePlanningItemRegex.toString().length - 1) +\r\n      ')?'\r\n  );\r\n\r\n  const planningRegex = concatRegexes(\r\n    /^\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/,\r\n    optionalSinglePlanningItemRegex,\r\n    /\\s*/\r\n  );\r\n  const planningMatch = rawText.match(planningRegex);\r\n\r\n  const planningItems = fromJS(\r\n    [2, 17, 32]\r\n      .map(planningTypeIndex => {\r\n        const type = planningMatch[planningTypeIndex];\r\n        if (!type) {\r\n          return null;\r\n        }\r\n\r\n        const timestamp = timestampFromRegexMatch(\r\n          planningMatch,\r\n          _.range(planningTypeIndex + 1, planningTypeIndex + 1 + 13)\r\n        );\r\n\r\n        return { type, timestamp, id: generateId() };\r\n      })\r\n      .filter(item => !!item)\r\n  );\r\n\r\n  if (planningItems.size > 0) {\r\n    // The `rawText` can look like:\r\n    // `SCHEDULED: <2019-07-30 Tue>\r\n    //   - indented list\r\n    //      - Foo`\r\n    // For the remaining description, filter the planning item out\r\n    const remainingDescriptionWithoutPlanningItem = rawText\r\n      .split('\\n')\r\n      .filter(line => {\r\n        return !line.includes(planningMatch[0].trim());\r\n      })\r\n      .join('\\n');\r\n    return { planningItems, strippedDescription: remainingDescriptionWithoutPlanningItem };\r\n  } else {\r\n    return { planningItems: fromJS([]), strippedDescription: rawText };\r\n  }\r\n};\r\n\r\nconst parsePropertyList = rawText => {\r\n  const lines = rawText.split('\\n');\r\n  const propertiesLineIndex = lines.findIndex(line => line.trim() === ':PROPERTIES:');\r\n  const endLineIndex = lines.findIndex(line => line.trim() === ':END:');\r\n\r\n  if (\r\n    propertiesLineIndex === -1 ||\r\n    endLineIndex === -1 ||\r\n    !rawText.trim().startsWith(':PROPERTIES:')\r\n  ) {\r\n    return {\r\n      propertyListItems: List(),\r\n      strippedDescription: rawText,\r\n    };\r\n  }\r\n\r\n  const propertyListItems = fromJS(\r\n    lines\r\n      .slice(propertiesLineIndex + 1, endLineIndex)\r\n      .map(line => {\r\n        const match = line.match(/:([^\\s]*):(?: (.*))?/);\r\n        if (!match) {\r\n          return null;\r\n        }\r\n\r\n        const value = !!match[2] ? parseMarkupAndCookies(match[2]) : null;\r\n\r\n        return {\r\n          property: match[1],\r\n          value,\r\n          id: generateId(),\r\n        };\r\n      })\r\n      .filter(result => !!result)\r\n  );\r\n\r\n  return {\r\n    propertyListItems,\r\n    strippedDescription: lines.slice(endLineIndex + 1).join('\\n'),\r\n  };\r\n};\r\n\r\nexport const parseDescriptionPrefixElements = rawText => {\r\n  const planningItemsParse = _parsePlanningItems(rawText);\r\n  const propertyListParse = parsePropertyList(planningItemsParse.strippedDescription);\r\n\r\n  return {\r\n    planningItems: planningItemsParse.planningItems,\r\n    propertyListItems: propertyListParse.propertyListItems,\r\n    strippedDescription: propertyListParse.strippedDescription,\r\n  };\r\n};\r\n\r\nconst defaultKeywordSets = fromJS([\r\n  {\r\n    keywords: ['TODO', 'DONE'],\r\n    completedKeywords: ['DONE'],\r\n    default: true,\r\n  },\r\n]);\r\n\r\nexport const parseTitleLine = (titleLine, todoKeywordSets) => {\r\n  const allKeywords = todoKeywordSets.flatMap(todoKeywordSet => {\r\n    return todoKeywordSet.get('keywords');\r\n  });\r\n  const todoKeyword = allKeywords.filter(keyword => titleLine.startsWith(keyword + ' ')).first();\r\n  let rawTitle = titleLine;\r\n  if (todoKeyword) {\r\n    rawTitle = rawTitle.substr(todoKeyword.length + 1);\r\n  }\r\n\r\n  // Check for tags.\r\n  let tags = [];\r\n  if (rawTitle.trimRight().endsWith(':')) {\r\n    const titleParts = rawTitle.trimRight().split(' ');\r\n    const possibleTags = titleParts[titleParts.length - 1];\r\n    if (/^:[^\\s]+:$/.test(possibleTags)) {\r\n      rawTitle = rawTitle.substr(0, rawTitle.length - possibleTags.length);\r\n      tags = possibleTags.split(':').filter(tag => tag !== '');\r\n    }\r\n  }\r\n\r\n  const title = parseMarkupAndCookies(rawTitle);\r\n\r\n  return fromJS({ title, rawTitle, todoKeyword, tags });\r\n};\r\n\r\nexport const newHeaderWithTitle = (line, nestingLevel, todoKeywordSets) => {\r\n  if (todoKeywordSets.size === 0) {\r\n    todoKeywordSets = defaultKeywordSets;\r\n  }\r\n\r\n  const titleLine = parseTitleLine(line, todoKeywordSets);\r\n  return fromJS({\r\n    titleLine,\r\n    rawDescription: '',\r\n    description: [],\r\n    opened: false,\r\n    id: generateId(),\r\n    nestingLevel,\r\n    planningItems: [],\r\n    propertyListItems: [],\r\n  });\r\n};\r\n\r\nconst concatRegexes = (...regexes) =>\r\n  regexes.reduce((prev, curr) =>\r\n    RegExp(\r\n      prev.toString().substring(1, prev.toString().length - 1) +\r\n        curr.toString().substring(1, curr.toString().length - 1)\r\n    )\r\n  );\r\n\r\nexport const newHeaderFromText = (rawText, todoKeywordSets) => {\r\n  const titleLine = rawText.split('\\n')[0].replace(/^\\**\\s*/, '');\r\n  const description = rawText\r\n    .split('\\n')\r\n    .slice(1)\r\n    .join('\\n');\r\n\r\n  const { planningItems, propertyListItems, strippedDescription } = parseDescriptionPrefixElements(\r\n    description\r\n  );\r\n\r\n  return newHeaderWithTitle(titleLine, 1, todoKeywordSets)\r\n    .set('rawDescription', strippedDescription)\r\n    .set('description', parseRawText(strippedDescription))\r\n    .set('planningItems', planningItems)\r\n    .set('propertyListItems', propertyListItems);\r\n};\r\n\r\nexport const parseOrg = fileContents => {\r\n  let headers = new List();\r\n  const lines = fileContents.split('\\n');\r\n\r\n  let todoKeywordSets = new List();\r\n  let fileConfigLines = new List();\r\n  let linesBeforeHeadings = new List();\r\n\r\n  lines.forEach(line => {\r\n    if (line.startsWith('*')) {\r\n      let nestingLevel = line.indexOf(' ');\r\n      if (nestingLevel === -1) {\r\n        nestingLevel = line.length;\r\n      }\r\n      const title = line.substr(nestingLevel + 1);\r\n      headers = headers.push(newHeaderWithTitle(title, nestingLevel, todoKeywordSets));\r\n    } else {\r\n      if (headers.size === 0) {\r\n        if (line.startsWith('#+TODO: ') || line.startsWith('#+TYP_TODO: ')) {\r\n          const keywordsString = line.substr(line.indexOf(':') + 2);\r\n          const keywordTokens = keywordsString.split(/\\s/);\r\n          const keywords = keywordTokens.filter(keyword => keyword !== '|');\r\n\r\n          const pipeIndex = keywordTokens.indexOf('|');\r\n          const completedKeywords = pipeIndex >= 0 ? keywords.slice(pipeIndex) : [];\r\n\r\n          todoKeywordSets = todoKeywordSets.push(\r\n            fromJS({\r\n              keywords,\r\n              completedKeywords,\r\n              configLine: line,\r\n              default: false,\r\n            })\r\n          );\r\n        } else if (line.startsWith('#+')) {\r\n          fileConfigLines = fileConfigLines.push(line);\r\n        } else {\r\n          linesBeforeHeadings = linesBeforeHeadings.push(line);\r\n        }\r\n      } else {\r\n        headers = headers.updateIn([headers.size - 1, 'rawDescription'], rawDescription =>\r\n          rawDescription.length === 0 ? line : rawDescription + '\\n' + line\r\n        );\r\n      }\r\n    }\r\n  });\r\n\r\n  if (todoKeywordSets.size === 0) {\r\n    todoKeywordSets = defaultKeywordSets;\r\n  }\r\n\r\n  headers = headers.map(header => {\r\n    const {\r\n      planningItems,\r\n      propertyListItems,\r\n      strippedDescription,\r\n    } = parseDescriptionPrefixElements(header.get('rawDescription'));\r\n\r\n    return header\r\n      .set('rawDescription', strippedDescription)\r\n      .set('description', parseRawText(strippedDescription))\r\n      .set('planningItems', planningItems)\r\n      .set('propertyListItems', propertyListItems);\r\n  });\r\n\r\n  return fromJS({\r\n    headers,\r\n    todoKeywordSets,\r\n    fileConfigLines,\r\n    linesBeforeHeadings,\r\n  });\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nimport {\r\n  parseOrg,\r\n  parseTitleLine,\r\n  parseRawText,\r\n  parseDescriptionPrefixElements,\r\n  parseMarkupAndCookies,\r\n  newHeaderWithTitle,\r\n  newHeaderFromText,\r\n} from '../lib/parse_org';\r\nimport { attributedStringToRawText } from '../lib/export_org';\r\nimport {\r\n  indexOfHeaderWithId,\r\n  headerWithId,\r\n  parentIdOfHeaderWithId,\r\n  subheadersOfHeaderWithId,\r\n  numSubheadersOfHeaderWithId,\r\n  indexOfPreviousSibling,\r\n  openDirectParent,\r\n  openHeaderWithPath,\r\n  nextVisibleHeaderAfterIndex,\r\n  previousVisibleHeaderAfterIndex,\r\n  updateTableContainingCellId,\r\n  newEmptyTableRowLikeRows,\r\n  newEmptyTableCell,\r\n  headerThatContainsTableCellId,\r\n  headerWithPath,\r\n  pathAndPartOfListItemWithIdInHeaders,\r\n  pathAndPartOfTimestampItemWithIdInHeaders,\r\n  todoKeywordSetForKeyword,\r\n  newListItem,\r\n  parentListItemWithIdInHeaders,\r\n  updateListContainingListItemId,\r\n  headerThatContainsListItemId,\r\n  updateContentsWithListItemAddition,\r\n} from '../lib/org_utils';\r\nimport { getCurrentTimestamp, applyRepeater, renderAsText } from '../lib/timestamps';\r\nimport generateId from '../lib/id_generator';\r\n\r\nconst displayFile = (state, action) => {\r\n  const parsedFile = parseOrg(action.contents);\r\n\r\n  return state\r\n    .set('path', action.path)\r\n    .set('contents', action.contents)\r\n    .set('headers', parsedFile.get('headers'))\r\n    .set('todoKeywordSets', parsedFile.get('todoKeywordSets'))\r\n    .set('fileConfigLines', parsedFile.get('fileConfigLines'))\r\n    .set('linesBeforeHeadings', parsedFile.get('linesBeforeHeadings'));\r\n};\r\n\r\nconst stopDisplayingFile = state =>\r\n  state\r\n    .set('path', null)\r\n    .set('contents', null)\r\n    .set('headers', null)\r\n    .set('todoKeywordSets', null)\r\n    .set('fileConfigLines', null)\r\n    .set('linesBeforeHeadings', null);\r\n\r\nconst openHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  return state.setIn(['headers', headerIndex, 'opened'], true);\r\n};\r\n\r\nconst toggleHeaderOpened = (state, action) => {\r\n  const headers = state.get('headers');\r\n\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  const isOpened = headerWithId(headers, action.headerId).get('opened');\r\n\r\n  if (isOpened && state.get('focusedHeaderId') === action.headerId) {\r\n    return state;\r\n  }\r\n\r\n  if (isOpened) {\r\n    const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n    subheaders.forEach((subheader, index) => {\r\n      state = state.setIn(['headers', headerIndex + index + 1, 'opened'], false);\r\n    });\r\n  }\r\n\r\n  return state.setIn(['headers', headerIndex, 'opened'], !isOpened);\r\n};\r\n\r\nconst selectHeader = (state, action) => {\r\n  return state.set('selectedHeaderId', action.headerId);\r\n};\r\n\r\nconst openParentsOfHeader = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const { headerId } = action;\r\n\r\n  let parentHeaderId = parentIdOfHeaderWithId(headers, headerId);\r\n  while (!!parentHeaderId) {\r\n    const parentHeaderIndex = indexOfHeaderWithId(headers, parentHeaderId);\r\n    headers = headers.setIn([parentHeaderIndex, 'opened'], true);\r\n    parentHeaderId = parentIdOfHeaderWithId(headers, parentHeaderId);\r\n  }\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst updateCookiesInAttributedStringWithChildCompletionStates = (parts, completionStates) => {\r\n  const doneCount = completionStates.filter(isDone => isDone).length;\r\n  const totalCount = completionStates.length;\r\n\r\n  return parts.map(part => {\r\n    switch (part.get('type')) {\r\n      case 'fraction-cookie':\r\n        return part.set('fraction', List([doneCount, totalCount]));\r\n      case 'percentage-cookie':\r\n        return part.set('percentage', Math.floor((doneCount / totalCount) * 100));\r\n      default:\r\n        return part;\r\n    }\r\n  });\r\n};\r\n\r\nconst updateCookiesOfHeaderWithId = (state, headerId) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n  const subheaders = subheadersOfHeaderWithId(headers, headerId);\r\n\r\n  const directChildren = [];\r\n  for (let i = 0; i < subheaders.size; ++i) {\r\n    const subheader = subheaders.get(i);\r\n    directChildren.push(subheader);\r\n\r\n    const subheaderSubheaders = subheadersOfHeaderWithId(headers, subheader.get('id'));\r\n    i += subheaderSubheaders.size;\r\n  }\r\n\r\n  let completionStates = directChildren\r\n    .map(header => header.getIn(['titleLine', 'todoKeyword']))\r\n    .filter(todoKeyword => !!todoKeyword)\r\n    .map(todoKeyword =>\r\n      todoKeywordSetForKeyword(state.get('todoKeywordSets'), todoKeyword)\r\n        .get('completedKeywords')\r\n        .contains(todoKeyword)\r\n    );\r\n\r\n  // If there are no headers with possible completion states, check for plain lists instead.\r\n  if (completionStates.length === 0) {\r\n    completionStates = headers\r\n      .get(headerIndex)\r\n      .get('description')\r\n      .filter(part => part.get('type') === 'list')\r\n      .flatMap(listPart => listPart.get('items'))\r\n      .filter(item => item.get('isCheckbox'))\r\n      .map(item => item.get('checkboxState') === 'checked')\r\n      .toJS();\r\n  }\r\n\r\n  return state\r\n    .updateIn(['headers', headerIndex, 'titleLine', 'title'], title =>\r\n      updateCookiesInAttributedStringWithChildCompletionStates(title, completionStates)\r\n    )\r\n    .updateIn(['headers', headerIndex, 'titleLine'], titleLine =>\r\n      titleLine.set('rawTitle', attributedStringToRawText(titleLine.get('title')))\r\n    );\r\n};\r\n\r\nconst updateCookiesOfParentOfHeaderWithId = (state, headerId) => {\r\n  const parentHeaderId = parentIdOfHeaderWithId(state.get('headers'), headerId);\r\n  if (!parentHeaderId) {\r\n    return state;\r\n  }\r\n\r\n  return updateCookiesOfHeaderWithId(state, parentHeaderId);\r\n};\r\n\r\nconst advanceTodoState = (state, action) => {\r\n  const headerId = action.headerId || state.get('selectedHeaderId');\r\n  if (!headerId) {\r\n    return state;\r\n  }\r\n\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, headerId);\r\n\r\n  const currentTodoState = header.getIn(['titleLine', 'todoKeyword']);\r\n  const currentTodoSet = todoKeywordSetForKeyword(state.get('todoKeywordSets'), currentTodoState);\r\n\r\n  const currentStateIndex = currentTodoSet.get('keywords').indexOf(currentTodoState);\r\n  const newStateIndex = currentStateIndex + 1;\r\n  const newTodoState = currentTodoSet.get('keywords').get(newStateIndex) || '';\r\n\r\n  const indexedPlanningItemsWithRepeaters = header\r\n    .get('planningItems')\r\n    .map((planningItem, index) => [planningItem, index])\r\n    .filter(([planningItem, index]) => !!planningItem.getIn(['timestamp', 'repeaterType']));\r\n\r\n  if (\r\n    currentTodoSet.get('completedKeywords').includes(newTodoState) &&\r\n    indexedPlanningItemsWithRepeaters.size > 0\r\n  ) {\r\n    indexedPlanningItemsWithRepeaters.forEach(([planningItem, planningItemIndex]) => {\r\n      state = state.setIn(\r\n        ['headers', headerIndex, 'planningItems', planningItemIndex, 'timestamp'],\r\n        applyRepeater(planningItem.get('timestamp'), new Date())\r\n      );\r\n    });\r\n\r\n    state = state.setIn(\r\n      ['headers', headerIndex, 'titleLine', 'todoKeyword'],\r\n      currentTodoSet.get('keywords').first()\r\n    );\r\n\r\n    const lastRepeatTimestamp = getCurrentTimestamp({ isActive: false, withStartTime: true });\r\n    const newLastRepeatValue = [\r\n      {\r\n        type: 'timestamp',\r\n        id: generateId(),\r\n        firstTimestamp: lastRepeatTimestamp,\r\n        secondTimestamp: null,\r\n      },\r\n    ];\r\n    state = state.updateIn(['headers', headerIndex, 'propertyListItems'], propertyListItems =>\r\n      propertyListItems.some(item => item.get('property') === 'LAST_REPEAT')\r\n        ? propertyListItems.map(item =>\r\n            item.get('property') === 'LAST_REPEAT'\r\n              ? item.set('value', fromJS(newLastRepeatValue))\r\n              : item\r\n          )\r\n        : propertyListItems.push(\r\n            fromJS({\r\n              property: 'LAST_REPEAT',\r\n              value: newLastRepeatValue,\r\n              id: generateId(),\r\n            })\r\n          )\r\n    );\r\n\r\n    state = state.updateIn(['headers', headerIndex], header => {\r\n      let rawDescription = header.get('rawDescription');\r\n      if (rawDescription.startsWith('\\n')) {\r\n        rawDescription = rawDescription.slice(1);\r\n      }\r\n\r\n      rawDescription =\r\n        `\\n- State \"${newTodoState}\"       from \"${currentTodoState}\"       ${renderAsText(\r\n          fromJS(lastRepeatTimestamp)\r\n        )}\\n` + rawDescription;\r\n\r\n      return header\r\n        .set('rawDescription', rawDescription)\r\n        .set('description', parseRawText(rawDescription));\r\n    });\r\n  } else {\r\n    state = state.setIn(['headers', headerIndex, 'titleLine', 'todoKeyword'], newTodoState);\r\n  }\r\n\r\n  state = updateCookiesOfParentOfHeaderWithId(state, headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst enterEditMode = (state, action) => state.set('editMode', action.editModeType);\r\n\r\nconst exitEditMode = (state, action) => state.set('editMode', null);\r\n\r\nconst updateHeaderTitle = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const newTitleLine = parseTitleLine(action.newRawTitle, state.get('todoKeywordSets'));\r\n\r\n  state = state.setIn(['headers', headerIndex, 'titleLine'], newTitleLine);\r\n\r\n  return updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n};\r\n\r\nconst updateHeaderDescription = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  return state.updateIn(['headers', headerIndex], header => {\r\n    const {\r\n      planningItems,\r\n      propertyListItems,\r\n      strippedDescription,\r\n    } = parseDescriptionPrefixElements(action.newRawDescription);\r\n\r\n    return header\r\n      .set('rawDescription', strippedDescription)\r\n      .set('description', parseRawText(strippedDescription))\r\n      .set('planningItems', planningItems)\r\n      .set('propertyListItems', propertyListItems);\r\n  });\r\n};\r\n\r\nconst addHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  const newHeader = newHeaderWithTitle(\r\n    '',\r\n    header.get('nestingLevel'),\r\n    state.get('todoKeywordSets')\r\n  );\r\n\r\n  if (action.headerId === state.get('focusedHeaderId')) {\r\n    state = state.set('focusedHeaderId', null);\r\n  }\r\n\r\n  return state.update('headers', headers =>\r\n    headers.insert(headerIndex + subheaders.size + 1, newHeader)\r\n  );\r\n};\r\n\r\nconst selectNextSiblingHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  const nextSibling = headers.get(headerIndex + subheaders.size + 1);\r\n\r\n  if (!nextSibling || nextSibling.get('nestingLevel') !== header.get('nestingLevel')) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', nextSibling.get('id'));\r\n};\r\n\r\nconst selectNextVisibleHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n\r\n  if (state.get('selectedHeaderId') === undefined) {\r\n    return state.set('selectedHeaderId', headers.getIn([0, 'id']));\r\n  }\r\n\r\n  const headerIndex = indexOfHeaderWithId(headers, state.get('selectedHeaderId'));\r\n\r\n  const nextVisibleHeader = nextVisibleHeaderAfterIndex(headers, headerIndex);\r\n\r\n  if (!nextVisibleHeader) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', nextVisibleHeader.get('id'));\r\n};\r\n\r\nconst selectPreviousVisibleHeader = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, state.get('selectedHeaderId'));\r\n\r\n  const previousVisibleHeader = previousVisibleHeaderAfterIndex(headers, headerIndex);\r\n\r\n  if (!previousVisibleHeader) {\r\n    return state;\r\n  }\r\n\r\n  return state.set('selectedHeaderId', previousVisibleHeader.get('id'));\r\n};\r\n\r\nconst removeHeader = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  const numHeadersToRemove = 1 + subheaders.size;\r\n\r\n  const parentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  _.times(numHeadersToRemove).forEach(() => {\r\n    headers = headers.delete(headerIndex);\r\n  });\r\n\r\n  if (action.headerId === state.get('focusedHeaderId')) {\r\n    state = state.set('focusedHeaderId', null);\r\n  }\r\n\r\n  state = state.set('headers', headers);\r\n\r\n  if (parentHeaderId) {\r\n    state = updateCookiesOfHeaderWithId(state, parentHeaderId);\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nconst moveHeaderUp = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousSiblingIndex = indexOfPreviousSibling(headers, headerIndex);\r\n  if (previousSiblingIndex === null) {\r\n    return state;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  _.times(1 + subheaders.size).forEach(() => {\r\n    headers = headers.insert(previousSiblingIndex, headers.get(headerIndex + subheaders.size));\r\n    headers = headers.delete(headerIndex + subheaders.size + 1);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst moveHeaderDown = (state, action) => {\r\n  let headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n  const nextSiblingIndex = headerIndex + subheaders.size + 1;\r\n  const nextSibling = headers.get(nextSiblingIndex);\r\n  if (nextSibling.get('nestingLevel') < header.get('nestingLevel')) {\r\n    return state;\r\n  }\r\n\r\n  const nextSiblingSubheaders = subheadersOfHeaderWithId(headers, nextSibling.get('id'));\r\n  _.times(1 + nextSiblingSubheaders.size).forEach(() => {\r\n    headers = headers.insert(\r\n      headerIndex,\r\n      headers.get(nextSiblingIndex + nextSiblingSubheaders.size)\r\n    );\r\n    headers = headers.delete(nextSiblingIndex + nextSiblingSubheaders.size + 1);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst moveHeaderLeft = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(['headers', headerIndex, 'nestingLevel'], nestingLevel =>\r\n    Math.max(nestingLevel - 1, 1)\r\n  );\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveHeaderRight = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel + 1\r\n  );\r\n\r\n  state = openDirectParent(state, action.headerId);\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveSubtreeLeft = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const header = headerWithId(headers, action.headerId);\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  if (header.get('nestingLevel') === 1) {\r\n    return state;\r\n  }\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel - 1\r\n  );\r\n\r\n  subheaders.forEach((_, index) => {\r\n    state = state.updateIn(\r\n      ['headers', headerIndex + index + 1, 'nestingLevel'],\r\n      nestingLevel => nestingLevel - 1\r\n    );\r\n  });\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return state;\r\n};\r\n\r\nconst moveSubtreeRight = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n\r\n  const previousParentHeaderId = parentIdOfHeaderWithId(headers, action.headerId);\r\n\r\n  const subheaders = subheadersOfHeaderWithId(headers, action.headerId);\r\n\r\n  state = state.updateIn(\r\n    ['headers', headerIndex, 'nestingLevel'],\r\n    nestingLevel => nestingLevel + 1\r\n  );\r\n  subheaders.forEach((_, index) => {\r\n    state = state.updateIn(\r\n      ['headers', headerIndex + index + 1, 'nestingLevel'],\r\n      nestingLevel => nestingLevel + 1\r\n    );\r\n  });\r\n\r\n  state = updateCookiesOfHeaderWithId(state, previousParentHeaderId);\r\n  state = updateCookiesOfParentOfHeaderWithId(state, action.headerId);\r\n\r\n  return openDirectParent(state, action.headerId);\r\n};\r\n\r\nconst focusHeader = (state, action) => {\r\n  return state.set('focusedHeaderId', action.headerId);\r\n};\r\n\r\nconst unfocusHeader = state => state.set('focusedHeaderId', null);\r\n\r\nconst noOp = state => state.update('noOpCounter', counter => (counter || 0) + 1);\r\n\r\nconst applyOpennessState = (state, action) => {\r\n  const opennessState = state.get('opennessState');\r\n  if (!opennessState) {\r\n    return state;\r\n  }\r\n\r\n  const fileOpennessState = opennessState.get(state.get('path'));\r\n  if (!fileOpennessState || fileOpennessState.size === 0) {\r\n    return state;\r\n  }\r\n\r\n  let headers = state.get('headers');\r\n  fileOpennessState.forEach(openHeaderPath => {\r\n    headers = openHeaderWithPath(headers, openHeaderPath);\r\n  });\r\n\r\n  return state.set('headers', headers);\r\n};\r\n\r\nconst setDirty = (state, action) => state.set('isDirty', action.isDirty);\r\n\r\nconst setSelectedTableCellId = (state, action) => state.set('selectedTableCellId', action.cellId);\r\n\r\nconst updateDescriptionOfHeaderContainingTableCell = (state, cellId, header = null) => {\r\n  const headers = state.get('headers');\r\n  if (!header) {\r\n    header = headerThatContainsTableCellId(headers, cellId);\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(headers, header.get('id'));\r\n\r\n  return state.updateIn(['headers', headerIndex], header =>\r\n    header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n  );\r\n};\r\n\r\nconst addNewTableRow = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rows.insert(rowIndex + 1, newEmptyTableRowLikeRows(rows))\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst removeTableRow = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsTableCellId(state.get('headers'), selectedTableCellId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rows.delete(rowIndex)\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedTableCellId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId, containingHeader);\r\n};\r\n\r\nconst addNewTableColumn = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, colIndex) => rows =>\r\n      rows.map(row =>\r\n        row.update('contents', contents => contents.insert(colIndex + 1, newEmptyTableCell()))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst removeTableColumn = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsTableCellId(state.get('headers'), selectedTableCellId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, colIndex) => rows =>\r\n      rows.map(row => row.update('contents', contents => contents.delete(colIndex)))\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedTableCellId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId, containingHeader);\r\n};\r\n\r\nconst moveTableRowDown = state => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rowIndex + 1 === rows.size\r\n        ? rows\r\n        : rows.insert(rowIndex, rows.get(rowIndex + 1)).delete(rowIndex + 2)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableRowUp = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, rowIndex => rows =>\r\n      rowIndex === 0 ? rows : rows.insert(rowIndex - 1, rows.get(rowIndex)).delete(rowIndex + 1)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableColumnLeft = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, columnIndex) => rows =>\r\n      columnIndex === 0\r\n        ? rows\r\n        : rows.map(row =>\r\n            row.update('contents', contents =>\r\n              contents.size === 0\r\n                ? contents\r\n                : contents\r\n                    .insert(columnIndex - 1, contents.get(columnIndex))\r\n                    .delete(columnIndex + 1)\r\n            )\r\n          )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst moveTableColumnRight = (state, action) => {\r\n  const selectedTableCellId = state.get('selectedTableCellId');\r\n  if (!selectedTableCellId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, selectedTableCellId, (_rowIndex, columnIndex) => rows =>\r\n      columnIndex + 1 >= rows.getIn([0, 'contents']).size\r\n        ? rows\r\n        : rows.map(row =>\r\n            row.update('contents', contents =>\r\n              contents.size === 0\r\n                ? contents\r\n                : contents\r\n                    .insert(columnIndex, contents.get(columnIndex + 1))\r\n                    .delete(columnIndex + 2)\r\n            )\r\n          )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, selectedTableCellId);\r\n};\r\n\r\nconst updateTableCellValue = (state, action) => {\r\n  state = state.update('headers', headers =>\r\n    updateTableContainingCellId(headers, action.cellId, (rowIndex, colIndex) => rows =>\r\n      rows.updateIn([rowIndex, 'contents', colIndex], cell =>\r\n        cell\r\n          .set('rawContents', action.newValue)\r\n          .set('contents', fromJS(parseMarkupAndCookies(action.newValue, { excludeCookies: true })))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingTableCell(state, action.cellId);\r\n};\r\n\r\nconst insertCapture = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const { template, content, shouldPrepend } = action;\r\n\r\n  const isTopLevelTarget = template.get('headerPaths').filter(path => path.length !== 0).size === 0;\r\n\r\n  const parentHeader = isTopLevelTarget\r\n    ? null\r\n    : headerWithPath(headers, template.get('headerPaths'));\r\n  if (!parentHeader && !isTopLevelTarget) {\r\n    return state;\r\n  }\r\n\r\n  const newHeader = newHeaderFromText(content, state.get('todoKeywordSets')).set(\r\n    'nestingLevel',\r\n    isTopLevelTarget ? 1 : parentHeader.get('nestingLevel') + 1\r\n  );\r\n\r\n  if (isTopLevelTarget) {\r\n    return state.update('headers', headers => headers.push(newHeader));\r\n  } else {\r\n    const parentHeaderIndex = indexOfHeaderWithId(headers, parentHeader.get('id'));\r\n    const numSubheaders = numSubheadersOfHeaderWithId(headers, parentHeader.get('id'));\r\n    const newIndex = parentHeaderIndex + 1 + (shouldPrepend ? 0 : numSubheaders);\r\n\r\n    state = state.update('headers', headers => headers.insert(newIndex, newHeader));\r\n\r\n    state = updateCookiesOfHeaderWithId(state, parentHeader.get('id'));\r\n\r\n    return state;\r\n  }\r\n};\r\n\r\nconst clearPendingCapture = state => state.set('pendingCapture', null);\r\n\r\nconst updateParentListCheckboxes = (state, itemPath) => {\r\n  const parentListItemPath = itemPath.slice(0, itemPath.length - 4);\r\n  const parentListItem = state.getIn(parentListItemPath);\r\n  if (!parentListItem.has('checkboxState')) {\r\n    return state;\r\n  }\r\n\r\n  const childrenCheckedStates = parentListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .flatMap(listPart =>\r\n      listPart\r\n        .get('items')\r\n        .filter(item => item.get('isCheckbox'))\r\n        .map(checkboxItem => checkboxItem.get('checkboxState'))\r\n    );\r\n\r\n  if (childrenCheckedStates.every(state => state === 'checked')) {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'checked');\r\n  } else if (childrenCheckedStates.every(state => state === 'unchecked')) {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'unchecked');\r\n  } else {\r\n    state = state.setIn(parentListItemPath.concat(['checkboxState']), 'partial');\r\n  }\r\n\r\n  const childCompletionStates = childrenCheckedStates\r\n    .map(state => {\r\n      switch (state) {\r\n        case 'checked':\r\n          return true;\r\n        case 'unchecked':\r\n          return false;\r\n        case 'partial':\r\n          return false;\r\n        default:\r\n          return false;\r\n      }\r\n    })\r\n    .toJS();\r\n\r\n  state = state.updateIn(parentListItemPath.concat('titleLine'), titleLine =>\r\n    updateCookiesInAttributedStringWithChildCompletionStates(titleLine, childCompletionStates)\r\n  );\r\n\r\n  if (parentListItem.get('isCheckbox')) {\r\n    return updateParentListCheckboxes(state, parentListItemPath);\r\n  } else {\r\n    return state;\r\n  }\r\n};\r\n\r\nconst advanceCheckboxState = (state, action) => {\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(state.get('headers'), action.listItemId);\r\n  const { path, listItemPart } = pathAndPart;\r\n\r\n  const hasDirectCheckboxChildren = listItemPart\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .some(listPart => listPart.get('items').some(item => item.get('isCheckbox')));\r\n  if (hasDirectCheckboxChildren) {\r\n    return state;\r\n  }\r\n\r\n  const newCheckboxState = {\r\n    checked: 'unchecked',\r\n    unchecked: 'checked',\r\n    partial: 'unchecked',\r\n  }[listItemPart.get('checkboxState')];\r\n\r\n  state = state.setIn(['headers'].concat(path).concat(['checkboxState']), newCheckboxState);\r\n  state = updateParentListCheckboxes(state, ['headers'].concat(path));\r\n\r\n  const headerIndex = path[0];\r\n  state = updateCookiesOfHeaderWithId(state, state.getIn(['headers', headerIndex, 'id']));\r\n  state = state.updateIn(['headers', headerIndex], header =>\r\n    header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n  );\r\n\r\n  return state;\r\n};\r\n\r\nconst setSelectedListItemId = (state, action) => state.set('selectedListItemId', action.listItemId);\r\n\r\nconst updateDescriptionOfHeaderContainingListItem = (state, listItemId, header = null) => {\r\n  let headerIndex = -1;\r\n  const headers = state.get('headers');\r\n  if (!header) {\r\n    const pathAndPart = pathAndPartOfListItemWithIdInHeaders(headers, listItemId);\r\n    headerIndex = pathAndPart.path[0];\r\n  } else {\r\n    headerIndex = indexOfHeaderWithId(headers, header.get('id'));\r\n  }\r\n\r\n  if (headerIndex >= 0) {\r\n    return state.updateIn(['headers', headerIndex], header =>\r\n      header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n    );\r\n  } else {\r\n    return state;\r\n  }\r\n};\r\n\r\nconst updateListTitleValue = (state, action) => {\r\n  const selectedListItemId = action.listItemId;\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.updateIn([itemIndex], item =>\r\n        item.set('titleLine', fromJS(parseMarkupAndCookies(action.newValue)))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst updateListContentsValue = (state, action) => {\r\n  const selectedListItemId = action.listItemId;\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.updateIn([itemIndex], item =>\r\n        item.set('contents', fromJS(parseRawText(action.newValue)))\r\n      )\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst addNewListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n\r\n  let newItem = newListItem();\r\n  if (pathAndPart.listItemPart.get('isCheckbox')) {\r\n    newItem = newItem.set('isCheckbox', true).set('checkboxState', 'unchecked');\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.insert(itemIndex + 1, newItem)\r\n    )\r\n  );\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst selectNextSiblingListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path } = pathAndPart;\r\n  path[path.length - 1] = path[path.length - 1] + 1;\r\n\r\n  state = state.set('selectedListItemId', state.getIn(['headers'].concat(path).concat('id')));\r\n\r\n  return state;\r\n};\r\n\r\nconst removeListItem = (state, action) => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const containingHeader = headerThatContainsListItemId(state.get('headers'), selectedListItemId);\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.set('selectedListItemId', null);\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId, containingHeader);\r\n};\r\n\r\nconst moveListItemUp = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex === 0\r\n        ? items\r\n        : items.insert(itemIndex - 1, items.get(itemIndex)).delete(itemIndex + 1)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListItemDown = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex + 1 === items.size\r\n        ? items\r\n        : items.insert(itemIndex, items.get(itemIndex + 1)).delete(itemIndex + 2)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListItemLeft = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n\r\n  const hasChildrenItem = pathAndPart.listItemPart\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .some(listPart => listPart.get('items').size > 0);\r\n  if (hasChildrenItem) {\r\n    return state;\r\n  }\r\n  return moveListSubtreeLeft(state);\r\n};\r\n\r\nconst moveListItemRight = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const listPart = state.getIn(['headers'].concat(path.slice(0, path.length - 2)));\r\n  const prevSiblingItemIndex = path[path.length - 1] - 1;\r\n\r\n  if (prevSiblingItemIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  const prevSiblingItemContentsPath = ['headers']\r\n    .concat(path.slice(0, path.length - 1))\r\n    .concat(prevSiblingItemIndex)\r\n    .concat('contents');\r\n\r\n  const childrenListParts = selectedListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list');\r\n\r\n  selectedListItem = selectedListItem.update('contents', contents =>\r\n    contents.filter(part => part.get('type') !== 'list')\r\n  );\r\n\r\n  state = state.updateIn(prevSiblingItemContentsPath, contents =>\r\n    updateContentsWithListItemAddition(contents, selectedListItem, listPart)\r\n  );\r\n\r\n  childrenListParts.map(listPart =>\r\n    listPart.get('items').forEach((item, itemIndex) => {\r\n      state = state.updateIn(prevSiblingItemContentsPath, contents =>\r\n        updateContentsWithListItemAddition(contents, item, listPart)\r\n      );\r\n    })\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListSubtreeLeft = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  let { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const selectedListItemIndex = path[path.length - 1];\r\n  if (path.filter(partOfPath => partOfPath === 'items').length < 2) {\r\n    return state;\r\n  }\r\n\r\n  const parentListItem = parentListItemWithIdInHeaders(\r\n    state.getIn(['headers']),\r\n    selectedListItemId\r\n  );\r\n\r\n  parentListItem\r\n    .get('contents')\r\n    .filter(part => part.get('type') === 'list')\r\n    .map(listPart =>\r\n      listPart.get('items').forEach((item, itemIndex) => {\r\n        if (itemIndex > selectedListItemIndex) {\r\n          selectedListItem = selectedListItem.update('contents', contents =>\r\n            updateContentsWithListItemAddition(contents, item, listPart)\r\n          );\r\n        }\r\n      })\r\n    );\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      items.filter((_item, index) => index < selectedListItemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, parentListItem.get('id'), itemIndex => items =>\r\n      items.insert(itemIndex + 1, selectedListItem)\r\n    )\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst moveListSubtreeRight = state => {\r\n  const selectedListItemId = state.get('selectedListItemId');\r\n  if (!selectedListItemId) {\r\n    return state;\r\n  }\r\n\r\n  const pathAndPart = pathAndPartOfListItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    selectedListItemId\r\n  );\r\n  const { path, listItemPart: selectedListItem } = pathAndPart;\r\n  const listPart = state.getIn(['headers'].concat(path.slice(0, path.length - 2)));\r\n  const prevSiblingItemIndex = path[path.length - 1] - 1;\r\n  if (prevSiblingItemIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  state = state.update('headers', headers =>\r\n    updateListContainingListItemId(headers, selectedListItemId, itemIndex => items =>\r\n      itemIndex === 0 ? items : items.delete(itemIndex)\r\n    )\r\n  );\r\n\r\n  state = state.updateIn(\r\n    ['headers']\r\n      .concat(path.slice(0, path.length - 1))\r\n      .concat(prevSiblingItemIndex)\r\n      .concat('contents'),\r\n    contents => updateContentsWithListItemAddition(contents, selectedListItem, listPart)\r\n  );\r\n\r\n  return updateDescriptionOfHeaderContainingListItem(state, selectedListItemId);\r\n};\r\n\r\nconst setLastSyncAt = (state, action) => state.set('lastSyncAt', action.lastSyncAt);\r\n\r\nconst setHeaderTags = (state, action) => {\r\n  const headers = state.get('headers');\r\n  const headerIndex = indexOfHeaderWithId(headers, action.headerId);\r\n  if (headerIndex === -1) {\r\n    return state;\r\n  }\r\n\r\n  return state.setIn(['headers', headerIndex, 'titleLine', 'tags'], action.tags);\r\n};\r\n\r\nconst reorderTags = (state, action) => {\r\n  const selectedHeaderId = state.get('selectedHeaderId');\r\n  if (!selectedHeaderId) {\r\n    return state;\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), selectedHeaderId);\r\n\r\n  return state.updateIn(['headers', headerIndex, 'titleLine', 'tags'], tags =>\r\n    tags.splice(action.fromIndex, 1).splice(action.toIndex, 0, tags.get(action.fromIndex))\r\n  );\r\n};\r\n\r\nconst reorderPropertyList = (state, action) => {\r\n  const headerId = action.headerId;\r\n  if (!headerId) {\r\n    return state;\r\n  }\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), headerId);\r\n\r\n  return state.updateIn(['headers', headerIndex, 'propertyListItems'], propertyListItems =>\r\n    propertyListItems\r\n      .splice(action.fromIndex, 1)\r\n      .splice(action.toIndex, 0, propertyListItems.get(action.fromIndex))\r\n  );\r\n};\r\n\r\nconst updateTimestampWithId = (state, action) => {\r\n  const pathAndPart = pathAndPartOfTimestampItemWithIdInHeaders(\r\n    state.get('headers'),\r\n    action.timestampId\r\n  );\r\n  if (!pathAndPart) {\r\n    return state;\r\n  }\r\n\r\n  const { path } = pathAndPart;\r\n  const headerIndex = path[0];\r\n\r\n  return state\r\n    .setIn(['headers'].concat(path), action.newTimestamp)\r\n    .updateIn(['headers', headerIndex], header =>\r\n      header.set('rawDescription', attributedStringToRawText(header.get('description')))\r\n    )\r\n    .updateIn(['headers', headerIndex], header =>\r\n      header.setIn(\r\n        ['titleLine', 'rawTitle'],\r\n        attributedStringToRawText(header.getIn(['titleLine', 'title']))\r\n      )\r\n    );\r\n};\r\n\r\nconst updatePlanningItemTimestamp = (state, action) => {\r\n  const { headerId, planningItemIndex, newTimestamp } = action;\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), headerId);\r\n\r\n  return state.setIn(\r\n    ['headers', headerIndex, 'planningItems', planningItemIndex, 'timestamp'],\r\n    newTimestamp\r\n  );\r\n};\r\n\r\nconst addNewPlanningItem = (state, action) => {\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), action.headerId);\r\n\r\n  const newPlanningItem = fromJS({\r\n    id: generateId(),\r\n    type: action.planningType,\r\n    timestamp: getCurrentTimestamp(),\r\n  });\r\n\r\n  return state.updateIn(['headers', headerIndex, 'planningItems'], planningItems =>\r\n    !!planningItems ? planningItems.push(newPlanningItem) : List([newPlanningItem])\r\n  );\r\n};\r\n\r\nexport const updatePropertyListItems = (state, action) => {\r\n  const headerIndex = indexOfHeaderWithId(state.get('headers'), action.headerId);\r\n\r\n  return state.setIn(['headers', headerIndex, 'propertyListItems'], action.newPropertyListItems);\r\n};\r\n\r\nconst setOrgFileErrorMessage = (state, action) => state.set('orgFileErrorMessage', action.message);\r\n\r\nexport default (state = new Map(), action) => {\r\n  if (action.dirtying) {\r\n    state = state.set('isDirty', true);\r\n  }\r\n\r\n  switch (action.type) {\r\n    case 'DISPLAY_FILE':\r\n      return displayFile(state, action);\r\n    case 'STOP_DISPLAYING_FILE':\r\n      return stopDisplayingFile(state, action);\r\n    case 'TOGGLE_HEADER_OPENED':\r\n      return toggleHeaderOpened(state, action);\r\n    case 'OPEN_HEADER':\r\n      return openHeader(state, action);\r\n    case 'SELECT_HEADER':\r\n      return selectHeader(state, action);\r\n    case 'OPEN_PARENTS_OF_HEADER':\r\n      return openParentsOfHeader(state, action);\r\n    case 'ADVANCE_TODO_STATE':\r\n      return advanceTodoState(state, action);\r\n    case 'ENTER_EDIT_MODE':\r\n      return enterEditMode(state, action);\r\n    case 'EXIT_EDIT_MODE':\r\n      return exitEditMode(state, action);\r\n    case 'UPDATE_HEADER_TITLE':\r\n      return updateHeaderTitle(state, action);\r\n    case 'UPDATE_HEADER_DESCRIPTION':\r\n      return updateHeaderDescription(state, action);\r\n    case 'ADD_HEADER':\r\n      return addHeader(state, action);\r\n    case 'SELECT_NEXT_SIBLING_HEADER':\r\n      return selectNextSiblingHeader(state, action);\r\n    case 'SELECT_NEXT_VISIBLE_HEADER':\r\n      return selectNextVisibleHeader(state, action);\r\n    case 'SELECT_PREVIOUS_VISIBLE_HEADER':\r\n      return selectPreviousVisibleHeader(state, action);\r\n    case 'REMOVE_HEADER':\r\n      return removeHeader(state, action);\r\n    case 'MOVE_HEADER_UP':\r\n      return moveHeaderUp(state, action);\r\n    case 'MOVE_HEADER_DOWN':\r\n      return moveHeaderDown(state, action);\r\n    case 'MOVE_HEADER_LEFT':\r\n      return moveHeaderLeft(state, action);\r\n    case 'MOVE_HEADER_RIGHT':\r\n      return moveHeaderRight(state, action);\r\n    case 'MOVE_SUBTREE_LEFT':\r\n      return moveSubtreeLeft(state, action);\r\n    case 'MOVE_SUBTREE_RIGHT':\r\n      return moveSubtreeRight(state, action);\r\n    case 'NO_OP':\r\n      return noOp(state, action);\r\n    case 'APPLY_OPENNESS_STATE':\r\n      return applyOpennessState(state, action);\r\n    case 'SET_DIRTY':\r\n      return setDirty(state, action);\r\n    case 'FOCUS_HEADER':\r\n      return focusHeader(state, action);\r\n    case 'UNFOCUS_HEADER':\r\n      return unfocusHeader(state, action);\r\n    case 'SET_SELECTED_TABLE_CELL_ID':\r\n      return setSelectedTableCellId(state, action);\r\n    case 'ADD_NEW_TABLE_ROW':\r\n      return addNewTableRow(state, action);\r\n    case 'REMOVE_TABLE_ROW':\r\n      return removeTableRow(state, action);\r\n    case 'ADD_NEW_TABLE_COLUMN':\r\n      return addNewTableColumn(state, action);\r\n    case 'REMOVE_TABLE_COLUMN':\r\n      return removeTableColumn(state, action);\r\n    case 'MOVE_TABLE_ROW_DOWN':\r\n      return moveTableRowDown(state, action);\r\n    case 'MOVE_TABLE_ROW_UP':\r\n      return moveTableRowUp(state, action);\r\n    case 'MOVE_TABLE_COLUMN_LEFT':\r\n      return moveTableColumnLeft(state, action);\r\n    case 'MOVE_TABLE_COLUMN_RIGHT':\r\n      return moveTableColumnRight(state, action);\r\n    case 'UPDATE_TABLE_CELL_VALUE':\r\n      return updateTableCellValue(state, action);\r\n    case 'INSERT_CAPTURE':\r\n      return insertCapture(state, action);\r\n    case 'CLEAR_PENDING_CAPTURE':\r\n      return clearPendingCapture(state, action);\r\n    case 'ADVANCE_CHECKBOX_STATE':\r\n      return advanceCheckboxState(state, action);\r\n    case 'SET_SELECTED_LIST_ITEM_ID':\r\n      return setSelectedListItemId(state, action);\r\n    case 'UPDATE_LIST_TITLE_VALUE':\r\n      return updateListTitleValue(state, action);\r\n    case 'UPDATE_LIST_CONTENTS_VALUE':\r\n      return updateListContentsValue(state, action);\r\n    case 'ADD_NEW_LIST_ITEM':\r\n      return addNewListItem(state, action);\r\n    case 'SELECT_NEXT_SIBLING_LIST_ITEM':\r\n      return selectNextSiblingListItem(state, action);\r\n    case 'REMOVE_LIST_ITEM':\r\n      return removeListItem(state, action);\r\n    case 'MOVE_LIST_ITEM_UP':\r\n      return moveListItemUp(state, action);\r\n    case 'MOVE_LIST_ITEM_DOWN':\r\n      return moveListItemDown(state, action);\r\n    case 'MOVE_LIST_ITEM_LEFT':\r\n      return moveListItemLeft(state, action);\r\n    case 'MOVE_LIST_ITEM_RIGHT':\r\n      return moveListItemRight(state, action);\r\n    case 'MOVE_LIST_SUBTREE_LEFT':\r\n      return moveListSubtreeLeft(state, action);\r\n    case 'MOVE_LIST_SUBTREE_RIGHT':\r\n      return moveListSubtreeRight(state, action);\r\n    case 'SET_LAST_SYNC_AT':\r\n      return setLastSyncAt(state, action);\r\n    case 'SET_HEADER_TAGS':\r\n      return setHeaderTags(state, action);\r\n    case 'REORDER_TAGS':\r\n      return reorderTags(state, action);\r\n    case 'REORDER_PROPERTY_LIST':\r\n      return reorderPropertyList(state, action);\r\n    case 'UPDATE_TIMESTAMP_WITH_ID':\r\n      return updateTimestampWithId(state, action);\r\n    case 'UPDATE_PLANNING_ITEM_TIMESTAMP':\r\n      return updatePlanningItemTimestamp(state, action);\r\n    case 'ADD_NEW_PLANNING_ITEM':\r\n      return addNewPlanningItem(state, action);\r\n    case 'UPDATE_PROPERTY_LIST_ITEMS':\r\n      return updatePropertyListItems(state, action);\r\n    case 'SET_ORG_FILE_ERROR_MESSAGE':\r\n      return setOrgFileErrorMessage(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { Map, List, fromJS } from 'immutable';\r\n\r\nimport generateId from '../lib/id_generator';\r\nimport { applyCaptureSettingsFromConfig } from '../util/settings_persister';\r\n\r\nconst indexOfTemplateWithId = (templates, templateId) =>\r\n  templates.findIndex(template => template.get('id') === templateId);\r\n\r\nconst addNewEmptyCaptureTemplate = state => {\r\n  if (!state.get('captureTemplates')) {\r\n    state = state.set('captureTemplates', new List());\r\n  }\r\n\r\n  return state.update('captureTemplates', templates =>\r\n    templates.push(\r\n      fromJS({\r\n        id: generateId(),\r\n        description: '',\r\n        letter: '',\r\n        iconName: '',\r\n        isAvailableInAllOrgFiles: true,\r\n        orgFilesWhereAvailable: [''],\r\n        headerPaths: [''],\r\n        shouldPrepend: false,\r\n        template: '',\r\n      })\r\n    )\r\n  );\r\n};\r\n\r\nconst updateTemplateFieldPathValue = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.setIn(['captureTemplates', templateIndex].concat(action.fieldPath), action.newValue);\r\n};\r\n\r\nconst addNewTemplateOrgFileAvailability = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'orgFilesWhereAvailable'], orgFiles =>\r\n    orgFiles.push('')\r\n  );\r\n};\r\n\r\nconst removeTemplateOrgFileAvailability = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'orgFilesWhereAvailable'], orgFiles =>\r\n    orgFiles.delete(action.orgFileAvailabilityIndex)\r\n  );\r\n};\r\n\r\nconst addNewTemplateHeaderPath = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'headerPaths'], headerPaths =>\r\n    headerPaths.push('')\r\n  );\r\n};\r\n\r\nconst removeTemplateHeaderPath = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.updateIn(['captureTemplates', templateIndex, 'headerPaths'], headerPaths =>\r\n    headerPaths.delete(action.headerPathIndex)\r\n  );\r\n};\r\n\r\nconst deleteTemplate = (state, action) => {\r\n  const templateIndex = indexOfTemplateWithId(state.get('captureTemplates'), action.templateId);\r\n\r\n  return state.update('captureTemplates', templates => templates.delete(templateIndex));\r\n};\r\n\r\nconst restoreCaptureSettings = (state, action) => {\r\n  if (!action.newSettings) {\r\n    return state;\r\n  }\r\n\r\n  return applyCaptureSettingsFromConfig(state, action.newSettings);\r\n};\r\n\r\nconst reorderCaptureTemplate = (state, action) =>\r\n  state.update('captureTemplates', templates =>\r\n    templates.splice(action.fromIndex, 1).splice(action.toIndex, 0, templates.get(action.fromIndex))\r\n  );\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'ADD_NEW_EMPTY_CAPTURE_TEMPLATE':\r\n      return addNewEmptyCaptureTemplate(state, action);\r\n    case 'UPDATE_TEMPLATE_FIELD_PATH_VALUE':\r\n      return updateTemplateFieldPathValue(state, action);\r\n    case 'ADD_NEW_TEMPLATE_ORG_FILE_AVAILABILITY':\r\n      return addNewTemplateOrgFileAvailability(state, action);\r\n    case 'REMOVE_TEMPLATE_ORG_FILE_AVAILABILITY':\r\n      return removeTemplateOrgFileAvailability(state, action);\r\n    case 'ADD_NEW_TEMPLATE_HEADER_PATH':\r\n      return addNewTemplateHeaderPath(state, action);\r\n    case 'REMOVE_TEMPLATE_HEADER_PATH':\r\n      return removeTemplateHeaderPath(state, action);\r\n    case 'DELETE_TEMPLATE':\r\n      return deleteTemplate(state, action);\r\n    case 'RESTORE_CAPTURE_SETTINGS':\r\n      return restoreCaptureSettings(state, action);\r\n    case 'REORDER_CAPTURE_TEMPLATE':\r\n      return reorderCaptureTemplate(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { combineReducers } from 'redux';\r\nimport undoable, { includeAction } from 'redux-linear-undo';\r\n\r\nimport baseReducer from './base';\r\nimport syncBackendReducer from './sync_backend';\r\nimport orgReducer from './org';\r\nimport captureReducer from './capture';\r\n\r\nconst UNDOABLE_ACTIONS = [\r\n  'ADD_HEADER',\r\n  'REMOVE_HEADER',\r\n  'MOVE_HEADER_UP',\r\n  'MOVE_HEADER_DOWN',\r\n  'MOVE_HEADER_LEFT',\r\n  'MOVE_HEADER_RIGHT',\r\n  'MOVE_SUBTREE_LEFT',\r\n  'MOVE_SUBTREE_RIGHT',\r\n  'ADVANCE_TODO_STATE',\r\n  'EDIT_HEADER_TITLE',\r\n  'EDIT_HEADER_DESCRIPTION',\r\n  'NO_OP',\r\n  'ADD_NEW_TABLE_ROW',\r\n  'ADD_NEW_TABLE_COLUMN',\r\n  'MOVE_TABLE_ROW_DOWN',\r\n  'MOVE_TABLE_ROW_UP',\r\n  'MOVE_TABLE_COLUMN_LEFT',\r\n  'MOVE_TABLE_COLUMN_RIGHT',\r\n  'ADD_NEW_LIST_ITEM',\r\n  'REMOVE_LIST_ITEM',\r\n  'MOVE_LIST_ITEM_UP',\r\n  'MOVE_LIST_ITEM_DOWN',\r\n  'MOVE_LIST_ITEM_LEFT',\r\n  'MOVE_LIST_ITEM_RIGHT',\r\n  'MOVE_LIST_SUBTREE_LEFT',\r\n  'MOVE_LIST_SUBTREE_RIGHT',\r\n  'INSERT_CAPTURE',\r\n];\r\n\r\nexport default combineReducers({\r\n  base: baseReducer,\r\n  syncBackend: syncBackendReducer,\r\n  org: undoable(orgReducer, {\r\n    filter: includeAction(UNDOABLE_ACTIONS),\r\n    linearizeHistory: true,\r\n  }),\r\n  capture: captureReducer,\r\n});\r\n","import { Map } from 'immutable';\r\n\r\nconst signOut = (state, action) => state.set('isAuthenticated', false).set('client', null);\r\n\r\nconst setCurrentFileBrowserDirectoryListing = (state, action) =>\r\n  state.set(\r\n    'currentFileBrowserDirectoryListing',\r\n    Map({\r\n      listing: action.directoryListing,\r\n      hasMore: action.hasMore,\r\n      additionalSyncBackendState: action.additionalSyncBackendState,\r\n    })\r\n  );\r\n\r\nconst setIsLoadingMoreDirectoryListing = (state, action) =>\r\n  state\r\n    .update(\r\n      'currentFileBrowserDirectoryListing',\r\n      currentFileBrowserDirectoryListing =>\r\n        !!currentFileBrowserDirectoryListing ? currentFileBrowserDirectoryListing : Map()\r\n    )\r\n    .setIn(['currentFileBrowserDirectoryListing', 'isLoadingMore'], action.isLoadingMore);\r\n\r\nexport default (state = new Map(), action) => {\r\n  switch (action.type) {\r\n    case 'SIGN_OUT':\r\n      return signOut(state, action);\r\n    case 'SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING':\r\n      return setCurrentFileBrowserDirectoryListing(state, action);\r\n    case 'SET_IS_LOADING_MORE_DIRECTORY_LISTING':\r\n      return setIsLoadingMoreDirectoryListing(state, action);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport googleAnalyticsLogger from './middleware/google_analytics_logging';\r\nimport liveSync from './middleware/live_sync';\r\nimport syncOnBecomingVisible from './middleware/sync_on_becoming_visible';\r\nimport rootReducer from './reducers';\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nexport default initialState =>\r\n  createStore(\r\n    rootReducer,\r\n    initialState,\r\n    composeEnhancers(applyMiddleware(thunk, googleAnalyticsLogger, liveSync, syncOnBecomingVisible))\r\n  );\r\n","import migrateAccessTokenToDropboxAccessToken from './migrate_access_token_to_dropbox_access_token';\r\nimport migrateStoreInDropboxToStoreInSyncBackend from './migrate_store_in_dropbox_to_store_in_sync_backend';\r\n\r\nexport default () => {\r\n  migrateAccessTokenToDropboxAccessToken();\r\n  migrateStoreInDropboxToStoreInSyncBackend();\r\n};\r\n","import { isLocalStorageAvailable } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  if (!isLocalStorageAvailable) {\r\n    return;\r\n  }\r\n\r\n  const accessToken = localStorage.getItem('accessToken');\r\n  if (!accessToken) {\r\n    return;\r\n  }\r\n\r\n  localStorage.setItem('dropboxAccessToken', accessToken);\r\n  localStorage.removeItem('accessToken');\r\n};\r\n","import { isLocalStorageAvailable } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  if (!isLocalStorageAvailable) {\r\n    return;\r\n  }\r\n\r\n  const shouldStoreSettingsInDropbox = localStorage.getItem('shouldStoreSettingsInDropbox');\r\n  if (!shouldStoreSettingsInDropbox) {\r\n    return;\r\n  }\r\n\r\n  localStorage.setItem('shouldStoreSettingsInSyncBackend', shouldStoreSettingsInDropbox);\r\n  localStorage.removeItem('shouldStoreSettingsInDropbox');\r\n};\r\n","const parseQueryString = str => {\r\n  var ret = Object.create(null);\r\n\r\n  if (typeof str !== 'string') {\r\n    return ret;\r\n  }\r\n\r\n  str = str.trim().replace(/^(\\?|#|&)/, '');\r\n\r\n  if (!str) {\r\n    return ret;\r\n  }\r\n\r\n  str.split('&').forEach(function(param) {\r\n    var parts = param.replace(/\\+/g, ' ').split('=');\r\n    // Firefox (pre 40) decodes `%3D` to `=`\r\n    // https://github.com/sindresorhus/query-string/pull/37\r\n    var key = parts.shift();\r\n    var val = parts.length > 0 ? parts.join('=') : undefined;\r\n\r\n    key = decodeURIComponent(key);\r\n\r\n    // missing `=` should be `null`:\r\n    // http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\r\n    val = val === undefined ? null : decodeURIComponent(val);\r\n\r\n    if (ret[key] === undefined) {\r\n      ret[key] = val;\r\n    } else if (Array.isArray(ret[key])) {\r\n      ret[key].push(val);\r\n    } else {\r\n      ret[key] = [ret[key], val];\r\n    }\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nexport default parseQueryString;\r\n","/* global gapi, google */\r\n\r\nimport { setLoadingMessage, hideLoadingMessage, clearModalStack, setIsLoading } from './base';\r\nimport {\r\n  displayFile,\r\n  applyOpennessState,\r\n  setDirty,\r\n  setLastSyncAt,\r\n  setOrgFileErrorMessage,\r\n} from './org';\r\nimport { persistField } from '../util/settings_persister';\r\nimport { Dropbox } from 'dropbox';\r\n\r\nimport { addSeconds } from 'date-fns';\r\n\r\nexport const signOut = () => (dispatch, getState) => {\r\n  switch (getState().syncBackend.get('client', {}).type) {\r\n    case 'Dropbox':\r\n      persistField('dropboxAccessToken', null);\r\n      break;\r\n    case 'Google Drive':\r\n      const token = gapi.client.getToken();\r\n      if (token) {\r\n        persistField('googleDriveAccessToken', null);\r\n        google.accounts.oauth2.revoke(token);\r\n        gapi.client.setToken('');\r\n        window.location.reload();\r\n      }\r\n      break;\r\n    default:\r\n  }\r\n\r\n  persistField('authenticatedSyncService', null);\r\n\r\n  dispatch({ type: 'SIGN_OUT' });\r\n  dispatch(clearModalStack());\r\n  dispatch(hideLoadingMessage());\r\n};\r\n\r\nexport const setCurrentFileBrowserDirectoryListing = (\r\n  directoryListing,\r\n  hasMore,\r\n  additionalSyncBackendState\r\n) => ({\r\n  type: 'SET_CURRENT_FILE_BROWSER_DIRECTORY_LISTING',\r\n  directoryListing,\r\n  hasMore,\r\n  additionalSyncBackendState,\r\n});\r\n\r\nexport const setIsLoadingMoreDirectoryListing = isLoadingMore => ({\r\n  type: 'SET_IS_LOADING_MORE_DIRECTORY_LISTING',\r\n  isLoadingMore,\r\n});\r\n\r\nexport const getDirectoryListing = path => (dispatch, getState) => {\r\n  dispatch(setLoadingMessage('Getting listing...'));\r\n\r\n  window.console.log('reading directories');\r\n\r\n  const client = getState().syncBackend.get('client');\r\n  client\r\n    .getDirectoryListing(path)\r\n    .then(({ listing, hasMore, additionalSyncBackendState }) => {\r\n      dispatch(setCurrentFileBrowserDirectoryListing(listing, hasMore, additionalSyncBackendState));\r\n      dispatch(hideLoadingMessage());\r\n    })\r\n    .catch(error => {\r\n      alert(`There was an error retrieving files! (status: ${error.status})`);\r\n\r\n      if (error.status === 401) {\r\n        window.console.log(`uRL: ${process.env.PUBLIC_URL}`);\r\n        const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n        const authURL = dropbox.getAuthenticationUrl(window.location.origin + process.env.PUBLIC_URL + '/');\r\n        window.location = authURL;\r\n      }\r\n\r\n      dispatch(hideLoadingMessage());\r\n    });\r\n};\r\n\r\nexport const loadMoreDirectoryListing = () => (dispatch, getState) => {\r\n  dispatch(setIsLoadingMoreDirectoryListing(true));\r\n\r\n  const client = getState().syncBackend.get('client');\r\n  const currentFileBrowserDirectoryListing = getState().syncBackend.get(\r\n    'currentFileBrowserDirectoryListing'\r\n  );\r\n  client\r\n    .getMoreDirectoryListing(currentFileBrowserDirectoryListing.get('additionalSyncBackendState'))\r\n    .then(({ listing, hasMore, additionalSyncBackendState }) => {\r\n      const extendedListing = currentFileBrowserDirectoryListing.get('listing').concat(listing);\r\n      dispatch(\r\n        setCurrentFileBrowserDirectoryListing(extendedListing, hasMore, additionalSyncBackendState)\r\n      );\r\n      dispatch(setIsLoadingMoreDirectoryListing(false));\r\n    });\r\n};\r\n\r\nexport const pushBackup = (pathOrFileId, contents) => {\r\n  return (dispatch, getState) => {\r\n    const client = getState().syncBackend.get('client');\r\n    switch (client.type) {\r\n      case 'Dropbox':\r\n        client.createFile(`${pathOrFileId}.org-web-bak`, contents);\r\n        break;\r\n      case 'Google Drive':\r\n        pathOrFileId = pathOrFileId.startsWith('/') ? pathOrFileId.substr(1) : pathOrFileId;\r\n        client.duplicateFile(pathOrFileId, fileName => `${fileName}.org-web-bak`);\r\n        break;\r\n      default:\r\n    }\r\n  };\r\n};\r\n\r\nexport const downloadFile = path => {\r\n  return (dispatch, getState) => {\r\n    dispatch(setLoadingMessage('Downloading file...'));\r\n\r\n    getState()\r\n      .syncBackend.get('client')\r\n      .getFileContents(path)\r\n      .then(fileContents => {\r\n        dispatch(setDirty(false));\r\n        dispatch(hideLoadingMessage());\r\n        dispatch(pushBackup(path, fileContents));\r\n        dispatch(setLastSyncAt(addSeconds(new Date(), 5)));\r\n        dispatch(displayFile(path, fileContents));\r\n        dispatch(applyOpennessState());\r\n      })\r\n      .catch((e) => {\r\n        if (e.status === 401) {\r\n          const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n          const authURL = dropbox.getAuthenticationUrl(window.location.origin + process.env.PUBLIC_URL + '/');\r\n          window.location = authURL;\r\n        }\r\n        dispatch(hideLoadingMessage());\r\n        dispatch(setIsLoading(false));\r\n        dispatch(setOrgFileErrorMessage('File not found'));\r\n      });\r\n  };\r\n};\r\n","import { Dropbox } from 'dropbox';\r\n\r\nimport { fromJS, Map } from 'immutable';\r\n\r\nexport default accessToken => {\r\n  const dropboxClient = new Dropbox({ accessToken, fetch });\r\n\r\n  const isSignedIn = () => new Promise(resolve => resolve(true));\r\n\r\n  const transformDirectoryListing = listing =>\r\n    fromJS(\r\n      listing.map(entry => ({\r\n        id: entry.id,\r\n        name: entry.name,\r\n        isDirectory: entry['.tag'] === 'folder',\r\n        path: entry.path_display,\r\n      }))\r\n    );\r\n\r\n  const getDirectoryListing = path =>\r\n    new Promise((resolve, reject) => {\r\n      dropboxClient\r\n        .filesListFolder({ path })\r\n        .then(response =>\r\n          resolve({\r\n            listing: transformDirectoryListing(response.entries),\r\n            hasMore: response.has_more,\r\n            additionalSyncBackendState: Map({\r\n              cursor: response.cursor,\r\n            }),\r\n          })\r\n        )\r\n        .catch(reject);\r\n    });\r\n\r\n  const getMoreDirectoryListing = additionalSyncBackendState => {\r\n    const cursor = additionalSyncBackendState.get('cursor');\r\n    return new Promise((resolve, reject) =>\r\n      dropboxClient.filesListFolderContinue({ cursor }).then(response =>\r\n        resolve({\r\n          listing: transformDirectoryListing(response.entries),\r\n          hasMore: response.has_more,\r\n          additionalSyncBackendState: Map({\r\n            cursor: response.cursor,\r\n          }),\r\n        })\r\n      )\r\n    );\r\n  };\r\n\r\n  const uploadFile = (path, contents) =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesUpload({\r\n          path,\r\n          contents,\r\n          mode: {\r\n            '.tag': 'overwrite',\r\n          },\r\n          autorename: true,\r\n        })\r\n        .then(resolve)\r\n        .catch(reject)\r\n    );\r\n\r\n  const updateFile = uploadFile;\r\n  const createFile = uploadFile;\r\n\r\n  const getFileContentsAndMetadata = path =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesDownload({ path })\r\n        .then(response => {\r\n          const reader = new FileReader();\r\n          reader.addEventListener('loadend', () =>\r\n            resolve({\r\n              contents: reader.result,\r\n              lastModifiedAt: response.server_modified,\r\n            })\r\n          );\r\n          reader.readAsText(response.fileBlob);\r\n        })\r\n        .catch(error => {\r\n          if (!!error.error && JSON.parse(error.error).error.path['.tag'] === 'not_found') {\r\n            reject();\r\n          }\r\n        })\r\n    );\r\n\r\n  const getFileContents = path =>\r\n    new Promise((resolve, reject) =>\r\n      getFileContentsAndMetadata(path)\r\n        .then(({ contents }) => resolve(contents))\r\n        .catch(reject)\r\n    );\r\n\r\n  const deleteFile = path =>\r\n    new Promise((resolve, reject) =>\r\n      dropboxClient\r\n        .filesDelete({ path })\r\n        .then(resolve)\r\n        .catch(error => reject(error.error.error['.tag'] === 'path_lookup', error))\r\n    );\r\n\r\n  return {\r\n    type: 'Dropbox',\r\n    isSignedIn,\r\n    getDirectoryListing,\r\n    getMoreDirectoryListing,\r\n    updateFile,\r\n    createFile,\r\n    getFileContentsAndMetadata,\r\n    getFileContents,\r\n    deleteFile,\r\n  };\r\n};\r\n","/* global process */\r\n\r\nimport { fromJS, Map } from 'immutable';\r\nimport { persistField, getPersistedField } from '../util/settings_persister';\r\n\r\nexport default () => {\r\n  const initGoogleDriveAPIClient = () =>\r\n    new Promise((resolve, reject) => {\r\n      window.gapi.load('client', () => {\r\n        window.gapi.client\r\n          .init({\r\n            apiKey: process.env.REACT_APP_GOOGLE_DRIVE_API_KEY,\r\n            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\r\n          })\r\n          .then(async () => {\r\n            const googleDriveAccessTokenString = getPersistedField('googleDriveAccessToken');\r\n            if (googleDriveAccessTokenString) {\r\n              const googleDriveAccessToken = JSON.parse(googleDriveAccessTokenString);\r\n              window.gapi.client.setToken(googleDriveAccessToken);\r\n              resolve();\r\n            } else {\r\n              const tokenClient = window.google.accounts.oauth2.initTokenClient({\r\n                client_id: process.env.REACT_APP_GOOGLE_DRIVE_CLIENT_ID,\r\n                scope: 'https://www.googleapis.com/auth/drive.file',\r\n                callback: accessToken => {\r\n                  persistField('authenticatedSyncService', 'Google Drive');\r\n                  persistField('googleDriveAccessToken', JSON.stringify(accessToken));\r\n                  resolve();\r\n                },\r\n              });\r\n              tokenClient.requestAccessToken({ prompt: 'consent' });\r\n            }\r\n          });\r\n      });\r\n    });\r\n\r\n  const getAPIClient = (() => {\r\n    let isInited = false;\r\n    let isIniting = false;\r\n    const afterInitCallbacks = [];\r\n\r\n    return () => {\r\n      return new Promise((resolve, reject) => {\r\n        if (isInited) {\r\n          resolve(window.gapi);\r\n        } else {\r\n          if (window.gapi && !isIniting) {\r\n            isIniting = true;\r\n            initGoogleDriveAPIClient().then(() => {\r\n              isInited = true;\r\n              afterInitCallbacks.forEach(callback => callback(window.gapi));\r\n              resolve(window.gapi);\r\n            });\r\n          } else {\r\n            afterInitCallbacks.push(resolve);\r\n          }\r\n        }\r\n      });\r\n    };\r\n  })();\r\n\r\n  // Trigger the API client init when the gapi script loads.\r\n  if (window.gapi) {\r\n    getAPIClient();\r\n  } else {\r\n    // This handler will be called when the <script> tag loads.\r\n    window.handleGoogleDriveClientLoad = getAPIClient;\r\n  }\r\n\r\n  const isSignedIn = () =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        resolve(gapi.client.getToken() !== null);\r\n      });\r\n    });\r\n\r\n  const transformDirectoryListing = listing =>\r\n    fromJS(\r\n      listing.map(entry => ({\r\n        id: entry.id,\r\n        name: entry.name,\r\n        isDirectory: entry.mimeType === 'application/vnd.google-apps.folder',\r\n        path: `/${entry.id}`,\r\n      }))\r\n    );\r\n\r\n  const getFiles = (directoryId, nextPageToken = null) => {\r\n    const fileListPromise = new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        gapi.client.drive.files\r\n          .list({\r\n            pageSize: 30,\r\n            fields: 'nextPageToken, files(id, name, mimeType, parents)',\r\n            q: `'${directoryId === '' ? 'root' : directoryId}' in parents and trashed = false`,\r\n            pageToken: nextPageToken,\r\n          })\r\n          .then(response => {\r\n            resolve({\r\n              listing: transformDirectoryListing(response.result.files),\r\n              hasMore: !!response.result.nextPageToken,\r\n              additionalSyncBackendState: Map({\r\n                currentDirectoryId: directoryId,\r\n                nextPageToken: response.result.nextPageToken,\r\n              }),\r\n            });\r\n          })\r\n          .catch(reject);\r\n      });\r\n    });\r\n\r\n    const fileParentPromise = new Promise((resolve, reject) => {\r\n      if (directoryId === '') {\r\n        resolve(null);\r\n      } else {\r\n        getAPIClient()\r\n          .then(gapi =>\r\n            gapi.client.drive.files.get({\r\n              fileId: directoryId,\r\n              fields: 'parents',\r\n            })\r\n          )\r\n          .then(response => {\r\n            if (!response.result.parents) {\r\n              resolve(null);\r\n            } else {\r\n              resolve(response.result.parents[0]);\r\n            }\r\n          })\r\n          .catch(reject);\r\n      }\r\n    });\r\n\r\n    const rootFolderIdPromise = new Promise((resolve, reject) => {\r\n      if (!!window.rootFolderId) {\r\n        resolve(window.rootFolderId);\r\n      } else {\r\n        getAPIClient()\r\n          .then(gapi =>\r\n            gapi.client.drive.files.get({\r\n              fileId: 'root',\r\n              fields: 'id',\r\n            })\r\n          )\r\n          .then(response => {\r\n            window.rootFolderId = response.result.id;\r\n            resolve(response.result.id);\r\n          })\r\n          .catch(reject);\r\n      }\r\n    });\r\n\r\n    return new Promise((resolve, reject) => {\r\n      Promise.all([fileListPromise, fileParentPromise, rootFolderIdPromise]).then(\r\n        ([listing, parentId, rootFolderId]) => {\r\n          const directoryParentId = parentId === rootFolderId ? '' : parentId;\r\n          listing.additionalSyncBackendState = listing.additionalSyncBackendState.set(\r\n            'parentId',\r\n            directoryParentId\r\n          );\r\n          resolve(listing);\r\n        }\r\n      );\r\n    });\r\n  };\r\n\r\n  const getDirectoryListing = directoryId =>\r\n    getFiles(directoryId.startsWith('/') ? directoryId.substr(1) : directoryId);\r\n\r\n  const getMoreDirectoryListing = additionalSyncBackendState => {\r\n    const directoryId = additionalSyncBackendState.get('currentDirectoryId');\r\n    const nextPageToken = additionalSyncBackendState.get('nextPageToken');\r\n    return getFiles(directoryId, nextPageToken);\r\n  };\r\n\r\n  const fileIdByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient()\r\n        .then(gapi =>\r\n          gapi.client.drive.files.list({\r\n            pageSize: 1,\r\n            fields: 'files(id)',\r\n            q: `'${parentId}' in parents and trashed = false and name = '${name}'`,\r\n          })\r\n        )\r\n        .then(response =>\r\n          resolve(response.result.files.length > 0 ? response.result.files[0].id : null)\r\n        )\r\n        .catch(reject);\r\n    });\r\n\r\n  const updateFile = (fileId, contents) => {\r\n    fileId = fileId.startsWith('/') ? fileId.substr(1) : fileId;\r\n\r\n    return getAPIClient().then(gapi => {\r\n      fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          Authorization: `Bearer ${gapi.auth.getToken().access_token}`,\r\n        },\r\n        body: contents,\r\n      });\r\n    });\r\n  };\r\n\r\n  const createFile = (name, parentId, contents) => {\r\n    return new Promise((resolve, reject) => {\r\n      fileIdByNameAndParent(name, parentId)\r\n        .then(fileId =>\r\n          !!fileId\r\n            ? updateFile(fileId, contents).then(resolve).catch(reject)\r\n            : getAPIClient().then(gapi => {\r\n                gapi.client.drive.files\r\n                  .create({\r\n                    name,\r\n                    parents: parentId,\r\n                  })\r\n                  .then(response => updateFile(response.result.id, contents))\r\n                  .then(resolve)\r\n                  .catch(reject);\r\n              })\r\n        )\r\n        .catch(reject);\r\n    });\r\n  };\r\n\r\n  const duplicateFile = (fileId, fileNameCallback) => {\r\n    return new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        gapi.client.drive.files\r\n          .get({\r\n            fileId,\r\n            fields: 'name, parents',\r\n          })\r\n          .then(getResponse => {\r\n            if (!getResponse.result.name) {\r\n              reject();\r\n            } else {\r\n              const newFileName = fileNameCallback(getResponse.result.name);\r\n              const parents = getResponse.result.parents[0];\r\n              fileIdByNameAndParent(newFileName, parents).then(backupFileId => {\r\n                const makeCopy = () => {\r\n                  gapi.client.drive.files\r\n                    .copy({\r\n                      fileId,\r\n                      parents,\r\n                      name: newFileName,\r\n                    })\r\n                    .then(copyResponse => {\r\n                      resolve();\r\n                    })\r\n                    .catch(reject);\r\n                };\r\n\r\n                if (!!backupFileId) {\r\n                  gapi.client.drive.files\r\n                    .delete({ fileId: backupFileId })\r\n                    .then(makeCopy)\r\n                    .catch(reject);\r\n                } else {\r\n                  makeCopy();\r\n                }\r\n              });\r\n            }\r\n          });\r\n      });\r\n    });\r\n  };\r\n\r\n  const getFileContentsAndMetadata = fileId =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi => {\r\n        fileId = fileId.startsWith('/') ? fileId.substr(1) : fileId;\r\n\r\n        const fileContentsPromise = new Promise(resolve => {\r\n          gapi.client.drive.files\r\n            .get({\r\n              fileId,\r\n              alt: 'media',\r\n            })\r\n            .then(response => resolve(decodeURIComponent(escape(response.body))))\r\n            .catch(error => {\r\n              if (error.body && JSON.parse(error.body).error.errors[0].reason === 'notFound') {\r\n                reject();\r\n              }\r\n            });\r\n        });\r\n\r\n        const fileModifiedTimePromise = new Promise(resolve => {\r\n          gapi.client.drive.files\r\n            .get({\r\n              fileId,\r\n              fields: 'modifiedTime',\r\n            })\r\n            .then(response => {\r\n              resolve(response.result.modifiedTime);\r\n            })\r\n            .catch(error => {\r\n              if (error.body && JSON.parse(error.body).error.errors[0].reason === 'notFound') {\r\n                reject();\r\n              }\r\n            });\r\n        });\r\n\r\n        Promise.all([fileContentsPromise, fileModifiedTimePromise]).then(\r\n          ([contents, lastModifiedAt]) => {\r\n            resolve({\r\n              contents,\r\n              lastModifiedAt,\r\n            });\r\n          }\r\n        );\r\n      });\r\n    });\r\n\r\n  const getFileContents = fileId =>\r\n    new Promise((resolve, reject) =>\r\n      getFileContentsAndMetadata(fileId)\r\n        .then(({ contents }) => resolve(contents))\r\n        .catch(reject)\r\n    );\r\n\r\n  const getFileContentsByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) =>\r\n      fileIdByNameAndParent(name, parentId).then(fileId => getFileContents(fileId).then(resolve))\r\n    );\r\n\r\n  const deleteFileByNameAndParent = (name, parentId) =>\r\n    new Promise((resolve, reject) => {\r\n      getAPIClient().then(gapi =>\r\n        gapi.client.drive.files\r\n          .list({\r\n            pageSize: 1,\r\n            fields: 'files(id)',\r\n            q: `'${parentId}' in parents and trashed = false and name = '${name}'`,\r\n          })\r\n          .then(listResponse => {\r\n            if (listResponse.result.files.length > 0) {\r\n              gapi.client.drive.files\r\n                .delete({\r\n                  fileId: listResponse.result.files[0].id,\r\n                })\r\n                .then(resolve)\r\n                .catch(reject);\r\n            } else {\r\n              resolve();\r\n            }\r\n          })\r\n      );\r\n    });\r\n\r\n  return {\r\n    type: 'Google Drive',\r\n    isSignedIn,\r\n    getDirectoryListing,\r\n    getMoreDirectoryListing,\r\n    updateFile,\r\n    createFile,\r\n    duplicateFile,\r\n    getFileContentsAndMetadata,\r\n    getFileContents,\r\n    getFileContentsByNameAndParent,\r\n    deleteFileByNameAndParent,\r\n  };\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nconst PrivacyPolicy = () => {\r\n  return (\r\n    <div className=\"privacy-policy-container\">\r\n      <h1>Privacy Policy</h1>\r\n      <p>Last updated: April 15th, 2019</p>\r\n      <p>\r\n        We (\"us\" or \"our\") operate https://org-web.org (the \"Site\"). This page informs you of our\r\n        policies regarding the collection, use and disclosure of Personal Information we receive\r\n        from users of the Site.\r\n      </p>\r\n      <p>\r\n        We use your Personal Information only for providing and improving the Site. By using the\r\n        Site, you agree to the collection and use of information in accordance with this policy.\r\n      </p>\r\n      <h2>Information Collection And Use</h2>\r\n      <p>\r\n        While using our Site, we may ask you to provide us with certain personally identifiable\r\n        information that can be used to contact or identify you. Personally identifiable information\r\n        may include, but is not limited to your name (\"Personal Information\").\r\n      </p>\r\n      <h2>Log Data</h2>\r\n      <p>\r\n        Like many site operators, we collect information that your browser sends whenever you visit\r\n        our Site (\"Log Data\").\r\n      </p>\r\n      <p>\r\n        This Log Data may include information such as your computer's Internet Protocol (\"IP\")\r\n        address, browser type, browser version, the pages of our Site that you visit, the time and\r\n        date of your visit, the time spent on those pages and other statistics.\r\n      </p>\r\n      <p>\r\n        In addition, we may use third party services such as Google Analytics that collect, monitor\r\n        and analyze this data.\r\n      </p>\r\n      <h2>Cookies</h2>\r\n      <p>\r\n        Cookies are files with small amount of data, which may include an anonymous unique\r\n        identifier. Cookies are sent to your browser from a web site and stored on your computer's\r\n        hard drive.\r\n      </p>\r\n      <p>\r\n        Like many sites, we use \"cookies\" to collect information. You can instruct your browser to\r\n        refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept\r\n        cookies, you may not be able to use some portions of our Site.\r\n      </p>\r\n      <h2>Security</h2>\r\n      <p>\r\n        The security of your Personal Information is important to us, but remember that no method of\r\n        transmission over the Internet, or method of electronic storage, is 100% secure. While we\r\n        strive to use commercially acceptable means to protect your Personal Information, we cannot\r\n        guarantee its absolute security.\r\n      </p>\r\n      <h2>Changes To This Privacy Policy</h2>\r\n      <p>\r\n        This Privacy Policy is effective as of April 15th, 2019 and will remain in effect except\r\n        with respect to any changes in its provisions in the future, which will be in effect\r\n        immediately after being posted on this page.\r\n      </p>\r\n      <p>\r\n        We reserve the right to update or change our Privacy Policy at any time and you should check\r\n        this Privacy Policy periodically. Your continued use of the Service after we post any\r\n        modifications to the Privacy Policy on this page will constitute your acknowledgment of the\r\n        modifications and your consent to abide and be bound by the modified Privacy Policy.\r\n      </p>\r\n      <p>\r\n        If we make any material changes to this Privacy Policy, we will notify you either through\r\n        the email address you have provided us, or by placing a prominent notice on our website.\r\n      </p>\r\n      <h2>Contact</h2>\r\n      <p>Us If you have any questions about this Privacy Policy, please contact us.</p>\r\n    </div>\r\n  );\r\n};\r\nexport default PrivacyPolicy;\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Link, withRouter } from 'react-router-dom';\r\n\r\nimport logo from './org-web.svg';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport * as baseActions from '../../actions/base';\r\nimport { ActionCreators as undoActions } from 'redux-linear-undo';\r\n\r\nimport { List } from 'immutable';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nclass HeaderBar extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleChangelogClick',\r\n      'handleSettingsClick',\r\n      'handleModalPageDoneClick',\r\n      'handleSettingsSubPageBackClick',\r\n      'handleUndoClick',\r\n      'handleHelpClick',\r\n    ]);\r\n  }\r\n\r\n  getPathRoot() {\r\n    const {\r\n      location: { pathname },\r\n    } = this.props;\r\n    return pathname.split('/')[1];\r\n  }\r\n\r\n  renderFileBrowserBackButton() {\r\n    const {\r\n      location: { pathname },\r\n      syncBackendType,\r\n    } = this.props;\r\n    if (syncBackendType === 'Google Drive') {\r\n      return <div />;\r\n    }\r\n\r\n    let directoryPath = pathname.substr('/files'.length);\r\n    if (directoryPath.endsWith('/')) {\r\n      directoryPath = directoryPath.substring(0, directoryPath.length - 1);\r\n    }\r\n\r\n    if (directoryPath === '') {\r\n      return <div />;\r\n    } else {\r\n      const pathParts = directoryPath.split('/');\r\n      const parentDirectoryName = pathParts[pathParts.length - 2];\r\n      const parentPath = pathParts.slice(0, pathParts.length - 1).join('/');\r\n\r\n      return (\r\n        <Link to={`/files${parentPath}`} className=\"header-bar__back-button\">\r\n          <i className=\"fas fa-chevron-left\" />\r\n          <span className=\"header-bar__back-button__directory-path\">{parentDirectoryName}/</span>\r\n        </Link>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderOrgFileBackButton() {\r\n    const {\r\n      location: { pathname },\r\n    } = this.props;\r\n\r\n    let filePath = pathname.substr('/file'.length);\r\n    if (filePath.endsWith('/')) {\r\n      filePath = filePath.substring(0, filePath.length - 1);\r\n    }\r\n\r\n    const pathParts = filePath.split('/');\r\n    const directoryPath = pathParts.slice(0, pathParts.length - 1).join('/');\r\n\r\n    return (\r\n      <Link to={`/files${directoryPath}`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">File browser</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  renderLogo() {\r\n    return (\r\n      <div className=\"header-bar__logo-container\">\r\n        <img className=\"header-bar__logo\" src={logo} alt=\"Logo\" width=\"30\" height=\"30\" />\r\n        <h2 className=\"header-bar__app-name\">org-web</h2>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSampleFileBackButton() {\r\n    return (\r\n      <Link to={`/`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Home</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  renderSignInBackButton() {\r\n    return (\r\n      <Link to={`/`} className=\"header-bar__back-button\">\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Home</span>\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  handleSettingsSubPageBackClick() {\r\n    this.props.base.popModalPage();\r\n  }\r\n\r\n  renderSettingsSubPageBackButton() {\r\n    return (\r\n      <div className=\"header-bar__back-button\" onClick={this.handleSettingsSubPageBackClick}>\r\n        <i className=\"fas fa-chevron-left\" />\r\n        <span className=\"header-bar__back-button__directory-path\">Settings</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderBackButton() {\r\n    const { activeModalPage } = this.props;\r\n\r\n    switch (activeModalPage) {\r\n      case 'changelog':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'keyboard_shortcuts_editor':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'capture_templates_editor':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'sample':\r\n        return this.renderSettingsSubPageBackButton();\r\n      case 'settings':\r\n        return <div />;\r\n      default:\r\n    }\r\n\r\n    switch (this.getPathRoot()) {\r\n      case '':\r\n        return this.renderLogo();\r\n      case 'files':\r\n        return this.renderFileBrowserBackButton();\r\n      case 'file':\r\n        return this.renderOrgFileBackButton();\r\n      case 'sample':\r\n        return this.renderSampleFileBackButton();\r\n      case 'sign_in':\r\n        return this.renderSignInBackButton();\r\n      default:\r\n        return <div />;\r\n    }\r\n  }\r\n\r\n  renderTitle() {\r\n    const titleContainerWithText = text => <div className=\"header-bar__title\">{text}</div>;\r\n\r\n    switch (this.props.activeModalPage) {\r\n      case 'changelog':\r\n        return titleContainerWithText('Changelog');\r\n      case 'settings':\r\n        return titleContainerWithText('Settings');\r\n      case 'keyboard_shortcuts_editor':\r\n        return titleContainerWithText('Shortcuts');\r\n      case 'capture_templates_editor':\r\n        return titleContainerWithText('Capture');\r\n      case 'sample':\r\n        return titleContainerWithText('Sample');\r\n      default:\r\n    }\r\n\r\n    switch (this.getPathRoot()) {\r\n      case 'sample':\r\n        return titleContainerWithText('Sample');\r\n      case 'sign_in':\r\n        return titleContainerWithText('Sign in');\r\n      default:\r\n    }\r\n\r\n    return titleContainerWithText('');\r\n  }\r\n\r\n  handleChangelogClick() {\r\n    this.props.base.pushModalPage('changelog');\r\n  }\r\n\r\n  handleSettingsClick() {\r\n    this.props.base.pushModalPage('settings');\r\n  }\r\n\r\n  handleModalPageDoneClick() {\r\n    this.props.base.clearModalStack();\r\n  }\r\n\r\n  handleUndoClick() {\r\n    if (this.props.isUndoEnabled) {\r\n      this.props.undo.undo();\r\n    }\r\n  }\r\n\r\n  handleHelpClick() {\r\n    this.props.base.pushModalPage('settings');\r\n    this.props.base.pushModalPage('sample');\r\n  }\r\n\r\n  renderActions() {\r\n    const {\r\n      isAuthenticated,\r\n      hasUnseenChangelog,\r\n      activeModalPage,\r\n      path,\r\n      isUndoEnabled,\r\n    } = this.props;\r\n\r\n    if (!!activeModalPage) {\r\n      return (\r\n        <div className=\"header-bar__actions\" onClick={this.handleModalPageDoneClick}>\r\n          Done\r\n        </div>\r\n      );\r\n    } else {\r\n      const undoIconClassName = classNames('fas fa-undo header-bar__actions__item', {\r\n        'header-bar__actions__item--disabled': !isUndoEnabled,\r\n      });\r\n\r\n      const settingsIconClassName = classNames('fas fa-cogs header-bar__actions__item', {\r\n        'settings-icon--has-unseen-changelog': hasUnseenChangelog,\r\n      });\r\n\r\n      return (\r\n        <div className=\"header-bar__actions\">\r\n          {!isAuthenticated &&\r\n            this.getPathRoot() !== 'sign_in' && (\r\n              <Link to=\"/sign_in\">\r\n                <div className=\"header-bar__actions__item\" title=\"Sign in\">\r\n                  Sign in\r\n                </div>\r\n              </Link>\r\n            )}\r\n\r\n          {!isAuthenticated && (\r\n            <a href=\"https://github.com/DanielDe/org-web\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n              <i className=\"fab fa-github header-bar__actions__item\" />\r\n            </a>\r\n          )}\r\n\r\n          {isAuthenticated &&\r\n            !activeModalPage &&\r\n            !!path && (\r\n              <Fragment>\r\n                <i className={undoIconClassName} onClick={this.handleUndoClick} title=\"Undo\" />\r\n                <i\r\n                  className=\"fas fa-question-circle header-bar__actions__item\"\r\n                  onClick={this.handleHelpClick}\r\n                  title=\"Help\"\r\n                />\r\n              </Fragment>\r\n            )}\r\n\r\n          {isAuthenticated && (\r\n            <i\r\n              className={settingsIconClassName}\r\n              onClick={this.handleSettingsClick}\r\n              title=\"Settings\"\r\n            />\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const className = classNames('header-bar', {\r\n      'header-bar--with-logo': this.getPathRoot() === '',\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        {this.renderBackButton()}\r\n        {this.renderTitle()}\r\n        {this.renderActions()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    isAuthenticated: state.syncBackend.get('isAuthenticated'),\r\n    hasUnseenChangelog: state.base.get('hasUnseenChangelog'),\r\n    activeModalPage: state.base.get('modalPageStack', List()).last(),\r\n    path: state.org.present.get('path'),\r\n    isUndoEnabled: state.org.past.length > 0,\r\n    syncBackendType: state.syncBackend.get('client') && state.syncBackend.get('client').type,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n    undo: bindActionCreators(undoActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(HeaderBar)\r\n);\r\n","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default () => {\r\n  return (\r\n    <div className=\"landing-container\">\r\n      <h1 className=\"landing-app-name\">org-web</h1>\r\n      <h2 className=\"landing-tagline\">Edit your org files online.</h2>\r\n      <h2 className=\"landing-tagline\">Optimized for mobile.</h2>\r\n      <h2 className=\"landing-tagline\">\r\n        Syncs with Dropbox\r\n        <br />\r\n        and Google Drive.\r\n      </h2>\r\n\r\n      <Link to=\"/sample\">\r\n        <div className=\"btn landing-button view-sample-button\">View sample</div>\r\n      </Link>\r\n      <Link to=\"/sign_in\">\r\n        <div className=\"btn landing-button\">Sign in</div>\r\n      </Link>\r\n\r\n      <div className=\"mailing-list-signup-container\">\r\n        Interested in getting updates about org-web? Sign up for the{' '}\r\n        <a href=\"http://eepurl.com/dK5F9w\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n          mailing list\r\n        </a>{' '}\r\n        (Or check out some{' '}\r\n        <a\r\n          href=\"https://us19.campaign-archive.com/home/?u=36b9d8082ddb55e6cc7e22339&id=f427625e31\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          past emails\r\n        </a>{' '}\r\n        before you sign up)\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\n\r\nconst FileBrowser = ({\r\n  path,\r\n  listing,\r\n  hasMore,\r\n  isLoadingMore,\r\n  syncBackendType,\r\n  syncBackend,\r\n  additionalSyncBackendState,\r\n}) => {\r\n  useEffect(() => syncBackend.getDirectoryListing(path), [path]);\r\n\r\n  const handleLoadMoreClick = () => syncBackend.loadMoreDirectoryListing();\r\n\r\n  const getParentDirectoryPath = () => {\r\n    switch (syncBackendType) {\r\n      case 'Dropbox':\r\n        const pathParts = path.split('/');\r\n        return pathParts.slice(0, pathParts.length - 1).join('/');\r\n      case 'Google Drive':\r\n        return !!additionalSyncBackendState.get('parentId')\r\n          ? '/' + additionalSyncBackendState.get('parentId')\r\n          : null;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const isTopLevelDirectory = path === '';\r\n\r\n  return (\r\n    <div className=\"file-browser-container\">\r\n      {syncBackendType === 'Dropbox' && (\r\n        <h3 className=\"file-browser__header\">Directory: {isTopLevelDirectory ? '/' : path}</h3>\r\n      )}\r\n\r\n      <ul className=\"file-browser__file-list\">\r\n        {!isTopLevelDirectory && (\r\n          <Link to={`/files${getParentDirectoryPath()}`}>\r\n            <li className=\"file-browser__file-list__element\">\r\n              <i className=\"fas fa-folder file-browser__file-list__icon--directory\" /> ..\r\n            </li>\r\n          </Link>\r\n        )}\r\n\r\n        {(listing || []).map(file => {\r\n          const isDirectory = file.get('isDirectory');\r\n          const isBackupFile = file.get('name').endsWith('.org-web-bak');\r\n          const isOrgFile = file.get('name').endsWith('.org');\r\n          const isSettingsFile = file.get('name') === '.org-web-config.json';\r\n\r\n          const iconClass = classNames('file-browser__file-list__icon fas', {\r\n            'fa-folder': isDirectory,\r\n            'file-browser__file-list__icon--directory': isDirectory,\r\n            'fa-file': !isDirectory && !isBackupFile && !isSettingsFile,\r\n            'file-browser__file-list__icon--not-org': !isOrgFile,\r\n            'fa-copy': isBackupFile,\r\n            'fa-cogs': isSettingsFile,\r\n          });\r\n\r\n          if (file.get('isDirectory')) {\r\n            return (\r\n              <Link to={`/files${file.get('path')}`} key={file.get('id')}>\r\n                <li className=\"file-browser__file-list__element\">\r\n                  <i className={iconClass} /> {file.get('name')}/\r\n                </li>\r\n              </Link>\r\n            );\r\n          } else {\r\n            return (\r\n              <Link to={`/file${file.get('path')}`} key={file.get('id')}>\r\n                <li className=\"file-browser__file-list__element\">\r\n                  <i className={iconClass} /> {file.get('name')}\r\n                </li>\r\n              </Link>\r\n            );\r\n          }\r\n        })}\r\n\r\n        {hasMore &&\r\n          (isLoadingMore ? (\r\n            <li className=\"file-browser__file-list__loading-more-container\">\r\n              <i className=\"fas fa-spinner fa-lg fa-spin\" />\r\n            </li>\r\n          ) : (\r\n            <li\r\n              className=\"file-browser__file-list__element file-browser__file-list__element--load-more-row\"\r\n              onClick={handleLoadMoreClick}\r\n            >\r\n              Load more...\r\n            </li>\r\n          ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const currentFileBrowserDirectoryListing = state.syncBackend.get(\r\n    'currentFileBrowserDirectoryListing'\r\n  );\r\n  return {\r\n    syncBackendType: state.syncBackend.get('client').type,\r\n    listing: !!currentFileBrowserDirectoryListing\r\n      ? currentFileBrowserDirectoryListing.get('listing')\r\n      : null,\r\n    hasMore:\r\n      !!currentFileBrowserDirectoryListing && currentFileBrowserDirectoryListing.get('hasMore'),\r\n    isLoadingMore:\r\n      !!currentFileBrowserDirectoryListing &&\r\n      currentFileBrowserDirectoryListing.get('isLoadingMore'),\r\n    additionalSyncBackendState:\r\n      !!currentFileBrowserDirectoryListing &&\r\n      currentFileBrowserDirectoryListing.get('additionalSyncBackendState'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(FileBrowser);\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ message }) => {\r\n  const [shouldRenderIndicator, setShouldRenderIndicator] = useState(true);\r\n  const [lastMessage, setLastMessage] = useState(message);\r\n\r\n  useEffect(\r\n    () => {\r\n      if (!!message) {\r\n        setLastMessage(message);\r\n        setShouldRenderIndicator(true);\r\n      }\r\n    },\r\n    [message]\r\n  );\r\n\r\n  const handleAnimationRest = () => {\r\n    if (!!message) {\r\n      return;\r\n    }\r\n\r\n    setShouldRenderIndicator(false);\r\n    setLastMessage(null);\r\n  };\r\n\r\n  const handleClick = () => setShouldRenderIndicator(false);\r\n\r\n  if (!shouldRenderIndicator) {\r\n    return null;\r\n  }\r\n\r\n  const style = {\r\n    opacity: spring(!!message ? 0.9 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={style} onRest={handleAnimationRest}>\r\n      {style => (\r\n        <div className=\"loading-indicator\" style={style} onClick={handleClick}>\r\n          {lastMessage}\r\n        </div>\r\n      )}\r\n    </Motion>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({\r\n  subPartDataAndHandlers: {\r\n    onEnterTableEditMode,\r\n    onAddNewTableRow,\r\n    onRemoveTableRow,\r\n    onAddNewTableColumn,\r\n    onRemoveTableColumn,\r\n  },\r\n}) => {\r\n  return (\r\n    <div className=\"table-action-drawer-container\">\r\n      <div className=\" table-action-drawer__edit-icon-container\" onClick={onEnterTableEditMode}>\r\n        <i className=\"fas fa-pencil-alt fa-lg\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onAddNewTableRow}>\r\n        <i className=\"fas fa-plus fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon table-action-drawer__sub-icon--rotated\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onRemoveTableRow}>\r\n        <i className=\"fas fa-times fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon table-action-drawer__sub-icon--rotated\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onAddNewTableColumn}>\r\n        <i className=\"fas fa-plus fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon\" />\r\n      </div>\r\n\r\n      <div className=\"table-action-drawer__sub-icon-container\" onClick={onRemoveTableColumn}>\r\n        <i className=\"fas fa-times fa-lg table-action-drawer__main-icon\" />\r\n        <i className=\"fas fa-columns fa-sm table-action-drawer__sub-icon\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString';\r\nimport TableActionDrawer from './TableActionDrawer';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class TablePart extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleCellSelect',\r\n      'handleTextareaBlur',\r\n      'handleCellChange',\r\n      'handleInsertTimestamp',\r\n      'handleTextareaRef',\r\n    ]);\r\n\r\n    this.state = {\r\n      rawCellValues: this.generateCellValueMap(props.table),\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const {\r\n      subPartDataAndHandlers: { onTableCellValueUpdate, selectedTableCellId, inTableEditMode },\r\n    } = this.props;\r\n    const { rawCellValues } = this.state;\r\n\r\n    if (prevProps.subPartDataAndHandlers.inTableEditMode && !inTableEditMode) {\r\n      if (rawCellValues.has(selectedTableCellId)) {\r\n        onTableCellValueUpdate(selectedTableCellId, rawCellValues.get(selectedTableCellId));\r\n      }\r\n    }\r\n\r\n    if (this.props.table !== prevProps.table) {\r\n      this.setState({ rawCellValues: this.generateCellValueMap(this.props.table) });\r\n    }\r\n  }\r\n\r\n  generateCellValueMap(table) {\r\n    return Map(\r\n      table\r\n        .get('contents')\r\n        .map(row => row.get('contents').map(cell => [cell.get('id'), cell.get('rawContents')]))\r\n        .flatten()\r\n    );\r\n  }\r\n\r\n  handleCellSelect(cellId) {\r\n    return () => this.props.subPartDataAndHandlers.onTableCellSelect(cellId);\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.subPartDataAndHandlers.onExitTableEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  handleCellChange(event) {\r\n    const { rawCellValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedTableCellId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      rawCellValues: rawCellValues.set(selectedTableCellId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleInsertTimestamp() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { rawCellValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedTableCellId },\r\n    } = this.props;\r\n    const cellValue = rawCellValues.get(selectedTableCellId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      rawCellValues: rawCellValues.set(\r\n        selectedTableCellId,\r\n        cellValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          cellValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      table,\r\n      subPartDataAndHandlers: { selectedTableCellId, inTableEditMode, shouldDisableActions },\r\n    } = this.props;\r\n    const { rawCellValues } = this.state;\r\n\r\n    const isTableSelected = table\r\n      .get('contents')\r\n      .some(row => row.get('contents').some(cell => cell.get('id') === selectedTableCellId));\r\n\r\n    return (\r\n      <Fragment>\r\n        <table className=\"table-part\">\r\n          <tbody>\r\n            {table.get('contents').map(row => (\r\n              <tr key={row.get('id')}>\r\n                {row.get('contents').map(cell => {\r\n                  const isCellSelected = cell.get('id') === selectedTableCellId;\r\n\r\n                  const className = classNames('table-part__cell', {\r\n                    'table-part__cell--selected': isCellSelected,\r\n                  });\r\n\r\n                  return (\r\n                    <td\r\n                      className={className}\r\n                      key={cell.get('id')}\r\n                      onClick={this.handleCellSelect(cell.get('id'))}\r\n                    >\r\n                      {isCellSelected && inTableEditMode ? (\r\n                        <div className=\"table-cell__edit-container\">\r\n                          <textarea\r\n                            autoFocus\r\n                            className=\"textarea\"\r\n                            rows=\"3\"\r\n                            value={rawCellValues.get(cell.get('id'))}\r\n                            onBlur={this.handleTextareaBlur}\r\n                            onChange={this.handleCellChange}\r\n                            ref={this.handleTextareaRef}\r\n                          />\r\n                          <div\r\n                            className=\"table-cell__insert-timestamp-button\"\r\n                            onClick={this.handleInsertTimestamp}\r\n                          >\r\n                            <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                            Insert timestamp\r\n                          </div>\r\n                        </div>\r\n                      ) : cell.get('contents').size > 0 ? (\r\n                        <AttributedString\r\n                          parts={cell.get('contents')}\r\n                          subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n                        />\r\n                      ) : (\r\n                        '   '\r\n                      )}\r\n                    </td>\r\n                  );\r\n                })}\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        <Collapse isOpened={isTableSelected && !shouldDisableActions}>\r\n          <TableActionDrawer subPartDataAndHandlers={this.props.subPartDataAndHandlers} />\r\n        </Collapse>\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n","// Interpolates between two colors.\r\n// colorA and colorB should be objects with keys {r, g, b, a}.\r\n// interpolationFactor should be a number between 0 and 1 representing how far from colorA to\r\n// colorB it should interpolate.\r\n// An object with keys {r, g, b, a} will be returned.\r\nexport const interpolateColors = (colorA, colorB, interpolationFactor) => {\r\n  return {\r\n    r: parseInt((colorB.r - colorA.r) * interpolationFactor + colorA.r, 10),\r\n    g: parseInt((colorB.g - colorA.g) * interpolationFactor + colorA.g, 10),\r\n    b: parseInt((colorB.b - colorA.b) * interpolationFactor + colorA.b, 10),\r\n    a: (colorB.a - colorA.a) * interpolationFactor + colorA.a,\r\n  };\r\n};\r\n\r\nexport const rgbaObject = (r, g, b, a) => {\r\n  return { r, g, b, a };\r\n};\r\n\r\nexport const rgbaString = rgba => {\r\n  return `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;\r\n};\r\n","import React from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../lib/color';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ state, onClick }) => {\r\n  const uncheckedColor = rgbaObject(255, 255, 255, 1);\r\n  const checkedColor = rgbaObject(94, 52, 140, 1);\r\n\r\n  const checkboxStyle = {\r\n    colorFactor: spring(\r\n      {\r\n        checked: 1,\r\n        partial: 1,\r\n        unchecked: 0,\r\n      }[state],\r\n      { stiffness: 300 }\r\n    ),\r\n  };\r\n\r\n  return (\r\n    <Motion style={checkboxStyle}>\r\n      {style => {\r\n        const backgroundColor = rgbaString(\r\n          interpolateColors(uncheckedColor, checkedColor, style.colorFactor)\r\n        );\r\n\r\n        return (\r\n          <div className=\"checkbox\" onClick={onClick} style={{ backgroundColor }}>\r\n            <div className=\"checkbox__inner-container\">\r\n              {state === 'checked' && <i className=\"fas fa-check\" />}\r\n              {state === 'partial' && <i className=\"fas fa-minus\" />}\r\n              {state === 'unchecked' && <i className=\"fas fa-square\" />}\r\n            </div>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({\r\n  subPartDataAndHandlers: {\r\n    onEnterListTitleEditMode,\r\n    onEnterListContentsEditMode,\r\n    onAddNewListItem,\r\n    onRemoveListItem,\r\n  },\r\n}) => {\r\n  return (\r\n    <div className=\"list-action-drawer-container\">\r\n      <div className=\"list-action-drawer__row\">\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onEnterListTitleEditMode}>\r\n          <i className=\"fas fa-pencil-alt fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div\r\n          className=\"list-action-drawer__edit-icon-container\"\r\n          onClick={onEnterListContentsEditMode}\r\n        >\r\n          <i className=\"fas fa-edit fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onAddNewListItem}>\r\n          <i className=\"fas fa-plus fa-lg\" />\r\n        </div>\r\n\r\n        <span className=\"list-action-drawer__separator\" />\r\n\r\n        <div className=\"list-action-drawer__edit-icon-container\" onClick={onRemoveListItem}>\r\n          <i className=\"fas fa-times fa-lg\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString/';\r\nimport Checkbox from '../../../../../UI/Checkbox/';\r\nimport ListActionDrawer from './ListActionDrawer';\r\nimport { attributedStringToRawText } from '../../../../../../lib/export_org';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class ListPart extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleListItemSelect',\r\n      'handleCheckboxClick',\r\n      'handleTextareaBlur',\r\n      'handleListTitleChange',\r\n      'handleListContentsChange',\r\n      'handleInsertTimestampListTitle',\r\n      'handleInsertTimestampListContents',\r\n      'handleTextareaRef',\r\n    ]);\r\n\r\n    this.state = {\r\n      listTitleValues: this.generateListTitleValueMap(props.part),\r\n      listContentsValues: this.generateListContentsValueMap(props.part),\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const {\r\n      subPartDataAndHandlers: {\r\n        onListTitleValueUpdate,\r\n        onListContentsValueUpdate,\r\n        inListTitleEditMode,\r\n        inListContentsEditMode,\r\n        selectedListItemId,\r\n      },\r\n    } = this.props;\r\n    const { listTitleValues, listContentsValues } = this.state;\r\n\r\n    if (prevProps.subPartDataAndHandlers.inListTitleEditMode && !inListTitleEditMode) {\r\n      if (listTitleValues.has(selectedListItemId)) {\r\n        onListTitleValueUpdate(selectedListItemId, listTitleValues.get(selectedListItemId));\r\n      }\r\n    }\r\n\r\n    const prevSelectedListItemId = prevProps.subPartDataAndHandlers.selectedListItemId;\r\n    if ((prevSelectedListItemId !== selectedListItemId) && inListTitleEditMode && prevProps.subPartDataAndHandlers.inListTitleEditMode) {\r\n      if (listTitleValues.has(prevSelectedListItemId)) {\r\n        onListTitleValueUpdate(prevSelectedListItemId, listTitleValues.get(prevSelectedListItemId));\r\n      }\r\n    }\r\n\r\n    if (prevProps.subPartDataAndHandlers.inListContentsEditMode && !inListContentsEditMode) {\r\n      if (listContentsValues.has(selectedListItemId)) {\r\n        onListContentsValueUpdate(selectedListItemId, listContentsValues.get(selectedListItemId));\r\n      }\r\n    }\r\n\r\n    if ((prevSelectedListItemId !== selectedListItemId) && inListContentsEditMode && prevProps.subPartDataAndHandlers.inListContentsEditMode) {\r\n      if (listContentsValues.has(prevSelectedListItemId)) {\r\n        onListContentsValueUpdate(prevSelectedListItemId, listContentsValues.get(prevSelectedListItemId));\r\n      }\r\n    }\r\n\r\n    if (this.props.part !== prevProps.part) {\r\n      this.setState({ listTitleValues: this.generateListTitleValueMap(this.props.part) });\r\n      this.setState({ listContentsValues: this.generateListContentsValueMap(this.props.part) });\r\n    }\r\n  }\r\n\r\n  generateListTitleValueMap(part) {\r\n    return Map(\r\n      part\r\n        .get('items')\r\n        .map(item => [item.get('id'), attributedStringToRawText(item.get('titleLine'))])\r\n    );\r\n  }\r\n\r\n  generateListContentsValueMap(part) {\r\n    return Map(\r\n      part\r\n        .get('items')\r\n        .map(item => [item.get('id'), attributedStringToRawText(item.get('contents'))])\r\n    );\r\n  }\r\n\r\n  handleListItemSelect(itemId) {\r\n    return () => this.props.subPartDataAndHandlers.onListItemSelect(itemId);\r\n  }\r\n\r\n  handleCheckboxClick(itemId) {\r\n    return () => this.props.subPartDataAndHandlers.onCheckboxClick(itemId);\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.subPartDataAndHandlers.onExitListTitleEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  handleListTitleChange(event) {\r\n    const { listTitleValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      listTitleValues: listTitleValues.set(selectedListItemId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleListContentsChange(event) {\r\n    const { listContentsValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n\r\n    this.setState({\r\n      listContentsValues: listContentsValues.set(selectedListItemId, event.target.value),\r\n    });\r\n  }\r\n\r\n  handleInsertTimestampListTitle() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { listTitleValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n    const listTitleValue = listTitleValues.get(selectedListItemId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      listTitleValues: listTitleValues.set(\r\n        selectedListItemId,\r\n        listTitleValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          listTitleValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handleInsertTimestampListContents() {\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { listContentsValues } = this.state;\r\n    const {\r\n      subPartDataAndHandlers: { selectedListItemId },\r\n    } = this.props;\r\n    const listContentsValue = listContentsValues.get(selectedListItemId);\r\n\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      listContentsValues: listContentsValues.set(\r\n        selectedListItemId,\r\n        listContentsValue.substring(0, insertionIndex) +\r\n          getCurrentTimestampAsText() +\r\n          listContentsValue.substring(this.textarea.selectionEnd || insertionIndex)\r\n      ),\r\n    });\r\n\r\n    this.textarea.focus();\r\n  }\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  renderContent() {\r\n    const {\r\n      part,\r\n      subPartDataAndHandlers: {\r\n        selectedListItemId,\r\n        inListTitleEditMode,\r\n        inListContentsEditMode,\r\n        shouldDisableActions,\r\n      },\r\n    } = this.props;\r\n    const { listTitleValues, listContentsValues } = this.state;\r\n\r\n    return part.get('items').map(item => {\r\n      const isItemSelected = item.get('id') === selectedListItemId;\r\n      const lineContainerClass = classNames({\r\n        'list-part__not_checkbox-container': !item.get('isCheckbox'),\r\n        'list-part__checkbox-container': item.get('isCheckbox'),\r\n        'list-part__item--selected': isItemSelected,\r\n      });\r\n\r\n      return (\r\n        <li key={item.get('id')} value={item.get('forceNumber')}>\r\n          <div className={lineContainerClass} onClick={this.handleListItemSelect(item.get('id'))}>\r\n            {item.get('isCheckbox') && (\r\n              <Checkbox\r\n                onClick={this.handleCheckboxClick(item.get('id'))}\r\n                state={item.get('checkboxState')}\r\n              />\r\n            )}\r\n            {isItemSelected && inListTitleEditMode ? (\r\n              <div className=\"list-title-line__edit-container\">\r\n                <textarea\r\n                  autoFocus\r\n                  className=\"textarea\"\r\n                  rows=\"3\"\r\n                  ref={this.handleTextareaRef}\r\n                  value={listTitleValues.get(item.get('id'))}\r\n                  onBlur={this.handleTextareaBlur}\r\n                  onChange={this.handleListTitleChange}\r\n                />\r\n                <div\r\n                  className=\"list-title-line__insert-timestamp-button\"\r\n                  onClick={this.handleInsertTimestampListTitle}\r\n                >\r\n                  <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                  Insert timestamp\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              listTitleValues.get(item.get('id'))) ? (\r\n                <AttributedString\r\n                parts={item.get('titleLine')}\r\n                subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n              />\r\n              ) : (\r\n                <span>&nbsp;</span>\r\n              )}\r\n          </div>\r\n          <Collapse isOpened={isItemSelected && !shouldDisableActions}>\r\n            <ListActionDrawer subPartDataAndHandlers={this.props.subPartDataAndHandlers} />\r\n          </Collapse>\r\n          {isItemSelected && inListContentsEditMode ? (\r\n            <div className=\"list-contents__edit-container\">\r\n              <textarea\r\n                autoFocus\r\n                className=\"textarea\"\r\n                rows=\"8\"\r\n                ref={this.handleTextareaRef}\r\n                value={listContentsValues.get(item.get('id'))}\r\n                onBlur={this.handleTextareaBlur}\r\n                onChange={this.handleListContentsChange}\r\n              />\r\n              <div\r\n                className=\"list-contents__insert-timestamp-button\"\r\n                onClick={this.handleInsertTimestampListContents}\r\n              >\r\n                <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n                Insert timestamp\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <AttributedString\r\n              parts={item.get('contents')}\r\n              subPartDataAndHandlers={this.props.subPartDataAndHandlers}\r\n            />\r\n          )}\r\n        </li>\r\n      );\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        {this.props.part.get('isOrdered') ? (\r\n          <ol className=\"attributed-string__list-part attributed-string__list-part--ordered\">\r\n            {this.renderContent()}\r\n          </ol>\r\n        ) : (\r\n          <ul className=\"attributed-string__list-part\">{this.renderContent()}</ul>\r\n        )}\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nexport default ({ part, subPartDataAndHandlers: { onTimestampClick, shouldDisableActions } }) => {\r\n  const handleClick = () => (shouldDisableActions ? void 0 : onTimestampClick(part.get('id')));\r\n\r\n  const firstTimestamp = part.get('firstTimestamp');\r\n  const secondTimestamp = part.get('secondTimestamp');\r\n\r\n  return (\r\n    <span className=\"attributed-string__timestamp-part\" onClick={handleClick}>\r\n      {!!firstTimestamp && renderAsText(firstTimestamp)}\r\n      {!!secondTimestamp && (\r\n        <Fragment>\r\n          {'--'}\r\n          {renderAsText(secondTimestamp)}\r\n        </Fragment>\r\n      )}\r\n    </span>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TablePart from './components/TablePart';\r\nimport ListPart from './components/ListPart';\r\nimport TimestampPart from './components/TimestampPart';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ parts, subPartDataAndHandlers }) => {\r\n  let className;\r\n\r\n  return (\r\n    <span>\r\n      {parts.map(part => {\r\n        switch (part.get('type')) {\r\n          case 'text':\r\n            return part.get('contents');\r\n          case 'link':\r\n            const uri = part.getIn(['contents', 'uri']);\r\n            const title = part.getIn(['contents', 'title']) || uri;\r\n\r\n            return (\r\n              <a key={part.get('id')} href={uri} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                {title}\r\n              </a>\r\n            );\r\n          case 'percentage-cookie':\r\n            className = classNames('attributed-string__cookie-part', {\r\n              'attributed-string__cookie-part--complete':\r\n                parseInt(part.get('percentage'), 10) === 100,\r\n            });\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                [{part.get('percentage')}\r\n                %]\r\n              </span>\r\n            );\r\n          case 'fraction-cookie':\r\n            className = classNames('attributed-string__cookie-part', {\r\n              'attributed-string__cookie-part--complete':\r\n                part.getIn(['fraction', 0]) !== '' &&\r\n                part.getIn(['fraction', 0]) === part.getIn(['fraction', 1]),\r\n            });\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                [{part.getIn(['fraction', 0])}/{part.getIn(['fraction', 1])}]\r\n              </span>\r\n            );\r\n          case 'table':\r\n            return (\r\n              <TablePart\r\n                key={part.get('id')}\r\n                table={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          case 'list':\r\n            return (\r\n              <ListPart\r\n                key={part.get('id')}\r\n                part={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          case 'inline-markup':\r\n            className = classNames(\r\n              'attributed-string__inline-markup',\r\n              `attributed-string__inline-markup--${part.get('markupType')}`\r\n            );\r\n\r\n            return (\r\n              <span key={part.get('id')} className={className}>\r\n                {part.get('content')}\r\n              </span>\r\n            );\r\n          case 'timestamp':\r\n            return (\r\n              <TimestampPart\r\n                key={part.get('id')}\r\n                part={part}\r\n                subPartDataAndHandlers={subPartDataAndHandlers}\r\n              />\r\n            );\r\n          default:\r\n            console.error(`Unrecognized attributed string part type! ${part.get('type')}`);\r\n            return '';\r\n        }\r\n      })}\r\n    </span>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport { getCurrentTimestampAsText } from '../../../../lib/timestamps';\r\n\r\nimport AttributedString from '../AttributedString';\r\n\r\nclass TitleLine extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleTitleSpanRef',\r\n      'handleTextareaRef',\r\n      'handleTitleClick',\r\n      'handleTextareaBlur',\r\n      'handleTitleChange',\r\n      'handleTitleFieldClick',\r\n      'handleTodoClick',\r\n      'handleTimestampClick',\r\n      'handleInsertTimestamp',\r\n    ]);\r\n\r\n    this.state = {\r\n      titleValue: this.calculateRawTitle(props.header),\r\n      containerWidth: null,\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  storeContainerWidth() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.storeContainerWidth();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { header } = this.props;\r\n\r\n    if (prevProps.inEditMode && !this.props.inEditMode) {\r\n      this.props.org.updateHeaderTitle(header.get('id'), this.state.titleValue);\r\n    }\r\n\r\n    if (prevProps.header !== this.props.header) {\r\n      this.setState(\r\n        {\r\n          titleValue: this.calculateRawTitle(this.props.header),\r\n        },\r\n        () => this.storeContainerWidth()\r\n      );\r\n    }\r\n  }\r\n\r\n  handleRef(div) {\r\n    this.containerDiv = div;\r\n  }\r\n\r\n  handleTitleSpanRef(span) {\r\n    this.titleSpan = span;\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  calculateRawTitle(header) {\r\n    const todoKeyword = header.getIn(['titleLine', 'todoKeyword']);\r\n    const tags = header.getIn(['titleLine', 'tags']);\r\n\r\n    let titleValue = header.getIn(['titleLine', 'rawTitle']);\r\n\r\n    if (!!todoKeyword) {\r\n      titleValue = `${todoKeyword} ${titleValue}`;\r\n    }\r\n\r\n    if (!!tags && tags.size > 0) {\r\n      titleValue = `${titleValue} :${tags.join(':')}:`;\r\n    }\r\n\r\n    return titleValue;\r\n  }\r\n\r\n  handleTitleClick(event) {\r\n    const { header, hasContent, isSelected, onClick } = this.props;\r\n\r\n    if (!!onClick) {\r\n      onClick();\r\n    } else {\r\n      if (hasContent && (!header.get('opened') || isSelected)) {\r\n        this.props.org.toggleHeaderOpened(header.get('id'));\r\n      }\r\n\r\n      this.props.org.selectHeader(header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleTodoClick(event) {\r\n    const { header, shouldTapTodoToAdvance, onClick } = this.props;\r\n\r\n    if (!!onClick) {\r\n      onClick();\r\n      event.stopPropagation();\r\n    } else {\r\n      this.props.org.selectHeader(header.get('id'));\r\n\r\n      if (shouldTapTodoToAdvance) {\r\n        this.props.org.advanceTodoState();\r\n      }\r\n    }\r\n  }\r\n\r\n  handleTextareaBlur(event) {\r\n    // Give the \"Insert timestamp\" button click a chance to tell us to ignore the blur event.\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.org.exitEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  handleTitleChange(event) {\r\n    // If the last character typed was a newline at the end, exit edit mode.\r\n    const newTitle = event.target.value;\r\n    const lastCharacter = newTitle[newTitle.length - 1];\r\n    if (\r\n      this.state.titleValue === newTitle.substring(0, newTitle.length - 1) &&\r\n      lastCharacter === '\\n'\r\n    ) {\r\n      this.props.org.exitEditMode();\r\n      return;\r\n    }\r\n\r\n    this.setState({ titleValue: newTitle });\r\n  }\r\n\r\n  handleTitleFieldClick(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  handleTimestampClick(timestampId) {\r\n    this.props.base.activatePopup('timestamp-editor', { timestampId });\r\n  }\r\n\r\n  handleInsertTimestamp(event) {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { titleValue } = this.state;\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      titleValue:\r\n        titleValue.substring(0, insertionIndex) +\r\n        getCurrentTimestampAsText() +\r\n        titleValue.substring(this.textarea.selectionEnd || insertionIndex),\r\n    });\r\n\r\n    this.textarea.focus();\r\n\r\n    event.stopPropagation();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      color,\r\n      hasContent,\r\n      inEditMode,\r\n      shouldDisableActions,\r\n      shouldDisableExplicitWidth,\r\n    } = this.props;\r\n    const { containerWidth } = this.state;\r\n    const todoKeyword = header.getIn(['titleLine', 'todoKeyword']);\r\n\r\n    const titleStyle = {\r\n      color,\r\n      wordBreak: 'break-word',\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className=\"title-line\"\r\n        onClick={this.handleTitleClick}\r\n        ref={this.handleRef}\r\n        style={{ width: shouldDisableExplicitWidth ? '' : containerWidth }}\r\n      >\r\n        {!inEditMode && !!todoKeyword ? (\r\n          <span\r\n            className={classNames('todo-keyword', `todo-keyword--${todoKeyword.toLowerCase()}`)}\r\n            onClick={this.handleTodoClick}\r\n          >\r\n            {todoKeyword}\r\n          </span>\r\n        ) : (\r\n          ''\r\n        )}\r\n\r\n        {inEditMode ? (\r\n          <div className=\"title-line__edit-container\">\r\n            <textarea\r\n              autoFocus\r\n              className=\"textarea\"\r\n              rows=\"3\"\r\n              ref={this.handleTextareaRef}\r\n              value={this.state.titleValue}\r\n              onBlur={this.handleTextareaBlur}\r\n              onChange={this.handleTitleChange}\r\n              onClick={this.handleTitleFieldClick}\r\n            />\r\n            <div\r\n              className=\"title-line__insert-timestamp-button\"\r\n              onClick={this.handleInsertTimestamp}\r\n            >\r\n              <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n              Insert timestamp\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <span style={titleStyle} ref={this.handleTitleSpanRef}>\r\n              <AttributedString\r\n                parts={header.getIn(['titleLine', 'title'])}\r\n                subPartDataAndHandlers={{\r\n                  onTimestampClick: this.handleTimestampClick,\r\n                  shouldDisableActions,\r\n                }}\r\n              />\r\n              {!header.get('opened') && hasContent ? '...' : ''}\r\n            </span>\r\n\r\n            {header.getIn(['titleLine', 'tags']).size > 0 && (\r\n              <div>\r\n                {header\r\n                  .getIn(['titleLine', 'tags'])\r\n                  .toSet()\r\n                  .toList()\r\n                  .filter(tag => !!tag)\r\n                  .map(tag => (\r\n                    <div className=\"header-tag\" key={tag}>\r\n                      {tag}\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode:\r\n      state.org.present.get('editMode') === 'title' &&\r\n      state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    shouldTapTodoToAdvance: state.base.get('shouldTapTodoToAdvance'),\r\n    isSelected: state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TitleLine);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\n\r\nexport default class PlanningItems extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleTimestampClick']);\r\n  }\r\n\r\n  handleTimestampClick(planningItemIndex) {\r\n    return () => this.props.onClick(planningItemIndex);\r\n  }\r\n\r\n  render() {\r\n    const { planningItems } = this.props;\r\n\r\n    if (planningItems.size === 0) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        {planningItems.map((planningItem, index) => (\r\n          <div key={planningItem.get('id')} className=\"planning-items__item-container\">\r\n            <div className=\"planning-item__type\">{planningItem.get('type')}: </div>\r\n            <div className=\"planning-item__timestamp\" onClick={this.handleTimestampClick(index)}>\r\n              {renderAsText(planningItem.get('timestamp'))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment, useState } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AttributedString from '../../../AttributedString';\r\n\r\nexport default ({ propertyListItems, shouldDisableActions, onTimestampClick, onEdit }) => {\r\n  const [isDrawerCollapsed, setIsDrawerCollapsed] = useState(true);\r\n\r\n  const handleCollapseToggle = () => setIsDrawerCollapsed(!isDrawerCollapsed);\r\n\r\n  return propertyListItems.size === 0 ? null : (\r\n    <div className=\"property-list-container\">\r\n      <div className=\"property-list__property\" onClick={handleCollapseToggle}>\r\n        :PROPERTIES:\r\n        {isDrawerCollapsed ? '...' : ''}\r\n      </div>\r\n\r\n      {!isDrawerCollapsed && (\r\n        <Fragment>\r\n          {propertyListItems.map(propertyListItem => (\r\n            <div className=\"property-list__item-container\" key={propertyListItem.get('id')}>\r\n              <div\r\n                className=\"property-list__property\"\r\n                onClick={shouldDisableActions ? null : onEdit}\r\n              >\r\n                :{propertyListItem.get('property')}:\r\n              </div>\r\n              <div className=\"property-list__value\">\r\n                <AttributedString\r\n                  parts={propertyListItem.get('value') || []}\r\n                  subPartDataAndHandlers={{\r\n                    onTimestampClick,\r\n                    shouldDisableActions,\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          <div className=\"property-list__property\" onClick={onEdit}>\r\n            :END:\r\n          </div>\r\n        </Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport PlanningItems from './components/PlanningItems';\r\nimport PropertyListItems from './components/PropertyListItems';\r\n\r\nimport _ from 'lodash';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport { renderAsText, getCurrentTimestampAsText } from '../../../../lib/timestamps';\r\nimport { attributedStringToRawText } from '../../../../lib/export_org';\r\n\r\nimport AttributedString from '../AttributedString';\r\n\r\nclass HeaderContent extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleTextareaRef',\r\n      'handleDescriptionChange',\r\n      'handleTextareaBlur',\r\n      'handleTableCellSelect',\r\n      'handleExitTableEditMode',\r\n      'handleTableCellValueUpdate',\r\n      'handleEnterTableEditMode',\r\n      'handleAddNewTableRow',\r\n      'handleRemoveTableRow',\r\n      'handleAddNewTableColumn',\r\n      'handleRemoveTableColumn',\r\n      'handleCheckboxClick',\r\n      'handleListItemSelect',\r\n      'handleEnterListTitleEditMode',\r\n      'handleExitListTitleEditMode',\r\n      'handleListTitleValueUpdate',\r\n      'handleEnterListContentsEditMode',\r\n      'handleExitListContentsEditMode',\r\n      'handleListContentsValueUpdate',\r\n      'handleAddNewListItem',\r\n      'handleRemoveListItem',\r\n      'handleTimestampClick',\r\n      'handleInsertTimestamp',\r\n      'handlePlanningItemTimestampClick',\r\n      'handlePropertyListEdit',\r\n    ]);\r\n\r\n    this.state = {\r\n      descriptionValue: this.calculateRawDescription(props.header),\r\n      containerWidth: null,\r\n      shouldIgnoreBlur: false,\r\n    };\r\n  }\r\n\r\n  storeContainerWidth() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.storeContainerWidth();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { header } = this.props;\r\n\r\n    if (prevProps.inEditMode && !this.props.inEditMode) {\r\n      this.props.org.updateHeaderDescription(header.get('id'), this.state.descriptionValue);\r\n    }\r\n\r\n    if (prevProps.header !== this.props.header) {\r\n      this.setState(\r\n        {\r\n          descriptionValue: this.calculateRawDescription(this.props.header),\r\n        },\r\n        () => this.storeContainerWidth()\r\n      );\r\n    }\r\n  }\r\n\r\n  calculateRawDescription(header) {\r\n    const planningItems = header.get('planningItems');\r\n    const propertyListItems = header.get('propertyListItems');\r\n\r\n    const planningItemsText = planningItems\r\n      .map(\r\n        planningItem =>\r\n          `${planningItem.get('type')}: ${renderAsText(planningItem.get('timestamp'))}`\r\n      )\r\n      .join(' ');\r\n\r\n    let propertyListItemsText = '';\r\n    if (propertyListItems.size > 0) {\r\n      propertyListItemsText += ':PROPERTIES:\\n';\r\n      propertyListItemsText += propertyListItems\r\n        .map(\r\n          propertyListItem =>\r\n            `:${propertyListItem.get('property')}: ${attributedStringToRawText(\r\n              propertyListItem.get('value')\r\n            )}`\r\n        )\r\n        .join('\\n');\r\n      propertyListItemsText += '\\n:END:';\r\n    }\r\n\r\n    let descriptionText = '';\r\n    if (!!planningItemsText) {\r\n      descriptionText += planningItemsText + '\\n';\r\n    }\r\n    if (!!propertyListItemsText) {\r\n      descriptionText += propertyListItemsText + '\\n';\r\n    }\r\n    descriptionText += header.get('rawDescription');\r\n    return descriptionText;\r\n  }\r\n\r\n  handleTextareaRef(textarea) {\r\n    this.textarea = textarea;\r\n  }\r\n\r\n  handleRef(div) {\r\n    this.containerDiv = div;\r\n  }\r\n\r\n  handleDescriptionChange(event) {\r\n    this.setState({ descriptionValue: event.target.value });\r\n  }\r\n\r\n  handleTextareaBlur() {\r\n    // Give the \"Insert timestamp\" button click a chance to tell us to ignore the blur event.\r\n    setTimeout(() => {\r\n      if (!this.state.shouldIgnoreBlur) {\r\n        this.props.org.exitEditMode();\r\n      } else {\r\n        this.setState({ shouldIgnoreBlur: false });\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  handleTableCellSelect(cellId) {\r\n    this.props.org.setSelectedTableCellId(cellId);\r\n  }\r\n\r\n  handleExitTableEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleTableCellValueUpdate(cellId, newValue) {\r\n    this.props.org.updateTableCellValue(cellId, newValue);\r\n  }\r\n\r\n  handleEnterTableEditMode() {\r\n    this.props.org.enterEditMode('table');\r\n  }\r\n\r\n  handleAddNewTableRow() {\r\n    this.props.org.addNewTableRow();\r\n  }\r\n\r\n  handleRemoveTableRow() {\r\n    this.props.org.removeTableRow();\r\n  }\r\n\r\n  handleAddNewTableColumn() {\r\n    this.props.org.addNewTableColumn();\r\n  }\r\n\r\n  handleRemoveTableColumn() {\r\n    this.props.org.removeTableColumn();\r\n  }\r\n\r\n  handleCheckboxClick(listItemId) {\r\n    this.props.org.advanceCheckboxState(listItemId);\r\n  }\r\n\r\n  handleListItemSelect(listItemId) {\r\n    this.props.org.setSelectedListItemId(listItemId);\r\n  }\r\n\r\n  handleEnterListTitleEditMode() {\r\n    this.props.org.enterEditMode('list-title');\r\n  }\r\n\r\n  handleExitListTitleEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleListTitleValueUpdate(listItemId, newValue) {\r\n    this.props.org.updateListTitleValue(listItemId, newValue);\r\n  }\r\n\r\n  handleEnterListContentsEditMode() {\r\n    this.props.org.enterEditMode('list-contents');\r\n  }\r\n\r\n  handleExitListContentsEditMode() {\r\n    this.props.org.exitEditMode();\r\n  }\r\n\r\n  handleListContentsValueUpdate(listItemId, newValue) {\r\n    this.props.org.updateListContentsValue(listItemId, newValue);\r\n  }\r\n\r\n  handleAddNewListItem() {\r\n    this.props.org.addNewListItemAndEdit();\r\n  }\r\n\r\n  handleRemoveListItem() {\r\n    this.props.org.removeListItem();\r\n  }\r\n\r\n  handleTimestampClick(timestampId) {\r\n    this.props.base.activatePopup('timestamp-editor', { timestampId });\r\n  }\r\n\r\n  handleInsertTimestamp() {\r\n    // Clicking this button will unfocus the textarea, but we don't want to exit edit mode,\r\n    // so instruct the blur handler to ignore the event.\r\n    this.setState({ shouldIgnoreBlur: true });\r\n\r\n    const { descriptionValue } = this.state;\r\n    const insertionIndex = this.textarea.selectionStart;\r\n    this.setState({\r\n      descriptionValue:\r\n        descriptionValue.substring(0, insertionIndex) +\r\n        getCurrentTimestampAsText() +\r\n        descriptionValue.substring(this.textarea.selectionEnd || insertionIndex),\r\n    });\r\n    this.textarea.focus();\r\n  }\r\n\r\n  handlePlanningItemTimestampClick(headerId) {\r\n    return planningItemIndex =>\r\n      this.props.base.activatePopup('timestamp-editor', { headerId, planningItemIndex });\r\n  }\r\n\r\n  handlePropertyListEdit() {\r\n    const { header } = this.props;\r\n    this.props.base.activatePopup('property-list-editor', { headerId: header.get('id') });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      inEditMode,\r\n      selectedTableCellId,\r\n      inTableEditMode,\r\n      shouldDisableActions,\r\n      selectedListItemId,\r\n      inListTitleEditMode,\r\n      inListContentsEditMode,\r\n    } = this.props;\r\n    const { containerWidth } = this.state;\r\n\r\n    if (!header.get('opened')) {\r\n      return <div />;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className=\"header-content-container nice-scroll\"\r\n        ref={this.handleRef}\r\n        style={{ width: containerWidth }}\r\n      >\r\n        {inEditMode ? (\r\n          <div className=\"header-content__edit-container\">\r\n            <textarea\r\n              autoFocus\r\n              className=\"textarea\"\r\n              rows={Math.min(10, this.state.descriptionValue.split('\\n').length)}\r\n              ref={this.handleTextareaRef}\r\n              value={this.state.descriptionValue}\r\n              onBlur={this.handleTextareaBlur}\r\n              onChange={this.handleDescriptionChange}\r\n              onFocus={(e) => {\r\n                e.target.scrollTop = e.target.scrollHeight;\r\n              }}\r\n            />\r\n            <div\r\n              className=\"header-content__insert-timestamp-button\"\r\n              onClick={this.handleInsertTimestamp}\r\n            >\r\n              <i className=\"fas fa-plus insert-timestamp-icon\" />\r\n              Insert timestamp\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <Fragment>\r\n            <PlanningItems\r\n              planningItems={header.get('planningItems')}\r\n              onClick={this.handlePlanningItemTimestampClick(header.get('id'))}\r\n            />\r\n            <PropertyListItems\r\n              propertyListItems={header.get('propertyListItems')}\r\n              onTimestampClick={this.handleTimestampClick}\r\n              shouldDisableActions={shouldDisableActions}\r\n              onEdit={this.handlePropertyListEdit}\r\n            />\r\n            <AttributedString\r\n              parts={header.get('description')}\r\n              subPartDataAndHandlers={{\r\n                onTableCellSelect: this.handleTableCellSelect,\r\n                selectedTableCellId: selectedTableCellId,\r\n                inTableEditMode: inTableEditMode,\r\n                onExitTableEditMode: this.handleExitTableEditMode,\r\n                onTableCellValueUpdate: this.handleTableCellValueUpdate,\r\n                onEnterTableEditMode: this.handleEnterTableEditMode,\r\n                onAddNewTableRow: this.handleAddNewTableRow,\r\n                onRemoveTableRow: this.handleRemoveTableRow,\r\n                onAddNewTableColumn: this.handleAddNewTableColumn,\r\n                onRemoveTableColumn: this.handleRemoveTableColumn,\r\n                onCheckboxClick: this.handleCheckboxClick,\r\n                onListItemSelect: this.handleListItemSelect,\r\n                onEnterListTitleEditMode: this.handleEnterListTitleEditMode,\r\n                onExitListTitleEditMode: this.handleExitListTitleEditMode,\r\n                onListTitleValueUpdate: this.handleListTitleValueUpdate,\r\n                onEnterListContentsEditMode: this.handleEnterListContentsEditMode,\r\n                onExitListContentsEditMode: this.handleExitListContentsEditMode,\r\n                onListContentsValueUpdate: this.handleListContentsValueUpdate,\r\n                onAddNewListItem: this.handleAddNewListItem,\r\n                onRemoveListItem: this.handleRemoveListItem,\r\n                selectedListItemId: selectedListItemId,\r\n                inListTitleEditMode: inListTitleEditMode,\r\n                inListContentsEditMode: inListContentsEditMode,\r\n                onTimestampClick: this.handleTimestampClick,\r\n                shouldDisableActions,\r\n              }}\r\n            />\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode:\r\n      state.org.present.get('editMode') === 'description' &&\r\n      state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    isSelected: state.org.present.get('selectedHeaderId') === props.header.get('id'),\r\n    selectedTableCellId: state.org.present.get('selectedTableCellId'),\r\n    inTableEditMode: state.org.present.get('editMode') === 'table',\r\n    selectedListItemId: state.org.present.get('selectedListItemId'),\r\n    inListTitleEditMode: state.org.present.get('editMode') === 'list-title',\r\n    inListContentsEditMode: state.org.present.get('editMode') === 'list-contents',\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HeaderContent);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default class HeaderActionDrawer extends PureComponent {\r\n  // A nasty hack required to get click handling to work properly in Firefox. No idea why its\r\n  // broken in the first place or why this fixes it.\r\n  iconWithFFClickCatcher(className, onClick) {\r\n    return (\r\n      <div onClick={onClick} className=\"header-action-drawer__ff-click-catcher-container\">\r\n        <div className=\"header-action-drawer__ff-click-catcher\" />\r\n        <i className={className} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      onEnterTitleEditMode,\r\n      onEnterDescriptionEditMode,\r\n      onTagsClick,\r\n      isFocused,\r\n      onFocus,\r\n      onUnfocus,\r\n      onAddNewHeader,\r\n      onDeadlineClick,\r\n      onScheduledClick,\r\n    } = this.props;\r\n\r\n    return (\r\n      <div className=\"header-action-drawer-container\">\r\n        <div className=\"header-action-drawer__row\">\r\n          {this.iconWithFFClickCatcher('fas fa-pencil-alt fa-lg', onEnterTitleEditMode)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-edit fa-lg', onEnterDescriptionEditMode)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-tags fa-lg', onTagsClick)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {isFocused\r\n            ? this.iconWithFFClickCatcher('fas fa-expand fa-lg', onUnfocus)\r\n            : this.iconWithFFClickCatcher('fas fa-compress fa-lg', onFocus)}\r\n\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          {this.iconWithFFClickCatcher('fas fa-plus fa-lg', onAddNewHeader)}\r\n          <div\r\n            className=\"header-action-drawer__deadline-scheduled-button\"\r\n            onClick={onDeadlineClick}\r\n          >\r\n            Deadline\r\n          </div>\r\n          <span className=\"header-action-drawer__separator\" />\r\n\r\n          <div\r\n            className=\"header-action-drawer__deadline-scheduled-button\"\r\n            onClick={onScheduledClick}\r\n          >\r\n            Scheduled\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\n\r\nimport TitleLine from '../TitleLine';\r\nimport HeaderContent from '../HeaderContent';\r\nimport HeaderActionDrawer from './components/HeaderActionDrawer';\r\n\r\nimport { headerWithId } from '../../../../lib/org_utils';\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../../lib/color';\r\n\r\nclass Header extends PureComponent {\r\n  SWIPE_ACTION_ACTIVATION_DISTANCE = 80;\r\n  FREE_DRAG_ACTIVATION_DISTANCE = 10;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleRef',\r\n      'handleMouseDown',\r\n      'handleMouseMove',\r\n      'handleMouseUp',\r\n      'handleMouseOut',\r\n      'handleTouchMove',\r\n      'handleTouchStart',\r\n      'handleTouchEnd',\r\n      'handleTouchCancel',\r\n      'handleHeaderClick',\r\n      'handleEnterTitleEditMode',\r\n      'handleEnterDescriptionEditMode',\r\n      'handleShowTagsModal',\r\n      'handleFocus',\r\n      'handleUnfocus',\r\n      'handleAddNewHeader',\r\n      'handleRest',\r\n      'handleDeadlineClick',\r\n      'handleScheduledClick',\r\n    ]);\r\n\r\n    this.state = {\r\n      isDraggingFreely: false,\r\n      dragStartX: null,\r\n      dragStartY: null,\r\n      currentDragX: null,\r\n      containerWidth: null,\r\n      isPlayingRemoveAnimation: false,\r\n      heightBeforeRemove: null,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.containerDiv) {\r\n      this.setState({ containerWidth: this.containerDiv.offsetWidth });\r\n    }\r\n  }\r\n\r\n  handleRef(containerDiv) {\r\n    this.containerDiv = containerDiv;\r\n    this.props.onRef(containerDiv);\r\n  }\r\n\r\n  handleDragStart(event, dragX, dragY) {\r\n    if (this.props.shouldDisableActions) {\r\n      return;\r\n    }\r\n    if (this.props.inEditMode) {\r\n      return;\r\n    }\r\n\r\n    if (!!event.target.closest('.table-part')) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      dragStartX: dragX,\r\n      dragStartY: dragY,\r\n    });\r\n  }\r\n\r\n  handleDragMove(dragX, dragY) {\r\n    const { dragStartX, dragStartY } = this.state;\r\n    if (dragStartX === null) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.isDraggingFreely) {\r\n      if (Math.abs(dragX - dragStartX) >= this.FREE_DRAG_ACTIVATION_DISTANCE) {\r\n        this.setState({ isDraggingFreely: true });\r\n      }\r\n    }\r\n\r\n    if (Math.abs(dragY - dragStartY) >= this.SWIPE_ACTION_ACTIVATION_DISTANCE / 2) {\r\n      this.setState({ dragStartX: null });\r\n    } else {\r\n      this.setState({ currentDragX: dragX });\r\n    }\r\n  }\r\n\r\n  handleDragEnd() {\r\n    const { dragStartX, currentDragX } = this.state;\r\n\r\n    if (!!dragStartX && !!currentDragX) {\r\n      const swipeDistance = currentDragX - dragStartX;\r\n\r\n      if (swipeDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE) {\r\n        this.props.org.advanceTodoState(this.props.header.get('id'));\r\n      }\r\n\r\n      if (-1 * swipeDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE) {\r\n        this.setState({\r\n          isPlayingRemoveAnimation: true,\r\n          heightBeforeRemove: this.containerDiv.offsetHeight,\r\n        });\r\n      }\r\n    }\r\n\r\n    this.setState({\r\n      dragStartX: null,\r\n      currentDragX: null,\r\n      isDraggingFreely: false,\r\n    });\r\n  }\r\n\r\n  handleDragCancel() {\r\n    this.setState({\r\n      dragStartX: null,\r\n      currentDragX: null,\r\n      isDraggingFreely: false,\r\n    });\r\n  }\r\n\r\n  handleMouseDown(event) {\r\n    this.handleDragStart(event, event.clientX, event.clientY);\r\n  }\r\n\r\n  handleMouseMove(event) {\r\n    this.handleDragMove(event.clientX, event.clientY);\r\n  }\r\n\r\n  handleMouseUp() {\r\n    this.handleDragEnd();\r\n  }\r\n\r\n  handleMouseOut() {\r\n    this.handleDragCancel();\r\n  }\r\n\r\n  handleTouchStart(event) {\r\n    this.handleDragStart(event, event.changedTouches[0].clientX, event.changedTouches[0].clientY);\r\n  }\r\n\r\n  handleTouchMove(event) {\r\n    this.handleDragMove(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\r\n  }\r\n\r\n  handleTouchEnd() {\r\n    this.handleDragEnd();\r\n  }\r\n\r\n  handleTouchCancel() {\r\n    this.handleDragCancel();\r\n  }\r\n\r\n  handleHeaderClick(event) {\r\n    const classList = event.target.classList;\r\n    if (classList.contains('header') || classList.contains('header__bullet')) {\r\n      const { header, hasContent, isSelected } = this.props;\r\n\r\n      if (hasContent && (!header.get('opened') || isSelected)) {\r\n        this.props.org.toggleHeaderOpened(header.get('id'));\r\n      }\r\n\r\n      this.props.org.selectHeader(header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleEnterTitleEditMode() {\r\n    this.props.org.enterEditMode('title');\r\n  }\r\n\r\n  handleEnterDescriptionEditMode() {\r\n    this.props.org.openHeader(this.props.header.get('id'));\r\n    this.props.org.enterEditMode('description');\r\n  }\r\n\r\n  handleShowTagsModal() {\r\n    this.props.base.activatePopup('tags-editor');\r\n  }\r\n\r\n  handleFocus() {\r\n    this.props.org.focusHeader(this.props.header.get('id'));\r\n  }\r\n\r\n  handleUnfocus() {\r\n    this.props.org.unfocusHeader();\r\n  }\r\n\r\n  handleAddNewHeader() {\r\n    this.props.org.addHeaderAndEdit(this.props.header.get('id'));\r\n  }\r\n\r\n  handleRest() {\r\n    if (this.state.isPlayingRemoveAnimation) {\r\n      this.props.org.removeHeader(this.props.header.get('id'));\r\n    }\r\n  }\r\n\r\n  handleDeadlineAndScheduledClick(planningType) {\r\n    const { header } = this.props;\r\n\r\n    const existingDeadlinePlanningItemIndex = header\r\n      .get('planningItems', [])\r\n      .findIndex(planningItem => planningItem.get('type') === planningType);\r\n\r\n    if (existingDeadlinePlanningItemIndex === -1) {\r\n      this.props.org.addNewPlanningItem(header.get('id'), planningType);\r\n      this.props.base.activatePopup('timestamp-editor', {\r\n        headerId: header.get('id'),\r\n        planningItemIndex: header.get('planningItems').size,\r\n      });\r\n    } else {\r\n      this.props.base.activatePopup('timestamp-editor', {\r\n        headerId: header.get('id'),\r\n        planningItemIndex: existingDeadlinePlanningItemIndex,\r\n      });\r\n    }\r\n\r\n    this.props.org.openHeader(header.get('id'));\r\n  }\r\n\r\n  handleDeadlineClick() {\r\n    this.handleDeadlineAndScheduledClick('DEADLINE');\r\n  }\r\n\r\n  handleScheduledClick() {\r\n    this.handleDeadlineAndScheduledClick('SCHEDULED');\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      header,\r\n      color,\r\n      hasContent,\r\n      isSelected,\r\n      bulletStyle,\r\n      focusedHeader,\r\n      isFocused,\r\n      shouldDisableActions,\r\n    } = this.props;\r\n\r\n    const indentLevel = !!focusedHeader\r\n      ? header.get('nestingLevel') - focusedHeader.get('nestingLevel') + 1\r\n      : header.get('nestingLevel');\r\n\r\n    const {\r\n      dragStartX,\r\n      currentDragX,\r\n      isDraggingFreely,\r\n      isPlayingRemoveAnimation,\r\n      containerWidth,\r\n    } = this.state;\r\n    const marginLeft =\r\n      !!dragStartX && !!currentDragX && isDraggingFreely\r\n        ? currentDragX - dragStartX\r\n        : isPlayingRemoveAnimation\r\n          ? spring(-1 * containerWidth, { stiffness: 300 })\r\n          : spring(0, { stiffness: 300 });\r\n\r\n    const style = {\r\n      paddingLeft: 20 * indentLevel,\r\n      marginLeft,\r\n      heightFactor: isPlayingRemoveAnimation ? spring(0, { stiffness: 300 }) : 1,\r\n    };\r\n\r\n    const className = classNames('header', {\r\n      'header--selected': isSelected,\r\n      'header--removing': isPlayingRemoveAnimation,\r\n    });\r\n\r\n    return (\r\n      <Motion style={style} onRest={this.handleRest}>\r\n        {interpolatedStyle => {\r\n          const swipedDistance = interpolatedStyle.marginLeft;\r\n          const isLeftActionActivated = swipedDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE;\r\n          const isRightActionActivated =\r\n            -1 * swipedDistance >= this.SWIPE_ACTION_ACTIVATION_DISTANCE;\r\n\r\n          const disabledColor = rgbaObject(211, 211, 211, 1);\r\n          const leftActivatedColor = rgbaObject(0, 128, 0, 1);\r\n          const rightActivatedColor = rgbaObject(255, 0, 0, 1);\r\n\r\n          const leftSwipeActionContainerStyle = {\r\n            width: interpolatedStyle.marginLeft,\r\n            backgroundColorFactor: spring(isLeftActionActivated ? 1 : 0, { stiffness: 300 }),\r\n          };\r\n          const rightSwipeActionContainerStyle = {\r\n            width: -1 * interpolatedStyle.marginLeft,\r\n            backgroundColorFactor: spring(isRightActionActivated ? 1 : 0, { stiffness: 300 }),\r\n          };\r\n\r\n          const leftIconStyle = {\r\n            display: swipedDistance > 30 ? '' : 'none',\r\n          };\r\n          const rightIconStyle = {\r\n            display: -1 * swipedDistance > 30 ? '' : 'none',\r\n          };\r\n\r\n          const { heightFactor, ...headerStyle } = interpolatedStyle;\r\n\r\n          if (isPlayingRemoveAnimation) {\r\n            headerStyle.height = this.state.heightBeforeRemove * heightFactor;\r\n          }\r\n\r\n          return (\r\n            <div\r\n              className={className}\r\n              style={headerStyle}\r\n              ref={this.handleRef}\r\n              onClick={this.handleHeaderClick}\r\n              onMouseDown={this.handleMouseDown}\r\n              onMouseMove={this.handleMouseMove}\r\n              onMouseUp={this.handleMouseUp}\r\n              onMouseOut={this.handleMouseOut}\r\n              onTouchStart={this.handleTouchStart}\r\n              onTouchMove={this.handleTouchMove}\r\n              onTouchEnd={this.handleTouchEnd}\r\n              onTouchCancel={this.handleTouchCancel}\r\n            >\r\n              <Motion style={leftSwipeActionContainerStyle}>\r\n                {leftInterpolatedStyle => {\r\n                  const leftStyle = {\r\n                    width: leftInterpolatedStyle.width,\r\n                    backgroundColor: rgbaString(\r\n                      interpolateColors(\r\n                        disabledColor,\r\n                        leftActivatedColor,\r\n                        leftInterpolatedStyle.backgroundColorFactor\r\n                      )\r\n                    ),\r\n                  };\r\n\r\n                  return (\r\n                    <div className=\"left-swipe-action-container\" style={leftStyle}>\r\n                      <i\r\n                        className=\"fas fa-check swipe-action-container__icon swipe-action-container__icon--left\"\r\n                        style={leftIconStyle}\r\n                      />\r\n                    </div>\r\n                  );\r\n                }}\r\n              </Motion>\r\n              <Motion style={rightSwipeActionContainerStyle}>\r\n                {rightInterpolatedStyle => {\r\n                  const rightStyle = {\r\n                    width: rightInterpolatedStyle.width,\r\n                    backgroundColor: rgbaString(\r\n                      interpolateColors(\r\n                        disabledColor,\r\n                        rightActivatedColor,\r\n                        rightInterpolatedStyle.backgroundColorFactor\r\n                      )\r\n                    ),\r\n                  };\r\n\r\n                  return (\r\n                    <div className=\"right-swipe-action-container\" style={rightStyle}>\r\n                      <i\r\n                        className=\"fas fa-times swipe-action-container__icon swipe-action-container__icon--right\"\r\n                        style={rightIconStyle}\r\n                      />\r\n                    </div>\r\n                  );\r\n                }}\r\n              </Motion>\r\n\r\n              <div style={{ marginLeft: -16, color }} className=\"header__bullet\">\r\n                {bulletStyle === 'Fancy' ? '●' : '*'}\r\n              </div>\r\n              <TitleLine\r\n                header={header}\r\n                color={color}\r\n                hasContent={hasContent}\r\n                isSelected={isSelected}\r\n                shouldDisableActions={shouldDisableActions}\r\n              />\r\n\r\n              <Collapse\r\n                isOpened={isSelected && !shouldDisableActions}\r\n                springConfig={{ stiffness: 300 }}\r\n                style={{ marginRight: rightSwipeActionContainerStyle.width }}\r\n              >\r\n                <HeaderActionDrawer\r\n                  onEnterTitleEditMode={this.handleEnterTitleEditMode}\r\n                  onEnterDescriptionEditMode={this.handleEnterDescriptionEditMode}\r\n                  isFocused={isFocused}\r\n                  onTagsClick={this.handleShowTagsModal}\r\n                  onFocus={this.handleFocus}\r\n                  onUnfocus={this.handleUnfocus}\r\n                  onAddNewHeader={this.handleAddNewHeader}\r\n                  onDeadlineClick={this.handleDeadlineClick}\r\n                  onScheduledClick={this.handleScheduledClick}\r\n                />\r\n              </Collapse>\r\n\r\n              <HeaderContent header={header} shouldDisableActions={shouldDisableActions} />\r\n            </div>\r\n          );\r\n        }}\r\n      </Motion>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const focusedHeader = !!state.org.present.get('focusedHeaderId')\r\n    ? headerWithId(state.org.present.get('headers'), state.org.present.get('focusedHeaderId'))\r\n    : null;\r\n\r\n  return {\r\n    bulletStyle: state.base.get('bulletStyle'),\r\n    focusedHeader,\r\n    isFocused: !!focusedHeader && focusedHeader.get('id') === props.header.get('id'),\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  org: bindActionCreators(orgActions, dispatch),\r\n  base: bindActionCreators(baseActions, dispatch),\r\n});\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Header);\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Header from '../Header';\r\n\r\nimport { numSubheadersOfHeaderWithId } from '../../../../lib/org_utils';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nclass HeaderList extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.headerRefs = {};\r\n\r\n    _.bindAll(this, ['handleHeaderRef']);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.selectedHeaderId !== this.props.selectedHeaderId) {\r\n      const selectedHeaderDiv = this.headerRefs[this.props.selectedHeaderId];\r\n      if (!!selectedHeaderDiv) {\r\n        const boundingRectangle = selectedHeaderDiv.getBoundingClientRect();\r\n        const viewportHeight = document.documentElement.clientHeight;\r\n\r\n        if (boundingRectangle.top > viewportHeight * 0.9 || boundingRectangle.bottom < 0) {\r\n          selectedHeaderDiv.scrollIntoView();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  handleHeaderRef(headerId) {\r\n    return div => (this.headerRefs[headerId] = div);\r\n  }\r\n\r\n  render() {\r\n    const { headers, selectedHeaderId, focusedHeaderId, shouldDisableActions } = this.props;\r\n\r\n    const headerRenderData = headers\r\n      .map(header => {\r\n        return {\r\n          header,\r\n          displayed: false,\r\n          hasContent:\r\n            !!header.get('rawDescription') ||\r\n            header.get('planningItems').size !== 0 ||\r\n            header.get('propertyListItems').size !== 0,\r\n        };\r\n      })\r\n      .toArray();\r\n\r\n    headerRenderData.forEach((headerRenderDatum, index) => {\r\n      const nestingLevel = headerRenderDatum.header.get('nestingLevel');\r\n\r\n      const hasNoParents = headerRenderData\r\n        .slice(0, index)\r\n        .every(\r\n          previousRenderDatum => previousRenderDatum.header.get('nestingLevel') >= nestingLevel\r\n        );\r\n      if (hasNoParents) {\r\n        headerRenderDatum.displayed = true;\r\n      }\r\n\r\n      const followingHeaders = headerRenderData.slice(index + 1);\r\n      for (\r\n        let followingHeaderIndex = 0;\r\n        followingHeaderIndex < followingHeaders.length;\r\n        ++followingHeaderIndex\r\n      ) {\r\n        const followingHeader = followingHeaders[followingHeaderIndex];\r\n        if (followingHeader.header.get('nestingLevel') <= nestingLevel) {\r\n          break;\r\n        }\r\n\r\n        headerRenderDatum.hasContent = true;\r\n\r\n        followingHeader.displayed =\r\n          headerRenderDatum.header.get('opened') && headerRenderDatum.displayed;\r\n      }\r\n    });\r\n\r\n    if (!!focusedHeaderId) {\r\n      const focusedHeaderIndex = headerRenderData.findIndex(\r\n        headerRenderDatum => headerRenderDatum.header.get('id') === focusedHeaderId\r\n      );\r\n\r\n      const previousHeaders = headerRenderData.slice(0, focusedHeaderIndex);\r\n      previousHeaders.forEach(headerRenderDatum => (headerRenderDatum.displayed = false));\r\n\r\n      const numSubheaders = numSubheadersOfHeaderWithId(headers, focusedHeaderId);\r\n      const followingHeaders = headerRenderData.slice(focusedHeaderIndex + numSubheaders + 1);\r\n      followingHeaders.forEach(headerRenderDatum => (headerRenderDatum.displayed = false));\r\n    }\r\n\r\n    const headerColors = [\r\n      'rgba(38, 143, 214, 1)',\r\n      'rgba(42, 164, 168, 1)',\r\n      'rgba(181, 142, 78, 1)',\r\n      'rgba(220, 64, 95, 1)',\r\n      'rgba(101, 128, 152, 1)',\r\n      'rgba(146, 164, 175, 1)',\r\n      'rgba(203, 85, 83, 1)',\r\n      'rgba(108, 119, 202, 1)',\r\n    ];\r\n\r\n    const displayedHeaderRenderData = headerRenderData.filter(\r\n      headerRenderDatum => headerRenderDatum.displayed\r\n    );\r\n\r\n    const className = classNames('header-list-container', {\r\n      'header-list-container--focused': !!focusedHeaderId,\r\n    });\r\n    return (\r\n      <div className={className}>\r\n        {displayedHeaderRenderData.map((headerRenderDatum, index) => {\r\n          const header = headerRenderDatum.header;\r\n          const color = headerColors[(header.get('nestingLevel') - 1) % headerColors.length];\r\n\r\n          return (\r\n            <Header\r\n              key={header.get('id')}\r\n              header={header}\r\n              color={color}\r\n              hasContent={headerRenderDatum.hasContent}\r\n              isSelected={header.get('id') === selectedHeaderId}\r\n              onRef={this.handleHeaderRef(header.get('id'))}\r\n              shouldDisableActions={shouldDisableActions}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    headers: state.org.present.get('headers'),\r\n    selectedHeaderId: state.org.present.get('selectedHeaderId'),\r\n    focusedHeaderId: state.org.present.get('focusedHeaderId'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {};\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(HeaderList);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\n\r\nexport default class ActionButton extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleClick']);\r\n  }\r\n\r\n  handleClick() {\r\n    const { onClick, isDisabled } = this.props;\r\n\r\n    if (isDisabled) {\r\n      return;\r\n    }\r\n\r\n    onClick();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      iconName,\r\n      subIconName,\r\n      isDisabled,\r\n      shouldRotateSubIcon,\r\n      letter,\r\n      additionalClassName,\r\n      style,\r\n      tooltip,\r\n      shouldSpinSubIcon,\r\n      onRef,\r\n    } = this.props;\r\n\r\n    const className = classNames(\r\n      'btn',\r\n      'btn--circle',\r\n      'action-drawer__btn',\r\n      additionalClassName || '',\r\n      {\r\n        fas: !letter,\r\n        'fa-lg': !letter,\r\n        [`fa-${iconName}`]: !letter,\r\n        'action-drawer__btn--with-sub-icon': !!subIconName,\r\n        'btn--disabled': isDisabled,\r\n        'action-drawer__btn--letter': !!letter,\r\n      }\r\n    );\r\n\r\n    const subIconClassName = classNames(\r\n      'fas',\r\n      'fa-xs',\r\n      `fa-${subIconName}`,\r\n      'action-drawer__btn__sub-icon',\r\n      {\r\n        'action-drawer__btn__sub-icon--rotated': shouldRotateSubIcon,\r\n        'fa-spin': shouldSpinSubIcon,\r\n      }\r\n    );\r\n\r\n    return (\r\n      <button\r\n        className={className}\r\n        onClick={this.handleClick}\r\n        style={style}\r\n        title={tooltip}\r\n        ref={onRef}\r\n      >\r\n        {!!letter && letter}\r\n        {!!subIconName && <i className={subIconClassName} />}\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import React, { Fragment, useState, useEffect, useMemo, useRef } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { List } from 'immutable';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\nimport * as captureActions from '../../../../actions/capture';\r\nimport * as baseActions from '../../../../actions/base';\r\n\r\nimport sampleCaptureTemplates from '../../../../lib/sample_capture_templates';\r\n\r\nimport ActionButton from './components/ActionButton/';\r\n\r\nconst ActionDrawer = ({\r\n  org,\r\n  selectedHeaderId,\r\n  base,\r\n  staticFile,\r\n  captureTemplates,\r\n  path,\r\n  selectedTableCellId,\r\n  selectedListItemId,\r\n  inEditMode,\r\n  isLoading,\r\n  shouldDisableSyncButtons,\r\n}) => {\r\n  const [isDisplayingArrowButtons, setIsDisplayingArrowButtons] = useState(false);\r\n  const [isDisplayingCaptureButtons, setIsDisplayingCaptureButtons] = useState(false);\r\n\r\n  // Send a no-op action to take care of the bug where redux-undo won't allow the first\r\n  // action to be undone.\r\n  useEffect(() => {\r\n    org.noOp();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    document.querySelector('html').style.paddingBottom = '90px';\r\n\r\n    return () => (document.querySelector('html').style.paddingBottom = '0px');\r\n  });\r\n\r\n  const mainArrowButton = useRef(null);\r\n\r\n  const mainArrowButtonBoundingRect = useMemo(\r\n    () => (!!mainArrowButton.current ? mainArrowButton.current.getBoundingClientRect() : null),\r\n    [mainArrowButton.current]\r\n  );\r\n\r\n  const handleUpClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderUp(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableRowUp()\r\n      : org.moveListItemUp();\r\n\r\n  const handleDownClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderDown(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableRowDown()\r\n      : org.moveListItemDown();\r\n\r\n  const handleLeftClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderLeft(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableColumnLeft()\r\n      : org.moveListItemLeft();\r\n\r\n  const handleRightClick = () =>\r\n    !!selectedHeaderId\r\n      ? org.moveHeaderRight(selectedHeaderId)\r\n      : !!selectedTableCellId\r\n      ? org.moveTableColumnRight()\r\n      : org.moveListItemRight();\r\n\r\n  const handleMoveSubtreeLeftClick = () =>\r\n    !!selectedHeaderId ? org.moveSubtreeLeft(selectedHeaderId) : org.moveListSubtreeLeft();\r\n\r\n  const handleMoveSubtreeRightClick = () =>\r\n    !!selectedHeaderId ? org.moveSubtreeRight(selectedHeaderId) : org.moveListSubtreeRight();\r\n\r\n  const handleDoneClick = () => org.exitEditMode();\r\n\r\n  const handleCaptureButtonClick = templateId => () => {\r\n    setIsDisplayingCaptureButtons(false);\r\n    base.activatePopup('capture', { templateId });\r\n  };\r\n\r\n  const getSampleCaptureTemplates = () => sampleCaptureTemplates;\r\n\r\n  const getAvailableCaptureTemplates = () =>\r\n    staticFile === 'sample'\r\n      ? getSampleCaptureTemplates()\r\n      : captureTemplates.filter(\r\n          template =>\r\n            template.get('isAvailableInAllOrgFiles') ||\r\n            template\r\n              .get('orgFilesWhereAvailable')\r\n              .map(availablePath =>\r\n                availablePath.trim().startsWith('/')\r\n                  ? availablePath.trim()\r\n                  : '/' + availablePath.trim()\r\n              )\r\n              .includes((path || '').trim())\r\n        );\r\n\r\n  const handleSync = () => org.sync();\r\n\r\n  const handleMainArrowButtonClick = () => setIsDisplayingArrowButtons(!isDisplayingArrowButtons);\r\n\r\n  const handleMainCaptureButtonClick = () => {\r\n    if (!isDisplayingCaptureButtons && getAvailableCaptureTemplates().size === 0) {\r\n      alert(\r\n        `You don't have any capture templates set up for this file! Add some in Settings > Capture Templates`\r\n      );\r\n      return;\r\n    }\r\n\r\n    setIsDisplayingCaptureButtons(!isDisplayingCaptureButtons);\r\n  };\r\n\r\n  const renderCaptureButtons = () => {\r\n    const availableCaptureTemplates = getAvailableCaptureTemplates();\r\n\r\n    const baseCaptureButtonStyle = {\r\n      position: 'absolute',\r\n      zIndex: 0,\r\n      left: 0,\r\n      opacity: isDisplayingArrowButtons ? 0 : 1,\r\n    };\r\n    if (!isDisplayingCaptureButtons) {\r\n      baseCaptureButtonStyle.boxShadow = 'none';\r\n    }\r\n\r\n    const mainButtonStyle = {\r\n      opacity: isDisplayingArrowButtons ? 0 : 1,\r\n      position: 'relative',\r\n      zIndex: 1,\r\n    };\r\n\r\n    const animatedStyle = {\r\n      bottom: spring(isDisplayingCaptureButtons ? 70 : 0, { stiffness: 300 }),\r\n    };\r\n\r\n    return (\r\n      <Motion style={animatedStyle}>\r\n        {style => (\r\n          <div className=\"action-drawer__capture-buttons-container\">\r\n            <ActionButton\r\n              iconName={isDisplayingCaptureButtons ? 'times' : 'list-ul'}\r\n              isDisabled={false}\r\n              onClick={handleMainCaptureButtonClick}\r\n              style={mainButtonStyle}\r\n              tooltip={\r\n                isDisplayingCaptureButtons ? 'Hide capture templates' : 'Show capture templates'\r\n              }\r\n            />\r\n\r\n            {availableCaptureTemplates.map((template, index) => (\r\n              <ActionButton\r\n                key={template.get('id')}\r\n                letter={template.get('letter')}\r\n                iconName={template.get('iconName')}\r\n                isDisabled={false}\r\n                onClick={handleCaptureButtonClick(template.get('id'))}\r\n                style={{ ...baseCaptureButtonStyle, bottom: style.bottom * (index + 1) }}\r\n                tooltip={`Activate \"${template.get('description')}\" capture template`}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Motion>\r\n    );\r\n  };\r\n\r\n  const renderMovementButtons = () => {\r\n    const baseArrowButtonStyle = {\r\n      opacity: isDisplayingCaptureButtons ? 0 : 1,\r\n    };\r\n    if (!isDisplayingArrowButtons) {\r\n      baseArrowButtonStyle.boxShadow = 'none';\r\n    }\r\n\r\n    let centerXOffset = 0;\r\n    if (!!mainArrowButtonBoundingRect) {\r\n      centerXOffset =\r\n        window.screen.width / 2 -\r\n        (mainArrowButtonBoundingRect.x + mainArrowButtonBoundingRect.width / 2);\r\n    }\r\n\r\n    const animatedStyles = {\r\n      centerXOffset: spring(isDisplayingArrowButtons ? centerXOffset : 0, { stiffness: 300 }),\r\n      topRowYOffset: spring(isDisplayingArrowButtons ? 150 : 0, { stiffness: 300 }),\r\n      bottomRowYOffset: spring(isDisplayingArrowButtons ? 80 : 0, { stiffness: 300 }),\r\n      firstColumnXOffset: spring(isDisplayingArrowButtons ? 70 : 0, {\r\n        stiffness: 300,\r\n      }),\r\n      secondColumnXOffset: spring(isDisplayingArrowButtons ? 140 : 0, {\r\n        stiffness: 300,\r\n      }),\r\n    };\r\n\r\n    let subIconNameStr = null;\r\n    let tooltipUpStr = 'Move header up';\r\n    let tooltipDownStr = 'Move header down';\r\n    let tooltipLeftStr = 'Move header left';\r\n    let tooltipRightStr = 'Move header right';\r\n    if (!!selectedTableCellId) {\r\n      subIconNameStr = 'table';\r\n      tooltipUpStr = 'Move row up';\r\n      tooltipDownStr = 'Move row down';\r\n      tooltipLeftStr = 'Move column left';\r\n      tooltipRightStr = 'Move column right';\r\n    } else if (!!selectedListItemId) {\r\n      subIconNameStr = 'list';\r\n      tooltipUpStr = 'Move list up';\r\n      tooltipDownStr = 'Move list down';\r\n      tooltipLeftStr = 'Move list left';\r\n      tooltipRightStr = 'Move list right';\r\n    }\r\n\r\n    return (\r\n      <Motion style={animatedStyles}>\r\n        {style => (\r\n          <div\r\n            className=\"action-drawer__arrow-buttons-container\"\r\n            style={{ left: style.centerXOffset }}\r\n          >\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-up\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleUpClick}\r\n              style={{ ...baseArrowButtonStyle, bottom: style.topRowYOffset }}\r\n              tooltip={tooltipUpStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-down\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleDownClick}\r\n              style={{ ...baseArrowButtonStyle, bottom: style.bottomRowYOffset }}\r\n              tooltip={tooltipDownStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-left\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleLeftClick}\r\n              style={{\r\n                ...baseArrowButtonStyle,\r\n                bottom: style.bottomRowYOffset,\r\n                right: style.firstColumnXOffset,\r\n              }}\r\n              tooltip={tooltipLeftStr}\r\n            />\r\n            <ActionButton\r\n              additionalClassName=\"action-drawer__arrow-button\"\r\n              iconName=\"arrow-right\"\r\n              subIconName={subIconNameStr}\r\n              isDisabled={false}\r\n              onClick={handleRightClick}\r\n              style={{\r\n                ...baseArrowButtonStyle,\r\n                bottom: style.bottomRowYOffset,\r\n                left: style.firstColumnXOffset,\r\n              }}\r\n              tooltip={tooltipRightStr}\r\n            />\r\n            {!selectedTableCellId && (\r\n              <Fragment>\r\n                <ActionButton\r\n                  additionalClassName=\"action-drawer__arrow-button\"\r\n                  iconName=\"chevron-left\"\r\n                  subIconName={subIconNameStr}\r\n                  isDisabled={false}\r\n                  onClick={handleMoveSubtreeLeftClick}\r\n                  style={{\r\n                    ...baseArrowButtonStyle,\r\n                    bottom: style.bottomRowYOffset,\r\n                    right: style.secondColumnXOffset,\r\n                  }}\r\n                  tooltip=\"Move entire subtree left\"\r\n                />\r\n                <ActionButton\r\n                  additionalClassName=\"action-drawer__arrow-button\"\r\n                  iconName=\"chevron-right\"\r\n                  subIconName={subIconNameStr}\r\n                  isDisabled={false}\r\n                  onClick={handleMoveSubtreeRightClick}\r\n                  style={{\r\n                    ...baseArrowButtonStyle,\r\n                    bottom: style.bottomRowYOffset,\r\n                    left: style.secondColumnXOffset,\r\n                  }}\r\n                  tooltip=\"Move entire subtree right\"\r\n                />\r\n              </Fragment>\r\n            )}\r\n\r\n            <ActionButton\r\n              iconName={isDisplayingArrowButtons ? 'times' : 'arrows-alt'}\r\n              subIconName={subIconNameStr}\r\n              additionalClassName=\"action-drawer__main-arrow-button\"\r\n              isDisabled={false}\r\n              onClick={handleMainArrowButtonClick}\r\n              style={{ opacity: isDisplayingCaptureButtons ? 0 : 1 }}\r\n              tooltip={isDisplayingArrowButtons ? 'Hide movement buttons' : 'Show movement buttons'}\r\n              onRef={mainArrowButton}\r\n            />\r\n          </div>\r\n        )}\r\n      </Motion>\r\n    );\r\n  };\r\n\r\n  const handleAgendaClick = () => base.activatePopup('agenda');\r\n\r\n  return (\r\n    <div className=\"action-drawer-container nice-scroll\">\r\n      {inEditMode ? (\r\n        <button className=\"btn action-drawer__done-btn\" onClick={handleDoneClick}>\r\n          Done\r\n        </button>\r\n      ) : (\r\n        <Fragment>\r\n          <ActionButton\r\n            iconName=\"cloud\"\r\n            subIconName=\"sync-alt\"\r\n            shouldSpinSubIcon={isLoading}\r\n            isDisabled={shouldDisableSyncButtons}\r\n            onClick={handleSync}\r\n            style={{ opacity: isDisplayingArrowButtons || isDisplayingCaptureButtons ? 0 : 1 }}\r\n            tooltip=\"Sync changes\"\r\n          />\r\n\r\n          {renderMovementButtons()}\r\n\r\n          <ActionButton\r\n            iconName=\"calendar-alt\"\r\n            shouldSpinSubIcon={isLoading}\r\n            isDisabled={false}\r\n            onClick={handleAgendaClick}\r\n            style={{ opacity: isDisplayingArrowButtons || isDisplayingCaptureButtons ? 0 : 1 }}\r\n            tooltip=\"Show agenda\"\r\n          />\r\n\r\n          {renderCaptureButtons()}\r\n        </Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n    selectedHeaderId: state.org.present.get('selectedHeaderId'),\r\n    isDirty: state.org.present.get('isDirty'),\r\n    isFocusedHeaderActive: !!state.org.present.get('focusedHeaderId'),\r\n    selectedTableCellId: state.org.present.get('selectedTableCellId'),\r\n    selectedListItemId: state.org.present.get('selectedListItemId'),\r\n    captureTemplates: state.capture.get('captureTemplates', new List()),\r\n    path: state.org.present.get('path'),\r\n    isLoading: state.base.get('isLoading'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(ActionDrawer);\r\n","import React from 'react';\r\nimport { Motion, spring } from 'react-motion';\r\n\r\nimport { interpolateColors, rgbaObject, rgbaString } from '../../../lib/color';\r\n\r\nimport './stylesheet.css';\r\n\r\nexport default ({ isEnabled, onToggle }) => {\r\n  const disabledColor = rgbaObject(255, 255, 255, 1);\r\n  const enabledColor = rgbaObject(94, 52, 140, 1);\r\n\r\n  const switchStyle = {\r\n    colorFactor: spring(isEnabled ? 1 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  const grabberStyle = {\r\n    marginLeft: spring(isEnabled ? 42 : 0, { stiffness: 300 }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={switchStyle}>\r\n      {style => {\r\n        const backgroundColor = rgbaString(\r\n          interpolateColors(disabledColor, enabledColor, style.colorFactor)\r\n        );\r\n\r\n        return (\r\n          <div className=\"switch\" style={{ backgroundColor }} onClick={onToggle}>\r\n            <Motion style={grabberStyle}>\r\n              {style => <div className=\"switch__grabber\" style={style} />}\r\n            </Motion>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { Motion, spring } from 'react-motion';\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ children, shouldIncludeCloseButton, onClose }) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [dragOffsetY, setDragOffsetY] = useState(null);\r\n\r\n  useLayoutEffect(() => {\r\n    setIsVisible(true);\r\n  }, []);\r\n\r\n  const initialClientY = useRef();\r\n  const innerContainer = useRef();\r\n\r\n  const innerContainerHeight = useRef();\r\n  useLayoutEffect(() => {\r\n    innerContainerHeight.current = innerContainer.current.offsetHeight;\r\n  });\r\n  const endInnerContainerDrag = () => {\r\n    setIsVisible(dragOffsetY <= innerContainerHeight.current * 0.3);\r\n    setDragOffsetY(null);\r\n  };\r\n\r\n  const handleInnerContainerClick = event => event.stopPropagation();\r\n\r\n  const handleClose = () => setIsVisible(false);\r\n\r\n  const handleAnimationRest = () => (!isVisible && !!onClose ? onClose() : void 0);\r\n\r\n  const handleTouchStart = event => (initialClientY.current = event.targetTouches[0].clientY);\r\n\r\n  const handleTouchMove = event => {\r\n    if (event.target.classList.contains('drag-handle')) {\r\n      return;\r\n    }\r\n\r\n    const isScrollingDown = initialClientY.current > event.targetTouches[0].clientY;\r\n\r\n    if (\r\n      isScrollingDown &&\r\n      innerContainer.current.scrollHeight - innerContainer.current.scrollTop <=\r\n        innerContainer.current.clientHeight\r\n    ) {\r\n      event.preventDefault();\r\n    } else if (!isScrollingDown && innerContainer.current.scrollTop === 0) {\r\n      event.preventDefault();\r\n\r\n      setDragOffsetY(event.targetTouches[0].clientY - initialClientY.current);\r\n    }\r\n  };\r\n\r\n  const handleTouchEndOrCancel = event => endInnerContainerDrag();\r\n\r\n  useEffect(\r\n    () => {\r\n      if (!!innerContainer.current) {\r\n        // Super annoying logic for disabling scrolling of the body when a slide up is active.\r\n        // Briefly: if we're already at the top of our Drawer and trying to scroll up, disable\r\n        // scrolling. Likewise, if we're already at the bottom of our Drawer and trying to scroll\r\n        // down, disable scrolling.\r\n        innerContainer.current.addEventListener('touchstart', handleTouchStart);\r\n        innerContainer.current.addEventListener('touchmove', handleTouchMove);\r\n        innerContainer.current.addEventListener('touchend', handleTouchEndOrCancel);\r\n        innerContainer.current.addEventListener('touchcancel', handleTouchEndOrCancel);\r\n\r\n        return () => {\r\n          innerContainer.current.removeEventListener('touchstart', handleTouchStart);\r\n          innerContainer.current.removeEventListener('touchmove', handleTouchMove);\r\n          innerContainer.current.removeEventListener('touchend', handleTouchEndOrCancel);\r\n          innerContainer.current.removeEventListener('touchcancel', handleTouchEndOrCancel);\r\n        };\r\n      } else {\r\n        return null;\r\n      }\r\n    },\r\n    [innerContainer.current, dragOffsetY]\r\n  );\r\n\r\n  useEffect(\r\n    () => {\r\n      // A ridiculous hack to get around what is presumably a Mobile Safari bug in iOS 12.\r\n      // Without this, I can't scroll the inner container in the agenda view.\r\n      setTimeout(() => {\r\n        innerContainer.current.style.left = '0';\r\n        setTimeout(() => {\r\n          innerContainer.current.style.left = '-1px';\r\n        }, 0);\r\n      }, 0);\r\n    },\r\n    [children]\r\n  );\r\n\r\n  const outerClassName = classNames('drawer-outer-container', {\r\n    'drawer-outer-container--visible': isVisible,\r\n  });\r\n\r\n  const innerStyle = {\r\n    offsetY:\r\n      dragOffsetY ||\r\n      spring(isVisible ? 0 : innerContainerHeight.current || window.innerHeight, {\r\n        stiffness: 300,\r\n      }),\r\n  };\r\n\r\n  return (\r\n    <Motion style={innerStyle} onRest={handleAnimationRest}>\r\n      {style => {\r\n        const interpolatedStyle = {\r\n          transform: `translateY(${style.offsetY}px)`,\r\n        };\r\n\r\n        return (\r\n          <div className={outerClassName} onClick={!!onClose ? handleClose : null}>\r\n            <div\r\n              onClick={handleInnerContainerClick}\r\n              className=\"drawer-inner-container nice-scroll\"\r\n              ref={innerContainer}\r\n              style={interpolatedStyle}\r\n            >\r\n              <div className=\"drawer__grabber\" />\r\n\r\n              {shouldIncludeCloseButton && (\r\n                <button className=\"fas fa-times fa-lg drawer__close-button\" onClick={handleClose} />\r\n              )}\r\n\r\n              {children}\r\n            </div>\r\n          </div>\r\n        );\r\n      }}\r\n    </Motion>\r\n  );\r\n};\r\n","import React, { Fragment, useState, useEffect, useRef, useMemo } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport ActionButton from '../ActionDrawer/components/ActionButton/';\r\nimport Switch from '../../../UI/Switch/';\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport { headerWithPath } from '../../../../lib/org_utils';\r\nimport substituteTemplateVariables from '../../../../lib/capture_template_substitution';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ template, onCapture, headers, onClose }) => {\r\n  const [substitutedTemplate, initialCursorIndex] = useMemo(\r\n    () => substituteTemplateVariables(template.get('template')),\r\n    [template.get('template')]\r\n  );\r\n\r\n  const isTopLevelTarget = template.get('headerPaths').filter(path => path.length !== 0).size === 0;\r\n  const targetHeader = useMemo(() => headerWithPath(headers, template.get('headerPaths')), [\r\n    headers,\r\n    template.get('headerPaths'),\r\n  ]);\r\n\r\n  const [textareaValue, setTextareaValue] = useState(substitutedTemplate);\r\n  const [shouldPrepend, setShouldPrepend] = useState(template.get('shouldPrepend'));\r\n\r\n  const textarea = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (textarea.current) {\r\n      textarea.current.focus();\r\n      if (initialCursorIndex !== null) {\r\n        textarea.current.selectionStart = initialCursorIndex;\r\n        textarea.current.selectionEnd = initialCursorIndex;\r\n      }\r\n    }\r\n  }, [textarea]);\r\n\r\n  const handleCaptureClick = () => onCapture(template.get('id'), textareaValue, shouldPrepend);\r\n\r\n  const handleTextareaChange = event => setTextareaValue(event.target.value);\r\n\r\n  const handlePrependSwitchToggle = () => setShouldPrepend(!shouldPrepend);\r\n\r\n  return (\r\n    <Drawer onClose={onClose}>\r\n      <div className=\"capture-modal-header\">\r\n        <ActionButton\r\n          letter={template.get('letter')}\r\n          iconName={template.get('iconName')}\r\n          isDisabled={false}\r\n          onClick={() => {}}\r\n          style={{ marginRight: 20 }}\r\n        />\r\n\r\n        <span>{template.get('description')}</span>\r\n      </div>\r\n\r\n      <div\r\n        className={classNames('capture-modal-header-path', {\r\n          'capture-modal-header-path--top-level': isTopLevelTarget,\r\n        })}\r\n      >\r\n        {isTopLevelTarget ? 'Top level header' : template.get('headerPaths').join(' > ')}\r\n      </div>\r\n\r\n      {!!targetHeader || isTopLevelTarget ? (\r\n        <Fragment>\r\n          <textarea\r\n            className=\"textarea capture-modal-textarea\"\r\n            rows=\"4\"\r\n            value={textareaValue}\r\n            onChange={handleTextareaChange}\r\n            ref={textarea}\r\n          />\r\n\r\n          <div className=\"capture-modal-button-container\">\r\n            <div className=\"capture-modal-prepend-container\">\r\n              <span className=\"capture-modal-prepend-label\">Prepend:</span>\r\n              <Switch isEnabled={shouldPrepend} onToggle={handlePrependSwitchToggle} />\r\n            </div>\r\n\r\n            <button className=\"btn capture-modal-button\" onClick={handleCaptureClick}>\r\n              Capture\r\n            </button>\r\n          </div>\r\n        </Fragment>\r\n      ) : (\r\n        <div className=\"capture-modal-error-message\">\r\n          The specified header path doesn't exist in this org file!\r\n        </div>\r\n      )}\r\n\r\n      <br />\r\n    </Drawer>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport formatDate from 'date-fns/format';\r\nimport { distanceInWordsToNow } from 'date-fns';\r\n\r\nexport default ({ lastServerModifiedAt, onPull, onPush, onCancel }) => {\r\n  return (\r\n    <Drawer>\r\n      <h2 className=\"sync-confirmation-modal__header\">Sync conflict</h2>\r\n      Since you last pulled, a newer version of the file has been pushed to the server. The newer\r\n      version is from:\r\n      <br />\r\n      <br />\r\n      <div className=\"sync-confirmation-modal__last-sync-time\">\r\n        {formatDate(lastServerModifiedAt, 'MMMM Do, YYYY [at] h:mm:ss a')}\r\n        <br />({distanceInWordsToNow(lastServerModifiedAt)} ago)\r\n      </div>\r\n      <div className=\"sync-confirmation-modal__buttons-container\">\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onPull}>\r\n          Pull latest version from server\r\n        </button>\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onPush}>\r\n          Overwrite server version\r\n        </button>\r\n        <button className=\"btn sync-confirmation-modal__button\" onClick={onCancel}>\r\n          Cancel sync\r\n        </button>\r\n      </div>\r\n      <br />\r\n    </Drawer>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nexport default class TagsEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleRemoveTag', 'handleAddNewTag', 'handleTagChange']);\r\n\r\n    this.state = {\r\n      allTags: props.allTags,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const prevTags = prevProps.header.getIn(['titleLine', 'tags']);\r\n    const currentTags = this.props.header.getIn(['titleLine', 'tags']);\r\n    if (prevTags.size === currentTags.size - 1 && currentTags.last() === '') {\r\n      if (this.lastTextfield) {\r\n        this.lastTextfield.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  handleTagChange(tagIndex) {\r\n    return event => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      this.props.onChange(tags.set(tagIndex, event.target.value.replace(/(\\s+|:)/g, '')));\r\n    };\r\n  }\r\n\r\n  handleRemoveTag(tagIndex) {\r\n    return () => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      this.props.onChange(tags.delete(tagIndex));\r\n    };\r\n  }\r\n\r\n  handleAddNewTag() {\r\n    const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n    this.props.onChange(tags.push(''));\r\n  }\r\n\r\n  handleExistingTagClick(newTag) {\r\n    return () => {\r\n      const tags = this.props.header.getIn(['titleLine', 'tags']);\r\n      if (tags.includes(newTag)) {\r\n        this.props.onChange(tags.filter(tag => tag !== newTag));\r\n      } else {\r\n        this.props.onChange(tags.push(newTag));\r\n      }\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const { header, onClose } = this.props;\r\n    const { allTags } = this.state;\r\n\r\n    const headerTags = header.getIn(['titleLine', 'tags']);\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"drawer-modal__title\">Edit tags</h2>\r\n\r\n        {headerTags.size === 0 ? (\r\n          <div className=\"no-tags-message\">\r\n            This header doesn't have any tags.\r\n            <br />\r\n            <br />\r\n            Click the <i className=\"fas fa-plus\" /> button to add a new one, or choose from the list\r\n            of all of your tags below.\r\n          </div>\r\n        ) : (\r\n          <Droppable droppableId=\"tags-editor-droppable\" type=\"TAG\">\r\n            {(provided, snapshot) => (\r\n              <div className=\"tags-container\" ref={provided.innerRef} {...provided.droppableProps}>\r\n                <Fragment>\r\n                  {headerTags.map((tag, index) => (\r\n                    <Draggable draggableId={`tag--${index}`} index={index} key={index}>\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          className={classNames('tag-container', {\r\n                            'tag-container--dragging': snapshot.isDragging,\r\n                          })}\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                        >\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"textfield tag-container__textfield\"\r\n                            value={tag}\r\n                            onChange={this.handleTagChange(index)}\r\n                            ref={textfield => (this.lastTextfield = textfield)}\r\n                          />\r\n                          <div className=\"tag-container__actions-container\">\r\n                            <i\r\n                              className=\"fas fa-times fa-lg\"\r\n                              onClick={this.handleRemoveTag(index)}\r\n                            />\r\n                            <i\r\n                              className=\"fas fa-bars fa-lg tag-container__drag-handle drag-handle\"\r\n                              {...provided.dragHandleProps}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  ))}\r\n\r\n                  {provided.placeholder}\r\n                </Fragment>\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        )}\r\n\r\n        <div className=\"tags-editor__add-new-container\">\r\n          <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={this.handleAddNewTag} />\r\n        </div>\r\n\r\n        <hr className=\"tags-editor__separator\" />\r\n\r\n        <h2 className=\"tags-editor__title\">All tags</h2>\r\n\r\n        <div className=\"all-tags-container\">\r\n          {allTags.filter(tag => !!tag).map(tag => {\r\n            const className = classNames('all-tags__tag', {\r\n              'all-tags__tag--in-use': headerTags.includes(tag),\r\n            });\r\n\r\n            return (\r\n              <div className={className} key={tag} onClick={this.handleExistingTagClick(tag)}>\r\n                {tag}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({ buttons, selectedButton, useEqualWidthTabs, onSelect }) => {\r\n  const handleButtonClick = buttonName => () => onSelect(buttonName);\r\n\r\n  const containerClassName = classNames('tab-buttons', {\r\n    'tab-buttons--equal-width-tabs': useEqualWidthTabs,\r\n  });\r\n\r\n  const style = {\r\n    gridTemplateColumns: useEqualWidthTabs ? `repeat(${buttons.length}, 1fr)` : null,\r\n  };\r\n\r\n  return (\r\n    <div className={containerClassName} style={style}>\r\n      {buttons.map(buttonName => {\r\n        const className = classNames('tab-buttons__btn', {\r\n          'tab-buttons__btn--selected': buttonName === selectedButton,\r\n        });\r\n\r\n        return (\r\n          <div key={buttonName} className={className} onClick={handleButtonClick(buttonName)}>\r\n            {buttonName}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Switch from '../../../../../UI/Switch/';\r\nimport TabButtons from '../../../../../UI/TabButtons/';\r\n\r\nimport { renderAsText } from '../../../../../../lib/timestamps';\r\n\r\nimport _ from 'lodash';\r\nimport parseDate from 'date-fns/parse';\r\nimport formatDate from 'date-fns/format';\r\n\r\nexport default class TimestampEditor extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleActiveToggle',\r\n      'handleDateChange',\r\n      'handleAddRepeater',\r\n      'handleRemoveRepeater',\r\n      'handleRepeaterTypeChange',\r\n      'handleRepeaterValueChange',\r\n      'handleRepeaterUnitChange',\r\n      'handleAddDelay',\r\n      'handleRemoveDelay',\r\n      'handleDelayTypeChange',\r\n      'handleDelayValueChange',\r\n      'handleDelayUnitChange',\r\n    ]);\r\n  }\r\n\r\n  handleActiveToggle() {\r\n    this.props.onChange(this.props.timestamp.update('isActive', isActive => !isActive));\r\n  }\r\n\r\n  handleDateChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n\r\n    const [newYear, newMonth, newDay, newDayName] = formatDate(\r\n      parseDate(event.target.value),\r\n      'YYYY MM DD ddd'\r\n    ).split(' ');\r\n    onChange(\r\n      timestamp\r\n        .set('year', newYear)\r\n        .set('month', newMonth)\r\n        .set('day', newDay)\r\n        .set('dayName', newDayName)\r\n    );\r\n  }\r\n\r\n  handleAddTime(startOrEnd) {\r\n    return () => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      const [hour, minute] = formatDate(new Date(), 'HH:mm').split(':');\r\n      onChange(timestamp.set(hourKey, hour).set(minuteKey, minute));\r\n    };\r\n  }\r\n\r\n  handleRemoveTime(startOrEnd) {\r\n    return () => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      onChange(timestamp.set(hourKey, null).set(minuteKey, null));\r\n    };\r\n  }\r\n\r\n  handleTimeChange(startOrEnd) {\r\n    return event => {\r\n      const { onChange, timestamp } = this.props;\r\n\r\n      const [hourKey, minuteKey] =\r\n        startOrEnd === 'start' ? ['startHour', 'startMinute'] : ['endHour', 'endMinute'];\r\n      let [hour, minute] = event.target.value.split(':');\r\n      hour = hour.startsWith('0') ? hour.substring(1) : hour;\r\n      onChange(timestamp.set(hourKey, hour).set(minuteKey, minute));\r\n    };\r\n  }\r\n\r\n  handleAddRepeater() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('repeaterType', '+')\r\n        .set('repeaterValue', 1)\r\n        .set('repeaterUnit', 'h')\r\n    );\r\n  }\r\n\r\n  handleRemoveRepeater() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('repeaterType', null)\r\n        .set('repeaterValue', null)\r\n        .set('repeaterUnit', null)\r\n    );\r\n  }\r\n\r\n  handleRepeaterTypeChange(newRepeaterType) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterType', newRepeaterType));\r\n  }\r\n\r\n  handleRepeaterValueChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterValue', event.target.value));\r\n  }\r\n\r\n  handleRepeaterUnitChange(newRepeaterUnit) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('repeaterUnit', newRepeaterUnit));\r\n  }\r\n\r\n  handleAddDelay() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('delayType', '-')\r\n        .set('delayValue', 1)\r\n        .set('delayUnit', 'h')\r\n    );\r\n  }\r\n\r\n  handleRemoveDelay() {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(\r\n      timestamp\r\n        .set('delayType', null)\r\n        .set('delayValue', null)\r\n        .set('delayUnit', null)\r\n    );\r\n  }\r\n\r\n  handleDelayTypeChange(newDelayType) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayType', newDelayType));\r\n  }\r\n\r\n  handleDelayValueChange(event) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayValue', event.target.value));\r\n  }\r\n\r\n  handleDelayUnitChange(newDelayUnit) {\r\n    const { onChange, timestamp } = this.props;\r\n    onChange(timestamp.set('delayUnit', newDelayUnit));\r\n  }\r\n\r\n  renderTimeField(label, timeKey, hour, minute, showRemoveButton = true) {\r\n    return (\r\n      <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n        <div className=\"timestamp-editor__field-title\">{label}</div>\r\n        <div className=\"timestamp-editor__field\">\r\n          {!!hour ? (\r\n            <Fragment>\r\n              <input\r\n                type=\"time\"\r\n                className=\"timestamp-editor__time-input\"\r\n                value={`${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`}\r\n                onChange={this.handleTimeChange(timeKey)}\r\n              />\r\n              {showRemoveButton && (\r\n                <i\r\n                  className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                  onClick={this.handleRemoveTime(timeKey)}\r\n                />\r\n              )}\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddTime(timeKey)}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderRepeater() {\r\n    const { repeaterType, repeaterValue, repeaterUnit } = this.props.timestamp.toJS();\r\n\r\n    return (\r\n      <div className=\"timestamp-editor__field-container\">\r\n        <div className=\"timestamp-editor__field-title\">Repeater</div>\r\n        <div className=\"timestamp-editor__field timestamp-editor__field--delay-repeater\">\r\n          {!!repeaterType ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__delay-repeater-type\">\r\n                <TabButtons\r\n                  buttons={['+', '++', '.+']}\r\n                  selectedButton={repeaterType || '+'}\r\n                  onSelect={this.handleRepeaterTypeChange}\r\n                />\r\n              </div>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                className=\"textfield delay-repeater-value-input\"\r\n                value={repeaterValue || 1}\r\n                onChange={this.handleRepeaterValueChange}\r\n              />\r\n              <div>\r\n                <TabButtons\r\n                  buttons={'hdwmy'.split('')}\r\n                  selectedButton={repeaterUnit || 'h'}\r\n                  onSelect={this.handleRepeaterUnitChange}\r\n                />\r\n              </div>\r\n              <i\r\n                className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                onClick={this.handleRemoveRepeater}\r\n              />\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddRepeater}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderDelay() {\r\n    const { delayType, delayValue, delayUnit } = this.props.timestamp.toJS();\r\n\r\n    return (\r\n      <div className=\"timestamp-editor__field-container\">\r\n        <div className=\"timestamp-editor__field-title\">Delay</div>\r\n        <div className=\"timestamp-editor__field\">\r\n          {!!delayType ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__delay-repeater-type\">\r\n                <TabButtons\r\n                  buttons={['-', '--']}\r\n                  selectedButton={delayType || '-'}\r\n                  onSelect={this.handleDelayTypeChange}\r\n                />\r\n              </div>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                className=\"textfield delay-repeater-value-input\"\r\n                value={delayValue || 1}\r\n                onChange={this.handleDelayValueChange}\r\n              />\r\n              <div>\r\n                <TabButtons\r\n                  buttons={'hdwmy'.split('')}\r\n                  selectedButton={delayUnit || 'h'}\r\n                  onSelect={this.handleDelayUnitChange}\r\n                />\r\n              </div>\r\n              <i\r\n                className=\"fas fa-times fa-lg timestamp-editor__icon timestamp-editor__icon--remove\"\r\n                onClick={this.handleRemoveDelay}\r\n              />\r\n            </Fragment>\r\n          ) : (\r\n            <i\r\n              className=\"fas fa-plus timestamp-editor__icon timestamp-editor__icon--add\"\r\n              onClick={this.handleAddDelay}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { timestamp } = this.props;\r\n    const {\r\n      isActive,\r\n      year,\r\n      month,\r\n      day,\r\n      startHour,\r\n      startMinute,\r\n      endHour,\r\n      endMinute,\r\n    } = timestamp.toJS();\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"timestamp-editor__render\">{renderAsText(timestamp)}</div>\r\n\r\n        <div className=\"timestamp-editor__date-time-fields-container\">\r\n          <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n            <div className=\"timestamp-editor__field-title\">Active</div>\r\n            <div className=\"timestamp-editor__field\">\r\n              <Switch isEnabled={isActive} onToggle={this.handleActiveToggle} />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"timestamp-editor__field-container timestamp-editor__field-container--inline\">\r\n            <div className=\"timestamp-editor__field-title\">Date</div>\r\n            <div className=\"timestamp-editor__field\">\r\n              <input\r\n                type=\"date\"\r\n                className=\"timestamp-editor__date-input\"\r\n                onChange={this.handleDateChange}\r\n                value={`${year}-${month}-${day}`}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {this.renderTimeField('Start time', 'start', startHour, startMinute, !endHour)}\r\n          {!!startHour && this.renderTimeField('End time', 'end', endHour, endMinute)}\r\n        </div>\r\n\r\n        {this.renderRepeater()}\r\n        {this.renderDelay()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TimestampEditor from './components/TimestampEditor';\r\nimport Drawer from '../../../UI/Drawer/';\r\n\r\nimport _ from 'lodash';\r\nimport formatDate from 'date-fns/format';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class TimestampEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleAddEndTimestamp', 'handleRemoveEndTimestamp']);\r\n  }\r\n\r\n  handleChange(key) {\r\n    return newTimestamp => this.props.onChange(this.props.timestamp.set(key, newTimestamp));\r\n  }\r\n\r\n  handleAddEndTimestamp() {\r\n    const { timestamp } = this.props;\r\n    const [year, month, day, dayName] = formatDate(new Date(), 'YYYY MM DD ddd').split(' ');\r\n    this.props.onChange(\r\n      timestamp.set(\r\n        'secondTimestamp',\r\n        Map({\r\n          year,\r\n          month,\r\n          day,\r\n          dayName,\r\n          isActive: timestamp.getIn(['firstTimestamp', 'isActive']),\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  handleRemoveEndTimestamp() {\r\n    this.props.onChange(this.props.timestamp.set('secondTimestamp', null));\r\n  }\r\n\r\n  render() {\r\n    const { timestamp, onClose, singleTimestampOnly } = this.props;\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"timestamp-editor__title\">Edit timestamp</h2>\r\n\r\n        <TimestampEditor\r\n          timestamp={timestamp.get('firstTimestamp')}\r\n          onChange={this.handleChange('firstTimestamp')}\r\n        />\r\n\r\n        {!singleTimestampOnly &&\r\n          (!!timestamp.get('secondTimestamp') ? (\r\n            <Fragment>\r\n              <div className=\"timestamp-editor__separator\">\r\n                <div className=\"timestamp-editor__separator__margin-line\" />\r\n                to\r\n                <div className=\"timestamp-editor__separator__margin-line\" />\r\n              </div>\r\n\r\n              <TimestampEditor\r\n                timestamp={timestamp.get('secondTimestamp')}\r\n                onChange={this.handleChange('secondTimestamp')}\r\n              />\r\n\r\n              <div className=\"timestamp-editor__button-container\">\r\n                <button\r\n                  className=\"btn timestamp-editor__add-new-button\"\r\n                  onClick={this.handleRemoveEndTimestamp}\r\n                >\r\n                  Remove end timestamp\r\n                </button>\r\n              </div>\r\n            </Fragment>\r\n          ) : (\r\n            <div className=\"timestamp-editor__button-container\">\r\n              <button\r\n                className=\"btn timestamp-editor__add-new-button\"\r\n                onClick={this.handleAddEndTimestamp}\r\n              >\r\n                Add end timestamp\r\n              </button>\r\n            </div>\r\n          ))}\r\n\r\n        <br />\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport Drawer from '../../../UI/Drawer';\r\n\r\nimport { attributedStringToRawText } from '../../../../lib/export_org';\r\nimport generateId from '../../../../lib/id_generator';\r\nimport { parseMarkupAndCookies } from '../../../../lib/parse_org';\r\n\r\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\r\nimport classNames from 'classnames';\r\nimport { fromJS } from 'immutable';\r\nimport _ from 'lodash';\r\n\r\nexport default class PropertyListEditorModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleAddNewItem']);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const prevItems = prevProps.propertyListItems;\r\n    const currentItems = this.props.propertyListItems;\r\n    if (prevItems.size === currentItems.size - 1 && currentItems.last().get('property') === '') {\r\n      if (this.lastTextfield) {\r\n        this.lastTextfield.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  handlePropertyChange(propertyListItemId) {\r\n    return event => {\r\n      const propertyListItemIndex = this.props.propertyListItems.findIndex(\r\n        propertyListItem => propertyListItem.get('id') === propertyListItemId\r\n      );\r\n      this.props.onChange(\r\n        this.props.propertyListItems.setIn([propertyListItemIndex, 'property'], event.target.value)\r\n      );\r\n    };\r\n  }\r\n\r\n  handleValueChange(propertyListItemId) {\r\n    return event => {\r\n      const { propertyListItems, onChange } = this.props;\r\n\r\n      const propertyListItemIndex = propertyListItems.findIndex(\r\n        propertyListItem => propertyListItem.get('id') === propertyListItemId\r\n      );\r\n      onChange(\r\n        propertyListItems.setIn(\r\n          [propertyListItemIndex, 'value'],\r\n          fromJS(parseMarkupAndCookies(event.target.value))\r\n        )\r\n      );\r\n    };\r\n  }\r\n\r\n  handleRemoveItem(propertyListItemId) {\r\n    return () =>\r\n      this.props.onChange(\r\n        this.props.propertyListItems.filter(\r\n          propertyListItem => propertyListItem.get('id') !== propertyListItemId\r\n        )\r\n      );\r\n  }\r\n\r\n  handleAddNewItem() {\r\n    this.props.onChange(\r\n      this.props.propertyListItems.push(\r\n        fromJS({\r\n          property: '',\r\n          value: '',\r\n          id: generateId(),\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { onClose, propertyListItems } = this.props;\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"drawer-modal__title\">Edit property list</h2>\r\n\r\n        {propertyListItems.size === 0 ? (\r\n          <div className=\"no-items-message\">\r\n            There are no items in this property list.\r\n            <br />\r\n            <br />\r\n            Click the <i className=\"fas fa-plus\" /> button to add a new one.\r\n          </div>\r\n        ) : (\r\n          <Droppable droppableId=\"property-list-editor-droppable\" type=\"PROPERTY-LIST\">\r\n            {(provided, snapshot) => (\r\n              <div\r\n                className=\"property-list-editor__items-container\"\r\n                ref={provided.innerRef}\r\n                {...provided.droppableProps}\r\n              >\r\n                <Fragment>\r\n                  {propertyListItems.map((propertyListItem, index) => (\r\n                    <Draggable\r\n                      draggableId={`property-list-item--${index}`}\r\n                      index={index}\r\n                      key={propertyListItem.get('id')}\r\n                    >\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          className={classNames('property-list-editor__item-container', {\r\n                            'property-list-editor__item-container--dragging': snapshot.isDragging,\r\n                          })}\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                        >\r\n                          <div className=\"item__textfields-container\">\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"textfield item-container__textfield\"\r\n                              value={propertyListItem.get('property')}\r\n                              onChange={this.handlePropertyChange(propertyListItem.get('id'))}\r\n                              ref={textfield => (this.lastTextfield = textfield)}\r\n                            />\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"textfield item-container__textfield\"\r\n                              value={attributedStringToRawText(propertyListItem.get('value'))}\r\n                              onChange={this.handleValueChange(propertyListItem.get('id'))}\r\n                            />\r\n                          </div>\r\n                          <div className=\"item-container__actions-container\">\r\n                            <i\r\n                              className=\"fas fa-times fa-lg\"\r\n                              onClick={this.handleRemoveItem(propertyListItem.get('id'))}\r\n                            />\r\n                            <i\r\n                              className=\"fas fa-bars fa-lg item-container__drag-handle drag-handle\"\r\n                              {...provided.dragHandleProps}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  ))}\r\n\r\n                  {provided.placeholder}\r\n                </Fragment>\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        )}\r\n\r\n        <div className=\"property-list-editor__add-new-container\">\r\n          <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={this.handleAddNewItem} />\r\n        </div>\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TitleLine from '../../../TitleLine';\r\n\r\nimport { isTodoKeywordCompleted } from '../../../../../../lib/org_utils';\r\nimport {\r\n  dateForTimestamp,\r\n  subtractTimestampUnitFromDate,\r\n  addTimestampUnitToDate,\r\n} from '../../../../../../lib/timestamps';\r\n\r\nimport {\r\n  isToday,\r\n  startOfDay,\r\n  endOfDay,\r\n  isBefore,\r\n  isAfter,\r\n  isEqual,\r\n  isWithinRange,\r\n  isPast,\r\n  distanceInWordsToNow,\r\n} from 'date-fns';\r\nimport formatDate from 'date-fns/format';\r\nimport classNames from 'classnames';\r\n\r\nexport default class AgendaDay extends PureComponent {\r\n  handleHeaderClick(headerId) {\r\n    return () => this.props.onHeaderClick(headerId);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      date,\r\n      headers,\r\n      todoKeywordSets,\r\n      dateDisplayType,\r\n      onToggleDateDisplayType,\r\n      agendaDefaultDeadlineDelayValue,\r\n      agendaDefaultDeadlineDelayUnit,\r\n    } = this.props;\r\n\r\n    const dateStart = startOfDay(date);\r\n    const dateEnd = endOfDay(date);\r\n\r\n    const planningItemsAndHeaders = headers\r\n      .flatMap(header => {\r\n        const planningItemsforDate = header.get('planningItems').filter(planningItem => {\r\n          const timestamp = planningItem.get('timestamp');\r\n          if (!timestamp.get('isActive')) {\r\n            return false;\r\n          }\r\n\r\n          const planningItemDate = dateForTimestamp(timestamp);\r\n          const isCompletedTodo =\r\n            !!header.getIn(['titleLine', 'todoKeyword']) &&\r\n            isTodoKeywordCompleted(todoKeywordSets, header.getIn(['titleLine', 'todoKeyword']));\r\n          if (isCompletedTodo) {\r\n            return false;\r\n          }\r\n\r\n          if (planningItem.get('type') === 'DEADLINE') {\r\n            if (isToday(date)) {\r\n              if (isBefore(planningItemDate, new Date())) {\r\n                return true;\r\n              }\r\n\r\n              const [delayValue, delayUnit] = !!timestamp.get('delayType')\r\n                ? [timestamp.get('delayValue'), timestamp.get('delayUnit')]\r\n                : [agendaDefaultDeadlineDelayValue, agendaDefaultDeadlineDelayUnit];\r\n\r\n              const appearDate = subtractTimestampUnitFromDate(\r\n                planningItemDate,\r\n                delayValue,\r\n                delayUnit\r\n              );\r\n              return isAfter(date, appearDate) || isEqual(date, appearDate);\r\n            } else {\r\n              return isWithinRange(planningItemDate, dateStart, dateEnd);\r\n            }\r\n          } else if (planningItem.get('type') === 'SCHEDULED') {\r\n            let appearDate = planningItemDate;\r\n            if (!!timestamp.get('delayType')) {\r\n              const hasBeenRepeated = header\r\n                .get('propertyListItems')\r\n                .some(propertyListItem => propertyListItem.get('property') === 'LAST_REPEAT');\r\n              if (timestamp.get('delayType') === '--' && !hasBeenRepeated) {\r\n                appearDate = addTimestampUnitToDate(\r\n                  planningItemDate,\r\n                  timestamp.get('delayValue'),\r\n                  timestamp.get('delayUnit')\r\n                );\r\n              }\r\n            }\r\n\r\n            if (isToday(date) && isAfter(date, appearDate)) {\r\n              return true;\r\n            }\r\n\r\n            return isWithinRange(appearDate, dateStart, dateEnd);\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n\r\n        return planningItemsforDate.map(planningItem => [planningItem, header]);\r\n      })\r\n      .sortBy(([planningItem, header]) => {\r\n        const { startHour, startMinute, endHour, endMinute, month, day } = planningItem\r\n          .get('timestamp')\r\n          .toJS();\r\n\r\n        return [!!startHour ? 0 : 1, startHour, startMinute, endHour, endMinute, month, day];\r\n      });\r\n\r\n    return (\r\n      <div className=\"agenda-day__container\">\r\n        <div className=\"agenda-day__title\">\r\n          {isToday(date) && <div className=\"agenda-day__today-indicator\" />}\r\n          <div className=\"agenda-day__title__day-name\">{formatDate(date, 'dddd')}</div>\r\n          <div className=\"agenda-day__title__date\">{formatDate(date, 'MMMM Do, YYYY')}</div>\r\n        </div>\r\n\r\n        <div className=\"agenda-day__headers-container\">\r\n          {planningItemsAndHeaders.map(([planningItem, header]) => {\r\n            const planningItemDate = dateForTimestamp(planningItem.get('timestamp'));\r\n            const hasTodoKeyword = !!header.getIn(['titleLine', 'todoKeyword']);\r\n\r\n            const dateClassName = classNames('agenda-day__header-planning-date', {\r\n              'agenda-day__header-planning-date--overdue':\r\n                hasTodoKeyword && isPast(planningItemDate),\r\n            });\r\n\r\n            return (\r\n              <div key={planningItem.get('id')} className=\"agenda-day__header-container\">\r\n                <div className=\"agenda-day__header__planning-item-container\">\r\n                  <div className=\"agenda-day__header-planning-type\">{planningItem.get('type')}</div>\r\n                  <div className={dateClassName} onClick={onToggleDateDisplayType}>\r\n                    {dateDisplayType === 'absolute'\r\n                      ? formatDate(planningItemDate, 'MM/DD')\r\n                      : `${distanceInWordsToNow(planningItemDate)} ago`}\r\n\r\n                    {!!planningItem.getIn(['timestamp', 'startHour']) && (\r\n                      <Fragment>\r\n                        <br />\r\n                        {formatDate(planningItemDate, 'h:mma')}\r\n                      </Fragment>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"agenda-day__header__header-container\">\r\n                  <TitleLine\r\n                    header={header}\r\n                    color=\"black\"\r\n                    hasContent={false}\r\n                    isSelected={false}\r\n                    shouldDisableActions\r\n                    shouldDisableExplicitWidth\r\n                    onClick={this.handleHeaderClick(header.get('id'))}\r\n                  />\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport AgendaDay from './components/AgendaDay';\r\nimport Drawer from '../../../UI/Drawer';\r\nimport TabButtons from '../../../UI/TabButtons';\r\n\r\nimport * as orgActions from '../../../../actions/org';\r\n\r\nimport _ from 'lodash';\r\nimport {\r\n  addDays,\r\n  addWeeks,\r\n  addMonths,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  startOfWeek,\r\n  startOfMonth,\r\n  getDaysInMonth,\r\n} from 'date-fns';\r\nimport formatDate from 'date-fns/format';\r\n\r\nclass AgendaModal extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleTimeframeTypeChange',\r\n      'handleNextDateClick',\r\n      'handlePreviousDateClick',\r\n      'handleHeaderClick',\r\n      'handleToggleDateDisplayType',\r\n    ]);\r\n\r\n    this.state = {\r\n      selectedDate: new Date(),\r\n      timeframeType: 'Week',\r\n      dateDisplayType: 'absolute',\r\n    };\r\n  }\r\n\r\n  handleTimeframeTypeChange(timeframeType) {\r\n    this.setState({ timeframeType });\r\n  }\r\n\r\n  handleNextDateClick() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        this.setState({ selectedDate: addDays(selectedDate, 1) });\r\n        break;\r\n      case 'Week':\r\n        this.setState({ selectedDate: addWeeks(selectedDate, 1) });\r\n        break;\r\n      case 'Month':\r\n        this.setState({ selectedDate: addMonths(selectedDate, 1) });\r\n        break;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  handleHeaderClick(headerId) {\r\n    this.props.onClose();\r\n    this.props.org.selectHeaderAndOpenParents(headerId);\r\n  }\r\n\r\n  handlePreviousDateClick() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        this.setState({ selectedDate: subDays(selectedDate, 1) });\r\n        break;\r\n      case 'Week':\r\n        this.setState({ selectedDate: subWeeks(selectedDate, 1) });\r\n        break;\r\n      case 'Month':\r\n        this.setState({ selectedDate: subMonths(selectedDate, 1) });\r\n        break;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  handleToggleDateDisplayType() {\r\n    const { dateDisplayType } = this.state;\r\n\r\n    this.setState({\r\n      dateDisplayType: dateDisplayType === 'absolute' ? 'relative' : 'absolute',\r\n    });\r\n  }\r\n\r\n  calculateTimeframeHeader() {\r\n    const { selectedDate, timeframeType } = this.state;\r\n\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        return formatDate(selectedDate, 'MMMM Do');\r\n      case 'Week':\r\n        const weekStart = startOfWeek(selectedDate);\r\n        const weekEnd = addWeeks(weekStart, 1);\r\n        return `${formatDate(weekStart, 'MMM Do')} - ${formatDate(\r\n          weekEnd,\r\n          'MMM Do'\r\n        )} (W${formatDate(weekStart, 'W')})`;\r\n      case 'Month':\r\n        return formatDate(selectedDate, 'MMMM');\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      onClose,\r\n      headers,\r\n      todoKeywordSets,\r\n      agendaDefaultDeadlineDelayValue,\r\n      agendaDefaultDeadlineDelayUnit,\r\n    } = this.props;\r\n    const { timeframeType, selectedDate, dateDisplayType } = this.state;\r\n\r\n    let dates = [];\r\n    switch (timeframeType) {\r\n      case 'Day':\r\n        dates = [selectedDate];\r\n        break;\r\n      case 'Week':\r\n        const weekStart = startOfWeek(selectedDate);\r\n        dates = _.range(7).map(daysAfter => addDays(weekStart, daysAfter));\r\n        break;\r\n      case 'Month':\r\n        const monthStart = startOfMonth(selectedDate);\r\n        dates = _.range(getDaysInMonth(selectedDate)).map(daysAfter =>\r\n          addDays(monthStart, daysAfter)\r\n        );\r\n        break;\r\n      default:\r\n    }\r\n\r\n    return (\r\n      <Drawer onClose={onClose}>\r\n        <h2 className=\"agenda__title\">Agenda</h2>\r\n\r\n        <div className=\"agenda__tab-container\">\r\n          <TabButtons\r\n            buttons={['Day', 'Week', 'Month']}\r\n            selectedButton={timeframeType}\r\n            onSelect={this.handleTimeframeTypeChange}\r\n            useEqualWidthTabs\r\n          />\r\n        </div>\r\n\r\n        <div className=\"agenda__timeframe-header-container\">\r\n          <i className=\"fas fa-chevron-left fa-lg\" onClick={this.handlePreviousDateClick} />\r\n          <div className=\"agenda__timeframe-header\">{this.calculateTimeframeHeader()}</div>\r\n          <i className=\"fas fa-chevron-right fa-lg\" onClick={this.handleNextDateClick} />\r\n        </div>\r\n\r\n        <div className=\"agenda__days-container\">\r\n          {dates.map(date => (\r\n            <AgendaDay\r\n              key={formatDate(date)}\r\n              date={date}\r\n              headers={headers}\r\n              onHeaderClick={this.handleHeaderClick}\r\n              todoKeywordSets={todoKeywordSets}\r\n              dateDisplayType={dateDisplayType}\r\n              onToggleDateDisplayType={this.handleToggleDateDisplayType}\r\n              agendaDefaultDeadlineDelayValue={agendaDefaultDeadlineDelayValue}\r\n              agendaDefaultDeadlineDelayUnit={agendaDefaultDeadlineDelayUnit}\r\n            />\r\n          ))}\r\n        </div>\r\n\r\n        <br />\r\n      </Drawer>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  todoKeywordSets: state.org.present.get('todoKeywordSets'),\r\n  agendaDefaultDeadlineDelayValue: state.base.get('agendaDefaultDeadlineDelayValue') || 5,\r\n  agendaDefaultDeadlineDelayUnit: state.base.get('agendaDefaultDeadlineDelayUnit') || 'd',\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  org: bindActionCreators(orgActions, dispatch),\r\n});\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(AgendaModal);\r\n","const DEFAULT_BINDINGS = [\r\n  ['Select next header', 'selectNextVisibleHeader', 'ctrl+n'],\r\n  ['Select previous header', 'selectPreviousVisibleHeader', 'ctrl+p'],\r\n  ['Toggle header opened', 'toggleHeaderOpened', 'tab'],\r\n  ['Advance todo state', 'advanceTodo', 'ctrl+t'],\r\n  ['Edit title', 'editTitle', 'ctrl+h'],\r\n  ['Edit description', 'editDescription', 'ctrl+d'],\r\n  ['Exit edit mode', 'exitEditMode', 'command+enter'],\r\n  ['Add header', 'addHeader', 'ctrl+enter'],\r\n  ['Remove header', 'removeHeader', 'backspace'],\r\n  ['Move header up', 'moveHeaderUp', 'ctrl+command+p'],\r\n  ['Move header down', 'moveHeaderDown', 'ctrl+command+n'],\r\n  ['Move header left', 'moveHeaderLeft', 'ctrl+command+b'],\r\n  ['Move header right', 'moveHeaderRight', 'ctrl+command+f'],\r\n  ['Undo', 'undo', 'ctrl+shift+-'],\r\n];\r\n\r\nexport const calculateNamedKeybindings = customKeybindings =>\r\n  DEFAULT_BINDINGS.map(([bindingName, _bindingAction, binding]) => [\r\n    bindingName,\r\n    customKeybindings.get(bindingName, binding),\r\n  ]);\r\n\r\nexport const calculateActionedKeybindings = customKeybindings =>\r\n  DEFAULT_BINDINGS.map(([bindingName, bindingAction, binding]) => [\r\n    bindingAction,\r\n    customKeybindings.get(bindingName, binding),\r\n  ]);\r\n","/* global ga */\r\n\r\nimport React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nimport { HotKeys } from 'react-hotkeys';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport HeaderList from './components/HeaderList';\r\nimport ActionDrawer from './components/ActionDrawer';\r\nimport CaptureModal from './components/CaptureModal';\r\nimport SyncConfirmationModal from './components/SyncConfirmationModal';\r\nimport TagsEditorModal from './components/TagsEditorModal';\r\nimport TimestampEditorModal from './components/TimestampEditorModal';\r\nimport PropertyListEditorModal from './components/PropertyListEditorModal';\r\nimport AgendaModal from './components/AgendaModal';\r\n\r\nimport * as baseActions from '../../actions/base';\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as orgActions from '../../actions/org';\r\nimport * as captureActions from '../../actions/capture';\r\nimport { ActionCreators as undoActions } from 'redux-linear-undo';\r\n\r\nimport sampleCaptureTemplates from '../../lib/sample_capture_templates';\r\nimport { calculateActionedKeybindings } from '../../lib/keybindings';\r\nimport { timestampWithId, headerWithId } from '../../lib/org_utils';\r\n\r\nimport _ from 'lodash';\r\nimport { fromJS, OrderedSet } from 'immutable';\r\n\r\nclass OrgFile extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, [\r\n      'handleSelectNextVisibleHeaderHotKey',\r\n      'handleSelectPreviousVisibleHeaderHotKey',\r\n      'handleToggleHeaderOpenedHotKey',\r\n      'handleAdvanceTodoHotKey',\r\n      'handleEditTitleHotKey',\r\n      'handleEditDescriptionHotKey',\r\n      'handleExitEditModeHotKey',\r\n      'handleAddHeaderHotKey',\r\n      'handleRemoveHeaderHotKey',\r\n      'handleMoveHeaderUpHotKey',\r\n      'handleMoveHeaderDownHotKey',\r\n      'handleMoveHeaderLeftHotKey',\r\n      'handleMoveHeaderRightHotKey',\r\n      'handleUndoHotKey',\r\n      'handleContainerRef',\r\n      'handleCapture',\r\n      'handlePopupClose',\r\n      'handleSyncConfirmationPull',\r\n      'handleSyncConfirmationPush',\r\n      'handleSyncConfirmationCancel',\r\n      'handleTagsChange',\r\n      'handlePropertyListItemsChange',\r\n    ]);\r\n\r\n    this.state = {\r\n      hasUncaughtError: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { staticFile, path, loadedPath } = this.props;\r\n\r\n    if (!!staticFile) {\r\n      this.props.base.loadStaticFile(staticFile);\r\n\r\n      if (staticFile === 'changelog') {\r\n        this.props.base.setHasUnseenChangelog(false);\r\n      }\r\n\r\n      setTimeout(() => (document.querySelector('html').scrollTop = 0), 0);\r\n    } else if (!!path && path !== loadedPath) {\r\n      this.props.syncBackend.downloadFile(path);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { staticFile } = this.props;\r\n\r\n    if (!!staticFile) {\r\n      this.props.base.unloadStaticFile();\r\n    } else {\r\n      this.props.org.stopDisplayingFile();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const { headers, pendingCapture } = this.props;\r\n    if (!!pendingCapture && !!headers && headers.size > 0) {\r\n      this.props.org.insertPendingCapture();\r\n    }\r\n  }\r\n\r\n  componentDidCatch(error) {\r\n    ga('send', 'event', 'error', 'OrgFile componentDidCatch', error);\r\n\r\n    this.setState({ hasUncaughtError: true });\r\n  }\r\n\r\n  handleSelectNextVisibleHeaderHotKey() {\r\n    this.props.org.selectNextVisibleHeader();\r\n  }\r\n\r\n  handleSelectPreviousVisibleHeaderHotKey() {\r\n    this.props.org.selectPreviousVisibleHeader();\r\n  }\r\n\r\n  handleToggleHeaderOpenedHotKey() {\r\n    const { selectedHeaderId } = this.props;\r\n\r\n    if (selectedHeaderId) {\r\n      this.props.org.toggleHeaderOpened(selectedHeaderId);\r\n    }\r\n  }\r\n\r\n  handleAdvanceTodoHotKey() {\r\n    this.props.org.advanceTodoState();\r\n  }\r\n\r\n  handleEditTitleHotKey() {\r\n    this.props.org.enterEditMode('title');\r\n  }\r\n\r\n  handleEditDescriptionHotKey() {\r\n    this.props.org.openHeader(this.props.selectedHeaderId);\r\n    this.props.org.enterEditMode('description');\r\n  }\r\n\r\n  handleExitEditModeHotKey() {\r\n    this.props.org.exitEditMode();\r\n    this.container.focus();\r\n  }\r\n\r\n  handleAddHeaderHotKey() {\r\n    this.props.org.addHeaderAndEdit(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleRemoveHeaderHotKey() {\r\n    const { selectedHeaderId } = this.props;\r\n\r\n    this.props.org.selectNextSiblingHeader(selectedHeaderId);\r\n    this.props.org.removeHeader(selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderUpHotKey() {\r\n    this.props.org.moveHeaderUp(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderDownHotKey() {\r\n    this.props.org.moveHeaderDown(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderLeftHotKey() {\r\n    this.props.org.moveHeaderLeft(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleMoveHeaderRightHotKey() {\r\n    this.props.org.moveHeaderRight(this.props.selectedHeaderId);\r\n  }\r\n\r\n  handleUndoHotKey() {\r\n    this.props.undo.undo();\r\n  }\r\n\r\n  handleContainerRef(container) {\r\n    this.container = container;\r\n    if (this.container) {\r\n      this.container.focus();\r\n    }\r\n  }\r\n\r\n  handleCapture(templateId, content, shouldPrepend) {\r\n    this.props.org.insertCapture(templateId, content, shouldPrepend);\r\n  }\r\n\r\n  handlePopupClose() {\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationPull() {\r\n    this.props.org.sync({ forceAction: 'pull' });\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationPush() {\r\n    this.props.org.sync({ forceAction: 'push' });\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleSyncConfirmationCancel() {\r\n    this.props.base.closePopup();\r\n  }\r\n\r\n  handleTagsChange(newTags) {\r\n    this.props.org.setHeaderTags(this.props.selectedHeaderId, newTags);\r\n  }\r\n\r\n  handlePropertyListItemsChange(newPropertyListItems) {\r\n    this.props.org.updatePropertyListItems(\r\n      this.props.activePopupData.get('headerId'),\r\n      newPropertyListItems\r\n    );\r\n  }\r\n\r\n  handleTimestampChange(popupData) {\r\n    if (!!popupData.get('timestampId')) {\r\n      return newTimestamp =>\r\n        this.props.org.updateTimestampWithId(popupData.get('timestampId'), newTimestamp);\r\n    } else {\r\n      return newTimestamp =>\r\n        this.props.org.updatePlanningItemTimestamp(\r\n          popupData.get('headerId'),\r\n          popupData.get('planningItemIndex'),\r\n          newTimestamp.get('firstTimestamp')\r\n        );\r\n    }\r\n  }\r\n\r\n  renderActivePopup() {\r\n    const {\r\n      activePopupType,\r\n      activePopupData,\r\n      captureTemplates,\r\n      headers,\r\n      selectedHeader,\r\n    } = this.props;\r\n\r\n    switch (activePopupType) {\r\n      case 'sync-confirmation':\r\n        return (\r\n          <SyncConfirmationModal\r\n            lastServerModifiedAt={activePopupData.get('lastServerModifiedAt')}\r\n            onPull={this.handleSyncConfirmationPull}\r\n            onPush={this.handleSyncConfirmationPush}\r\n            onCancel={this.handleSyncConfirmationCancel}\r\n          />\r\n        );\r\n      case 'capture':\r\n        return (\r\n          <CaptureModal\r\n            template={captureTemplates.find(\r\n              template => template.get('id') === activePopupData.get('templateId')\r\n            )}\r\n            headers={headers}\r\n            onCapture={this.handleCapture}\r\n            onClose={this.handlePopupClose}\r\n          />\r\n        );\r\n      case 'tags-editor':\r\n        return !!selectedHeader ? (\r\n          <TagsEditorModal\r\n            header={selectedHeader}\r\n            allTags={OrderedSet(\r\n              headers.flatMap(header => header.getIn(['titleLine', 'tags']))\r\n            ).sort()}\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handleTagsChange}\r\n          />\r\n        ) : null;\r\n      case 'timestamp-editor':\r\n        let editingTimestamp = null;\r\n        if (activePopupData.get('timestampId')) {\r\n          editingTimestamp = timestampWithId(headers, activePopupData.get('timestampId'));\r\n        } else {\r\n          editingTimestamp = fromJS({\r\n            firstTimestamp: headerWithId(headers, activePopupData.get('headerId')).getIn([\r\n              'planningItems',\r\n              activePopupData.get('planningItemIndex'),\r\n              'timestamp',\r\n            ]),\r\n          });\r\n        }\r\n\r\n        return (\r\n          <TimestampEditorModal\r\n            timestamp={editingTimestamp}\r\n            singleTimestampOnly={!activePopupData.get('timestampId')}\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handleTimestampChange(activePopupData)}\r\n          />\r\n        );\r\n\r\n      case 'property-list-editor':\r\n        return (\r\n          <PropertyListEditorModal\r\n            onClose={this.handlePopupClose}\r\n            onChange={this.handlePropertyListItemsChange}\r\n            propertyListItems={headerWithId(headers, activePopupData.get('headerId')).get(\r\n              'propertyListItems'\r\n            )}\r\n          />\r\n        );\r\n      case 'agenda':\r\n        return <AgendaModal onClose={this.handlePopupClose} headers={headers} />;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      headers,\r\n      shouldDisableDirtyIndicator,\r\n      shouldDisableSyncButtons,\r\n      shouldDisableActions,\r\n      isDirty,\r\n      parsingErrorMessage,\r\n      path,\r\n      staticFile,\r\n      customKeybindings,\r\n      inEditMode,\r\n      orgFileErrorMessage,\r\n    } = this.props;\r\n\r\n    if (!path && !staticFile) {\r\n      return <Redirect to=\"/files\" />;\r\n    }\r\n\r\n    if (this.state.hasUncaughtError) {\r\n      return (\r\n        <div className=\"error-message-container\">\r\n          Uh oh, you ran into a bug!\r\n          <br />\r\n          <br />\r\n          This was probably the result of an error in attempting to parse your org file. It'd be\r\n          super helpful if you could{' '}\r\n          <a\r\n            href=\"https://github.com/DanielDe/org-web/issues/new\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            create an issue\r\n          </a>{' '}\r\n          (and include the org file if possible!)\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (!!orgFileErrorMessage) {\r\n      return <div className=\"error-message-container\">{orgFileErrorMessage}</div>;\r\n    }\r\n\r\n    if (!headers) {\r\n      return <div />;\r\n    }\r\n\r\n    const keyMap = _.fromPairs(calculateActionedKeybindings(customKeybindings));\r\n\r\n    // Automatically call preventDefault on all the keyboard events that come through for\r\n    // these hotkeys.\r\n    const preventDefaultAndHandleEditMode = (callback, ignoreInEditMode = false) => event => {\r\n      if (ignoreInEditMode && inEditMode) {\r\n        return;\r\n      }\r\n\r\n      if (ignoreInEditMode && ['TEXTAREA', 'INPUT'].includes(document.activeElement.nodeName)) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n      callback(event);\r\n    };\r\n\r\n    const handlers = {\r\n      selectNextVisibleHeader: preventDefaultAndHandleEditMode(\r\n        this.handleSelectNextVisibleHeaderHotKey\r\n      ),\r\n      selectPreviousVisibleHeader: preventDefaultAndHandleEditMode(\r\n        this.handleSelectPreviousVisibleHeaderHotKey\r\n      ),\r\n      toggleHeaderOpened: preventDefaultAndHandleEditMode(\r\n        this.handleToggleHeaderOpenedHotKey,\r\n        true\r\n      ),\r\n      advanceTodo: preventDefaultAndHandleEditMode(this.handleAdvanceTodoHotKey),\r\n      editTitle: preventDefaultAndHandleEditMode(this.handleEditTitleHotKey),\r\n      editDescription: preventDefaultAndHandleEditMode(this.handleEditDescriptionHotKey),\r\n      exitEditMode: preventDefaultAndHandleEditMode(this.handleExitEditModeHotKey),\r\n      addHeader: preventDefaultAndHandleEditMode(this.handleAddHeaderHotKey),\r\n      removeHeader: preventDefaultAndHandleEditMode(this.handleRemoveHeaderHotKey, true),\r\n      moveHeaderUp: preventDefaultAndHandleEditMode(this.handleMoveHeaderUpHotKey),\r\n      moveHeaderDown: preventDefaultAndHandleEditMode(this.handleMoveHeaderDownHotKey),\r\n      moveHeaderLeft: preventDefaultAndHandleEditMode(this.handleMoveHeaderLeftHotKey),\r\n      moveHeaderRight: preventDefaultAndHandleEditMode(this.handleMoveHeaderRightHotKey),\r\n      undo: preventDefaultAndHandleEditMode(this.handleUndoHotKey),\r\n    };\r\n\r\n    return (\r\n      <HotKeys keyMap={keyMap} handlers={handlers}>\r\n        <div className=\"org-file-container\" tabIndex=\"-1\" ref={this.handleContainerRef}>\r\n          {headers.size === 0 ? (\r\n            <div className=\"org-file__parsing-error-message\">\r\n              <h3>Couldn't parse file</h3>\r\n\r\n              {!!parsingErrorMessage ? (\r\n                <Fragment>{parsingErrorMessage}</Fragment>\r\n              ) : (\r\n                <Fragment>\r\n                  If you think this is a bug, please{' '}\r\n                  <a\r\n                    href=\"https://github.com/DanielDe/org-web/issues/new\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                  >\r\n                    create an issue\r\n                  </a>{' '}\r\n                  and include the org file if possible!\r\n                </Fragment>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <HeaderList shouldDisableActions={shouldDisableActions} />\r\n          )}\r\n\r\n          {isDirty &&\r\n            !shouldDisableDirtyIndicator && <div className=\"dirty-indicator\">Unpushed changes</div>}\r\n\r\n          {!shouldDisableActions && (\r\n            <ActionDrawer\r\n              shouldDisableSyncButtons={shouldDisableSyncButtons}\r\n              staticFile={staticFile}\r\n            />\r\n          )}\r\n\r\n          {this.renderActivePopup()}\r\n        </div>\r\n      </HotKeys>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  const headers = state.org.present.get('headers');\r\n  const selectedHeaderId = state.org.present.get('selectedHeaderId');\r\n  const activePopup = state.base.get('activePopup');\r\n\r\n  return {\r\n    headers,\r\n    selectedHeaderId,\r\n    isDirty: state.org.present.get('isDirty'),\r\n    loadedPath: state.org.present.get('path'),\r\n    selectedHeader: headers && headers.find(header => header.get('id') === selectedHeaderId),\r\n    customKeybindings: state.base.get('customKeybindings'),\r\n    inEditMode: !!state.org.present.get('editMode'),\r\n    activePopupType: !!activePopup ? activePopup.get('type') : null,\r\n    activePopupData: !!activePopup ? activePopup.get('data') : null,\r\n    captureTemplates: state.capture.get('captureTemplates').concat(sampleCaptureTemplates),\r\n    pendingCapture: state.org.present.get('pendingCapture'),\r\n    orgFileErrorMessage: state.org.present.get('orgFileErrorMessage'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    undo: bindActionCreators(undoActions, dispatch),\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(OrgFile);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as baseActions from '../../actions/base';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport TabButtons from '../UI/TabButtons';\r\nimport Switch from '../UI/Switch';\r\n\r\nconst Settings = ({\r\n  fontSize,\r\n  bulletStyle,\r\n  shouldTapTodoToAdvance,\r\n  shouldStoreSettingsInSyncBackend,\r\n  shouldLiveSync,\r\n  shouldSyncOnBecomingVisibile,\r\n  agendaDefaultDeadlineDelayValue,\r\n  agendaDefaultDeadlineDelayUnit,\r\n  hasUnseenChangelog,\r\n  syncBackend,\r\n  base,\r\n}) => {\r\n  const handleSignOutClick = () =>\r\n    window.confirm('Are you sure you want to sign out?') ? syncBackend.signOut() : void 0;\r\n\r\n  const handleKeyboardShortcutsClick = () => base.pushModalPage('keyboard_shortcuts_editor');\r\n\r\n  const handleCaptureTemplatesClick = () => base.pushModalPage('capture_templates_editor');\r\n\r\n  const handleFontSizeChange = newFontSize => base.setFontSize(newFontSize);\r\n\r\n  const handleBulletStyleChange = newBulletStyle => base.setBulletStyle(newBulletStyle);\r\n\r\n  const handleShouldTapTodoToAdvanceChange = () =>\r\n    base.setShouldTapTodoToAdvance(!shouldTapTodoToAdvance);\r\n\r\n  const handleAgendaDefaultDeadlineDelayValueChange = event =>\r\n    base.setAgendaDefaultDeadlineDelayValue(event.target.value);\r\n\r\n  const handleAgendaDefaultDeadlineDelayUnitChange = newDelayUnit =>\r\n    base.setAgendaDefaultDeadlineDelayUnit(newDelayUnit);\r\n\r\n  const handleShouldLiveSyncChange = () => base.setShouldLiveSync(!shouldLiveSync);\r\n\r\n  const handleShouldSyncOnBecomingVisibleChange = () => base.setShouldSyncOnBecomingVisibile(!shouldSyncOnBecomingVisibile);\r\n\r\n  const handleShouldStoreSettingsInSyncBackendChange = () =>\r\n    base.setShouldStoreSettingsInSyncBackend(!shouldStoreSettingsInSyncBackend);\r\n\r\n  const handleChangelogClick = () => base.pushModalPage('changelog');\r\n\r\n  const handleHelpClick = () => base.pushModalPage('sample');\r\n\r\n  return (\r\n    <div className=\"settings-container\">\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Font size</div>\r\n        <TabButtons\r\n          buttons={['Regular', 'Large']}\r\n          selectedButton={fontSize}\r\n          onSelect={handleFontSizeChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Bullet style</div>\r\n        <TabButtons\r\n          buttons={['Classic', 'Fancy']}\r\n          selectedButton={bulletStyle}\r\n          onSelect={handleBulletStyleChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">Tap TODO to advance state</div>\r\n        <Switch isEnabled={shouldTapTodoToAdvance} onToggle={handleShouldTapTodoToAdvanceChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Live sync\r\n          <div className=\"setting-label__description\">\r\n            If enabled, changes are automatically pushed to the sync backend as you make them.\r\n          </div>\r\n        </div>\r\n        <Switch isEnabled={shouldLiveSync} onToggle={handleShouldLiveSyncChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Sync on application becoming visible\r\n          <div className=\"setting-label__description\">\r\n            If enabled, the current org file is pulled from the sync backend when the browser tab becomes visible. This prevents you from having a stale file before starting to make changes to it.\r\n          </div>\r\n        </div>\r\n        <Switch isEnabled={shouldSyncOnBecomingVisibile} onToggle={handleShouldSyncOnBecomingVisibleChange} />\r\n      </div>\r\n\r\n      <div className=\"setting-container\">\r\n        <div className=\"setting-label\">\r\n          Store settings in sync backend\r\n          <div className=\"setting-label__description\">\r\n            Store settings and keyboard shortcuts in a .org-web-config.json file in your sync\r\n            backend to sync betweeen multiple devices.\r\n          </div>\r\n        </div>\r\n        <Switch\r\n          isEnabled={shouldStoreSettingsInSyncBackend}\r\n          onToggle={handleShouldStoreSettingsInSyncBackendChange}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"setting-container setting-container--vertical\">\r\n        <div className=\"setting-label\">Default DEADLINE warning period</div>\r\n\r\n        <div className=\"default-deadline-warning-container\">\r\n          <input\r\n            type=\"number\"\r\n            min=\"0\"\r\n            className=\"textfield default-deadline-value-textfield\"\r\n            value={agendaDefaultDeadlineDelayValue}\r\n            onChange={handleAgendaDefaultDeadlineDelayValueChange}\r\n          />\r\n\r\n          <TabButtons\r\n            buttons={'hdwmy'.split('')}\r\n            selectedButton={agendaDefaultDeadlineDelayUnit}\r\n            onSelect={handleAgendaDefaultDeadlineDelayUnitChange}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"settings-buttons-container\">\r\n        <button className=\"btn settings-btn\" onClick={handleCaptureTemplatesClick}>\r\n          Capture templates\r\n        </button>\r\n        <button className=\"btn settings-btn\" onClick={handleKeyboardShortcutsClick}>\r\n          Keyboard shortcuts\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\" onClick={handleChangelogClick}>\r\n          Changelog\r\n          {hasUnseenChangelog && (\r\n            <div className=\"changelog-badge-container\">\r\n              <i className=\"fas fa-gift\" />\r\n            </div>\r\n          )}\r\n        </button>\r\n        <button className=\"btn settings-btn\" onClick={handleHelpClick}>\r\n          Help\r\n        </button>\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"https://github.com/DanielDe/org-web\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Github repo <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"http://eepurl.com/dK5F9w\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Mailing list <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <div className=\"settings-button-help-text\">\r\n          Sign up for the mailing list if you're interested in getting occasional ({'<'}1 per week)\r\n          updates on org-web. Or take a look at some{' '}\r\n          <a\r\n            href=\"https://us19.campaign-archive.com/home/?u=36b9d8082ddb55e6cc7e22339&id=f427625e31\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            past emails\r\n          </a>{' '}\r\n          before you sign up. You can unsubscribe at any time!\r\n        </div>\r\n\r\n        <button className=\"btn settings-btn\">\r\n          <a\r\n            href=\"https://twitter.com/org_web_org\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            style={{ color: 'white' }}\r\n          >\r\n            Twitter <i className=\"fas fa-external-link-alt fa-sm\" />\r\n          </a>\r\n        </button>\r\n\r\n        <hr className=\"settings-button-separator\" />\r\n\r\n        <button className=\"btn settings-btn\" onClick={handleSignOutClick}>\r\n          Sign out\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    fontSize: state.base.get('fontSize') || 'Regular',\r\n    bulletStyle: state.base.get('bulletStyle') || 'Classic',\r\n    shouldTapTodoToAdvance: state.base.get('shouldTapTodoToAdvance'),\r\n    agendaDefaultDeadlineDelayValue: state.base.get('agendaDefaultDeadlineDelayValue') || 5,\r\n    agendaDefaultDeadlineDelayUnit: state.base.get('agendaDefaultDeadlineDelayUnit') || 'd',\r\n    shouldStoreSettingsInSyncBackend: state.base.get('shouldStoreSettingsInSyncBackend'),\r\n    shouldLiveSync: state.base.get('shouldLiveSync'),\r\n    shouldSyncOnBecomingVisibile: state.base.get('shouldSyncOnBecomingVisibile'),\r\n    hasUnseenChangelog: state.base.get('hasUnseenChangelog'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(Settings)\r\n);\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nexport default class ShortcutRow extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleRebindClick', 'handleKeyPress']);\r\n\r\n    this.state = {\r\n      isEditMode: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.rebindArea.addEventListener('blur', () => this.setState({ isEditMode: false }));\r\n  }\r\n\r\n  handleRebindClick() {\r\n    this.setState({ isEditMode: true });\r\n    document.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress(event) {\r\n    this.setState({ isEditMode: false });\r\n    document.removeEventListener('keypress', this.handleKeyPress);\r\n\r\n    let key = null;\r\n    if (event.code.startsWith('Key')) {\r\n      key = event.code.substr(3).toLowerCase();\r\n    } else if (event.code.startsWith('Digit')) {\r\n      key = event.code.substr(5);\r\n    } else {\r\n      key = {\r\n        Minus: '-',\r\n        Equal: '=',\r\n        Backspace: 'backspace',\r\n        Enter: 'enter',\r\n        Return: 'return',\r\n        Tab: 'tab',\r\n        BracketLeft: '[',\r\n        BracketRight: ']',\r\n        Semicolon: ';',\r\n        Quote: '\"',\r\n        Backslash: '\\\\',\r\n        Comma: ',',\r\n        Period: '.',\r\n        Slash: '/',\r\n      }[event.code];\r\n    }\r\n\r\n    if (!key) {\r\n      return;\r\n    }\r\n\r\n    const modifiers = [\r\n      ['ctrlKey', 'ctrl'],\r\n      ['altKey', 'alt'],\r\n      ['metaKey', 'meta'],\r\n      ['shiftKey', 'shift'],\r\n    ];\r\n\r\n    const newModifiers = modifiers\r\n      .filter(([modifier, _]) => event[modifier])\r\n      .map(([_, symbol]) => symbol)\r\n      .join('+');\r\n    const newBinding = `${newModifiers}${!!newModifiers ? '+' : ''}${key}`;\r\n\r\n    this.props.onBindingChange(this.props.name, newBinding);\r\n  }\r\n\r\n  symbolizeKeybinding(binding) {\r\n    if (!binding) {\r\n      return '';\r\n    }\r\n\r\n    const replacements = [\r\n      ['ctrl', '^'],\r\n      ['alt', '⌥'],\r\n      ['option', '⌥'],\r\n      ['command', '⌘'],\r\n      ['meta', '⌘'],\r\n      ['shift', '⇧'],\r\n      ['backspace', '⌫'],\r\n      ['return', '⏎'],\r\n      ['enter', '⏎'],\r\n      ['left', '←'],\r\n      ['right', '→'],\r\n      ['up', '↑'],\r\n      ['down', '↓'],\r\n    ];\r\n\r\n    return replacements.reduce(\r\n      (currentBinding, [name, symbol]) => currentBinding.replace(RegExp(`${name}\\\\+?`), symbol),\r\n      binding\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { name, binding } = this.props;\r\n    const { isEditMode } = this.state;\r\n\r\n    const rebindAreaClassName = classNames('keyboard-shortcut-container__shortcut-key', {\r\n      'keyboard-shortcut-container__shortcut-key--edit-mode': isEditMode,\r\n    });\r\n\r\n    return (\r\n      <div className=\"keyboard-shortcut-container\">\r\n        <div className=\"keyboard-shortcut-container__shortcut-name\">{name}</div>\r\n        <div\r\n          className={rebindAreaClassName}\r\n          onClick={this.handleRebindClick}\r\n          tabIndex=\"-1\"\r\n          ref={div => (this.rebindArea = div)}\r\n        >\r\n          {isEditMode ? '...' : this.symbolizeKeybinding(binding)}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport { Map } from 'immutable';\r\n\r\nimport ShortcutRow from './components/ShortcutRow';\r\n\r\nimport * as baseActions from '../../actions/base';\r\n\r\nimport { calculateNamedKeybindings } from '../../lib/keybindings';\r\n\r\nimport './stylesheet.css';\r\n\r\nconst KeyboardShortcutsEditor = ({ customKeybindings, base }) => {\r\n  const handleBindingChange = (bindingName, newBinding) => {\r\n    const alreadyInUseBinding = calculateNamedKeybindings(customKeybindings).filter(\r\n      ([_, binding]) => binding === newBinding\r\n    )[0];\r\n\r\n    if (!!alreadyInUseBinding) {\r\n      alert(`That binding is already in use for \"${alreadyInUseBinding[0]}\"`);\r\n      return;\r\n    }\r\n\r\n    base.setCustomKeybinding(bindingName, newBinding);\r\n  };\r\n\r\n  return (\r\n    <div className=\"keyboard-shortcuts-editor-container\">\r\n      {calculateNamedKeybindings(customKeybindings).map(([name, binding]) => (\r\n        <ShortcutRow\r\n          key={name}\r\n          name={name}\r\n          binding={binding}\r\n          onBindingChange={handleBindingChange}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    customKeybindings: state.base.get('customKeybindings') || Map(),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(KeyboardShortcutsEditor)\r\n);\r\n","import React, { Fragment, useState } from 'react';\r\nimport { UnmountClosed as Collapse } from 'react-collapse';\r\n\r\nimport { Draggable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport ActionButton from '../../../OrgFile/components/ActionDrawer/components/ActionButton';\r\nimport Switch from '../../../UI/Switch/';\r\n\r\nimport classNames from 'classnames';\r\n\r\nexport default ({\r\n  template,\r\n  index,\r\n  onFieldPathUpdate,\r\n  onAddNewTemplateOrgFileAvailability,\r\n  onRemoveTemplateOrgFileAvailability,\r\n  onAddNewTemplateHeaderPath,\r\n  onRemoveTemplateHeaderPath,\r\n  onDeleteTemplate,\r\n  syncBackendType,\r\n}) => {\r\n  const [isCollapsed, setIsCollapsed] = useState(!!template.get('description'));\r\n  const handleHeaderBarClick = () => setIsCollapsed(!isCollapsed);\r\n\r\n  const updateField = fieldName => event =>\r\n    onFieldPathUpdate(template.get('id'), [fieldName], event.target.value);\r\n\r\n  const toggleAvailabilityInAllOrgFiles = () =>\r\n    onFieldPathUpdate(\r\n      template.get('id'),\r\n      ['isAvailableInAllOrgFiles'],\r\n      !template.get('isAvailableInAllOrgFiles')\r\n    );\r\n\r\n  const togglePrepend = () =>\r\n    onFieldPathUpdate(template.get('id'), ['shouldPrepend'], !template.get('shouldPrepend'));\r\n\r\n  const handleAddNewOrgFileAvailability = () => {\r\n    onAddNewTemplateOrgFileAvailability(template.get('id'));\r\n  };\r\n\r\n  const handleRemoveOrgFileAvailability = index => () =>\r\n    onRemoveTemplateOrgFileAvailability(template.get('id'), index);\r\n\r\n  const handleOrgFileAvailabilityChange = orgFileAvailabilityIndex => event =>\r\n    onFieldPathUpdate(\r\n      template.get('id'),\r\n      ['orgFilesWhereAvailable', orgFileAvailabilityIndex],\r\n      event.target.value\r\n    );\r\n\r\n  const handleAddNewHeaderPath = () => onAddNewTemplateHeaderPath(template.get('id'));\r\n\r\n  const handleRemoveHeaderPath = headerPathIndex => () =>\r\n    onRemoveTemplateHeaderPath(template.get('id'), headerPathIndex);\r\n\r\n  const handleHeaderPathChange = headerPathIndex => event =>\r\n    onFieldPathUpdate(template.get('id'), ['headerPaths', headerPathIndex], event.target.value);\r\n\r\n  const handleDeleteClick = () => {\r\n    if (\r\n      window.confirm(\r\n        `Are you sure you want to delete the \"${template.get('description')}\" template?`\r\n      )\r\n    ) {\r\n      onDeleteTemplate(template.get('id'));\r\n    }\r\n  };\r\n\r\n  const renderDescriptionField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Description:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield\"\r\n          value={template.get('description', '')}\r\n          onChange={updateField('description')}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderIconField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Letter:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield capture-template__letter-textfield\"\r\n          maxLength=\"1\"\r\n          value={template.get('letter', '')}\r\n          onChange={updateField('letter')}\r\n          autoCapitalize=\"none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__field__or-container\">\r\n        <div className=\"capture-template__field__or-line\" />\r\n        <div className=\"capture-template__field__or\">or</div>\r\n        <div className=\"capture-template__field__or-line\" />\r\n      </div>\r\n\r\n      <div className=\"capture-template__field\">\r\n        <div>Icon name:</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"textfield\"\r\n          value={template.get('iconName')}\r\n          onChange={updateField('iconName')}\r\n          autoCapitalize=\"none\"\r\n          autoCorrect=\"none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        Instead of a letter, you can specify the name of any free Font Awesome icon (like lemon or\r\n        calendar-plus) to use as the capture icon. You can search the available icons{' '}\r\n        <a\r\n          href=\"https://fontawesome.com/icons?d=gallery&s=solid&m=free\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          here\r\n        </a>\r\n        .\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderOrgFileAvailability = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Available in all org files?</div>\r\n        <Switch\r\n          isEnabled={template.get('isAvailableInAllOrgFiles')}\r\n          onToggle={toggleAvailabilityInAllOrgFiles}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        You can make this capture template available in all org files, or just the ones you specify.\r\n        {syncBackendType === 'Dropbox' && (\r\n          <Fragment>\r\n            {' '}\r\n            Specify full paths starting from the root of your Dropbox, like{' '}\r\n            <code>/org/todo.org</code>\r\n          </Fragment>\r\n        )}\r\n        {syncBackendType === 'Google Drive' && (\r\n          <Fragment>\r\n            {' '}\r\n            Specify the file id of each file. You can find the file id in the URL of the file in\r\n            org-web (e.g.,{' '}\r\n            <code>\r\n              /file/\r\n              {'<file id>'}\r\n            </code>\r\n            ).\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n\r\n      <Collapse\r\n        isOpened={!template.get('isAvailableInAllOrgFiles')}\r\n        springConfig={{ stiffness: 300 }}\r\n      >\r\n        <div className=\"multi-textfields-container\">\r\n          {template.get('orgFilesWhereAvailable').map((orgFilePath, index) => (\r\n            <div key={`org-file-availability-${index}`} className=\"multi-textfield-container\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"e.g., /org/todo.org\"\r\n                className=\"textfield multi-textfield-field\"\r\n                value={orgFilePath}\r\n                onChange={handleOrgFileAvailabilityChange(index)}\r\n              />\r\n              <button\r\n                className=\"fas fa-times fa-lg remove-multi-textfield-button\"\r\n                onClick={handleRemoveOrgFileAvailability(index)}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"add-new-multi-textfield-button-container\">\r\n          <button\r\n            className=\"fas fa-plus add-new-multi-textfield-button\"\r\n            onClick={handleAddNewOrgFileAvailability}\r\n          />\r\n        </div>\r\n      </Collapse>\r\n    </div>\r\n  );\r\n\r\n  const renderHeaderPaths = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\" style={{ marginTop: 7 }}>\r\n        <div>Header path</div>\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        Specify the path to the header under which the new header should be filed. One header per\r\n        textfield.\r\n      </div>\r\n\r\n      <div className=\"multi-textfields-container\">\r\n        {template.get('headerPaths').map((headerPath, index) => (\r\n          <div key={`header-path-${index}`} className=\"multi-textfield-container\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"e.g., Todos\"\r\n              className=\"textfield multi-textfield-field\"\r\n              value={headerPath}\r\n              onChange={handleHeaderPathChange(index)}\r\n            />\r\n            <button\r\n              className=\"fas fa-times fa-lg remove-multi-textfield-button\"\r\n              onClick={handleRemoveHeaderPath(index)}\r\n            />\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"add-new-multi-textfield-button-container\">\r\n        <button\r\n          className=\"fas fa-plus add-new-multi-textfield-button\"\r\n          onClick={handleAddNewHeaderPath}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderPrependField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\">\r\n        <div>Prepend?</div>\r\n        <Switch isEnabled={template.get('shouldPrepend')} onToggle={togglePrepend} />\r\n      </div>\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        By default, new captured headers are appended to the specified header path. Enable this\r\n        setting to prepend them instead.\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderTemplateField = template => (\r\n    <div className=\"capture-template__field-container\">\r\n      <div className=\"capture-template__field\" style={{ marginTop: 7 }}>\r\n        <div>Template</div>\r\n      </div>\r\n\r\n      <textarea\r\n        className=\"textarea template-textarea\"\r\n        rows=\"3\"\r\n        value={template.get('template')}\r\n        onChange={updateField('template')}\r\n      />\r\n\r\n      <div className=\"capture-template__help-text\">\r\n        The template for creating the capture item. You can use the following template variables\r\n        that will be expanded upon capture:\r\n        <ul>\r\n          <li>\r\n            <code>%?</code> - Place the cursor here.\r\n          </li>\r\n          <li>\r\n            <code>%t</code> - Timestamp, date only.\r\n          </li>\r\n          <li>\r\n            <code>%T</code> - Timestamp, with date and time.\r\n          </li>\r\n          <li>\r\n            <code>%u</code> - Inactive timestamp, date only.\r\n          </li>\r\n          <li>\r\n            <code>%U</code> - Inactive timestamp, with date and time.\r\n          </li>\r\n          <li>\r\n            <code>%{'<custom variable>'}</code> - A custom variable from a URL param capture. See{' '}\r\n            <a href=\"https://github.com/DanielDe/org-web/#capture-params-and-siri-support\">\r\n              the README file\r\n            </a>{' '}\r\n            for more details.\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderDeleteButton = template => (\r\n    <div className=\"capture-template__field-container capture-template__delete-button-container\">\r\n      <button\r\n        className=\"btn settings-btn capture-template__delete-button\"\r\n        onClick={handleDeleteClick}\r\n      >\r\n        Delete template\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const caretClassName = classNames(\r\n    'fas fa-2x fa-caret-right capture-template-container__header__caret',\r\n    {\r\n      'capture-template-container__header__caret--rotated': !isCollapsed,\r\n    }\r\n  );\r\n\r\n  return (\r\n    <Draggable draggableId={`capture-template--${template.get('id')}`} index={index}>\r\n      {(provided, snapshot) => (\r\n        <div\r\n          className={classNames('capture-template-container', {\r\n            'capture-template-container--dragging': snapshot.isDragging,\r\n          })}\r\n          ref={provided.innerRef}\r\n          {...provided.draggableProps}\r\n        >\r\n          <div className=\"capture-template-container__header\" onClick={handleHeaderBarClick}>\r\n            <i className={caretClassName} />\r\n            <ActionButton\r\n              iconName={template.get('iconName')}\r\n              letter={template.get('letter')}\r\n              onClick={() => {}}\r\n              style={{ marginRight: 20 }}\r\n            />\r\n            <span className=\"capture-template-container__header__title\">\r\n              {template.get('description')}\r\n            </span>\r\n            <i\r\n              className=\"fas fa-bars fa-lg capture-template-container__header__drag-handle\"\r\n              {...provided.dragHandleProps}\r\n            />\r\n          </div>\r\n\r\n          <Collapse isOpened={!isCollapsed} springConfig={{ stiffness: 300 }}>\r\n            <div className=\"capture-template-container__content\">\r\n              {renderDescriptionField(template)}\r\n              {renderIconField(template)}\r\n              {renderOrgFileAvailability(template)}\r\n              {renderHeaderPaths(template)}\r\n              {renderPrependField(template)}\r\n              {renderTemplateField(template)}\r\n              {renderDeleteButton(template)}\r\n            </div>\r\n          </Collapse>\r\n        </div>\r\n      )}\r\n    </Draggable>\r\n  );\r\n};\r\n","import React, { Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Droppable } from 'react-beautiful-dnd';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport * as captureActions from '../../actions/capture';\r\n\r\nimport CaptureTemplate from './components/CaptureTemplate';\r\n\r\nimport { List } from 'immutable';\r\n\r\nconst CaptureTemplatesEditor = ({ captureTemplates, syncBackendType, capture }) => {\r\n  const handleAddNewTemplateClick = () => capture.addNewEmptyCaptureTemplate();\r\n\r\n  const handleFieldPathUpdate = (templateId, fieldPath, newValue) =>\r\n    capture.updateTemplateFieldPathValue(templateId, fieldPath, newValue);\r\n\r\n  const handleAddNewTemplateOrgFileAvailability = templateId =>\r\n    capture.addNewTemplateOrgFileAvailability(templateId);\r\n\r\n  const handleRemoveTemplateOrgFileAvailability = (templateId, orgFileAvailabilityIndex) =>\r\n    capture.removeTemplateOrgFileAvailability(templateId, orgFileAvailabilityIndex);\r\n\r\n  const handleAddNewTemplateHeaderPath = templateId => capture.addNewTemplateHeaderPath(templateId);\r\n\r\n  const handleRemoveTemplateHeaderPath = (templateId, headerPathIndex) =>\r\n    capture.removeTemplateHeaderPath(templateId, headerPathIndex);\r\n\r\n  const handleDeleteTemplate = templateId => capture.deleteTemplate(templateId);\r\n\r\n  const handleReorderTemplate = (fromIndex, toIndex) =>\r\n    capture.reorderCaptureTemplate(fromIndex, toIndex);\r\n\r\n  return (\r\n    <div>\r\n      <Droppable droppableId=\"capture-templates-editor-droppable\" type=\"CAPTURE-TEMPLATE\">\r\n        {(provided, snapshot) => (\r\n          <div\r\n            className=\"capture-templates-container\"\r\n            ref={provided.innerRef}\r\n            {...provided.droppableProps}\r\n          >\r\n            {captureTemplates.size === 0 ? (\r\n              <div className=\"no-capture-templates-message\">\r\n                You don't currently have any capture templates - add one by pressing the{' '}\r\n                <i className=\"fas fa-plus\" /> button.\r\n                <br />\r\n                <br />\r\n                Capture templates show up in the action drawer and give you quick access to creating\r\n                new headers (like org-capture).\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                {captureTemplates.map((template, index) => (\r\n                  <CaptureTemplate\r\n                    key={template.get('id')}\r\n                    index={index}\r\n                    template={template}\r\n                    syncBackendType={syncBackendType}\r\n                    onFieldPathUpdate={handleFieldPathUpdate}\r\n                    onAddNewTemplateOrgFileAvailability={handleAddNewTemplateOrgFileAvailability}\r\n                    onRemoveTemplateOrgFileAvailability={handleRemoveTemplateOrgFileAvailability}\r\n                    onAddNewTemplateHeaderPath={handleAddNewTemplateHeaderPath}\r\n                    onRemoveTemplateHeaderPath={handleRemoveTemplateHeaderPath}\r\n                    onDeleteTemplate={handleDeleteTemplate}\r\n                    onReorder={handleReorderTemplate}\r\n                  />\r\n                ))}\r\n\r\n                {provided.placeholder}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Droppable>\r\n\r\n      <div className=\"new-capture-template-button-container\">\r\n        <button className=\"fas fa-plus fa-lg btn btn--circle\" onClick={handleAddNewTemplateClick} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    captureTemplates: state.capture.get('captureTemplates', new List()),\r\n    syncBackendType: state.syncBackend.get('client').type,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    capture: bindActionCreators(captureActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(CaptureTemplatesEditor);\r\n","/* global process, gapi, google */\r\n\r\nimport React, { PureComponent } from 'react';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport DropboxLogo from './dropbox.svg';\r\nimport GoogleDriveLogo from './google_drive.png';\r\n\r\nimport { persistField } from '../../util/settings_persister';\r\n\r\nimport { Dropbox } from 'dropbox';\r\n\r\nimport _ from 'lodash';\r\n\r\nexport default class SyncServiceSignIn extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['handleDropboxClick', 'handleGoogleDriveClick']);\r\n  }\r\n\r\n  handleDropboxClick() {\r\n    persistField('authenticatedSyncService', 'Dropbox');\r\n\r\n    const dropbox = new Dropbox({ clientId: process.env.REACT_APP_DROPBOX_CLIENT_ID, fetch });\r\n    const authURL = dropbox.getAuthenticationUrl(window.location.origin + process.env.PUBLIC_URL + '/');\r\n    window.location = authURL;\r\n  }\r\n\r\n  handleGoogleDriveClick() {\r\n    try {\r\n      gapi.load('client', () => {\r\n        window.gapi.client\r\n          .init({\r\n            apiKey: process.env.REACT_APP_GOOGLE_DRIVE_API_KEY,\r\n            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\r\n          })\r\n          .then(async () => {\r\n            const tokenClient = google.accounts.oauth2.initTokenClient({\r\n              client_id: process.env.REACT_APP_GOOGLE_DRIVE_CLIENT_ID,\r\n              scope: 'https://www.googleapis.com/auth/drive.file',\r\n              callback: (accessToken) => {\r\n                persistField('authenticatedSyncService', 'Google Drive');\r\n                persistField('googleDriveAccessToken', JSON.stringify(accessToken));\r\n                window.location.reload();\r\n              },\r\n            });\r\n            tokenClient.requestAccessToken({ prompt: 'consent' });\r\n          });\r\n      });\r\n    } catch (error) {\r\n      alert(\r\n        `The Google Drive API client isn't available - you might be blocking it with an ad blocker`\r\n      );\r\n      return;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"sync-service-sign-in-container\">\r\n        <p className=\"sync-service-sign-in__help-text\">\r\n          org-web syncs your files with Dropbox or Google Drive. Choose your preferred sync backend\r\n          below to sign in.\r\n        </p>\r\n\r\n        <div className=\"sync-service-container\" onClick={this.handleDropboxClick}>\r\n          <img src={DropboxLogo} alt=\"Dropbox logo\" className=\"dropbox-logo\" />\r\n        </div>\r\n\r\n        <div className=\"sync-service-container\" onClick={this.handleGoogleDriveClick}>\r\n          <img src={GoogleDriveLogo} alt=\"Google Drive logo\" className=\"google-drive-logo\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nimport { Route, Switch, Redirect, Prompt, withRouter } from 'react-router-dom';\r\n\r\nimport './stylesheet.css';\r\n\r\nimport { List } from 'immutable';\r\nimport _ from 'lodash';\r\nimport classNames from 'classnames';\r\n\r\nimport { parseOrg } from '../../lib/parse_org';\r\n\r\nimport raw from 'raw.macro';\r\n\r\nimport PrivacyPolicy from '../PrivacyPolicy';\r\nimport HeaderBar from '../HeaderBar';\r\nimport Landing from '../Landing';\r\nimport FileBrowser from '../FileBrowser';\r\nimport LoadingIndicator from '../LoadingIndicator';\r\nimport OrgFile from '../OrgFile';\r\nimport Settings from '../Settings';\r\nimport KeyboardShortcutsEditor from '../KeyboardShortcutsEditor';\r\nimport CaptureTemplatesEditor from '../CaptureTemplatesEditor';\r\nimport SyncServiceSignIn from '../SyncServiceSignIn';\r\n\r\nimport * as syncBackendActions from '../../actions/sync_backend';\r\nimport * as orgActions from '../../actions/org';\r\nimport * as baseActions from '../../actions/base';\r\n\r\nclass Entry extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    _.bindAll(this, ['renderChangelogFile', 'renderSampleFile', 'renderFileBrowser', 'renderFile']);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { lastSeenChangelogHeader, isAuthenticated } = this.props;\r\n\r\n    const changelogFile = parseOrg(raw('../../../changelog.org'));\r\n    const firstHeaderTitle = changelogFile.getIn(['headers', 0, 'titleLine', 'rawTitle']);\r\n    if (\r\n      isAuthenticated &&\r\n      !!lastSeenChangelogHeader &&\r\n      firstHeaderTitle !== lastSeenChangelogHeader\r\n    ) {\r\n      this.props.base.setHasUnseenChangelog(true);\r\n    }\r\n    this.props.base.setLastSeenChangelogHeader(firstHeaderTitle);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.shouldPromptWhenLeaving()\r\n      ? (window.onbeforeunload = () => true)\r\n      : (window.onbeforeunload = undefined);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.onbeforeunload = undefined;\r\n  }\r\n\r\n  renderChangelogFile() {\r\n    return (\r\n      <OrgFile\r\n        staticFile=\"changelog\"\r\n        shouldDisableDirtyIndicator={true}\r\n        shouldDisableActions={true}\r\n        shouldDisableSyncButtons={false}\r\n        parsingErrorMessage={\r\n          \"The contents of changelog.org couldn't be loaded. You probably forgot to set the environment variable - see the Development section of README.org for details!\"\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  renderSampleFile() {\r\n    return (\r\n      <OrgFile\r\n        staticFile=\"sample\"\r\n        shouldDisableDirtyIndicator={true}\r\n        shouldDisableActionDrawer={false}\r\n        shouldDisableSyncButtons={true}\r\n        parsingErrorMessage={\r\n          \"The contents of sample.org couldn't be loaded. You probably forgot to set the environment variable - see the Development section of README.org for details!\"\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  renderFileBrowser({\r\n    match: {\r\n      params: { path = '' },\r\n    },\r\n  }) {\r\n    if (!!path) {\r\n      path = '/' + path;\r\n    }\r\n\r\n    return <FileBrowser path={path} />;\r\n  }\r\n\r\n  renderFile({\r\n    match: {\r\n      params: { path },\r\n    },\r\n  }) {\r\n    if (!!path) {\r\n      path = '/' + path;\r\n    }\r\n\r\n    return (\r\n      <OrgFile\r\n        path={path}\r\n        shouldDisableDirtyIndicator={false}\r\n        shouldDisableActionDrawer={false}\r\n        shouldDisableSyncButtons={false}\r\n      />\r\n    );\r\n  }\r\n\r\n  shouldPromptWhenLeaving() {\r\n    return this.props.location.pathname.startsWith('/file/') && this.props.isDirty;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isAuthenticated,\r\n      loadingMessage,\r\n      fontSize,\r\n      activeModalPage,\r\n      pendingCapture,\r\n      location: { pathname },\r\n    } = this.props;\r\n\r\n    const pendingCapturePath = !!pendingCapture && `/file${pendingCapture.get('capturePath')}`;\r\n    const shouldRedirectToCapturePath = pendingCapturePath && pendingCapturePath !== pathname;\r\n\r\n    const className = classNames('entry-container', {\r\n      'entry-container--large-font': fontSize === 'Large',\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        <HeaderBar />\r\n\r\n        <LoadingIndicator message={loadingMessage} />\r\n\r\n        <Prompt\r\n          when={this.shouldPromptWhenLeaving()}\r\n          message={() => 'You have unpushed changes - are you sure you want to leave this page?'}\r\n        />\r\n\r\n        {activeModalPage === 'changelog' ? (\r\n          this.renderChangelogFile()\r\n        ) : isAuthenticated ? (\r\n          ['keyboard_shortcuts_editor', 'settings', 'capture_templates_editor', 'sample'].includes(\r\n            activeModalPage\r\n          ) ? (\r\n            <Fragment>\r\n              {activeModalPage === 'settings' && <Settings />}\r\n              {activeModalPage === 'keyboard_shortcuts_editor' && <KeyboardShortcutsEditor />}\r\n              {activeModalPage === 'capture_templates_editor' && <CaptureTemplatesEditor />}\r\n              {activeModalPage === 'sample' && this.renderSampleFile()}\r\n            </Fragment>\r\n          ) : (\r\n            <Switch>\r\n              {shouldRedirectToCapturePath && <Redirect to={pendingCapturePath} />}\r\n              <Route path=\"/privacy-policy\" exact component={PrivacyPolicy} />\r\n              <Route path=\"/file/:path+\" render={this.renderFile} />\r\n              <Route path=\"/files/:path*\" render={this.renderFileBrowser} />\r\n              <Redirect to=\"/files\" />\r\n            </Switch>\r\n          )\r\n        ) : (\r\n          <Switch>\r\n            <Route path=\"/privacy-policy\" exact component={PrivacyPolicy} />\r\n            <Route path=\"/sample\" exact={true} render={this.renderSampleFile} />\r\n            <Route path=\"/sign_in\" exact={true} component={SyncServiceSignIn} />\r\n            <Route path=\"/\" exact={true} component={Landing} />\r\n            <Redirect to=\"/\" />\r\n          </Switch>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    loadingMessage: state.base.get('loadingMessage'),\r\n    isAuthenticated: state.syncBackend.get('isAuthenticated'),\r\n    fontSize: state.base.get('fontSize'),\r\n    lastSeenChangelogHeader: state.base.get('lastSeenChangelogHeader'),\r\n    activeModalPage: state.base.get('modalPageStack', List()).last(),\r\n    pendingCapture: state.org.present.get('pendingCapture'),\r\n    isDirty: state.org.present.get('isDirty'),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    syncBackend: bindActionCreators(syncBackendActions, dispatch),\r\n    org: bindActionCreators(orgActions, dispatch),\r\n    base: bindActionCreators(baseActions, dispatch),\r\n  };\r\n};\r\n\r\nexport default withRouter(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(Entry)\r\n);\r\n","import React, { PureComponent } from 'react';\r\nimport { Provider } from 'react-redux';\r\nimport Store from './store';\r\nimport {\r\n  readInitialState,\r\n  loadSettingsFromConfigFile,\r\n  subscribeToChanges,\r\n  persistField,\r\n  getPersistedField,\r\n} from './util/settings_persister';\r\nimport runAllMigrations from './migrations';\r\nimport parseQueryString from './util/parse_query_string';\r\nimport { BrowserRouter as Router } from 'react-router-dom';\r\n\r\nimport { DragDropContext } from 'react-beautiful-dnd';\r\n\r\nimport { reorderCaptureTemplate } from './actions/capture';\r\nimport { reorderTags, reorderPropertyList } from './actions/org';\r\nimport { signOut } from './actions/sync_backend';\r\nimport { setDisappearingLoadingMessage } from './actions/base';\r\n\r\nimport createDropboxSyncBackendClient from './sync_backend_clients/dropbox_sync_backend_client';\r\nimport createGoogleDriveSyncBackendClient from './sync_backend_clients/google_drive_sync_backend_client';\r\n\r\nimport './base.css';\r\n\r\nimport Entry from './components/Entry';\r\n\r\nimport _ from 'lodash';\r\nimport { Map } from 'immutable';\r\n\r\nexport default class App extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    runAllMigrations();\r\n\r\n    const initialState = readInitialState();\r\n\r\n    window.initialHash = window.location.hash.substring(0);\r\n    const hashContents = parseQueryString(window.location.hash);\r\n    const authenticatedSyncService = getPersistedField('authenticatedSyncService', true);\r\n    let client = null;\r\n\r\n    if (!!authenticatedSyncService) {\r\n      switch (authenticatedSyncService) {\r\n        case 'Dropbox':\r\n          const dropboxAccessToken = hashContents.access_token;\r\n          if (dropboxAccessToken) {\r\n            client = createDropboxSyncBackendClient(dropboxAccessToken);\r\n            initialState.syncBackend = Map({\r\n              isAuthenticated: true,\r\n              client,\r\n            });\r\n            persistField('dropboxAccessToken', dropboxAccessToken);\r\n            window.location.hash = '';\r\n          } else {\r\n            const persistedDropboxAccessToken = getPersistedField('dropboxAccessToken', true);\r\n            if (!!persistedDropboxAccessToken) {\r\n              client = createDropboxSyncBackendClient(persistedDropboxAccessToken);\r\n              initialState.syncBackend = Map({\r\n                isAuthenticated: true,\r\n                client,\r\n              });\r\n            }\r\n          }\r\n          break;\r\n        case 'Google Drive':\r\n          client = createGoogleDriveSyncBackendClient();\r\n          initialState.syncBackend = Map({\r\n            isAuthenticated: true,\r\n            client,\r\n          });\r\n          break;\r\n        default:\r\n      }\r\n    }\r\n\r\n    const queryStringContents = parseQueryString(window.location.search);\r\n    const { captureFile, captureTemplateName, captureContent } = queryStringContents;\r\n    if (!!captureFile && !!captureTemplateName) {\r\n      const capturePath = captureFile.startsWith('/') ? captureFile : `/${captureFile}`;\r\n      const customCaptureVariables = Map(\r\n        Object.entries(queryStringContents)\r\n          .map(([key, value]) => {\r\n            const CUSTOM_VARIABLE_PREFIX = 'captureVariable_';\r\n            if (key.startsWith(CUSTOM_VARIABLE_PREFIX)) {\r\n              return [key.substring(CUSTOM_VARIABLE_PREFIX.length), value];\r\n            }\r\n\r\n            return null;\r\n          })\r\n          .filter(item => !!item)\r\n      );\r\n      initialState.org.present = initialState.org.present.set(\r\n        'pendingCapture',\r\n        Map({\r\n          capturePath,\r\n          captureTemplateName,\r\n          captureContent,\r\n          customCaptureVariables,\r\n        })\r\n      );\r\n    }\r\n\r\n    this.store = Store(initialState);\r\n    this.store.subscribe(subscribeToChanges(this.store));\r\n\r\n    if (!!client) {\r\n      client.isSignedIn().then(isSignedIn => {\r\n        if (isSignedIn) {\r\n          loadSettingsFromConfigFile(this.store.dispatch, this.store.getState);\r\n        } else {\r\n          this.store.dispatch(signOut());\r\n        }\r\n      });\r\n    } else {\r\n      if (!!this.store.getState().org.present.get('pendingCapture')) {\r\n        this.store.dispatch(\r\n          setDisappearingLoadingMessage(\r\n            `You need to sign in before you can use capture templates`,\r\n            5000\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n    _.bindAll(this, ['handleDragEnd']);\r\n  }\r\n\r\n  handleDragEnd(result) {\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n\r\n    if (result.type === 'CAPTURE-TEMPLATE') {\r\n      this.store.dispatch(reorderCaptureTemplate(result.source.index, result.destination.index));\r\n    } else if (result.type === 'TAG') {\r\n      this.store.dispatch(reorderTags(result.source.index, result.destination.index));\r\n    } else if (result.type === 'PROPERTY-LIST') {\r\n      this.store.dispatch(reorderPropertyList(result.source.index, result.destination.index));\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <DragDropContext onDragEnd={this.handleDragEnd}>\r\n        <Router basename={process.env.PUBLIC_URL}>\r\n          <Provider store={this.store}>\r\n            <div className=\"App\">\r\n              <Entry />\r\n            </div>\r\n          </Provider>\r\n        </Router>\r\n      </DragDropContext>\r\n    );\r\n  }\r\n}\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}